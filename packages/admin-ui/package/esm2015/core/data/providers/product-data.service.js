import { pick } from '@vendure/common/lib/pick';
import { SortOrder, } from '../../common/generated-types';
import { ADD_OPTION_GROUP_TO_PRODUCT, ADD_OPTION_TO_GROUP, ASSIGN_PRODUCTS_TO_CHANNEL, ASSIGN_VARIANTS_TO_CHANNEL, CREATE_ASSETS, CREATE_PRODUCT, CREATE_PRODUCT_OPTION_GROUP, CREATE_PRODUCT_VARIANTS, CREATE_TAG, DELETE_ASSETS, DELETE_PRODUCT, DELETE_PRODUCT_OPTION, DELETE_PRODUCT_VARIANT, DELETE_PRODUCTS, DELETE_TAG, GET_ASSET, GET_ASSET_LIST, GET_PRODUCT_LIST, GET_PRODUCT_OPTION_GROUP, GET_PRODUCT_OPTION_GROUPS, GET_PRODUCT_SIMPLE, GET_PRODUCT_VARIANT, GET_PRODUCT_VARIANT_LIST, GET_PRODUCT_VARIANT_LIST_SIMPLE, GET_PRODUCT_VARIANT_OPTIONS, GET_PRODUCT_WITH_VARIANTS, GET_TAG, GET_TAG_LIST, PRODUCT_SELECTOR_SEARCH, REMOVE_OPTION_GROUP_FROM_PRODUCT, REMOVE_PRODUCTS_FROM_CHANNEL, REMOVE_VARIANTS_FROM_CHANNEL, SEARCH_PRODUCTS, UPDATE_ASSET, UPDATE_PRODUCT, UPDATE_PRODUCT_OPTION, UPDATE_PRODUCT_OPTION_GROUP, UPDATE_PRODUCT_VARIANTS, UPDATE_TAG, } from '../definitions/product-definitions';
import { GET_PENDING_SEARCH_INDEX_UPDATES, REINDEX, RUN_PENDING_SEARCH_INDEX_UPDATES, } from '../definitions/settings-definitions';
export class ProductDataService {
    constructor(baseDataService) {
        this.baseDataService = baseDataService;
    }
    searchProducts(term, take = 10, skip = 0) {
        return this.baseDataService.query(SEARCH_PRODUCTS, {
            input: {
                term,
                take,
                skip,
                groupByProduct: true,
            },
        });
    }
    productSelectorSearch(term, take) {
        return this.baseDataService.query(PRODUCT_SELECTOR_SEARCH, {
            take,
            term,
        });
    }
    reindex() {
        return this.baseDataService.mutate(REINDEX);
    }
    getPendingSearchIndexUpdates() {
        return this.baseDataService.query(GET_PENDING_SEARCH_INDEX_UPDATES);
    }
    runPendingSearchIndexUpdates() {
        return this.baseDataService.mutate(RUN_PENDING_SEARCH_INDEX_UPDATES);
    }
    getProducts(options) {
        return this.baseDataService.query(GET_PRODUCT_LIST, {
            options,
        });
    }
    getProduct(id, variantListOptions) {
        return this.baseDataService.query(GET_PRODUCT_WITH_VARIANTS, {
            id,
            variantListOptions,
        });
    }
    getProductSimple(id) {
        return this.baseDataService.query(GET_PRODUCT_SIMPLE, {
            id,
        });
    }
    getProductVariantsSimple(options, productId) {
        return this.baseDataService.query(GET_PRODUCT_VARIANT_LIST_SIMPLE, { options, productId });
    }
    getProductVariants(options, productId) {
        return this.baseDataService.query(GET_PRODUCT_VARIANT_LIST, { options, productId });
    }
    getProductVariant(id) {
        return this.baseDataService.query(GET_PRODUCT_VARIANT, { id });
    }
    getProductVariantsOptions(id) {
        return this.baseDataService.query(GET_PRODUCT_VARIANT_OPTIONS, {
            id,
        });
    }
    getProductOptionGroup(id) {
        return this.baseDataService.query(GET_PRODUCT_OPTION_GROUP, {
            id,
        });
    }
    createProduct(product) {
        const input = {
            input: pick(product, [
                'enabled',
                'translations',
                'customFields',
                'assetIds',
                'featuredAssetId',
                'facetValueIds',
            ]),
        };
        return this.baseDataService.mutate(CREATE_PRODUCT, input);
    }
    updateProduct(product) {
        const input = {
            input: pick(product, [
                'id',
                'enabled',
                'translations',
                'customFields',
                'assetIds',
                'featuredAssetId',
                'facetValueIds',
            ]),
        };
        return this.baseDataService.mutate(UPDATE_PRODUCT, input);
    }
    deleteProduct(id) {
        return this.baseDataService.mutate(DELETE_PRODUCT, {
            id,
        });
    }
    deleteProducts(ids) {
        return this.baseDataService.mutate(DELETE_PRODUCTS, {
            ids,
        });
    }
    createProductVariants(input) {
        return this.baseDataService.mutate(CREATE_PRODUCT_VARIANTS, {
            input,
        });
    }
    updateProductVariants(variants) {
        const input = {
            input: variants.map(pick([
                'id',
                'enabled',
                'translations',
                'sku',
                'price',
                'taxCategoryId',
                'facetValueIds',
                'featuredAssetId',
                'assetIds',
                'trackInventory',
                'outOfStockThreshold',
                'useGlobalOutOfStockThreshold',
                'stockOnHand',
                'customFields',
            ])),
        };
        return this.baseDataService.mutate(UPDATE_PRODUCT_VARIANTS, input);
    }
    deleteProductVariant(id) {
        return this.baseDataService.mutate(DELETE_PRODUCT_VARIANT, {
            id,
        });
    }
    createProductOptionGroups(productOptionGroup) {
        const input = {
            input: productOptionGroup,
        };
        return this.baseDataService.mutate(CREATE_PRODUCT_OPTION_GROUP, input);
    }
    addOptionGroupToProduct(variables) {
        return this.baseDataService.mutate(ADD_OPTION_GROUP_TO_PRODUCT, variables);
    }
    addOptionToGroup(input) {
        return this.baseDataService.mutate(ADD_OPTION_TO_GROUP, { input });
    }
    deleteProductOption(id) {
        return this.baseDataService.mutate(DELETE_PRODUCT_OPTION, { id });
    }
    removeOptionGroupFromProduct(variables) {
        return this.baseDataService.mutate(REMOVE_OPTION_GROUP_FROM_PRODUCT, variables);
    }
    updateProductOption(input) {
        return this.baseDataService.mutate(UPDATE_PRODUCT_OPTION, {
            input: pick(input, ['id', 'code', 'translations', 'customFields']),
        });
    }
    updateProductOptionGroup(input) {
        return this.baseDataService.mutate(UPDATE_PRODUCT_OPTION_GROUP, {
            input: pick(input, ['id', 'code', 'translations', 'customFields']),
        });
    }
    getProductOptionGroups(filterTerm) {
        return this.baseDataService.query(GET_PRODUCT_OPTION_GROUPS, {
            filterTerm,
        });
    }
    getAssetList(take = 10, skip = 0) {
        return this.baseDataService.query(GET_ASSET_LIST, {
            options: {
                skip,
                take,
                sort: {
                    createdAt: SortOrder.DESC,
                },
            },
        });
    }
    getAsset(id) {
        return this.baseDataService.query(GET_ASSET, {
            id,
        });
    }
    createAssets(files) {
        return this.baseDataService.mutate(CREATE_ASSETS, {
            input: files.map(file => ({ file })),
        });
    }
    updateAsset(input) {
        return this.baseDataService.mutate(UPDATE_ASSET, {
            input,
        });
    }
    deleteAssets(ids, force) {
        return this.baseDataService.mutate(DELETE_ASSETS, {
            input: {
                assetIds: ids,
                force,
            },
        });
    }
    assignProductsToChannel(input) {
        return this.baseDataService.mutate(ASSIGN_PRODUCTS_TO_CHANNEL, {
            input,
        });
    }
    removeProductsFromChannel(input) {
        return this.baseDataService.mutate(REMOVE_PRODUCTS_FROM_CHANNEL, {
            input,
        });
    }
    assignVariantsToChannel(input) {
        return this.baseDataService.mutate(ASSIGN_VARIANTS_TO_CHANNEL, {
            input,
        });
    }
    removeVariantsFromChannel(input) {
        return this.baseDataService.mutate(REMOVE_VARIANTS_FROM_CHANNEL, {
            input,
        });
    }
    getTag(id) {
        return this.baseDataService.query(GET_TAG, { id });
    }
    getTagList(options) {
        return this.baseDataService.query(GET_TAG_LIST, { options });
    }
    createTag(input) {
        return this.baseDataService.mutate(CREATE_TAG, { input });
    }
    updateTag(input) {
        return this.baseDataService.mutate(UPDATE_TAG, { input });
    }
    deleteTag(id) {
        return this.baseDataService.mutate(DELETE_TAG, { id });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvcmUvc3JjL2RhdGEvcHJvdmlkZXJzL3Byb2R1Y3QtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUVoRCxPQUFPLEVBZ0RILFNBQVMsR0FjWixNQUFNLDhCQUE4QixDQUFDO0FBQ3RDLE9BQU8sRUFDSCwyQkFBMkIsRUFDM0IsbUJBQW1CLEVBQ25CLDBCQUEwQixFQUMxQiwwQkFBMEIsRUFDMUIsYUFBYSxFQUNiLGNBQWMsRUFDZCwyQkFBMkIsRUFDM0IsdUJBQXVCLEVBQ3ZCLFVBQVUsRUFDVixhQUFhLEVBQ2IsY0FBYyxFQUNkLHFCQUFxQixFQUNyQixzQkFBc0IsRUFDdEIsZUFBZSxFQUNmLFVBQVUsRUFDVixTQUFTLEVBQ1QsY0FBYyxFQUNkLGdCQUFnQixFQUNoQix3QkFBd0IsRUFDeEIseUJBQXlCLEVBQ3pCLGtCQUFrQixFQUNsQixtQkFBbUIsRUFDbkIsd0JBQXdCLEVBQ3hCLCtCQUErQixFQUMvQiwyQkFBMkIsRUFDM0IseUJBQXlCLEVBQ3pCLE9BQU8sRUFDUCxZQUFZLEVBQ1osdUJBQXVCLEVBQ3ZCLGdDQUFnQyxFQUNoQyw0QkFBNEIsRUFDNUIsNEJBQTRCLEVBQzVCLGVBQWUsRUFDZixZQUFZLEVBQ1osY0FBYyxFQUNkLHFCQUFxQixFQUNyQiwyQkFBMkIsRUFDM0IsdUJBQXVCLEVBQ3ZCLFVBQVUsR0FDYixNQUFNLG9DQUFvQyxDQUFDO0FBQzVDLE9BQU8sRUFDSCxnQ0FBZ0MsRUFDaEMsT0FBTyxFQUNQLGdDQUFnQyxHQUNuQyxNQUFNLHFDQUFxQyxDQUFDO0FBSTdDLE1BQU0sT0FBTyxrQkFBa0I7SUFDM0IsWUFBb0IsZUFBZ0M7UUFBaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO0lBQUcsQ0FBQztJ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QUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBMEMsVUFBVSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUN2RyxDQUFDO0lBRUQsU0FBUyxDQUFDLEtBQXFCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQTBDLFVBQVUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDdkcsQ0FBQztJQUVELFNBQVMsQ0FBQyxFQUFVO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQTBDLFVBQVUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEcsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGljayB9IGZyb20gJ0B2ZW5kdXJlL2NvbW1vbi9saWIvcGljayc7XG5cbmltcG9ydCB7XG4gICAgQWRkT3B0aW9uR3JvdXBUb1Byb2R1Y3QsXG4gICAgQWRkT3B0aW9uVG9Hcm91cCxcbiAgICBBc3NpZ25Qcm9kdWN0c1RvQ2hhbm5lbCxcbiAgICBBc3NpZ25Qcm9kdWN0c1RvQ2hhbm5lbElucHV0LFxuICAgIEFzc2lnblByb2R1Y3RWYXJpYW50c1RvQ2hhbm5lbElucHV0LFxuICAgIEFzc2lnblZhcmlhbnRzVG9DaGFubmVsLFxuICAgIENyZWF0ZUFzc2V0cyxcbiAgICBDcmVhdGVQcm9kdWN0LFxuICAgIENyZWF0ZVByb2R1Y3RJbnB1dCxcbiAgICBDcmVhdGVQcm9kdWN0T3B0aW9uR3JvdXAsXG4gICAgQ3JlYXRlUHJvZHVjdE9wdGlvbkdyb3VwSW5wdXQsXG4gICAgQ3JlYXRlUHJvZHVjdE9wdGlvbklucHV0LFxuICAgIENyZWF0ZVByb2R1Y3RWYXJpYW50SW5wdXQsXG4gICAgQ3JlYXRlUHJvZHVjdFZhcmlhbnRzLFxuICAgIENyZWF0ZVRhZyxcbiAgICBDcmVhdGVUYWdJbnB1dCxcbiAgICBEZWxldGVBc3NldHMsXG4gICAgRGVsZXRlUHJvZHVjdCxcbiAgICBEZWxldGVQcm9kdWN0T3B0aW9uLFxuICAgIERlbGV0ZVByb2R1Y3RzLFxuICAgIERlbGV0ZVByb2R1Y3RWYXJpYW50LFxuICAgIERlbGV0ZVRhZyxcbiAgICBHZXRBc3NldCxcbiAgICBHZXRBc3NldExpc3QsXG4gICAgR2V0UGVuZGluZ1NlYXJjaEluZGV4VXBkYXRlcyxcbiAgICBHZXRQcm9kdWN0TGlzdCxcbiAgICBHZXRQcm9kdWN0T3B0aW9uR3JvdXAsXG4gICAgR2V0UHJvZHVjdE9wdGlvbkdyb3VwcyxcbiAgICBHZXRQcm9kdWN0U2ltcGxlLFxuICAgIEdldFByb2R1Y3RWYXJpYW50LFxuICAgIEdldFByb2R1Y3RWYXJpYW50TGlzdCxcbiAgICBHZXRQcm9kdWN0VmFyaWFudExpc3RTaW1wbGUsXG4gICAgR2V0UHJvZHVjdFZhcmlhbnRPcHRpb25zLFxuICAgIEdldFByb2R1Y3RXaXRoVmFyaWFudHMsXG4gICAgR2V0VGFnLFxuICAgIEdldFRhZ0xpc3QsXG4gICAgUHJvZHVjdExpc3RPcHRpb25zLFxuICAgIFByb2R1Y3RTZWxlY3RvclNlYXJjaCxcbiAgICBQcm9kdWN0VmFyaWFudExpc3RPcHRpb25zLFxuICAgIFJlaW5kZXgsXG4gICAgUmVtb3ZlT3B0aW9uR3JvdXBGcm9tUHJvZHVjdCxcbiAgICBSZW1vdmVQcm9kdWN0c0Zyb21DaGFubmVsLFxuICAgIFJlbW92ZVByb2R1Y3RzRnJvbUNoYW5uZWxJbnB1dCxcbiAgICBSZW1vdmVQcm9kdWN0VmFyaWFudHNGcm9tQ2hhbm5lbElucHV0LFxuICAgIFJlbW92ZVZhcmlhbnRzRnJvbUNoYW5uZWwsXG4gICAgUnVuUGVuZGluZ1NlYXJjaEluZGV4VXBkYXRlcyxcbiAgICBTZWFyY2hQcm9kdWN0cyxcbiAgICBTb3J0T3JkZXIsXG4gICAgVGFnTGlzdE9wdGlvbnMsXG4gICAgVXBkYXRlQXNzZXQsXG4gICAgVXBkYXRlQXNzZXRJbnB1dCxcbiAgICBVcGRhdGVQcm9kdWN0LFxuICAgIFVwZGF0ZVByb2R1Y3RJbnB1dCxcbiAgICBVcGRhdGVQcm9kdWN0T3B0aW9uLFxuICAgIFVwZGF0ZVByb2R1Y3RPcHRpb25Hcm91cCxcbiAgICBVcGRhdGVQcm9kdWN0T3B0aW9uR3JvdXBJbnB1dCxcbiAgICBVcGRhdGVQcm9kdWN0T3B0aW9uSW5wdXQsXG4gICAgVXBkYXRlUHJvZHVjdFZhcmlhbnRJbnB1dCxcbiAgICBVcGRhdGVQcm9kdWN0VmFyaWFudHMsXG4gICAgVXBkYXRlVGFnLFxuICAgIFVwZGF0ZVRhZ0lucHV0LFxufSBmcm9tICcuLi8uLi9jb21tb24vZ2VuZXJhdGVkLXR5cGVzJztcbmltcG9ydCB7XG4gICAgQUREX09QVElPTl9HUk9VUF9UT19QUk9EVUNULFxuICAgIEFERF9PUFRJT05fVE9fR1JPVVAsXG4gICAgQVNTSUdOX1BST0RVQ1RTX1RPX0NIQU5ORUwsXG4gICAgQVNTSUdOX1ZBUklBTlRTX1RPX0NIQU5ORUwsXG4gICAgQ1JFQVRFX0FTU0VUUyxcbiAgICBDUkVBVEVfUFJPRFVDVCxcbiAgICBDUkVBVEVfUFJPRFVDVF9PUFRJT05fR1JPVVAsXG4gICAgQ1JFQVRFX1BST0RVQ1RfVkFSSUFOVFMsXG4gICAgQ1JFQVRFX1RBRyxcbiAgICBERUxFVEVfQVNTRVRTLFxuICAgIERFTEVURV9QUk9EVUNULFxuICAgIERFTEVURV9QUk9EVUNUX09QVElPTixcbiAgICBERUxFVEVfUFJPRFVDVF9WQVJJQU5ULFxuICAgIERFTEVURV9QUk9EVUNUUyxcbiAgICBERUxFVEVfVEFHLFxuICAgIEdFVF9BU1NFVCxcbiAgICBHRVRfQVNTRVRfTElTVCxcbiAgICBHRVRfUFJPRFVDVF9MSVNULFxuICAgIEdFVF9QUk9EVUNUX09QVElPTl9HUk9VUCxcbiAgICBHRVRfUFJPRFVDVF9PUFRJT05fR1JPVVBTLFxuICAgIEdFVF9QUk9EVUNUX1NJTVBMRSxcbiAgICBHRVRfUFJPRFVDVF9WQVJJQU5ULFxuICAgIEdFVF9QUk9EVUNUX1ZBUklBTlRfTElTVCxcbiAgICBHRVRfUFJPRFVDVF9WQVJJQU5UX0xJU1RfU0lNUExFLFxuICAgIEdFVF9QUk9EVUNUX1ZBUklBTlRfT1BUSU9OUyxcbiAgICBHRVRfUFJPRFVDVF9XSVRIX1ZBUklBTlRTLFxuICAgIEdFVF9UQUcsXG4gICAgR0VUX1RBR19MSVNULFxuICAgIFBST0RVQ1RfU0VMRUNUT1JfU0VBUkNILFxuICAgIFJFTU9WRV9PUFRJT05fR1JPVVBfRlJPTV9QUk9EVUNULFxuICAgIFJFTU9WRV9QUk9EVUNUU19GUk9NX0NIQU5ORUwsXG4gICAgUkVNT1ZFX1ZBUklBTlRTX0ZST01fQ0hBTk5FTCxcbiAgICBTRUFSQ0hfUFJPRFVDVFMsXG4gICAgVVBEQVRFX0FTU0VULFxuICAgIFVQREFURV9QUk9EVUNULFxuICAgIFVQREFURV9QUk9EVUNUX09QVElPTixcbiAgICBVUERBVEVfUFJPRFVDVF9PUFRJT05fR1JPVVAsXG4gICAgVVBEQVRFX1BST0RVQ1RfVkFSSUFOVFMsXG4gICAgVVBEQVRFX1RBRyxcbn0gZnJvbSAnLi4vZGVmaW5pdGlvbnMvcHJvZHVjdC1kZWZpbml0aW9ucyc7XG5pbXBvcnQge1xuICAgIEdFVF9QRU5ESU5HX1NFQVJDSF9JTkRFWF9VUERBVEVTLFxuICAgIFJFSU5ERVgsXG4gICAgUlVOX1BFTkRJTkdfU0VBUkNIX0lOREVYX1VQREFURVMsXG59IGZyb20gJy4uL2RlZmluaXRpb25zL3NldHRpbmdzLWRlZmluaXRpb25zJztcblxuaW1wb3J0IHsgQmFzZURhdGFTZXJ2aWNlIH0gZnJvbSAnLi9iYXNlLWRhdGEuc2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBQcm9kdWN0RGF0YVNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgYmFzZURhdGFTZXJ2aWNlOiBCYXNlRGF0YVNlcnZpY2UpIHt9XG5cbiAgICBzZWFyY2hQcm9kdWN0cyh0ZXJtOiBzdHJpbmcsIHRha2U6IG51bWJlciA9IDEwLCBza2lwOiBudW1iZXIgPSAwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxTZWFyY2hQcm9kdWN0cy5RdWVyeSwgU2VhcmNoUHJvZHVjdHMuVmFyaWFibGVzPihTRUFSQ0hfUFJPRFVDVFMsIHtcbiAgICAgICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgICAgICAgdGVybSxcbiAgICAgICAgICAgICAgICB0YWtlLFxuICAgICAgICAgICAgICAgIHNraXAsXG4gICAgICAgICAgICAgICAgZ3JvdXBCeVByb2R1Y3Q6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm9kdWN0U2VsZWN0b3JTZWFyY2godGVybTogc3RyaW5nLCB0YWtlOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PFByb2R1Y3RTZWxlY3RvclNlYXJjaC5RdWVyeSwgUHJvZHVjdFNlbGVjdG9yU2VhcmNoLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBQUk9EVUNUX1NFTEVDVE9SX1NFQVJDSCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0YWtlLFxuICAgICAgICAgICAgICAgIHRlcm0sXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIHJlaW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8UmVpbmRleC5NdXRhdGlvbj4oUkVJTkRFWCk7XG4gICAgfVxuXG4gICAgZ2V0UGVuZGluZ1NlYXJjaEluZGV4VXBkYXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFBlbmRpbmdTZWFyY2hJbmRleFVwZGF0ZXMuUXVlcnk+KFxuICAgICAgICAgICAgR0VUX1BFTkRJTkdfU0VBUkNIX0lOREVYX1VQREFURVMsXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcnVuUGVuZGluZ1NlYXJjaEluZGV4VXBkYXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxSdW5QZW5kaW5nU2VhcmNoSW5kZXhVcGRhdGVzLk11dGF0aW9uPihcbiAgICAgICAgICAgIFJVTl9QRU5ESU5HX1NFQVJDSF9JTkRFWF9VUERBVEVTLFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RzKG9wdGlvbnM6IFByb2R1Y3RMaXN0T3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8R2V0UHJvZHVjdExpc3QuUXVlcnksIEdldFByb2R1Y3RMaXN0LlZhcmlhYmxlcz4oR0VUX1BST0RVQ1RfTElTVCwge1xuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdChpZDogc3RyaW5nLCB2YXJpYW50TGlzdE9wdGlvbnM/OiBQcm9kdWN0VmFyaWFudExpc3RPcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRQcm9kdWN0V2l0aFZhcmlhbnRzLlF1ZXJ5LCBHZXRQcm9kdWN0V2l0aFZhcmlhbnRzLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBHRVRfUFJPRFVDVF9XSVRIX1ZBUklBTlRTLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIHZhcmlhbnRMaXN0T3B0aW9ucyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdFNpbXBsZShpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRQcm9kdWN0U2ltcGxlLlF1ZXJ5LCBHZXRQcm9kdWN0U2ltcGxlLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBHRVRfUFJPRFVDVF9TSU1QTEUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RWYXJpYW50c1NpbXBsZShvcHRpb25zOiBQcm9kdWN0VmFyaWFudExpc3RPcHRpb25zLCBwcm9kdWN0SWQ/OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PFxuICAgICAgICAgICAgR2V0UHJvZHVjdFZhcmlhbnRMaXN0U2ltcGxlLlF1ZXJ5LFxuICAgICAgICAgICAgR2V0UHJvZHVjdFZhcmlhbnRMaXN0U2ltcGxlLlZhcmlhYmxlc1xuICAgICAgICA+KEdFVF9QUk9EVUNUX1ZBUklBTlRfTElTVF9TSU1QTEUsIHsgb3B0aW9ucywgcHJvZHVjdElkIH0pO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RWYXJpYW50cyhvcHRpb25zOiBQcm9kdWN0VmFyaWFudExpc3RPcHRpb25zLCBwcm9kdWN0SWQ/OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFByb2R1Y3RWYXJpYW50TGlzdC5RdWVyeSwgR2V0UHJvZHVjdFZhcmlhbnRMaXN0LlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBHRVRfUFJPRFVDVF9WQVJJQU5UX0xJU1QsXG4gICAgICAgICAgICB7IG9wdGlvbnMsIHByb2R1Y3RJZCB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RWYXJpYW50KGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFByb2R1Y3RWYXJpYW50LlF1ZXJ5LCBHZXRQcm9kdWN0VmFyaWFudC5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgR0VUX1BST0RVQ1RfVkFSSUFOVCxcbiAgICAgICAgICAgIHsgaWQgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0VmFyaWFudHNPcHRpb25zKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFByb2R1Y3RWYXJpYW50T3B0aW9ucy5RdWVyeSwgR2V0UHJvZHVjdFZhcmlhbnRPcHRpb25zLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBHRVRfUFJPRFVDVF9WQVJJQU5UX09QVElPTlMsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RPcHRpb25Hcm91cChpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRQcm9kdWN0T3B0aW9uR3JvdXAuUXVlcnksIEdldFByb2R1Y3RPcHRpb25Hcm91cC5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgR0VUX1BST0RVQ1RfT1BUSU9OX0dST1VQLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBjcmVhdGVQcm9kdWN0KHByb2R1Y3Q6IENyZWF0ZVByb2R1Y3RJbnB1dCkge1xuICAgICAgICBjb25zdCBpbnB1dDogQ3JlYXRlUHJvZHVjdC5WYXJpYWJsZXMgPSB7XG4gICAgICAgICAgICBpbnB1dDogcGljayhwcm9kdWN0LCBbXG4gICAgICAgICAgICAgICAgJ2VuYWJsZWQnLFxuICAgICAgICAgICAgICAgICd0cmFuc2xhdGlvbnMnLFxuICAgICAgICAgICAgICAgICdjdXN0b21GaWVsZHMnLFxuICAgICAgICAgICAgICAgICdhc3NldElkcycsXG4gICAgICAgICAgICAgICAgJ2ZlYXR1cmVkQXNzZXRJZCcsXG4gICAgICAgICAgICAgICAgJ2ZhY2V0VmFsdWVJZHMnLFxuICAgICAgICAgICAgXSksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8Q3JlYXRlUHJvZHVjdC5NdXRhdGlvbiwgQ3JlYXRlUHJvZHVjdC5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgQ1JFQVRFX1BST0RVQ1QsXG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICB1cGRhdGVQcm9kdWN0KHByb2R1Y3Q6IFVwZGF0ZVByb2R1Y3RJbnB1dCkge1xuICAgICAgICBjb25zdCBpbnB1dDogVXBkYXRlUHJvZHVjdC5WYXJpYWJsZXMgPSB7XG4gICAgICAgICAgICBpbnB1dDogcGljayhwcm9kdWN0LCBbXG4gICAgICAgICAgICAgICAgJ2lkJyxcbiAgICAgICAgICAgICAgICAnZW5hYmxlZCcsXG4gICAgICAgICAgICAgICAgJ3RyYW5zbGF0aW9ucycsXG4gICAgICAgICAgICAgICAgJ2N1c3RvbUZpZWxkcycsXG4gICAgICAgICAgICAgICAgJ2Fzc2V0SWRzJyxcbiAgICAgICAgICAgICAgICAnZmVhdHVyZWRBc3NldElkJyxcbiAgICAgICAgICAgICAgICAnZmFjZXRWYWx1ZUlkcycsXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxVcGRhdGVQcm9kdWN0Lk11dGF0aW9uLCBVcGRhdGVQcm9kdWN0LlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBVUERBVEVfUFJPRFVDVCxcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGRlbGV0ZVByb2R1Y3QoaWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPERlbGV0ZVByb2R1Y3QuTXV0YXRpb24sIERlbGV0ZVByb2R1Y3QuVmFyaWFibGVzPihERUxFVEVfUFJPRFVDVCwge1xuICAgICAgICAgICAgaWQsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGRlbGV0ZVByb2R1Y3RzKGlkczogc3RyaW5nW10pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxEZWxldGVQcm9kdWN0cy5NdXRhdGlvbiwgRGVsZXRlUHJvZHVjdHMuVmFyaWFibGVzPihcbiAgICAgICAgICAgIERFTEVURV9QUk9EVUNUUyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZHMsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGNyZWF0ZVByb2R1Y3RWYXJpYW50cyhpbnB1dDogQ3JlYXRlUHJvZHVjdFZhcmlhbnRJbnB1dFtdKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8Q3JlYXRlUHJvZHVjdFZhcmlhbnRzLk11dGF0aW9uLCBDcmVhdGVQcm9kdWN0VmFyaWFudHMuVmFyaWFibGVzPihcbiAgICAgICAgICAgIENSRUFURV9QUk9EVUNUX1ZBUklBTlRTLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlucHV0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICB1cGRhdGVQcm9kdWN0VmFyaWFudHModmFyaWFudHM6IFVwZGF0ZVByb2R1Y3RWYXJpYW50SW5wdXRbXSkge1xuICAgICAgICBjb25zdCBpbnB1dDogVXBkYXRlUHJvZHVjdFZhcmlhbnRzLlZhcmlhYmxlcyA9IHtcbiAgICAgICAgICAgIGlucHV0OiB2YXJpYW50cy5tYXAoXG4gICAgICAgICAgICAgICAgcGljayhbXG4gICAgICAgICAgICAgICAgICAgICdpZCcsXG4gICAgICAgICAgICAgICAgICAgICdlbmFibGVkJyxcbiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zbGF0aW9ucycsXG4gICAgICAgICAgICAgICAgICAgICdza3UnLFxuICAgICAgICAgICAgICAgICAgICAncHJpY2UnLFxuICAgICAgICAgICAgICAgICAgICAndGF4Q2F0ZWdvcnlJZCcsXG4gICAgICAgICAgICAgICAgICAgICdmYWNldFZhbHVlSWRzJyxcbiAgICAgICAgICAgICAgICAgICAgJ2ZlYXR1cmVkQXNzZXRJZCcsXG4gICAgICAgICAgICAgICAgICAgICdhc3NldElkcycsXG4gICAgICAgICAgICAgICAgICAgICd0cmFja0ludmVudG9yeScsXG4gICAgICAgICAgICAgICAgICAgICdvdXRPZlN0b2NrVGhyZXNob2xkJyxcbiAgICAgICAgICAgICAgICAgICAgJ3VzZUdsb2JhbE91dE9mU3RvY2tUaHJlc2hvbGQnLFxuICAgICAgICAgICAgICAgICAgICAnc3RvY2tPbkhhbmQnLFxuICAgICAgICAgICAgICAgICAgICAnY3VzdG9tRmllbGRzJyxcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8VXBkYXRlUHJvZHVjdFZhcmlhbnRzLk11dGF0aW9uLCBVcGRhdGVQcm9kdWN0VmFyaWFudHMuVmFyaWFibGVzPihcbiAgICAgICAgICAgIFVQREFURV9QUk9EVUNUX1ZBUklBTlRTLFxuICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZGVsZXRlUHJvZHVjdFZhcmlhbnQoaWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPERlbGV0ZVByb2R1Y3RWYXJpYW50Lk11dGF0aW9uLCBEZWxldGVQcm9kdWN0VmFyaWFudC5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgREVMRVRFX1BST0RVQ1RfVkFSSUFOVCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgY3JlYXRlUHJvZHVjdE9wdGlvbkdyb3Vwcyhwcm9kdWN0T3B0aW9uR3JvdXA6IENyZWF0ZVByb2R1Y3RPcHRpb25Hcm91cElucHV0KSB7XG4gICAgICAgIGNvbnN0IGlucHV0OiBDcmVhdGVQcm9kdWN0T3B0aW9uR3JvdXAuVmFyaWFibGVzID0ge1xuICAgICAgICAgICAgaW5wdXQ6IHByb2R1Y3RPcHRpb25Hcm91cCxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxcbiAgICAgICAgICAgIENyZWF0ZVByb2R1Y3RPcHRpb25Hcm91cC5NdXRhdGlvbixcbiAgICAgICAgICAgIENyZWF0ZVByb2R1Y3RPcHRpb25Hcm91cC5WYXJpYWJsZXNcbiAgICAgICAgPihDUkVBVEVfUFJPRFVDVF9PUFRJT05fR1JPVVAsIGlucHV0KTtcbiAgICB9XG5cbiAgICBhZGRPcHRpb25Hcm91cFRvUHJvZHVjdCh2YXJpYWJsZXM6IEFkZE9wdGlvbkdyb3VwVG9Qcm9kdWN0LlZhcmlhYmxlcykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPFxuICAgICAgICAgICAgQWRkT3B0aW9uR3JvdXBUb1Byb2R1Y3QuTXV0YXRpb24sXG4gICAgICAgICAgICBBZGRPcHRpb25Hcm91cFRvUHJvZHVjdC5WYXJpYWJsZXNcbiAgICAgICAgPihBRERfT1BUSU9OX0dST1VQX1RPX1BST0RVQ1QsIHZhcmlhYmxlcyk7XG4gICAgfVxuXG4gICAgYWRkT3B0aW9uVG9Hcm91cChpbnB1dDogQ3JlYXRlUHJvZHVjdE9wdGlvbklucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8QWRkT3B0aW9uVG9Hcm91cC5NdXRhdGlvbiwgQWRkT3B0aW9uVG9Hcm91cC5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgQUREX09QVElPTl9UT19HUk9VUCxcbiAgICAgICAgICAgIHsgaW5wdXQgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBkZWxldGVQcm9kdWN0T3B0aW9uKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxEZWxldGVQcm9kdWN0T3B0aW9uLk11dGF0aW9uLCBEZWxldGVQcm9kdWN0T3B0aW9uLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBERUxFVEVfUFJPRFVDVF9PUFRJT04sXG4gICAgICAgICAgICB7IGlkIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmVtb3ZlT3B0aW9uR3JvdXBGcm9tUHJvZHVjdCh2YXJpYWJsZXM6IFJlbW92ZU9wdGlvbkdyb3VwRnJvbVByb2R1Y3QuVmFyaWFibGVzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBSZW1vdmVPcHRpb25Hcm91cEZyb21Qcm9kdWN0Lk11dGF0aW9uLFxuICAgICAgICAgICAgUmVtb3ZlT3B0aW9uR3JvdXBGcm9tUHJvZHVjdC5WYXJpYWJsZXNcbiAgICAgICAgPihSRU1PVkVfT1BUSU9OX0dST1VQX0ZST01fUFJPRFVDVCwgdmFyaWFibGVzKTtcbiAgICB9XG5cbiAgICB1cGRhdGVQcm9kdWN0T3B0aW9uKGlucHV0OiBVcGRhdGVQcm9kdWN0T3B0aW9uSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxVcGRhdGVQcm9kdWN0T3B0aW9uLk11dGF0aW9uLCBVcGRhdGVQcm9kdWN0T3B0aW9uLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBVUERBVEVfUFJPRFVDVF9PUFRJT04sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaW5wdXQ6IHBpY2soaW5wdXQsIFsnaWQnLCAnY29kZScsICd0cmFuc2xhdGlvbnMnLCAnY3VzdG9tRmllbGRzJ10pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICB1cGRhdGVQcm9kdWN0T3B0aW9uR3JvdXAoaW5wdXQ6IFVwZGF0ZVByb2R1Y3RPcHRpb25Hcm91cElucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBVcGRhdGVQcm9kdWN0T3B0aW9uR3JvdXAuTXV0YXRpb24sXG4gICAgICAgICAgICBVcGRhdGVQcm9kdWN0T3B0aW9uR3JvdXAuVmFyaWFibGVzXG4gICAgICAgID4oVVBEQVRFX1BST0RVQ1RfT1BUSU9OX0dST1VQLCB7XG4gICAgICAgICAgICBpbnB1dDogcGljayhpbnB1dCwgWydpZCcsICdjb2RlJywgJ3RyYW5zbGF0aW9ucycsICdjdXN0b21GaWVsZHMnXSksXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RPcHRpb25Hcm91cHMoZmlsdGVyVGVybT86IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8R2V0UHJvZHVjdE9wdGlvbkdyb3Vwcy5RdWVyeSwgR2V0UHJvZHVjdE9wdGlvbkdyb3Vwcy5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgR0VUX1BST0RVQ1RfT1BUSU9OX0dST1VQUyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJUZXJtLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRBc3NldExpc3QodGFrZTogbnVtYmVyID0gMTAsIHNraXA6IG51bWJlciA9IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldEFzc2V0TGlzdC5RdWVyeSwgR2V0QXNzZXRMaXN0LlZhcmlhYmxlcz4oR0VUX0FTU0VUX0xJU1QsIHtcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBza2lwLFxuICAgICAgICAgICAgICAgIHRha2UsXG4gICAgICAgICAgICAgICAgc29ydDoge1xuICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IFNvcnRPcmRlci5ERVNDLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRBc3NldChpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRBc3NldC5RdWVyeSwgR2V0QXNzZXQuVmFyaWFibGVzPihHRVRfQVNTRVQsIHtcbiAgICAgICAgICAgIGlkLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjcmVhdGVBc3NldHMoZmlsZXM6IEZpbGVbXSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPENyZWF0ZUFzc2V0cy5NdXRhdGlvbiwgQ3JlYXRlQXNzZXRzLlZhcmlhYmxlcz4oQ1JFQVRFX0FTU0VUUywge1xuICAgICAgICAgICAgaW5wdXQ6IGZpbGVzLm1hcChmaWxlID0+ICh7IGZpbGUgfSkpLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB1cGRhdGVBc3NldChpbnB1dDogVXBkYXRlQXNzZXRJbnB1dCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPFVwZGF0ZUFzc2V0Lk11dGF0aW9uLCBVcGRhdGVBc3NldC5WYXJpYWJsZXM+KFVQREFURV9BU1NFVCwge1xuICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGRlbGV0ZUFzc2V0cyhpZHM6IHN0cmluZ1tdLCBmb3JjZTogYm9vbGVhbikge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPERlbGV0ZUFzc2V0cy5NdXRhdGlvbiwgRGVsZXRlQXNzZXRzLlZhcmlhYmxlcz4oREVMRVRFX0FTU0VUUywge1xuICAgICAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICAgICAgICBhc3NldElkczogaWRzLFxuICAgICAgICAgICAgICAgIGZvcmNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXNzaWduUHJvZHVjdHNUb0NoYW5uZWwoaW5wdXQ6IEFzc2lnblByb2R1Y3RzVG9DaGFubmVsSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxcbiAgICAgICAgICAgIEFzc2lnblByb2R1Y3RzVG9DaGFubmVsLk11dGF0aW9uLFxuICAgICAgICAgICAgQXNzaWduUHJvZHVjdHNUb0NoYW5uZWwuVmFyaWFibGVzXG4gICAgICAgID4oQVNTSUdOX1BST0RVQ1RTX1RPX0NIQU5ORUwsIHtcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZW1vdmVQcm9kdWN0c0Zyb21DaGFubmVsKGlucHV0OiBSZW1vdmVQcm9kdWN0c0Zyb21DaGFubmVsSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxcbiAgICAgICAgICAgIFJlbW92ZVByb2R1Y3RzRnJvbUNoYW5uZWwuTXV0YXRpb24sXG4gICAgICAgICAgICBSZW1vdmVQcm9kdWN0c0Zyb21DaGFubmVsLlZhcmlhYmxlc1xuICAgICAgICA+KFJFTU9WRV9QUk9EVUNUU19GUk9NX0NIQU5ORUwsIHtcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhc3NpZ25WYXJpYW50c1RvQ2hhbm5lbChpbnB1dDogQXNzaWduUHJvZHVjdFZhcmlhbnRzVG9DaGFubmVsSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxcbiAgICAgICAgICAgIEFzc2lnblZhcmlhbnRzVG9DaGFubmVsLk11dGF0aW9uLFxuICAgICAgICAgICAgQXNzaWduVmFyaWFudHNUb0NoYW5uZWwuVmFyaWFibGVzXG4gICAgICAgID4oQVNTSUdOX1ZBUklBTlRTX1RPX0NIQU5ORUwsIHtcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZW1vdmVWYXJpYW50c0Zyb21DaGFubmVsKGlucHV0OiBSZW1vdmVQcm9kdWN0VmFyaWFudHNGcm9tQ2hhbm5lbElucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBSZW1vdmVWYXJpYW50c0Zyb21DaGFubmVsLk11dGF0aW9uLFxuICAgICAgICAgICAgUmVtb3ZlVmFyaWFudHNGcm9tQ2hhbm5lbC5WYXJpYWJsZXNcbiAgICAgICAgPihSRU1PVkVfVkFSSUFOVFNfRlJPTV9DSEFOTkVMLCB7XG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0VGFnKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFRhZy5RdWVyeSwgR2V0VGFnLlZhcmlhYmxlcz4oR0VUX1RBRywgeyBpZCB9KTtcbiAgICB9XG5cbiAgICBnZXRUYWdMaXN0KG9wdGlvbnM/OiBUYWdMaXN0T3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8R2V0VGFnTGlzdC5RdWVyeSwgR2V0VGFnTGlzdC5WYXJpYWJsZXM+KEdFVF9UQUdfTElTVCwgeyBvcHRpb25zIH0pO1xuICAgIH1cblxuICAgIGNyZWF0ZVRhZyhpbnB1dDogQ3JlYXRlVGFnSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxDcmVhdGVUYWcuTXV0YXRpb24sIENyZWF0ZVRhZy5WYXJpYWJsZXM+KENSRUFURV9UQUcsIHsgaW5wdXQgfSk7XG4gICAgfVxuXG4gICAgdXBkYXRlVGFnKGlucHV0OiBVcGRhdGVUYWdJbnB1dCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPFVwZGF0ZVRhZy5NdXRhdGlvbiwgVXBkYXRlVGFnLlZhcmlhYmxlcz4oVVBEQVRFX1RBRywgeyBpbnB1dCB9KTtcbiAgICB9XG5cbiAgICBkZWxldGVUYWcoaWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPERlbGV0ZVRhZy5NdXRhdGlvbiwgRGVsZXRlVGFnLlZhcmlhYmxlcz4oREVMRVRFX1RBRywgeyBpZCB9KTtcbiAgICB9XG59XG4iXX0=