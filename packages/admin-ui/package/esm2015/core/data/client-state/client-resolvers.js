import { GET_NEWTORK_STATUS, GET_UI_STATE, GET_USER_STATUS } from '../definitions/client-definitions';
const ɵ0 = (_, args, { cache }) => {
    return updateRequestsInFlight(cache, 1);
}, ɵ1 = (_, args, { cache }) => {
    return updateRequestsInFlight(cache, -1);
}, ɵ2 = (_, args, { cache }) => {
    const { input: { username, loginTime, channels, activeChannelId }, } = args;
    // tslint:disable-next-line:no-non-null-assertion
    const permissions = channels.find(c => c.id === activeChannelId).permissions;
    const data = {
        userStatus: {
            __typename: 'UserStatus',
            username,
            loginTime,
            isLoggedIn: true,
            permissions,
            channels,
            activeChannelId,
        },
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ3 = (_, args, { cache }) => {
    const data = {
        userStatus: {
            __typename: 'UserStatus',
            username: '',
            loginTime: '',
            isLoggedIn: false,
            permissions: [],
            channels: [],
            activeChannelId: null,
        },
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ4 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'language', args.languageCode);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.languageCode;
}, ɵ5 = (_, args, { cache }) => {
    var _a;
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'locale', args.locale);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return (_a = args.locale) !== null && _a !== void 0 ? _a : undefined;
}, ɵ6 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'contentLanguage', args.languageCode);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.languageCode;
}, ɵ7 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'theme', args.theme);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.theme;
}, ɵ8 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = updateUiState(previous, 'displayUiExtensionPoints', args.display);
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.display;
}, ɵ9 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_USER_STATUS });
    const activeChannel = previous.userStatus.channels.find(c => c.id === args.channelId);
    if (!activeChannel) {
        throw new Error('setActiveChannel: Could not find Channel with ID ' + args.channelId);
    }
    const permissions = activeChannel.permissions;
    const data = {
        userStatus: Object.assign(Object.assign({}, previous.userStatus), { permissions, activeChannelId: activeChannel.id }),
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ10 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_USER_STATUS });
    const data = {
        userStatus: Object.assign(Object.assign({}, previous.userStatus), { channels: Array.isArray(args.channels) ? args.channels : [args.channels] }),
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
};
export const clientResolvers = {
    Mutation: {
        requestStarted: ɵ0,
        requestCompleted: ɵ1,
        setAsLoggedIn: ɵ2,
        setAsLoggedOut: ɵ3,
        setUiLanguage: ɵ4,
        setUiLocale: ɵ5,
        setContentLanguage: ɵ6,
        setUiTheme: ɵ7,
        setDisplayUiExtensionPoints: ɵ8,
        setActiveChannel: ɵ9,
        updateUserChannels: ɵ10,
    },
};
function updateUiState(previous, key, value) {
    return {
        uiState: Object.assign(Object.assign({}, previous.uiState), { [key]: value, __typename: 'UiState' }),
    };
}
function updateRequestsInFlight(cache, increment) {
    const previous = cache.readQuery({ query: GET_NEWTORK_STATUS });
    const inFlightRequests = previous ? previous.networkStatus.inFlightRequests + increment : increment;
    const data = {
        networkStatus: {
            __typename: 'NetworkStatus',
            inFlightRequests,
        },
    };
    cache.writeQuery({ query: GET_NEWTORK_STATUS, data });
    return inFlightRequests;
}
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9, ɵ10 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50LXJlc29sdmVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvZGF0YS9jbGllbnQtc3RhdGUvY2xpZW50LXJlc29sdmVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpQkEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztXQWdCOUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQVUsRUFBRTtJQUMzQyxPQUFPLHNCQUFzQixDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM1QyxDQUFDLE9BQ2lCLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFVLEVBQUU7SUFDN0MsT0FBTyxzQkFBc0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM3QyxDQUFDLE9BQ2MsQ0FBQyxDQUFDLEVBQUUsSUFBNkIsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUE0QixFQUFFO0lBQ3JGLE1BQU0sRUFDRixLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsR0FDNUQsR0FBRyxJQUFJLENBQUM7SUFDVCxpREFBaUQ7SUFDakQsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssZUFBZSxDQUFFLENBQUMsV0FBVyxDQUFDO0lBQzlFLE1BQU0sSUFBSSxHQUErQjtRQUNyQyxVQUFVLEVBQUU7WUFDUixVQUFVLEVBQUUsWUFBWTtZQUN4QixRQUFRO1lBQ1IsU0FBUztZQUNULFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFdBQVc7WUFDWCxRQUFRO1lBQ1IsZUFBZTtTQUNsQjtLQUNKLENBQUM7SUFDRixLQUFLLENBQUMsVUFBVSxD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S0FBSyxFQUNaLFVBQVUsRUFBRSxTQUFTLEdBQ3hCO0tBQ0osQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFTLHNCQUFzQixDQUFDLEtBQW9CLEVBQUUsU0FBaUI7SUFDbkUsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBeUIsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO0lBQ3hGLE1BQU0sZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLGdCQUFnQixHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0lBQ3BHLE1BQU0sSUFBSSxHQUEyQjtRQUNqQyxhQUFhLEVBQUU7WUFDWCxVQUFVLEVBQUUsZUFBZTtZQUMzQixnQkFBZ0I7U0FDbkI7S0FDSixDQUFDO0lBQ0YsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELE9BQU8sZ0JBQWdCLENBQUM7QUFDNUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluTWVtb3J5Q2FjaGUgfSBmcm9tICdAYXBvbGxvL2NsaWVudC9jb3JlJztcblxuaW1wb3J0IHtcbiAgICBHZXROZXR3b3JrU3RhdHVzLFxuICAgIEdldFVpU3RhdGUsXG4gICAgR2V0VXNlclN0YXR1cyxcbiAgICBMYW5ndWFnZUNvZGUsXG4gICAgU2V0QWN0aXZlQ2hhbm5lbCxcbiAgICBTZXRBc0xvZ2dlZEluLFxuICAgIFNldENvbnRlbnRMYW5ndWFnZSxcbiAgICBTZXREaXNwbGF5VWlFeHRlbnNpb25Qb2ludHMsXG4gICAgU2V0VWlMYW5ndWFnZSxcbiAgICBTZXRVaUxvY2FsZSxcbiAgICBTZXRVaVRoZW1lLFxuICAgIFVwZGF0ZVVzZXJDaGFubmVscyxcbiAgICBVc2VyU3RhdHVzLFxufSBmcm9tICcuLi8uLi9jb21tb24vZ2VuZXJhdGVkLXR5cGVzJztcbmltcG9ydCB7IEdFVF9ORVdUT1JLX1NUQVRVUywgR0VUX1VJX1NUQVRFLCBHRVRfVVNFUl9TVEFUVVMgfSBmcm9tICcuLi9kZWZpbml0aW9ucy9jbGllbnQtZGVmaW5pdGlvbnMnO1xuXG5leHBvcnQgdHlwZSBSZXNvbHZlckNvbnRleHQgPSB7XG4gICAgY2FjaGU6IEluTWVtb3J5Q2FjaGU7XG4gICAgb3B0aW1pc3RpY1Jlc3BvbnNlOiBhbnk7XG4gICAgZ2V0Q2FjaGVLZXk6IChzdG9yZU9iajogYW55KSA9PiBzdHJpbmc7XG59O1xuXG5leHBvcnQgdHlwZSBSZXNvbHZlckRlZmluaXRpb24gPSB7XG4gICAgTXV0YXRpb246IHtcbiAgICAgICAgW25hbWU6IHN0cmluZ106IChyb290VmFsdWU6IGFueSwgYXJnczogYW55LCBjb250ZXh0OiBSZXNvbHZlckNvbnRleHQsIGluZm8/OiBhbnkpID0+IGFueTtcbiAgICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IGNsaWVudFJlc29sdmVyczogUmVzb2x2ZXJEZWZpbml0aW9uID0ge1xuICAgIE11dGF0aW9uOiB7XG4gICAgICAgIHJlcXVlc3RTdGFydGVkOiAoXywgYXJncywgeyBjYWNoZSB9KTogbnVtYmVyID0+IHtcbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVSZXF1ZXN0c0luRmxpZ2h0KGNhY2hlLCAxKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWVzdENvbXBsZXRlZDogKF8sIGFyZ3MsIHsgY2FjaGUgfSk6IG51bWJlciA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlUmVxdWVzdHNJbkZsaWdodChjYWNoZSwgLTEpO1xuICAgICAgICB9LFxuICAgICAgICBzZXRBc0xvZ2dlZEluOiAoXywgYXJnczogU2V0QXNMb2dnZWRJbi5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IEdldFVzZXJTdGF0dXMuVXNlclN0YXR1cyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgICAgaW5wdXQ6IHsgdXNlcm5hbWUsIGxvZ2luVGltZSwgY2hhbm5lbHMsIGFjdGl2ZUNoYW5uZWxJZCB9LFxuICAgICAgICAgICAgfSA9IGFyZ3M7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IGNoYW5uZWxzLmZpbmQoYyA9PiBjLmlkID09PSBhY3RpdmVDaGFubmVsSWQpIS5wZXJtaXNzaW9ucztcbiAgICAgICAgICAgIGNvbnN0IGRhdGE6IHsgdXNlclN0YXR1czogVXNlclN0YXR1cyB9ID0ge1xuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgX190eXBlbmFtZTogJ1VzZXJTdGF0dXMnLFxuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgbG9naW5UaW1lLFxuICAgICAgICAgICAgICAgICAgICBpc0xvZ2dlZEluOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbHMsXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNoYW5uZWxJZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcbiAgICAgICAgfSxcbiAgICAgICAgc2V0QXNMb2dnZWRPdXQ6IChfLCBhcmdzLCB7IGNhY2hlIH0pOiBHZXRVc2VyU3RhdHVzLlVzZXJTdGF0dXMgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGF0YTogR2V0VXNlclN0YXR1cy5RdWVyeSA9IHtcbiAgICAgICAgICAgICAgICB1c2VyU3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgIF9fdHlwZW5hbWU6ICdVc2VyU3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6ICcnLFxuICAgICAgICAgICAgICAgICAgICBsb2dpblRpbWU6ICcnLFxuICAgICAgICAgICAgICAgICAgICBpc0xvZ2dlZEluOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBjaGFubmVsczogW10sXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNoYW5uZWxJZDogbnVsbCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcbiAgICAgICAgfSxcbiAgICAgICAgc2V0VWlMYW5ndWFnZTogKF8sIGFyZ3M6IFNldFVpTGFuZ3VhZ2UuVmFyaWFibGVzLCB7IGNhY2hlIH0pOiBMYW5ndWFnZUNvZGUgPT4ge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8R2V0VWlTdGF0ZS5RdWVyeT4oeyBxdWVyeTogR0VUX1VJX1NUQVRFIH0pITtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB1cGRhdGVVaVN0YXRlKHByZXZpb3VzLCAnbGFuZ3VhZ2UnLCBhcmdzLmxhbmd1YWdlQ29kZSk7XG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcbiAgICAgICAgICAgIHJldHVybiBhcmdzLmxhbmd1YWdlQ29kZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0VWlMb2NhbGU6IChfLCBhcmdzOiBTZXRVaUxvY2FsZS5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVaVN0YXRlLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUgfSkhO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHVwZGF0ZVVpU3RhdGUocHJldmlvdXMsICdsb2NhbGUnLCBhcmdzLmxvY2FsZSk7XG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcbiAgICAgICAgICAgIHJldHVybiBhcmdzLmxvY2FsZSA/PyB1bmRlZmluZWQ7XG4gICAgICAgIH0sXG4gICAgICAgIHNldENvbnRlbnRMYW5ndWFnZTogKF8sIGFyZ3M6IFNldENvbnRlbnRMYW5ndWFnZS5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IExhbmd1YWdlQ29kZSA9PiB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVaVN0YXRlLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUgfSkhO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHVwZGF0ZVVpU3RhdGUocHJldmlvdXMsICdjb250ZW50TGFuZ3VhZ2UnLCBhcmdzLmxhbmd1YWdlQ29kZSk7XG4gICAgICAgICAgICBjYWNoZS53cml0ZVF1ZXJ5KHsgcXVlcnk6IEdFVF9VSV9TVEFURSwgZGF0YSB9KTtcbiAgICAgICAgICAgIHJldHVybiBhcmdzLmxhbmd1YWdlQ29kZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0VWlUaGVtZTogKF8sIGFyZ3M6IFNldFVpVGhlbWUuVmFyaWFibGVzLCB7IGNhY2hlIH0pOiBzdHJpbmcgPT4ge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8R2V0VWlTdGF0ZS5RdWVyeT4oeyBxdWVyeTogR0VUX1VJX1NUQVRFIH0pITtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB1cGRhdGVVaVN0YXRlKHByZXZpb3VzLCAndGhlbWUnLCBhcmdzLnRoZW1lKTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VJX1NUQVRFLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGFyZ3MudGhlbWU7XG4gICAgICAgIH0sXG4gICAgICAgIHNldERpc3BsYXlVaUV4dGVuc2lvblBvaW50czogKF8sIGFyZ3M6IFNldERpc3BsYXlVaUV4dGVuc2lvblBvaW50cy5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IGJvb2xlYW4gPT4ge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBjYWNoZS5yZWFkUXVlcnk8R2V0VWlTdGF0ZS5RdWVyeT4oeyBxdWVyeTogR0VUX1VJX1NUQVRFIH0pITtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB1cGRhdGVVaVN0YXRlKHByZXZpb3VzLCAnZGlzcGxheVVpRXh0ZW5zaW9uUG9pbnRzJywgYXJncy5kaXNwbGF5KTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VJX1NUQVRFLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGFyZ3MuZGlzcGxheTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0QWN0aXZlQ2hhbm5lbDogKF8sIGFyZ3M6IFNldEFjdGl2ZUNoYW5uZWwuVmFyaWFibGVzLCB7IGNhY2hlIH0pOiBVc2VyU3RhdHVzID0+IHtcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUucmVhZFF1ZXJ5PEdldFVzZXJTdGF0dXMuUXVlcnk+KHsgcXVlcnk6IEdFVF9VU0VSX1NUQVRVUyB9KSE7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVDaGFubmVsID0gcHJldmlvdXMudXNlclN0YXR1cy5jaGFubmVscy5maW5kKGMgPT4gYy5pZCA9PT0gYXJncy5jaGFubmVsSWQpO1xuICAgICAgICAgICAgaWYgKCFhY3RpdmVDaGFubmVsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXRBY3RpdmVDaGFubmVsOiBDb3VsZCBub3QgZmluZCBDaGFubmVsIHdpdGggSUQgJyArIGFyZ3MuY2hhbm5lbElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gYWN0aXZlQ2hhbm5lbC5wZXJtaXNzaW9ucztcbiAgICAgICAgICAgIGNvbnN0IGRhdGE6IHsgdXNlclN0YXR1czogVXNlclN0YXR1cyB9ID0ge1xuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucHJldmlvdXMudXNlclN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMsXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNoYW5uZWxJZDogYWN0aXZlQ2hhbm5lbC5pZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlVXNlckNoYW5uZWxzOiAoXywgYXJnczogVXBkYXRlVXNlckNoYW5uZWxzLlZhcmlhYmxlcywgeyBjYWNoZSB9KTogVXNlclN0YXR1cyA9PiB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVc2VyU3RhdHVzLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMgfSkhO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1c2VyU3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnByZXZpb3VzLnVzZXJTdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBBcnJheS5pc0FycmF5KGFyZ3MuY2hhbm5lbHMpID8gYXJncy5jaGFubmVscyA6IFthcmdzLmNoYW5uZWxzXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcbiAgICAgICAgfSxcbiAgICB9LFxufTtcblxuZnVuY3Rpb24gdXBkYXRlVWlTdGF0ZTxLIGV4dGVuZHMga2V5b2YgR2V0VWlTdGF0ZS5RdWVyeVsndWlTdGF0ZSddPihcbiAgICBwcmV2aW91czogR2V0VWlTdGF0ZS5RdWVyeSxcbiAgICBrZXk6IEssXG4gICAgdmFsdWU6IEdldFVpU3RhdGUuUXVlcnlbJ3VpU3RhdGUnXVtLXSxcbik6IEdldFVpU3RhdGUuUXVlcnkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHVpU3RhdGU6IHtcbiAgICAgICAgICAgIC4uLnByZXZpb3VzLnVpU3RhdGUsXG4gICAgICAgICAgICBba2V5XTogdmFsdWUsXG4gICAgICAgICAgICBfX3R5cGVuYW1lOiAnVWlTdGF0ZScsXG4gICAgICAgIH0sXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlUmVxdWVzdHNJbkZsaWdodChjYWNoZTogSW5NZW1vcnlDYWNoZSwgaW5jcmVtZW50OiAxIHwgLTEpOiBudW1iZXIge1xuICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUucmVhZFF1ZXJ5PEdldE5ldHdvcmtTdGF0dXMuUXVlcnk+KHsgcXVlcnk6IEdFVF9ORVdUT1JLX1NUQVRVUyB9KTtcbiAgICBjb25zdCBpbkZsaWdodFJlcXVlc3RzID0gcHJldmlvdXMgPyBwcmV2aW91cy5uZXR3b3JrU3RhdHVzLmluRmxpZ2h0UmVxdWVzdHMgKyBpbmNyZW1lbnQgOiBpbmNyZW1lbnQ7XG4gICAgY29uc3QgZGF0YTogR2V0TmV0d29ya1N0YXR1cy5RdWVyeSA9IHtcbiAgICAgICAgbmV0d29ya1N0YXR1czoge1xuICAgICAgICAgICAgX190eXBlbmFtZTogJ05ldHdvcmtTdGF0dXMnLFxuICAgICAgICAgICAgaW5GbGlnaHRSZXF1ZXN0cyxcbiAgICAgICAgfSxcbiAgICB9O1xuICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX05FV1RPUktfU1RBVFVTLCBkYXRhIH0pO1xuICAgIHJldHVybiBpbkZsaWdodFJlcXVlc3RzO1xufVxuIl19