!function(){"use strict";var e;function t(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t,r){return(n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,r||e)}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var i=c(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}function a(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(c){l=!0,i=c}finally{try{a||null==n.return||n.return()}finally{if(l)throw i}}return o}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}function u(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}(self.webpackChunk_vendure_admin_ui=self.webpackChunk_vendure_admin_ui||[]).push([[212],{80212:function(i,a,u){u.r(a),u.d(a,{AddManualPaymentDialogComponent:function(){return w},CancelOrderDialogComponent:function(){return Y},CouponCodeSelectorComponent:function(){return W},DraftOrderDetailComponent:function(){return rn},DraftOrderVariantSelectorComponent:function(){return it},FulfillOrderDialogComponent:function(){return un},FulfillmentCardComponent:function(){return wn},FulfillmentDetailComponent:function(){return xn},FulfillmentStateLabelComponent:function(){return pn},GET_CUSTOMER_ADDRESSES:function(){return re},LineFulfillmentComponent:function(){return At},LineRefundsComponent:function(){return ct},ModificationDetailComponent:function(){return Sn},NODE_HEIGHT:function(){return Mn},OrderCustomFieldsCardComponent:function(){return Qt},OrderDetailComponent:function(){return Mi},OrderEditResultType:function(){return Ui},OrderEditorComponent:function(){return _o},OrderEditsPreviewDialogComponent:function(){return Hi},OrderGuard:function(){return Ko},OrderHistoryComponent:function(){return ti},OrderListComponent:function(){return Go},OrderModule:function(){return na},OrderPaymentCardComponent:function(){return Zi},OrderProcessEdgeComponent:function(){return Qn},OrderProcessGraphComponent:function(){return Dn},OrderProcessGraphDialogComponent:function(){return $n},OrderProcessNodeComponent:function(){return Pn},OrderResolver:function(){return Xo},OrderStateSelectDialogComponent:function(){return $e},OrderTableComponent:function(){return St},OrderTransitionService:function(){return Re},PaymentDetailComponent:function(){return yr},PaymentStateLabelComponent:function(){return ri},RefundOrderDialogComponent:function(){return cr},RefundStateLabelComponent:function(){return oi},SelectAddressDialogComponent:function(){return me},SelectCustomerDialogComponent:function(){return qe},SelectShippingMethodDialogComponent:function(){return ke},SettleRefundDialogComponent:function(){return fr},SimpleItemListComponent:function(){return vn},modifyingOrderBreadcrumb:function(){return ta},orderBreadcrumb:function(){return ea},orderRoutes:function(){return zo}});var f=u(1707),m=u(30464),h=u(15455),Z=u(20309),y=u(34652),x=u(36868),A=u(57890),b=u(98318),C=u(70325),q=u(54364),T=u(4187);function O(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.add-payment-to-order"))}function _(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",7),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",8),m.NdJ("click",function(){return m.CHM(n),m.oxw().submit()}),m._uU(4),m.ALo(5,"translate"),m.ALo(6,"localeCurrency"),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,4,"common.cancel")),m.xp6(2),m.Q6J("disabled",r.form.invalid||r.form.pristine),m.xp6(1),m.AsE(" ",m.lcZ(5,6,"order.add-payment")," (",m.xi3(6,8,r.outstandingAmount,r.currencyCode),") ")}}var w=function(){function e(t){g(this,e),this.dataService=t,this.form=new f.cw({method:new f.NI("",f.kI.required),transactionId:new f.NI("",f.kI.required)})}return v(e,[{key:"ngOnInit",value:function(){this.paymentMethods$=this.dataService.settings.getPaymentMethods(999).mapSingle(function(e){return e.paymentMethods.items})}},{key:"submit",value:function(){var e=this.form.value;this.resolveWith({method:e.method,transactionId:e.transactionId})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();w.\u0275fac=function(e){return new(e||w)(m.Y36(h.DoR))},w.\u0275cmp=m.Xpm({type:w,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,O,2,3,"ng-template",0),m.TgZ(1,"form",1),m.TgZ(2,"vdr-form-field",2),m.ALo(3,"translate"),m._UZ(4,"ng-select",3),m.ALo(5,"async"),m.qZA(),m.TgZ(6,"vdr-form-field",4),m.ALo(7,"translate"),m._UZ(8,"input",5),m.qZA(),m.qZA(),m.YNc(9,_,7,11,"ng-template",6)),2&e&&(m.xp6(1),m.Q6J("formGroup",t.form),m.xp6(1),m.Q6J("label",m.lcZ(3,5,"order.payment-method")),m.xp6(2),m.Q6J("items",m.lcZ(5,7,t.paymentMethods$))("addTag",!0),m.xp6(2),m.Q6J("label",m.lcZ(7,9,"order.transaction-id")))},directives:[Z.q,f._Y,f.JL,f.sg,y.h,x.w9,f.JJ,f.u,A.y,f.Fj,b.n],pipes:[C.X$,q.Ov,T.k],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0});var I=u(30724),L=u(65671),k=u(51353);function N(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.cancel-order"))}function S(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"input",19),m.NdJ("ngModelChange",function(e){m.CHM(n);var t=m.oxw().$implicit;return m.oxw().lineQuantities[t.id]=e})("input",function(){return m.CHM(n),m.oxw(2).checkIfAllSelected()}),m.qZA()}if(2&e){var r=m.oxw().$implicit,i=m.oxw();m.Q6J("ngModel",i.lineQuantities[r.id])("disabled",i.cancelAll)("max",r.quantity)}}function F(e,t){if(1&e&&m._uU(0),2&e){var n=m.oxw().$implicit;m.Oqu(n.quantity)}}function J(e,t){if(1&e&&(m.TgZ(0,"tr",10),m.TgZ(1,"td",11),m._UZ(2,"img",12),m.ALo(3,"assetPreview"),m.qZA(),m.TgZ(4,"td",13),m._uU(5),m.qZA(),m.TgZ(6,"td",14),m._uU(7),m.qZA(),m.TgZ(8,"td",15),m._uU(9),m.qZA(),m.TgZ(10,"td",15),m._uU(11),m.ALo(12,"localeCurrency"),m.qZA(),m.TgZ(13,"td",16),m.YNc(14,S,1,3,"input",17),m.YNc(15,F,1,1,"ng-template",null,18,m.W1O),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.MAs(16),i=m.oxw();m.ekj("is-disabled",i.cancelAll)("is-cancelled",0===n.quantity),m.xp6(2),m.Q6J("src",m.xi3(3,11,n.featuredAsset,"tiny"),m.LSH),m.xp6(3),m.Oqu(n.productVariant.name),m.xp6(2),m.Oqu(n.productVariant.sku),m.xp6(2),m.Oqu(n.quantity),m.xp6(2),m.hij(" ",m.xi3(12,14,n.unitPriceWithTax,i.order.currencyCode)," "),m.xp6(3),m.Q6J("ngIf",n.quantity>0&&!i.order.active)("ngIfElse",r)}}function M(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"clr-radio-wrapper"),m.TgZ(2,"input",20),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().cancelAll=e})("ngModelChange",function(){return m.CHM(n),m.oxw().radioChanged()}),m.qZA(),m.TgZ(3,"label"),m._uU(4),m.ALo(5,"translate"),m.qZA(),m.qZA(),m.TgZ(6,"clr-radio-wrapper"),m.TgZ(7,"input",20),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().cancelAll=e})("ngModelChange",function(){return m.CHM(n),m.oxw().radioChanged()}),m.qZA(),m.TgZ(8,"label"),m._uU(9),m.ALo(10,"translate"),m.qZA(),m.qZA(),m.BQk()}if(2&e){var r=m.oxw();m.xp6(2),m.Q6J("value",!0)("ngModel",r.cancelAll),m.xp6(2),m.Oqu(m.lcZ(5,6,"order.cancel-entire-order")),m.xp6(3),m.Q6J("value",!1)("ngModel",r.cancelAll),m.xp6(2),m.Oqu(m.lcZ(10,8,"order.cancel-specified-items"))}}function U(e,t){1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.BQk()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.cancel-selected-items")," "))}function P(e,t){1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.BQk()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.cancel-order")," "))}function Q(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",21),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",22),m.NdJ("click",function(){return m.CHM(n),m.oxw().select()}),m.YNc(4,U,3,3,"ng-container",6),m.YNc(5,P,3,3,"ng-container",6),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,4,"common.cancel")),m.xp6(2),m.Q6J("disabled",!r.reason||!r.order.active&&0===r.selectionCount),m.xp6(1),m.Q6J("ngIf",!r.order.active),m.xp6(1),m.Q6J("ngIf",r.order.active)}}var Y=function(){function e(t){var n,r=this;g(this,e),this.i18nService=t,this.cancelAll=!0,this.lineQuantities={},this.reasons=null!==(n=(0,h.hq7)().cancellationReasons)&&void 0!==n?n:[(0,I.J)("order.cancel-reason-customer-request"),(0,I.J)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(function(e){return r.i18nService.translate(e)})}return v(e,[{key:"selectionCount",get:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e+t},0)}},{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce(function(e,t){return Object.assign(Object.assign({},e),p({},t.id,t.quantity))},{})}},{key:"radioChanged",value:function(){if(this.cancelAll){var e,t=s(this.order.lines);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.lineQuantities[n.id]=n.quantity}}catch(a){t.e(a)}finally{t.f()}}else{var r,i=s(this.order.lines);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.lineQuantities[o.id]=0}}catch(a){i.e(a)}finally{i.f()}}}},{key:"checkIfAllSelected",value:function(){for(var e,t=this,n=function(){var n=d(i[r],2),o=n[0],a=n[1],l=null===(e=t.order.lines.find(function(e){return e.id===o}))||void 0===e?void 0:e.quantity;if(l&&a<l)return{v:void 0}},r=0,i=Object.entries(this.lineQuantities);r<i.length;r++){var o=n();if("object"==typeof o)return o.v}this.cancelAll=!0}},{key:"select",value:function(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason,cancelShipping:this.cancelAll})}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getLineInputs",value:function(){if(!this.order.active)return Object.entries(this.lineQuantities).map(function(e){var t=d(e,2);return{orderLineId:t[0],quantity:t[1]}}).filter(function(e){return 0<e.quantity})}}]),e}();Y.\u0275fac=function(e){return new(e||Y)(m.Y36(h.Dp7))},Y.\u0275cmp=m.Xpm({type:Y,selectors:[["vdr-cancel-order-dialog"]],decls:30,vars:23,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-disabled","is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[4,"ngIf"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input"],["type","radio","clrRadio","","name","options",3,"value","ngModel","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,N,2,3,"ng-template",0),m.TgZ(1,"div",1),m.TgZ(2,"div",2),m.TgZ(3,"table",3),m.TgZ(4,"thead"),m.TgZ(5,"tr"),m._UZ(6,"th"),m.TgZ(7,"th"),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.TgZ(10,"th"),m._uU(11),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"th"),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"th"),m._uU(17),m.ALo(18,"translate"),m.qZA(),m.TgZ(19,"th"),m._uU(20),m.ALo(21,"translate"),m.qZA(),m.qZA(),m.qZA(),m.YNc(22,J,17,17,"tr",4),m.qZA(),m.qZA(),m.TgZ(23,"div",5),m.YNc(24,M,11,10,"ng-container",6),m.TgZ(25,"label",7),m._uU(26),m.ALo(27,"translate"),m.qZA(),m.TgZ(28,"ng-select",8),m.NdJ("ngModelChange",function(e){return t.reason=e}),m.qZA(),m.qZA(),m.qZA(),m.YNc(29,Q,6,6,"ng-template",9)),2&e&&(m.xp6(8),m.Oqu(m.lcZ(9,11,"order.product-name")),m.xp6(3),m.Oqu(m.lcZ(12,13,"order.product-sku")),m.xp6(3),m.Oqu(m.lcZ(15,15,"order.quantity")),m.xp6(3),m.Oqu(m.lcZ(18,17,"order.unit-price")),m.xp6(3),m.Oqu(m.lcZ(21,19,"order.cancel")),m.xp6(2),m.Q6J("ngForOf",t.order.lines),m.xp6(2),m.Q6J("ngIf",!0!==t.order.active),m.xp6(2),m.Oqu(m.lcZ(27,21,"order.cancellation-reason")),m.xp6(2),m.Q6J("items",t.reasons)("addTag",!0)("ngModel",t.reason))},directives:[Z.q,q.sg,q.O5,L.MgK,x.w9,f.JJ,f.On,b.n,A.y,f.qQ,f.wV,f.Fd,f.Fj,L.EeQ,f._,L.asN],pipes:[C.X$,k.M,T.k],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0});var j=u(79441),D=u(83972),E=u(83720),$=u(79902),R=u(33927),H=u(1143),V=u(74447);function B(e,t){if(1&e&&(m.TgZ(0,"vdr-chip"),m._uU(1),m.qZA(),m._uU(2)),2&e){var n=t.item;m.xp6(1),m.Oqu(n.code),m.xp6(1),m.hij(" ",n.promotionName," ")}}var W=function(){function e(t){g(this,e),this.dataService=t,this.addCouponCode=new m.vpe,this.removeCouponCode=new m.vpe,this.couponCodeInput$=new j.xQ}return v(e,[{key:"ngOnInit",value:function(){var e,t=this;this.availableCouponCodes$=(0,D.z)(this.couponCodeInput$.pipe((0,E.x)(),(0,$.w)(function(e){return t.dataService.promotion.getPromotions(10,0,{couponCode:{contains:e}}).single$}),(0,R.U)(function(e){return e.promotions.items.map(function(e){return{code:e.couponCode,promotionName:e.name}})}),(0,H.O)([]))),this.control||(this.control=new f.NI(null!==(e=this.couponCodes)&&void 0!==e?e:[]))}}]),e}();W.\u0275fac=function(e){return new(e||W)(m.Y36(h.DoR))},W.\u0275cmp=m.Xpm({type:W,selectors:[["vdr-coupon-code-selector"]],inputs:{couponCodes:"couponCodes",control:"control"},outputs:{addCouponCode:"addCouponCode",removeCouponCode:"removeCouponCode"},decls:3,vars:9,consts:[["appendTo","body","bindLabel","code","bindValue","code","typeToSearchText","",3,"items","addTag","multiple","hideSelected","minTermLength","typeahead","formControl","add","remove"],["ng-option-tmp",""]],template:function(e,t){1&e&&(m.TgZ(0,"ng-select",0),m.NdJ("add",function(e){return t.addCouponCode.emit(e.code)})("remove",function(e){return t.removeCouponCode.emit(null==e.value?null:e.value.code)}),m.ALo(1,"async"),m.YNc(2,B,3,2,"ng-template",1),m.qZA()),2&e&&m.Q6J("items",m.lcZ(1,7,t.availableCouponCodes$))("addTag",!1)("multiple",!0)("hideSelected",!0)("minTermLength",2)("typeahead",t.couponCodeInput$)("formControl",t.control)},directives:[x.w9,f.JJ,f.oH,x.Z2,V.Y],pipes:[q.Ov],styles:[""],changeDetection:0});var G,X,K=u(61486),z=u(53466),ee=u(65762),te=u(81134),ne=u(14921),re=u(32928).Ps(e||(G=["\n    query GetCustomerAddresses($customerId: ID!) {\n        customer(id: $customerId) {\n            id\n            addresses {\n                ...Address\n            }\n        }\n    }\n    ","\n"],X||(X=G.slice(0)),e=Object.freeze(Object.defineProperties(G,{raw:{value:Object.freeze(X)}}))),h.UYy),ie=u(87876),oe=u(2448),ae=u(99667),le=u(1480);function ce(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.select-address"))}function de(e,t){if(1&e&&(m.TgZ(0,"vdr-radio-card",7),m._UZ(1,"vdr-formatted-address",8),m.qZA()),2&e){var n=t.$implicit;m.Q6J("item",n),m.xp6(1),m.Q6J("address",n)}}function se(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"clr-tab-content"),m.TgZ(1,"vdr-radio-card-fieldset",5),m.NdJ("selectItem",function(e){return m.CHM(n),m.oxw(3).selectedAddress=e}),m.YNc(2,de,2,2,"vdr-radio-card",6),m.qZA(),m.qZA()}if(2&e){var r=m.oxw(2).ngIf,i=m.oxw();m.xp6(1),m.Q6J("idFn",i.addressIdFn)("selectedItemId",i.selectedAddress&&i.addressIdFn(i.selectedAddress)),m.xp6(1),m.Q6J("ngForOf",r)}}function ue(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"clr-tab"),m.TgZ(1,"button",3),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.YNc(4,se,3,3,"ng-template",4),m.NdJ("clrIfActiveChange",function(e){return m.CHM(n),m.oxw(2).useExisting=e}),m.qZA()}if(2&e){var r=m.oxw(2);m.xp6(2),m.Oqu(m.lcZ(3,2,"order.existing-address")),m.xp6(2),m.Q6J("clrIfActive",r.useExisting)}}function fe(e,t){if(1&e&&(m.TgZ(0,"clr-tab-content"),m._UZ(1,"vdr-address-form",9),m.ALo(2,"async"),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.Q6J("formGroup",n.addressForm)("availableCountries",m.lcZ(2,2,n.availableCountries$))}}function pe(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"clr-tabs"),m.YNc(1,ue,5,4,"clr-tab",1),m.TgZ(2,"clr-tab"),m.TgZ(3,"button",3),m._uU(4),m.ALo(5,"translate"),m.qZA(),m.YNc(6,fe,3,4,"ng-template",4),m.NdJ("clrIfActiveChange",function(e){return m.CHM(n),m.oxw().createNew=e}),m.qZA(),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(1),m.Q6J("ngIf",i.customerId&&r.length),m.xp6(3),m.Oqu(m.lcZ(5,3,"customer.create-new-address")),m.xp6(2),m.Q6J("clrIfActive",i.createNew)}}function ge(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",10),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",11),m.NdJ("click",function(){return m.CHM(n),m.oxw().select()}),m._uU(4),m.ALo(5,"translate"),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,3,"common.cancel")),m.xp6(2),m.Q6J("disabled",r.useExisting&&!r.selectedAddress||r.createNew&&r.addressForm.invalid),m.xp6(1),m.hij(" ",m.lcZ(5,5,"common.okay")," ")}}var me=function(){function e(t,n){g(this,e),this.dataService=t,this.formBuilder=n,this.useExisting=!0,this.createNew=!1}return v(e,[{key:"ngOnInit",value:function(){var e,t,n,r,i,o,a,l,c,d,s,u,p,g,m,v,h,Z,y=this;this.addressForm=this.formBuilder.group({fullName:[null!==(t=null===(e=this.currentAddress)||void 0===e?void 0:e.fullName)&&void 0!==t?t:""],company:[null!==(r=null===(n=this.currentAddress)||void 0===n?void 0:n.company)&&void 0!==r?r:""],streetLine1:[null!==(o=null===(i=this.currentAddress)||void 0===i?void 0:i.streetLine1)&&void 0!==o?o:"",f.kI.required],streetLine2:[null!==(l=null===(a=this.currentAddress)||void 0===a?void 0:a.streetLine2)&&void 0!==l?l:""],city:[null!==(d=null===(c=this.currentAddress)||void 0===c?void 0:c.city)&&void 0!==d?d:"",f.kI.required],province:[null!==(u=null===(s=this.currentAddress)||void 0===s?void 0:s.province)&&void 0!==u?u:""],postalCode:[null!==(g=null===(p=this.currentAddress)||void 0===p?void 0:p.postalCode)&&void 0!==g?g:"",f.kI.required],countryCode:[null!==(v=null===(m=this.currentAddress)||void 0===m?void 0:m.countryCode)&&void 0!==v?v:"",f.kI.required],phoneNumber:[null!==(Z=null===(h=this.currentAddress)||void 0===h?void 0:h.phoneNumber)&&void 0!==Z?Z:""]}),this.useExisting=!!this.customerId,this.addresses$=this.customerId?this.dataService.query(re,{customerId:this.customerId}).mapSingle(function(e){var t,n=e.customer;return null!==(t=null==n?void 0:n.addresses)&&void 0!==t?t:[]}).pipe((0,ne.b)(function(e){y.currentAddress&&(y.selectedAddress=e.find(function(e){var t,n;return e.streetLine1===(null===(t=y.currentAddress)||void 0===t?void 0:t.streetLine1)&&e.postalCode===(null===(n=y.currentAddress)||void 0===n?void 0:n.postalCode)})),0===e.length&&(y.createNew=!0,y.useExisting=!1)})):(0,te.of)([]),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(function(e){return e.countries.items})}},{key:"trackByFn",value:function(e){return e.id}},{key:"addressIdFn",value:function(e){return e.streetLine1+e.postalCode}},{key:"cancel",value:function(){this.resolveWith()}},{key:"select",value:function(){if(this.useExisting&&this.selectedAddress&&this.resolveWith(Object.assign(Object.assign({},(0,ee.e)(this.selectedAddress,["fullName","company","streetLine1","streetLine2","city","province","phoneNumber","postalCode"])),{countryCode:this.selectedAddress.country.code})),this.createNew&&this.addressForm.valid){var e=this.addressForm.value;this.resolveWith(e)}}}]),e}();me.\u0275fac=function(e){return new(e||me)(m.Y36(h.DoR),m.Y36(f.qu))},me.\u0275cmp=m.Xpm({type:me,selectors:[["vdr-select-address-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[4,"ngIf"],["vdrDialogButtons",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],[1,"block","mt4",3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[3,"address"],[3,"formGroup","availableCountries"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,ce,2,3,"ng-template",0),m.YNc(1,pe,7,5,"clr-tabs",1),m.ALo(2,"async"),m.YNc(3,ge,6,7,"ng-template",2)),2&e&&(m.xp6(1),m.Q6J("ngIf",m.lcZ(2,1,t.addresses$)))},directives:[Z.q,q.O5,b.n,L.gKI,L.dl,L.S4y,L.Iq$,L.Qs7,L.tam,L.UkA,ie.m,q.sg,oe.C,ae.b,le.C,f.JL,f.sg],pipes:[q.Ov,C.X$],styles:[""],changeDetection:0});var ve=u(80639),he=u(18293);function Ze(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.set-customer-for-order"))}function ye(e,t){if(1&e&&(m._UZ(0,"clr-icon",7),m.TgZ(1,"span",8),m._uU(2),m.qZA(),m.TgZ(3,"vdr-chip"),m._uU(4),m.qZA()),2&e){var n=t.item;m.xp6(2),m.AsE("",n.firstName," ",n.lastName,""),m.xp6(2),m.Oqu(n.emailAddress)}}function xe(e,t){if(1&e&&(m._UZ(0,"clr-icon",7),m.TgZ(1,"span",8),m._uU(2),m.qZA(),m.TgZ(3,"vdr-chip"),m._uU(4),m.qZA()),2&e){var n=t.item;m.xp6(2),m.AsE("",n.firstName," ",n.lastName,""),m.xp6(2),m.Oqu(n.emailAddress)}}function Ae(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"clr-tab-content"),m.TgZ(1,"ng-select",4),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().selectedCustomer=e}),m.ALo(2,"async"),m.YNc(3,ye,5,3,"ng-template",5),m.YNc(4,xe,5,3,"ng-template",6),m.qZA(),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Q6J("items",m.lcZ(2,9,r.customers$))("addTag",!1)("multiple",!0)("hideSelected",!0)("trackByFn",r.trackByFn)("minTermLength",2)("loading",r.isLoading)("typeahead",r.input$)("ngModel",r.selectedCustomer)}}function be(e,t){if(1&e&&(m.TgZ(0,"clr-tab-content"),m.TgZ(1,"form",9),m.TgZ(2,"vdr-form-field",10),m.ALo(3,"translate"),m._UZ(4,"input",11),m.qZA(),m.TgZ(5,"vdr-form-field",12),m.ALo(6,"translate"),m._UZ(7,"input",13),m.qZA(),m.TgZ(8,"vdr-form-field",14),m.ALo(9,"translate"),m._UZ(10,"input",15),m.qZA(),m.TgZ(11,"vdr-form-field",16),m.ALo(12,"translate"),m._UZ(13,"input",17),m.qZA(),m.TgZ(14,"vdr-form-field",18),m.ALo(15,"translate"),m._UZ(16,"input",19),m.qZA(),m.qZA(),m.qZA()),2&e){var n=m.oxw();m.xp6(1),m.Q6J("formGroup",n.customerForm),m.xp6(1),m.Q6J("label",m.lcZ(3,6,"customer.title")),m.xp6(3),m.Q6J("label",m.lcZ(6,8,"customer.first-name")),m.xp6(3),m.Q6J("label",m.lcZ(9,10,"customer.last-name")),m.xp6(3),m.Q6J("label",m.lcZ(12,12,"customer.email-address")),m.xp6(3),m.Q6J("label",m.lcZ(15,14,"customer.phone-number"))}}function Ce(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",20),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",21),m.NdJ("click",function(){return m.CHM(n),m.oxw().select()}),m._uU(4),m.ALo(5,"translate"),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,3,"common.cancel")),m.xp6(2),m.Q6J("disabled",r.useExisting&&0===r.selectedCustomer.length||r.createNew&&r.customerForm.invalid),m.xp6(1),m.hij(" ",m.lcZ(5,5,"common.okay")," ")}}var qe=function(){function e(t,n){g(this,e),this.dataService=t,this.formBuilder=n,this.isLoading=!1,this.input$=new j.xQ,this.selectedCustomer=[],this.useExisting=!0,this.createNew=!1,this.customerForm=this.formBuilder.group({title:"",firstName:["",f.kI.required],lastName:["",f.kI.required],phoneNumber:"",emailAddress:["",[f.kI.required,f.kI.email]]})}return v(e,[{key:"ngOnInit",value:function(){var e=this;this.customers$=(0,D.z)((0,te.of)([]),this.input$.pipe((0,ve.b)(200),(0,E.x)(),(0,ne.b)(function(){return e.isLoading=!0}),(0,$.w)(function(t){return e.dataService.customer.getCustomerList(10,0,t).mapStream(function(e){return e.customers.items}).pipe((0,he.K)(function(){return(0,te.of)([])}),(0,ne.b)(function(){return e.isLoading=!1}))})))}},{key:"trackByFn",value:function(e){return e.id}},{key:"cancel",value:function(){this.resolveWith()}},{key:"select",value:function(){if(this.useExisting&&1===this.selectedCustomer.length&&this.resolveWith(this.selectedCustomer[0]),this.createNew&&this.customerForm.valid){var e=this.customerForm.value;this.resolveWith(e)}}}]),e}();qe.\u0275fac=function(e){return new(e||qe)(m.Y36(h.DoR),m.Y36(f.qu))},qe.\u0275cmp=m.Xpm({type:qe,selectors:[["vdr-select-customer-dialog"]],decls:13,vars:8,consts:[["vdrDialogTitle",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],["vdrDialogButtons",""],["appendTo","body","bindLabel","name",1,"mt4",3,"items","addTag","multiple","hideSelected","trackByFn","minTermLength","loading","typeahead","ngModel","ngModelChange"],["ng-label-tmp",""],["ng-option-tmp",""],["shape","user",1,"is-solid"],[1,"ml2","mr2"],[3,"formGroup"],["for","title",3,"label"],["id","title","type","text","formControlName","title"],["for","firstName",3,"label"],["id","firstName","type","text","formControlName","firstName"],["for","lastName",3,"label"],["id","lastName","type","text","formControlName","lastName"],["for","emailAddress",3,"label"],["id","emailAddress","type","text","formControlName","emailAddress"],["for","phoneNumber",3,"label"],["id","phoneNumber","type","text","formControlName","phoneNumber"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,Ze,2,3,"ng-template",0),m.TgZ(1,"clr-tabs"),m.TgZ(2,"clr-tab"),m.TgZ(3,"button",1),m._uU(4),m.ALo(5,"translate"),m.qZA(),m.YNc(6,Ae,5,11,"ng-template",2),m.NdJ("clrIfActiveChange",function(e){return t.useExisting=e}),m.qZA(),m.TgZ(7,"clr-tab"),m.TgZ(8,"button",1),m._uU(9),m.ALo(10,"translate"),m.qZA(),m.YNc(11,be,17,16,"ng-template",2),m.NdJ("clrIfActiveChange",function(e){return t.createNew=e}),m.qZA(),m.qZA(),m.YNc(12,Ce,6,7,"ng-template",3)),2&e&&(m.xp6(4),m.Oqu(m.lcZ(5,4,"order.existing-customer")),m.xp6(2),m.Q6J("clrIfActive",t.useExisting),m.xp6(3),m.Oqu(m.lcZ(10,6,"customer.create-new-customer")),m.xp6(2),m.Q6J("clrIfActive",t.createNew))},directives:[Z.q,L.gKI,L.dl,L.S4y,L.Iq$,L.Qs7,L.tam,b.n,L.UkA,x.w9,f.JJ,f.On,x.bb,x.Z2,L.qvL,V.Y,f._Y,f.JL,f.sg,y.h,A.y,f.Fj,f.u],pipes:[C.X$,q.Ov],styles:[""],changeDetection:0});var Te=u(87368),Oe=u(2702);function _e(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.select-shipping-method"))}function we(e,t){if(1&e&&m._UZ(0,"vdr-object-tree",9),2&e){var n=m.oxw().$implicit;m.Q6J("value",n.metadata)}}function Ie(e,t){if(1&e&&(m.TgZ(0,"vdr-radio-card",4),m.TgZ(1,"div",5),m.TgZ(2,"vdr-labeled-data",6),m.ALo(3,"translate"),m._uU(4),m.qZA(),m.TgZ(5,"div",7),m.TgZ(6,"vdr-labeled-data",6),m.ALo(7,"translate"),m._uU(8),m.ALo(9,"localeCurrency"),m.qZA(),m.TgZ(10,"vdr-labeled-data",6),m.ALo(11,"translate"),m._uU(12),m.ALo(13,"localeCurrency"),m.qZA(),m.qZA(),m.YNc(14,we,1,1,"vdr-object-tree",8),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw();m.Q6J("item",n),m.xp6(2),m.Q6J("label",m.lcZ(3,8,"settings.shipping-method")),m.xp6(2),m.hij(" ",n.name," "),m.xp6(2),m.Q6J("label",m.lcZ(7,10,"common.price")),m.xp6(2),m.hij(" ",m.xi3(9,12,n.price,r.currencyCode)," "),m.xp6(2),m.Q6J("label",m.lcZ(11,15,"common.price-with-tax")),m.xp6(2),m.hij(" ",m.xi3(13,17,n.priceWithTax,r.currencyCode)," "),m.xp6(2),m.Q6J("ngIf",n.metadata)}}function Le(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",10),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",11),m.NdJ("click",function(){return m.CHM(n),m.oxw().select()}),m._uU(4),m.ALo(5,"translate"),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,3,"common.cancel")),m.xp6(2),m.Q6J("disabled",!r.selectedMethod),m.xp6(1),m.hij(" ",m.lcZ(5,5,"common.okay")," ")}}var ke=function(){function e(){g(this,e)}return v(e,[{key:"ngOnInit",value:function(){var e=this;this.currentSelectionId&&(this.selectedMethod=this.eligibleShippingMethods.find(function(t){return t.id===e.currentSelectionId}))}},{key:"methodIdFn",value:function(e){return e.id}},{key:"cancel",value:function(){this.resolveWith()}},{key:"select",value:function(){this.selectedMethod&&this.resolveWith(this.selectedMethod.id)}}]),e}();ke.\u0275fac=function(e){return new(e||ke)},ke.\u0275cmp=m.Xpm({type:ke,selectors:[["vdr-select-shipping-method-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"item"],[1,"result-details"],[3,"label"],[1,"price-row"],[3,"value",4,"ngIf"],[3,"value"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,_e,2,3,"ng-template",0),m.TgZ(1,"vdr-radio-card-fieldset",1),m.NdJ("selectItem",function(e){return t.selectedMethod=e}),m.YNc(2,Ie,15,20,"vdr-radio-card",2),m.qZA(),m.YNc(3,Le,6,7,"ng-template",3)),2&e&&(m.xp6(1),m.Q6J("idFn",t.methodIdFn)("selectedItemId",null==t.selectedMethod?null:t.selectedMethod.id),m.xp6(1),m.Q6J("ngForOf",t.eligibleShippingMethods))},directives:[Z.q,ie.m,q.sg,b.n,oe.C,Te.W,q.O5,Oe._],pipes:[C.X$,T.k],styles:[""],changeDetection:0});var Ne=u(16320),Se=u(8117),Fe=u(27272),Je=function(){function e(t,n){g(this,e),this.notifier=t,this.source=n}return v(e,[{key:"call",value:function(e,t){return t.subscribe(new Me(e,this.notifier,this.source))}}]),e}(),Me=function(e){r(i,e);var t=o(i);function i(e,n,r){var o;return g(this,i),(o=t.call(this,e)).notifier=n,o.source=r,o}return v(i,[{key:"error",value:function(e){if(!this.isStopped){var t=this.errors,r=this.retries,o=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{t=new j.xQ;try{var a;r=(0,this.notifier)(t)}catch(a){return n(c(i.prototype),"error",this).call(this,a)}o=(0,Fe.ft)(r,new Fe.IY(this))}this._unsubscribeAndRecycle(),this.errors=t,this.retries=r,this.retriesSubscription=o,t.next(e)}}},{key:"_unsubscribe",value:function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}},{key:"notifyNext",value:function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)}}]),i}(Fe.Ds),Ue=u(65318),Pe=u(10858);function Qe(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.select-state"))}function Ye(e,t){if(1&e&&(m.TgZ(0,"option",4),m._uU(1),m.ALo(2,"translate"),m.ALo(3,"stateI18nToken"),m.qZA()),2&e){var n=t.$implicit;m.Q6J("value",n),m.xp6(1),m.hij(" ",m.lcZ(2,2,m.lcZ(3,4,n))," ")}}function je(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",7),m.NdJ("click",function(){return m.CHM(n),m.oxw(2).cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA()}2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"common.cancel")," "))}var De=function(e){return{state:e}};function Ee(e,t){if(1&e){var n=m.EpF();m.YNc(0,je,3,3,"button",5),m.TgZ(1,"button",6),m.NdJ("click",function(){return m.CHM(n),m.oxw().select()}),m._uU(2),m.ALo(3,"translate"),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.qZA()}if(2&e){var r=m.oxw();m.Q6J("ngIf",r.cancellable),m.xp6(1),m.Q6J("disabled",!r.selectedState),m.xp6(1),m.hij(" ",m.xi3(3,3,"order.transition-to-state",m.VKq(10,De,m.lcZ(4,6,m.lcZ(5,8,r.selectedState))))," ")}}var $e=function(){function e(){g(this,e),this.nextStates=[],this.message="",this.selectedState=""}return v(e,[{key:"select",value:function(){this.selectedState&&this.resolveWith(this.selectedState)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();$e.\u0275fac=function(e){return new(e||$e)},$e.\u0275cmp=m.Xpm({type:$e,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["clrSelect","","name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(m.YNc(0,Qe,2,3,"ng-template",0),m.TgZ(1,"p"),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"clr-select-container"),m.TgZ(5,"select",1),m.NdJ("ngModelChange",function(e){return t.selectedState=e}),m.YNc(6,Ye,4,6,"option",2),m.qZA(),m.qZA(),m.YNc(7,Ee,6,12,"ng-template",3)),2&e&&(m.xp6(2),m.Oqu(m.lcZ(3,3,t.message)),m.xp6(3),m.Q6J("ngModel",t.selectedState),m.xp6(1),m.Q6J("ngForOf",t.nextStates))},directives:[Z.q,L.dTv,A.y,f.EJ,L.otW,f.JJ,f.On,q.sg,b.n,f.YN,f.Kr,q.O5],pipes:[C.X$,Pe.N],styles:[""],changeDetection:0});var Re=function(){function e(t,n,r,i){g(this,e),this.dataService=t,this.modalService=n,this.notificationService=r,this.i18nService=i}return v(e,[{key:"transitionToPreModifyingState",value:function(e,t){var n=this;return this.getPreModifyingState(e).pipe((0,$.w)(function(r){var i={orderId:e,nextStates:t,message:n.i18nService.translate((0,I.J)("order.unable-to-transition-to-state-try-another"),{state:r}),cancellable:!1,retry:10};return r?n.transitionToStateOrThrow(e,r).pipe((0,he.K)(function(e){return n.manuallyTransitionToState(i)})):n.manuallyTransitionToState(i)}))}},{key:"manuallyTransitionToState",value:function(e){var t,n=this;return this.modalService.fromComponent($e,{locals:{nextStates:e.nextStates,cancellable:e.cancellable,message:e.message},closable:!1,size:"md"}).pipe((0,$.w)(function(t){if(t)return n.transitionToStateOrThrow(e.orderId,t);if(e.cancellable)return Se.E;throw new Error("An order state must be selected")}),(t=function(t){return t.pipe((0,Ue.g)(2e3),(0,z.q)(e.retry))},function(e){return e.lift(new Je(t,e))}))}},{key:"getPreModifyingState",value:function(e){return this.dataService.order.getOrderHistory(e,{filter:{type:{eq:h.iYD.ORDER_STATE_TRANSITION}},sort:{createdAt:h.Asd.DESC}}).mapSingle(function(e){return e.order}).pipe((0,R.U)(function(e){var t=null==e?void 0:e.history.items.find(function(e){return"Modifying"===e.data.to});if(t)return t.data.from}))}},{key:"transitionToStateOrThrow",value:function(e,t){var n=this;return this.dataService.order.transitionToState(e,t).pipe((0,R.U)(function(e){var t=e.transitionOrderToState;switch(null==t?void 0:t.__typename){case"Order":return null==t?void 0:t.state;case"OrderStateTransitionError":throw n.notificationService.error(null==t?void 0:t.transitionError),new Error(null==t?void 0:t.transitionError)}}))}}]),e}();Re.\u0275fac=function(e){return new(e||Re)(m.LFG(h.DoR),m.LFG(h.Z7U),m.LFG(h.gqp),m.LFG(h.Dp7))},Re.\u0275prov=m.Yz7({token:Re,factory:Re.\u0275fac,providedIn:"root"});var He=u(27346),Ve=u(33146),Be=u(75886),We=u(30735),Ge=u(41519),Xe=u(28854),Ke=u(15111),ze=u(93331),et=u(42231);function tt(e,t){if(1&e&&(m.TgZ(0,"div",16),m._UZ(1,"vdr-custom-field-control",17),m.qZA()),2&e){var n=t.$implicit,r=m.oxw(3);m.xp6(1),m.Q6J("compact",!0)("readonly",!1)("customField",n)("customFieldsFormGroup",r.customFieldsFormGroup)}}function nt(e,t){if(1&e&&(m.ynx(0),m.YNc(1,tt,2,4,"div",15),m.BQk()),2&e){var n=m.oxw(2);m.xp6(1),m.Q6J("ngForOf",n.orderLineCustomFields)}}function rt(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div",1),m.TgZ(1,"div",5),m._UZ(2,"img",6),m.ALo(3,"assetPreview"),m.TgZ(4,"div",7),m.TgZ(5,"div"),m._uU(6),m.qZA(),m.TgZ(7,"div",8),m._uU(8),m.qZA(),m.qZA(),m.TgZ(9,"div",9),m.TgZ(10,"div",8),m._uU(11),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"div",8),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.qZA(),m._UZ(16,"div",10),m.TgZ(17,"div",7),m.TgZ(18,"div"),m._uU(19),m.ALo(20,"localeCurrency"),m.qZA(),m.TgZ(21,"div",11),m.ALo(22,"translate"),m._uU(23),m.ALo(24,"localeCurrency"),m.qZA(),m.qZA(),m.TgZ(25,"div"),m.TgZ(26,"input",12),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().quantity=e}),m.qZA(),m.qZA(),m.TgZ(27,"button",13),m.NdJ("click",function(){var e=m.CHM(n).ngIf;return m.oxw().addItemClick(e)}),m._uU(28),m.ALo(29,"translate"),m.qZA(),m.qZA(),m.YNc(30,nt,2,1,"ng-container",14),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(2),m.Q6J("src",m.xi3(3,15,r.featuredAsset||r.product.featuredAsset,32),m.LSH),m.xp6(4),m.Oqu(null==r?null:r.name),m.xp6(2),m.Oqu(null==r?null:r.sku),m.xp6(3),m.AsE(" ",m.lcZ(12,18,"catalog.stock-on-hand"),": ",r.stockOnHand," "),m.xp6(3),m.AsE(" ",m.lcZ(15,20,"catalog.stock-allocated"),": ",r.stockAllocated," "),m.xp6(5),m.Oqu(m.xi3(20,22,null==r?null:r.priceWithTax,i.currencyCode)),m.xp6(2),m.Q6J("title",m.lcZ(22,25,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(24,27,null==r?null:r.price,i.currencyCode)," "),m.xp6(3),m.Q6J("disabled",!r)("ngModel",i.quantity),m.xp6(1),m.Q6J("disabled",!r),m.xp6(1),m.hij(" ",m.lcZ(29,30,"order.add-item-to-order")," "),m.xp6(2),m.Q6J("ngIf",i.orderLineCustomFields.length)}}var it=function(){function e(t){g(this,e),this.dataService=t,this.addItem=new m.vpe,this.customFieldsFormGroup=new f.cw({}),this.selectedVariantId$=new j.xQ,this.quantity=1}return v(e,[{key:"ngOnInit",value:function(){var e=this;this.selectedVariant$=this.selectedVariantId$.pipe((0,$.w)(function(t){return t?e.dataService.product.getProductVariant(t).mapSingle(function(e){return e.productVariant}):[void 0]}));var t,n=s(this.orderLineCustomFields);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.customFieldsFormGroup.addControl(r.name,new f.NI(""))}}catch(i){n.e(i)}finally{n.f()}}},{key:"addItemClick",value:function(e){e&&(this.addItem.emit({productVariantId:e.id,quantity:this.quantity,customFields:this.orderLineCustomFields.length?this.customFieldsFormGroup.value:void 0}),this.selectedVariantId$.next(void 0),this.customFieldsFormGroup.reset())}}]),e}();it.\u0275fac=function(e){return new(e||it)(m.Y36(h.DoR))},it.\u0275cmp=m.Xpm({type:it,selectors:[["vdr-draft-order-variant-selector"]],inputs:{currencyCode:"currencyCode",orderLineCustomFields:"orderLineCustomFields"},outputs:{addItem:"addItem"},decls:8,vars:6,consts:[[1,"card"],[1,"card-block"],[1,"card-title"],[3,"productSelected"],["class","card-block",4,"ngIf"],[1,"variant-details"],[1,"mr2",3,"src"],[1,"details"],[1,"small"],[1,"details","ml4"],[1,"flex-spacer"],[1,"small",3,"title"],["type","number","min","0",3,"disabled","ngModel","ngModelChange"],[1,"btn","btn-small","btn-primary",3,"disabled","click"],[4,"ngIf"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"compact","readonly","customField","customFieldsFormGroup"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0),m.TgZ(1,"div",1),m.TgZ(2,"h4",2),m._uU(3),m.ALo(4,"translate"),m.qZA(),m.TgZ(5,"vdr-product-selector",3),m.NdJ("productSelected",function(e){return t.selectedVariantId$.next(e.productVariantId)}),m.qZA(),m.qZA(),m.YNc(6,rt,31,32,"div",4),m.ALo(7,"async"),m.qZA()),2&e&&(m.xp6(3),m.Oqu(m.lcZ(4,2,"order.add-item-to-order")),m.xp6(3),m.Q6J("ngIf",m.lcZ(7,4,t.selectedVariant$)))},directives:[ze.c,q.O5,A.y,f.qQ,f.wV,f.Fj,f.JJ,f.On,q.sg,et.M],pipes:[C.X$,q.Ov,k.M,T.k],styles:[".variant-details[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img);width:32px;height:32px}.variant-details[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{font-size:.65rem;line-height:.7rem}.variant-details[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:48px;margin:0 6px}.variant-details[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});var ot=u(772),at=function(e){return{count:e}};function lt(e,t){if(1&e&&(m.TgZ(0,"span",1),m.ALo(1,"translate"),m._UZ(2,"clr-icon",2),m.qZA()),2&e){var n=m.oxw();m.Q6J("title",m.xi3(1,1,"order.refunded-count",m.VKq(4,at,n.getRefundedCount())))}}var ct=function(){function e(){g(this,e)}return v(e,[{key:"getRefundedCount",value:function(){var e,n,r=null!==(n=null===(e=this.payments)||void 0===e?void 0:e.reduce(function(e,n){return[].concat(t(e),t(n.refunds))},[]))&&void 0!==n?n:[];return this.line.items.filter(function(e){if(null===e.refundId&&!e.cancelled)return!1;if(e.refundId){var t=r.find(function(t){return t.id===e.refundId});return"Failed"!==(null==t?void 0:t.state)}return!1}).length}}]),e}();ct.\u0275fac=function(e){return new(e||ct)},ct.\u0275cmp=m.Xpm({type:ct,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(e,t){1&e&&m.YNc(0,lt,3,6,"span",0),2&e&&m.Q6J("ngIf",t.getRefundedCount())},directives:[q.O5,L.qvL,ot.Lv],pipes:[C.X$],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0});var dt=u(2651);function st(e,t){1&e&&m._UZ(0,"clr-icon",9)}function ut(e,t){1&e&&m._UZ(0,"clr-icon",10)}function ft(e,t){1&e&&m._UZ(0,"clr-icon",11)}function pt(e,t){1&e&&(m.TgZ(0,"label",12),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.line-fulfillment-all")," "))}var gt=function(e,t){return{total:e,count:t}};function mt(e,t){if(1&e&&(m.TgZ(0,"label",12),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.hij(" ",m.xi3(2,1,"order.line-fulfillment-partial",m.WLB(4,gt,n.line.quantity,n.fulfilledCount))," ")}}function vt(e,t){1&e&&(m.TgZ(0,"label",12),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.line-fulfillment-none")," "))}function ht(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",15),m.ALo(1,"translate"),m._uU(2),m.qZA()),2&e){var n=m.oxw().$implicit;m.Q6J("label",m.lcZ(1,2,"order.tracking-code")),m.xp6(2),m.hij(" ",n.fulfillment.trackingCode," ")}}var Zt=function(e){return{count:e}};function yt(e,t){if(1&e&&(m.TgZ(0,"div",13),m.TgZ(1,"div",14),m._uU(2),m.ALo(3,"translate"),m.ALo(4,"translate"),m.qZA(),m.TgZ(5,"vdr-labeled-data",15),m.ALo(6,"translate"),m._uU(7),m.ALo(8,"localeDate"),m.qZA(),m.TgZ(9,"vdr-labeled-data",15),m.ALo(10,"translate"),m._uU(11),m.qZA(),m.YNc(12,ht,3,4,"vdr-labeled-data",16),m.qZA()),2&e){var n=t.$implicit;m.xp6(2),m.lnq(" ",m.lcZ(3,8,"order.fulfillment")," #",n.fulfillment.id," (",m.xi3(4,10,"order.item-count",m.VKq(20,Zt,n.count)),") "),m.xp6(3),m.Q6J("label",m.lcZ(6,13,"common.created-at")),m.xp6(2),m.hij(" ",m.xi3(8,15,n.fulfillment.createdAt,"medium")," "),m.xp6(2),m.Q6J("label",m.lcZ(10,18,"order.fulfillment-method")),m.xp6(2),m.hij(" ",n.fulfillment.method," "),m.xp6(1),m.Q6J("ngIf",n.fulfillment.trackingCode)}}function xt(e,t){if(1&e&&(m.TgZ(0,"vdr-dropdown",1),m.TgZ(1,"button",2),m.YNc(2,st,1,0,"clr-icon",3),m.YNc(3,ut,1,0,"clr-icon",4),m.YNc(4,ft,1,0,"clr-icon",5),m.qZA(),m.TgZ(5,"vdr-dropdown-menu",6),m.YNc(6,pt,3,3,"label",7),m.YNc(7,mt,3,7,"label",7),m.YNc(8,vt,3,3,"label",7),m.YNc(9,yt,13,22,"div",8),m.qZA(),m.qZA()),2&e){var n=m.oxw();m.xp6(2),m.Q6J("ngIf","full"===n.fulfillmentStatus),m.xp6(1),m.Q6J("ngIf","partial"===n.fulfillmentStatus),m.xp6(1),m.Q6J("ngIf","none"===n.fulfillmentStatus),m.xp6(2),m.Q6J("ngIf","full"===n.fulfillmentStatus),m.xp6(1),m.Q6J("ngIf","partial"===n.fulfillmentStatus),m.xp6(1),m.Q6J("ngIf","none"===n.fulfillmentStatus),m.xp6(1),m.Q6J("ngForOf",n.fulfillments)}}var At=function(){function e(){g(this,e),this.fulfilledCount=0,this.fulfillments=[]}return v(e,[{key:"ngOnChanges",value:function(e){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.items.length),this.fulfillments=this.getFulfillments(this.line))}},{key:"getDeliveredCount",value:function(e){var t,n;return null!==(n=null===(t=e.fulfillments)||void 0===t?void 0:t.reduce(function(t,n){var r,i;return t+(null!==(i=null===(r=n.summary.find(function(t){return t.orderLine.id===e.id}))||void 0===r?void 0:r.quantity)&&void 0!==i?i:0)},0))&&void 0!==n?n:0}},{key:"getFulfillmentStatus",value:function(e,t){return e===t?"full":0<e&&e<t?"partial":"none"}},{key:"getFulfillments",value:function(e){var t,n;return null!==(n=null===(t=e.fulfillments)||void 0===t?void 0:t.map(function(t){var n,r=t.summary.find(function(t){return t.orderLine.id===e.id});return{count:null!==(n=null==r?void 0:r.quantity)&&void 0!==n?n:0,fulfillment:t}}))&&void 0!==n?n:[]}}]),e}();function bt(e,t){if(1&e&&(m._UZ(0,"img",24),m.ALo(1,"assetPreview")),2&e){var n=m.oxw().$implicit;m.Q6J("src",m.xi3(1,1,n.featuredAsset,"tiny"),m.LSH)}}function Ct(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.BQk()),2&e){var n=m.oxw().$implicit;m.xp6(1),m.hij(" ",n.quantity," ")}}function qt(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div",25),m.TgZ(1,"input",26,27),m.NdJ("blur",function(){m.CHM(n);var e=m.MAs(2),t=m.oxw().$implicit;return m.oxw().draftInputBlur(t,e.valueAsNumber)}),m.qZA(),m.TgZ(3,"button",28),m.NdJ("click",function(){m.CHM(n);var e=m.oxw().$implicit;return m.oxw().remove.emit({lineId:e.id})}),m._UZ(4,"clr-icon",29),m.qZA(),m.qZA()}if(2&e){var r=m.oxw().$implicit;m.xp6(1),m.Q6J("value",r.quantity)}}function Tt(e,t){if(1&e&&(m.TgZ(0,"div",32),m.TgZ(1,"a",33),m._uU(2),m.qZA(),m.TgZ(3,"div",34),m._uU(4),m.ALo(5,"localeCurrency"),m.TgZ(6,"div",7),m.ALo(7,"translate"),m._uU(8),m.ALo(9,"localeCurrency"),m.qZA(),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw(4);m.xp6(1),m.Q6J("routerLink",r.getPromotionLink(n)),m.xp6(1),m.Oqu(n.description),m.xp6(2),m.hij(" ",m.xi3(5,5,n.amountWithTax,r.order.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(7,8,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(9,10,n.amount,r.order.currencyCode)," ")}}function Ot(e,t){if(1&e&&(m.TgZ(0,"vdr-dropdown"),m.TgZ(1,"div",30),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"vdr-dropdown-menu"),m.YNc(5,Tt,10,13,"div",31),m.qZA(),m.qZA()),2&e){var n=m.oxw().ngIf;m.xp6(2),m.hij(" ",m.lcZ(3,2,"order.promotions-applied")," "),m.xp6(3),m.Q6J("ngForOf",n)}}function _t(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Ot,6,4,"vdr-dropdown",23),m.BQk()),2&e){var n=t.ngIf;m.xp6(1),m.Q6J("ngIf",n.length)}}function wt(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"tr",11),m.TgZ(2,"td",12),m.YNc(3,bt,2,4,"img",13),m.qZA(),m.TgZ(4,"td",14),m._uU(5),m.qZA(),m.TgZ(6,"td",15),m._uU(7),m.qZA(),m.TgZ(8,"td",16),m._uU(9),m.qZA(),m.TgZ(10,"td",17),m.YNc(11,Ct,2,1,"ng-container",18),m.YNc(12,qt,5,1,"ng-template",null,19,m.W1O),m._UZ(14,"vdr-line-refunds",20),m._UZ(15,"vdr-line-fulfillment",21),m.qZA(),m.TgZ(16,"td",22),m._uU(17),m.ALo(18,"localeCurrency"),m.TgZ(19,"div",7),m.ALo(20,"translate"),m._uU(21),m.ALo(22,"localeCurrency"),m.qZA(),m.YNc(23,_t,2,1,"ng-container",23),m.qZA(),m.qZA(),m.BQk()),2&e){var n=t.$implicit,r=m.MAs(13),i=m.oxw();m.xp6(1),m.ekj("is-cancelled",0===n.quantity),m.xp6(2),m.Q6J("ngIf",n.featuredAsset),m.xp6(2),m.Oqu(n.productVariant.name),m.xp6(2),m.Oqu(n.productVariant.sku),m.xp6(2),m.hij(" ",n.customFields.isCone?"Yes":"No"," "),m.xp6(2),m.Q6J("ngIf",!i.isDraft)("ngIfElse",r),m.xp6(3),m.Q6J("line",n)("payments",i.order.payments),m.xp6(1),m.Q6J("line",n)("orderState",i.order.state),m.xp6(2),m.hij(" ",m.xi3(18,16,n.linePriceWithTax,i.order.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(20,19,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(22,21,n.linePrice,i.order.currencyCode)," "),m.xp6(2),m.Q6J("ngIf",i.getLineDiscounts(n))}}function It(e,t){if(1&e&&(m.TgZ(0,"tr",35),m.TgZ(1,"td",36),m._uU(2),m.qZA(),m.TgZ(3,"td",15),m._uU(4),m.qZA(),m._UZ(5,"td",37),m.TgZ(6,"td",22),m._uU(7),m.ALo(8,"localeCurrency"),m.TgZ(9,"div",7),m.ALo(10,"translate"),m._uU(11),m.ALo(12,"localeCurrency"),m.qZA(),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw();m.xp6(2),m.Oqu(n.description),m.xp6(2),m.Oqu(n.sku),m.xp6(3),m.hij(" ",m.xi3(8,5,n.priceWithTax,r.order.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(10,8,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(12,10,n.price,r.order.currencyCode)," ")}}function Lt(e,t){if(1&e&&(m.TgZ(0,"vdr-chip"),m._uU(1),m.qZA()),2&e){var n=t.ngIf;m.xp6(1),m.Oqu(n)}}function kt(e,t){if(1&e&&(m.TgZ(0,"tr",39),m.TgZ(1,"td",40),m.TgZ(2,"a",41),m._uU(3),m.qZA(),m.YNc(4,Lt,2,1,"vdr-chip",23),m.qZA(),m.TgZ(5,"td",6),m._uU(6),m.ALo(7,"localeCurrency"),m.TgZ(8,"div",7),m.ALo(9,"translate"),m._uU(10),m.ALo(11,"localeCurrency"),m.qZA(),m.qZA(),m.qZA()),2&e){var n=m.oxw().$implicit,r=m.oxw();m.xp6(2),m.Q6J("routerLink",r.getPromotionLink(n)),m.xp6(1),m.Oqu(n.description),m.xp6(1),m.Q6J("ngIf",r.getCouponCodeForAdjustment(r.order,n)),m.xp6(2),m.hij(" ",m.xi3(7,6,n.amountWithTax,r.order.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(9,9,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(11,11,n.amount,r.order.currencyCode)," ")}}function Nt(e,t){if(1&e&&(m.ynx(0),m.YNc(1,kt,12,14,"tr",38),m.BQk()),2&e){var n=t.$implicit;m.xp6(1),m.Q6J("ngIf","OTHER"!==n.type)}}At.\u0275fac=function(e){return new(e||At)},At.\u0275cmp=m.Xpm({type:At,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",orderState:"orderState"},features:[m.TTD],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(e,t){1&e&&m.YNc(0,xt,10,7,"vdr-dropdown",0),2&e&&m.Q6J("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},directives:[q.O5,We.J,Ge.U,Xe.N,q.sg,L.qvL,L.MgK,Te.W],pipes:[C.X$,dt.H],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-500)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-500)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-500)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0});var St=function(){function e(){g(this,e),this.isDraft=!1,this.adjust=new m.vpe,this.remove=new m.vpe,this.orderLineCustomFieldsVisible=!1,this.customFieldsForLine={}}return v(e,[{key:"visibleOrderLineCustomFields",get:function(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}},{key:"showElided",get:function(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}},{key:"ngOnInit",value:function(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2,this.getLineCustomFields()}},{key:"draftInputBlur",value:function(e,t){e.quantity!==t&&this.adjust.emit({lineId:e.id,quantity:t})}},{key:"toggleOrderLineCustomFields",value:function(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}},{key:"getLineDiscounts",value:function(e){return e.discounts.filter(function(e){return e.type===h.S2X.PROMOTION})}},{key:"getLineCustomFields",value:function(){var e,t=this,n=s(this.order.lines);try{var r=function(){var n=e.value,r=new f.cw({}),i=t.orderLineCustomFields.map(function(e){var t=n.customFields[e.name];return r.addControl(e.name,new f.NI(t)),{config:e,formGroup:r,value:t}}).filter(function(e){return!!t.orderLineCustomFieldsVisible||null!=e.value});t.customFieldsForLine[n.id]=i};for(n.s();!(e=n.n()).done;)r()}catch(i){n.e(i)}finally{n.f()}}},{key:"getPromotionLink",value:function(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}},{key:"getCouponCodeForAdjustment",value:function(e,t){var n=t.adjustmentSource.split(":")[1],r=e.promotions.find(function(e){return e.id===n});if(r)return r.couponCode||void 0}},{key:"getShippingNames",value:function(e){return e.shippingLines.length?e.shippingLines.map(function(e){return e.shippingMethod.name}).join(", "):""}}]),e}();St.\u0275fac=function(e){return new(e||St)},St.\u0275cmp=m.Xpm({type:St,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields",isDraft:"isDraft"},outputs:{adjust:"adjust",remove:"remove"},decls:60,vars:58,consts:[[1,"order-table","table"],[4,"ngFor","ngForOf"],["class","surcharge",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"left","clr-align-middle"],["colspan","4"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["colspan","3"],[1,"total"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],[4,"ngIf","ngIfElse"],["draft",""],[3,"line","payments"],[3,"line","orderState"],[1,"align-middle","total"],[4,"ngIf"],[3,"src"],[1,"flex"],["type","number","min","0",1,"draft-qty",3,"value","blur"],["qtyInput",""],[1,"icon-button",3,"click"],["shape","trash"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],["colspan","2",1,"align-middle"],["class","order-adjustment",4,"ngIf"],[1,"order-adjustment"],["colspan","5",1,"left","clr-align-middle"],[3,"routerLink"]],template:function(e,t){1&e&&(m.TgZ(0,"table",0),m.TgZ(1,"thead"),m.TgZ(2,"tr"),m._UZ(3,"th"),m.TgZ(4,"th"),m._uU(5),m.ALo(6,"translate"),m.qZA(),m.TgZ(7,"th"),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.TgZ(10,"th"),m._uU(11,"Is Cone"),m.qZA(),m.TgZ(12,"th"),m._uU(13),m.ALo(14,"translate"),m.qZA(),m.TgZ(15,"th"),m._uU(16),m.ALo(17,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(18,"tbody"),m.YNc(19,wt,24,24,"ng-container",1),m.YNc(20,It,13,13,"tr",2),m.YNc(21,Nt,2,1,"ng-container",1),m.TgZ(22,"tr",3),m.TgZ(23,"td",4),m._uU(24),m.ALo(25,"translate"),m.qZA(),m._UZ(26,"td",5),m.TgZ(27,"td",6),m._uU(28),m.ALo(29,"localeCurrency"),m.TgZ(30,"div",7),m.ALo(31,"translate"),m._uU(32),m.ALo(33,"localeCurrency"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(34,"tr",8),m.TgZ(35,"td",4),m._uU(36),m.ALo(37,"translate"),m.qZA(),m.TgZ(38,"td",6),m._uU(39),m.qZA(),m._UZ(40,"td",9),m.TgZ(41,"td",6),m._uU(42),m.ALo(43,"localeCurrency"),m.TgZ(44,"div",7),m.ALo(45,"translate"),m._uU(46),m.ALo(47,"localeCurrency"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(48,"tr",10),m.TgZ(49,"td",4),m._uU(50),m.ALo(51,"translate"),m.qZA(),m._UZ(52,"td",5),m.TgZ(53,"td",6),m._uU(54),m.ALo(55,"localeCurrency"),m.TgZ(56,"div",7),m.ALo(57,"translate"),m._uU(58),m.ALo(59,"localeCurrency"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA()),2&e&&(m.xp6(5),m.Oqu(m.lcZ(6,20,"order.product-name")),m.xp6(3),m.Oqu(m.lcZ(9,22,"order.product-sku")),m.xp6(5),m.Oqu(m.lcZ(14,24,"order.quantity")),m.xp6(3),m.Oqu(m.lcZ(17,26,"order.total")),m.xp6(3),m.Q6J("ngForOf",t.order.lines),m.xp6(1),m.Q6J("ngForOf",t.order.surcharges),m.xp6(1),m.Q6J("ngForOf",t.order.discounts),m.xp6(3),m.Oqu(m.lcZ(25,28,"order.sub-total")),m.xp6(4),m.hij(" ",m.xi3(29,30,t.order.subTotalWithTax,t.order.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(31,33,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(33,35,t.order.subTotal,t.order.currencyCode)," "),m.xp6(4),m.Oqu(m.lcZ(37,38,"order.shipping")),m.xp6(3),m.Oqu(t.getShippingNames(t.order)),m.xp6(3),m.hij(" ",m.xi3(43,40,t.order.shippingWithTax,t.order.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(45,43,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(47,45,t.order.shipping,t.order.currencyCode)," "),m.xp6(4),m.Oqu(m.lcZ(51,48,"order.total")),m.xp6(4),m.hij(" ",m.xi3(55,50,t.order.totalWithTax,t.order.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(57,53,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(59,55,t.order.total,t.order.currencyCode)," "))},directives:[q.sg,q.O5,ct,At,A.y,L.qvL,We.J,Ge.U,Xe.N,Ne.yS,V.Y],pipes:[C.X$,T.k,k.M],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:bold;border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-left:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});var Ft=u(50837);function Jt(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",9),m.NdJ("click",function(){return m.CHM(n),m.oxw(2).editable=!0}),m._UZ(1,"clr-icon",10),m._uU(2),m.ALo(3,"translate"),m.qZA()}2&e&&(m.xp6(2),m.hij(" ",m.lcZ(3,1,"common.edit")," "))}function Mt(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",11),m.NdJ("click",function(){return m.CHM(n),m.oxw(2).onUpdateClick()}),m._UZ(1,"clr-icon",12),m._uU(2),m.ALo(3,"translate"),m.qZA()}if(2&e){var r=m.oxw(2);m.Q6J("disabled",r.customFieldForm.pristine||r.customFieldForm.invalid),m.xp6(2),m.hij(" ",m.lcZ(3,2,"common.update")," ")}}function Ut(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",9),m.NdJ("click",function(){return m.CHM(n),m.oxw(2).onCancelClick()}),m._UZ(1,"clr-icon",13),m._uU(2),m.ALo(3,"translate"),m.qZA()}2&e&&(m.xp6(2),m.hij(" ",m.lcZ(3,1,"common.cancel")," "))}function Pt(e,t){if(1&e&&(m.TgZ(0,"div",1),m.TgZ(1,"div",2),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"div",3),m.TgZ(5,"div",4),m._UZ(6,"vdr-tabbed-custom-fields",5),m.qZA(),m.qZA(),m.TgZ(7,"div",6),m.YNc(8,Jt,4,3,"button",7),m.YNc(9,Mt,4,4,"button",8),m.YNc(10,Ut,4,3,"button",7),m.qZA(),m.qZA()),2&e){var n=m.oxw();m.xp6(2),m.hij(" ",m.lcZ(3,10,"common.custom-fields")," "),m.xp6(3),m.ekj("editable",n.editable),m.xp6(1),m.Q6J("customFields",n.customFieldsConfig)("customFieldsFormGroup",n.customFieldForm)("readonly",!n.editable)("compact",!0),m.xp6(2),m.Q6J("ngIf",!n.editable),m.xp6(1),m.Q6J("ngIf",n.editable),m.xp6(1),m.Q6J("ngIf",n.editable)}}var Qt=function(){function e(t,n){g(this,e),this.formBuilder=t,this.modalService=n,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new m.vpe,this.editable=!1}return v(e,[{key:"ngOnInit",value:function(){this.customFieldForm=this.formBuilder.group({});var e,t=s(this.customFieldsConfig);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.customFieldForm.addControl(n.name,this.formBuilder.control(this.customFieldValues[n.name]))}}catch(r){t.e(r)}finally{t.f()}}},{key:"onUpdateClick",value:function(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}},{key:"onCancelClick",value:function(){var e=this;this.customFieldForm.dirty?this.modalService.dialog({title:(0,I.J)("catalog.confirm-cancel"),buttons:[{type:"secondary",label:(0,I.J)("common.keep-editing")},{type:"danger",label:(0,I.J)("common.discard-changes"),returnValue:!0}]}).subscribe(function(t){t&&(e.customFieldForm.reset(),e.customFieldForm.markAsPristine(),e.editable=!1)}):this.editable=!1}}]),e}();Qt.\u0275fac=function(e){return new(e||Qt)(m.Y36(f.qu),m.Y36(h.Z7U))},Qt.\u0275cmp=m.Xpm({type:Qt,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly","compact"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"],["shape","times"]],template:function(e,t){1&e&&m.YNc(0,Pt,11,12,"div",0),2&e&&m.Q6J("ngIf",t.customFieldsConfig.length)},directives:[q.O5,Ft.y,L.qvL],pipes:[C.X$],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0});var Yt=u(90458);function jt(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"vdr-action-bar"),m.TgZ(1,"vdr-ab-left"),m.TgZ(2,"div",1),m._UZ(3,"vdr-entity-info",2),m.ALo(4,"async"),m._UZ(5,"vdr-order-state-label",3),m.qZA(),m.qZA(),m.TgZ(6,"vdr-ab-right"),m.TgZ(7,"button",4),m.NdJ("click",function(){return m.CHM(n),m.oxw().completeOrder()}),m._UZ(8,"clr-icon",5),m._uU(9),m.ALo(10,"translate"),m.qZA(),m.TgZ(11,"vdr-dropdown"),m.TgZ(12,"button",6),m._UZ(13,"clr-icon",7),m.qZA(),m.TgZ(14,"vdr-dropdown-menu",8),m.TgZ(15,"button",9),m.NdJ("click",function(){return m.CHM(n),m.oxw().deleteOrder()}),m._UZ(16,"clr-icon",10),m._uU(17),m.ALo(18,"translate"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(3),m.Q6J("entity",m.lcZ(4,5,i.entity$)),m.xp6(2),m.Q6J("state",r.state),m.xp6(2),m.Q6J("disabled",!r.customer||!r.lines.length||!r.shippingLines.length),m.xp6(2),m.hij(" ",m.lcZ(10,7,"order.complete-draft-order")," "),m.xp6(8),m.hij(" ",m.lcZ(18,9,"order.delete-draft-order")," ")}}function Dt(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",30),m.NdJ("click",function(){m.CHM(n);var e=m.oxw(2);return e.displayCouponCodeInput=!e.displayCouponCodeInput}),m._uU(1),m.ALo(2,"translate"),m.qZA()}2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.set-coupon-codes")," "))}function Et(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div"),m.TgZ(1,"label"),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"vdr-coupon-code-selector",31),m.NdJ("addCouponCode",function(e){return m.CHM(n),m.oxw(2).applyCouponCode(e)})("removeCouponCode",function(e){return m.CHM(n),m.oxw(2).removeCouponCode(e)}),m.qZA(),m.qZA()}if(2&e){var r=m.oxw().ngIf;m.xp6(2),m.Oqu(m.lcZ(3,2,"order.set-coupon-codes")),m.xp6(2),m.Q6J("couponCodes",r.couponCodes)}}function $t(e,t){if(1&e&&(m.TgZ(0,"tr"),m.TgZ(1,"td"),m._uU(2),m.qZA(),m.TgZ(3,"td"),m._uU(4),m.ALo(5,"percent"),m.qZA(),m.TgZ(6,"td"),m._uU(7),m.ALo(8,"localeCurrency"),m.qZA(),m.TgZ(9,"td"),m._uU(10),m.ALo(11,"localeCurrency"),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw(2).ngIf;m.xp6(2),m.Oqu(n.description),m.xp6(2),m.Oqu(m.lcZ(5,4,n.taxRate/100)),m.xp6(3),m.Oqu(m.xi3(8,6,n.taxBase,r.currencyCode)),m.xp6(3),m.Oqu(m.xi3(11,9,n.taxTotal,r.currencyCode))}}function Rt(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"h4"),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"table",32),m.TgZ(5,"thead"),m.TgZ(6,"tr"),m.TgZ(7,"th"),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.TgZ(10,"th"),m._uU(11),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"th"),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"th"),m._uU(17),m.ALo(18,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(19,"tbody"),m.YNc(20,$t,12,12,"tr",28),m.qZA(),m.qZA(),m.BQk()),2&e){var n=m.oxw().ngIf;m.xp6(2),m.Oqu(m.lcZ(3,6,"order.tax-summary")),m.xp6(6),m.Oqu(m.lcZ(9,8,"common.description")),m.xp6(3),m.Oqu(m.lcZ(12,10,"order.tax-rate")),m.xp6(3),m.Oqu(m.lcZ(15,12,"order.tax-base")),m.xp6(3),m.Oqu(m.lcZ(18,14,"order.tax-total")),m.xp6(3),m.Q6J("ngForOf",n.taxSummary)}}function Ht(e,t){1&e&&m._UZ(0,"clr-icon",33)}function Vt(e,t){1&e&&m._UZ(0,"clr-icon",34)}function Bt(e,t){if(1&e&&m._UZ(0,"vdr-customer-label",35),2&e){var n=m.oxw().ngIf;m.Q6J("customer",n.customer)}}function Wt(e,t){1&e&&m._UZ(0,"clr-icon",33)}function Gt(e,t){1&e&&m._UZ(0,"clr-icon",34)}function Xt(e,t){if(1&e&&m._UZ(0,"vdr-formatted-address",36),2&e){var n=m.oxw().ngIf;m.Q6J("address",n.billingAddress)}}function Kt(e,t){1&e&&m._UZ(0,"clr-icon",33)}function zt(e,t){1&e&&m._UZ(0,"clr-icon",34)}function en(e,t){if(1&e&&m._UZ(0,"vdr-formatted-address",36),2&e){var n=m.oxw().ngIf;m.Q6J("address",n.shippingAddress)}}function tn(e,t){if(1&e&&(m.TgZ(0,"div"),m._uU(1),m.qZA()),2&e){var n=t.$implicit;m.xp6(1),m.hij(" ",n.shippingMethod.name," ")}}function nn(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div"),m.TgZ(1,"div",11),m.TgZ(2,"div",12),m.TgZ(3,"vdr-draft-order-variant-selector",13),m.NdJ("addItem",function(e){return m.CHM(n),m.oxw().addItemToOrder(e)}),m.qZA(),m.TgZ(4,"vdr-order-table",14),m.NdJ("adjust",function(e){return m.CHM(n),m.oxw().adjustOrderLine(e)})("remove",function(e){return m.CHM(n),m.oxw().removeOrderLine(e)}),m.qZA(),m.TgZ(5,"div",15),m.YNc(6,Dt,3,3,"button",16),m.YNc(7,Et,5,4,"div",0),m.qZA(),m.YNc(8,Rt,21,16,"ng-container",0),m.qZA(),m.TgZ(9,"div",17),m.TgZ(10,"div",18),m.TgZ(11,"div",19),m.YNc(12,Ht,1,0,"clr-icon",20),m.YNc(13,Vt,1,0,"clr-icon",21),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"div",22),m.TgZ(17,"div",23),m.YNc(18,Bt,1,1,"vdr-customer-label",24),m.TgZ(19,"button",25),m.NdJ("click",function(){return m.CHM(n),m.oxw().setCustomer()}),m._uU(20),m.ALo(21,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(22,"div",22),m.TgZ(23,"h4",26),m.YNc(24,Wt,1,0,"clr-icon",20),m.YNc(25,Gt,1,0,"clr-icon",21),m._uU(26),m.ALo(27,"translate"),m.qZA(),m.TgZ(28,"div",23),m.YNc(29,Xt,1,1,"vdr-formatted-address",27),m.TgZ(30,"button",25),m.NdJ("click",function(){return m.CHM(n),m.oxw().setBillingAddress()}),m._uU(31),m.ALo(32,"translate"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(33,"div",18),m.TgZ(34,"div",19),m.YNc(35,Kt,1,0,"clr-icon",20),m.YNc(36,zt,1,0,"clr-icon",21),m._uU(37),m.ALo(38,"translate"),m.qZA(),m.TgZ(39,"div",22),m.TgZ(40,"div",23),m.YNc(41,en,1,1,"vdr-formatted-address",27),m.TgZ(42,"button",25),m.NdJ("click",function(){return m.CHM(n),m.oxw().setShippingAddress()}),m._uU(43),m.ALo(44,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(45,"div",22),m.TgZ(46,"div",23),m.YNc(47,tn,2,1,"div",28),m.TgZ(48,"button",25),m.NdJ("click",function(){return m.CHM(n),m.oxw().setShippingMethod()}),m._uU(49),m.ALo(50,"translate"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(51,"vdr-order-custom-fields-card",29),m.NdJ("updateClick",function(e){return m.CHM(n),m.oxw().updateCustomFields(e)}),m.qZA(),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(3),m.Q6J("orderLineCustomFields",i.orderLineCustomFields)("currencyCode",r.currencyCode),m.xp6(1),m.Q6J("order",r)("orderLineCustomFields",i.orderLineCustomFields)("isDraft",!0),m.xp6(2),m.Q6J("ngIf",0===r.couponCodes.length&&!i.displayCouponCodeInput),m.xp6(1),m.Q6J("ngIf",r.couponCodes.length||i.displayCouponCodeInput),m.xp6(1),m.Q6J("ngIf",r.taxSummary.length),m.xp6(4),m.Q6J("ngIf",!r.customer),m.xp6(1),m.Q6J("ngIf",r.customer),m.xp6(1),m.hij(" ",m.lcZ(15,27,"order.customer")," "),m.xp6(4),m.Q6J("ngIf",r.customer),m.xp6(2),m.hij(" ",m.lcZ(21,29,"order.set-customer-for-order")," "),m.xp6(4),m.Q6J("ngIf",!r.billingAddress.streetLine1),m.xp6(1),m.Q6J("ngIf",r.billingAddress.streetLine1),m.xp6(1),m.hij(" ",m.lcZ(27,31,"order.billing-address")," "),m.xp6(3),m.Q6J("ngIf",r.billingAddress),m.xp6(2),m.hij(" ",m.lcZ(32,33,"order.set-billing-address")," "),m.xp6(4),m.Q6J("ngIf",!r.shippingAddress.streetLine1||!r.shippingLines.length),m.xp6(1),m.Q6J("ngIf",r.shippingAddress.streetLine1&&r.shippingLines.length),m.xp6(1),m.hij(" ",m.lcZ(38,35,"order.shipping")," "),m.xp6(4),m.Q6J("ngIf",r.shippingAddress),m.xp6(2),m.hij(" ",m.lcZ(44,37,"order.set-shipping-address")," "),m.xp6(4),m.Q6J("ngForOf",r.shippingLines),m.xp6(2),m.hij(" ",m.lcZ(50,39,"order.set-shipping-method")," "),m.xp6(2),m.Q6J("customFieldsConfig",i.customFields)("customFieldValues",r.customFields)}}var rn=function(e){r(n,e);var t=o(n);function n(e,r,i,o,a,l,c,d){var s;return g(this,n),(s=t.call(this,r,e,i,a)).changeDetector=o,s.dataService=a,s.notificationService=l,s.modalService=c,s.orderTransitionService=d,s.detailForm=new f.cw({}),s.fetchHistory=new j.xQ,s.displayCouponCodeInput=!1,s}return v(n,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.eligibleShippingMethods$=this.entity$.pipe((0,$.w)(function(t){return e.dataService.order.getDraftOrderEligibleShippingMethods(t.id).mapSingle(function(e){return e.eligibleShippingMethodsForDraftOrder})})),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine")}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"addItemToOrder",value:function(e){var t=this;this.dataService.order.addItemToDraftOrder(this.id,e).subscribe(function(e){"Order"!==e.addItemToDraftOrder.__typename&&t.notificationService.error(e.addItemToDraftOrder.message)})}},{key:"adjustOrderLine",value:function(e){var t=this;this.dataService.order.adjustDraftOrderLine(this.id,{orderLineId:e.lineId,quantity:e.quantity}).subscribe(function(e){"Order"!==e.adjustDraftOrderLine.__typename&&t.notificationService.error(e.adjustDraftOrderLine.message)})}},{key:"removeOrderLine",value:function(e){var t=this;this.dataService.order.removeDraftOrderLine(this.id,e.lineId).subscribe(function(e){"Order"!==e.removeDraftOrderLine.__typename&&t.notificationService.error(e.removeDraftOrderLine.message)})}},{key:"getOrderAddressLines",value:function(e){return e?Object.values(e).filter(function(e){return"OrderAddress"!==e}).filter(function(e){return!!e}):[]}},{key:"setCustomer",value:function(){var e=this;this.modalService.fromComponent(qe).subscribe(function(t){e.hasId(t)?e.dataService.order.setCustomerForDraftOrder(e.id,{customerId:t.id}).subscribe():t&&e.dataService.order.setCustomerForDraftOrder(e.id,{input:t}).subscribe()})}},{key:"setShippingAddress",value:function(){var e=this;this.entity$.pipe((0,z.q)(1),(0,$.w)(function(t){var n,r;return e.modalService.fromComponent(me,{locals:{customerId:null===(n=t.customer)||void 0===n?void 0:n.id,currentAddress:null!==(r=t.shippingAddress)&&void 0!==r?r:void 0}})})).subscribe(function(t){t&&e.dataService.order.setDraftOrderShippingAddress(e.id,t).subscribe()})}},{key:"setBillingAddress",value:function(){var e=this;this.entity$.pipe((0,z.q)(1),(0,$.w)(function(t){var n,r;return e.modalService.fromComponent(me,{locals:{customerId:null===(n=t.customer)||void 0===n?void 0:n.id,currentAddress:null!==(r=t.billingAddress)&&void 0!==r?r:void 0}})})).subscribe(function(t){t&&e.dataService.order.setDraftOrderBillingAddress(e.id,t).subscribe()})}},{key:"applyCouponCode",value:function(e){this.dataService.order.applyCouponCodeToDraftOrder(this.id,e).subscribe()}},{key:"removeCouponCode",value:function(e){this.dataService.order.removeCouponCodeFromDraftOrder(this.id,e).subscribe()}},{key:"setShippingMethod",value:function(){var e=this;(0,K.aj)(this.entity$,this.eligibleShippingMethods$).pipe((0,z.q)(1),(0,$.w)(function(t){var n,r,i=d(t,2),o=i[0],a=i[1];return e.modalService.fromComponent(ke,{locals:{eligibleShippingMethods:a,currencyCode:o.currencyCode,currentSelectionId:null===(r=null===(n=o.shippingLines)||void 0===n?void 0:n[0])||void 0===r?void 0:r.shippingMethod.id}})})).subscribe(function(t){t&&e.dataService.order.setDraftOrderShippingMethod(e.id,t).subscribe()})}},{key:"updateCustomFields",value:function(e){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe()}},{key:"deleteOrder",value:function(){var e=this;this.dataService.order.deleteDraftOrder(this.id).subscribe(function(t){var n=t.deleteDraftOrder;n.result===h.PcR.DELETED?(e.notificationService.success((0,I.J)("common.notify-delete-success"),{entity:"Order"}),e.router.navigate(["/orders"])):n.message&&e.notificationService.error(n.message)})}},{key:"completeOrder",value:function(){var e=this;this.dataService.order.transitionToState(this.id,"ArrangingPayment").subscribe(function(t){var n=t.transitionOrderToState;"Order"===(null==n?void 0:n.__typename)?e.router.navigate(["/orders",e.id]):"OrderStateTransitionError"===(null==n?void 0:n.__typename)&&e.notificationService.error(n.transitionError)})}},{key:"hasId",value:function(e){return"object"==typeof e&&!!e.id}},{key:"setFormValues",value:function(e){}}]),n}(h.UT_);rn.\u0275fac=function(e){return new(e||rn)(m.Y36(Ne.F0),m.Y36(Ne.gz),m.Y36(h.iHG),m.Y36(m.sBO),m.Y36(h.DoR),m.Y36(h.gqp),m.Y36(h.Z7U),m.Y36(Re))},rn.\u0275cmp=m.Xpm({type:rn,selectors:[["vdr-draft-order-detail"]],features:[m.qOj],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-primary",3,"disabled","click"],["shape","check"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","trash",1,"is-danger"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"orderLineCustomFields","currencyCode","addItem"],[3,"order","orderLineCustomFields","isDraft","adjust","remove"],[1,"flex"],["class","btn btn-link btn-sm mr2",3,"click",4,"ngIf"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],["shape","unknown-status","class","is-warning",4,"ngIf"],["shape","check","class","is-success",4,"ngIf"],[1,"card-block"],[1,"card-text"],["class","block mb2",3,"customer",4,"ngIf"],[1,"btn","btn-link","btn-sm",3,"click"],[1,"card-title"],["class","block mb2",3,"address",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"btn","btn-link","btn-sm","mr2",3,"click"],[3,"couponCodes","addCouponCode","removeCouponCode"],[1,"table"],["shape","unknown-status",1,"is-warning"],["shape","check",1,"is-success"],[1,"block","mb2",3,"customer"],[1,"block","mb2",3,"address"]],template:function(e,t){1&e&&(m.YNc(0,jt,19,11,"vdr-action-bar",0),m.ALo(1,"async"),m.YNc(2,nn,52,41,"div",0),m.ALo(3,"async")),2&e&&(m.Q6J("ngIf",m.lcZ(1,2,t.entity$)),m.xp6(2),m.Q6J("ngIf",m.lcZ(3,4,t.entity$)))},directives:[q.O5,He.Kk,He.BN,Ve.V,Be.G,He.mz,L.qvL,We.J,Ge.U,Xe.N,Ke.H,it,St,q.sg,Qt,L.MgK,W,Yt.d,ae.b],pipes:[q.Ov,C.X$,q.Zx,T.k],styles:[""],changeDetection:0});var on=u(54116);function an(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.fulfill-order"))}function ln(e,t){if(1&e&&(m._UZ(0,"img",17),m.ALo(1,"assetPreview")),2&e){var n=m.oxw().$implicit;m.Q6J("src",m.xi3(1,1,n.featuredAsset,"tiny"),m.LSH)}}function cn(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"input",18),m.NdJ("ngModelChange",function(e){m.CHM(n);var t=m.oxw().$implicit;return m.oxw().fulfillmentQuantities[t.id].fulfillCount=e}),m.qZA()}if(2&e){var r=m.oxw().$implicit,i=m.oxw();m.Q6J("disabled",0===i.getUnfulfilledCount(r))("ngModel",i.fulfillmentQuantities[r.id].fulfillCount)("max",i.fulfillmentQuantities[r.id].max)}}function dn(e,t){if(1&e&&(m.TgZ(0,"tr",9),m.TgZ(1,"td",10),m.YNc(2,ln,2,4,"img",11),m.qZA(),m.TgZ(3,"td",12),m._uU(4),m.qZA(),m.TgZ(5,"td",13),m._uU(6),m.qZA(),m.TgZ(7,"td",14),m._uU(8),m.qZA(),m.TgZ(9,"td",14),m._uU(10),m.qZA(),m.TgZ(11,"td",15),m.YNc(12,cn,1,3,"input",16),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw();m.ekj("ignore",0===r.getUnfulfilledCount(n)),m.xp6(2),m.Q6J("ngIf",n.featuredAsset),m.xp6(2),m.Oqu(n.productVariant.name),m.xp6(2),m.Oqu(n.productVariant.sku),m.xp6(2),m.Oqu(r.getUnfulfilledCount(n)),m.xp6(2),m.Oqu(n.productVariant.stockOnHand),m.xp6(2),m.Q6J("ngIf",r.fulfillmentQuantities[n.id])}}function sn(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",19),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",20),m.NdJ("click",function(){return m.CHM(n),m.oxw().select()}),m._uU(4),m.ALo(5,"translate"),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,3,"common.cancel")),m.xp6(2),m.Q6J("disabled",!r.canSubmit()),m.xp6(1),m.hij(" ",m.lcZ(5,5,"order.create-fulfillment")," ")}}var un=function(){function e(t,n){g(this,e),this.dataService=t,this.changeDetector=n,this.fulfillmentHandlerControl=new f.NI,this.fulfillmentQuantities={}}return v(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getGlobalSettings().single$.subscribe(function(t){var n=t.globalSettings;e.fulfillmentQuantities=e.order.lines.reduce(function(t,r){var i=e.getFulfillableCount(r,n.trackInventory);return Object.assign(Object.assign({},t),p({},r.id,{fulfillCount:i,max:i}))},{}),e.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(function(e){return e.fulfillmentHandlers}).subscribe(function(t){e.fulfillmentHandlerDef=t.find(function(t){var n,r;return t.code===(null===(r=null===(n=e.order.shippingLines[0])||void 0===n?void 0:n.shippingMethod)||void 0===r?void 0:r.fulfillmentHandlerCode)})||t[0],e.fulfillmentHandler=(0,h.miO)(e.fulfillmentHandlerDef),e.fulfillmentHandlerControl.patchValue(e.fulfillmentHandler),e.changeDetector.markForCheck()})}},{key:"getFulfillableCount",value:function(e,t){var n=e.productVariant,r=n.trackInventory,i=n.stockOnHand,o=r===h.TvZ.INHERIT?t:r===h.TvZ.TRUE,a=this.getUnfulfilledCount(e);return o?Math.min(a,i):a}},{key:"getUnfulfilledCount",value:function(e){var t,n,r=null!==(n=null===(t=e.fulfillments)||void 0===t?void 0:t.map(function(e){return e.summary}).flat().filter(function(t){return t.orderLine.id===e.id}).reduce(function(e,t){return e+t.quantity},0))&&void 0!==n?n:0;return e.quantity-r}},{key:"canSubmit",value:function(){var e=Object.values(this.fulfillmentQuantities).reduce(function(e,t){return e+t.fulfillCount},0);return(0,h.dOS)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<e}},{key:"select",value:function(){var e=Object.entries(this.fulfillmentQuantities).map(function(e){var t=d(e,2);return{orderLineId:t[0],quantity:t[1].fulfillCount}});this.resolveWith({lines:e,handler:(0,h.RnJ)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();function fn(e,t){1&e&&m._UZ(0,"clr-icon",2)}un.\u0275fac=function(e){return new(e||un)(m.Y36(h.DoR),m.Y36(m.sBO))},un.\u0275cmp=m.Xpm({type:un,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,an,2,3,"ng-template",0),m.TgZ(1,"div",1),m.TgZ(2,"div",2),m.TgZ(3,"table",3),m.TgZ(4,"thead"),m.TgZ(5,"tr"),m._UZ(6,"th"),m.TgZ(7,"th"),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.TgZ(10,"th"),m._uU(11),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"th"),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"th"),m._uU(17),m.ALo(18,"translate"),m.qZA(),m.TgZ(19,"th"),m._uU(20),m.ALo(21,"translate"),m.qZA(),m.qZA(),m.qZA(),m.YNc(22,dn,13,8,"tr",4),m.qZA(),m.qZA(),m.TgZ(23,"div",5),m._UZ(24,"vdr-formatted-address",6),m.TgZ(25,"h6"),m._uU(26),m.ALo(27,"translate"),m.qZA(),m._uU(28),m.TgZ(29,"strong"),m._uU(30),m.ALo(31,"localeCurrency"),m.qZA(),m._UZ(32,"vdr-configurable-input",7),m.qZA(),m.qZA(),m.YNc(33,sn,6,7,"ng-template",8)),2&e&&(m.xp6(8),m.Oqu(m.lcZ(9,14,"order.product-name")),m.xp6(3),m.Oqu(m.lcZ(12,16,"order.product-sku")),m.xp6(3),m.Oqu(m.lcZ(15,18,"order.unfulfilled")),m.xp6(3),m.Oqu(m.lcZ(18,20,"catalog.stock-on-hand")),m.xp6(3),m.Oqu(m.lcZ(21,22,"order.fulfill")),m.xp6(2),m.Q6J("ngForOf",t.order.lines),m.xp6(2),m.Q6J("address",t.order.shippingAddress),m.xp6(2),m.Oqu(m.lcZ(27,24,"order.shipping-method")),m.xp6(2),m.hij(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),m.xp6(2),m.Oqu(m.xi3(31,26,t.order.shipping,t.order.currencyCode)),m.xp6(2),m.Q6J("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},directives:[Z.q,q.sg,ae.b,on.q,f.JJ,f.oH,b.n,q.O5,A.y,f.qQ,f.wV,f.Fd,f.Fj,f.On],pipes:[C.X$,T.k,k.M],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0});var pn=function(){function e(){g(this,e)}return v(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}]),e}();pn.\u0275fac=function(e){return new(e||pn)},pn.\u0275cmp=m.Xpm({type:pn,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(m.TgZ(0,"vdr-chip",0),m.ALo(1,"translate"),m.YNc(2,fn,1,0,"clr-icon",1),m._uU(3),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.qZA()),2&e&&(m.Q6J("title",m.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),m.xp6(2),m.Q6J("ngIf","Delivered"===t.state),m.xp6(1),m.hij(" ",m.lcZ(4,6,m.lcZ(5,8,t.state)),"\n"))},directives:[V.Y,q.O5,L.qvL],pipes:[C.X$,Pe.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var gn=u(87187);function mn(e,t){if(1&e&&(m.TgZ(0,"li",2),m.TgZ(1,"div",3),m._uU(2),m.qZA(),m._UZ(3,"clr-icon",4),m._uU(4),m.qZA()),2&e){var n=t.$implicit;m.Q6J("title",n.name),m.xp6(2),m.Oqu(n.quantity),m.xp6(2),m.hij(" ",n.name," ")}}var vn=function e(){g(this,e)};function hn(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.qZA()),2&e){var n=m.oxw();m.Q6J("label",m.lcZ(1,2,"order.tracking-code")),m.xp6(2),m.hij(" ",null==n.fulfillment?null:n.fulfillment.trackingCode,"\n")}}function Zn(e,t){if(1&e&&m._UZ(0,"vdr-custom-field-control",5),2&e){var n=m.oxw().$implicit,r=m.oxw();m.Q6J("readonly",!0)("compact",!0)("customField",n)("customFieldsFormGroup",r.customFieldFormGroup)}}function yn(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Zn,1,4,"vdr-custom-field-control",4),m.BQk()),2&e){var n=t.$implicit,r=m.oxw();m.xp6(1),m.Q6J("ngIf",r.customFieldFormGroup.get(n.name))}}vn.\u0275fac=function(e){return new(e||vn)},vn.\u0275cmp=m.Xpm({type:vn,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0),m.TgZ(1,"ul"),m.YNc(2,mn,5,3,"li",1),m.qZA(),m.qZA()),2&e&&(m.xp6(2),m.Q6J("ngForOf",t.items))},directives:[q.sg,L.qvL],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-left:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0});var xn=function(){function e(t){g(this,e),this.serverConfigService=t,this.customFieldConfig=[],this.customFieldFormGroup=new f.cw({})}return v(e,[{key:"ngOnInit",value:function(){this.customFieldConfig=this.serverConfigService.getCustomFieldsFor("Fulfillment")}},{key:"ngOnChanges",value:function(e){this.buildCustomFieldsFormGroup()}},{key:"fulfillment",get:function(){var e=this;return this.order.fulfillments&&this.order.fulfillments.find(function(t){return t.id===e.fulfillmentId})}},{key:"items",get:function(){var e,t,n=this;return null!==(t=null===(e=this.fulfillment)||void 0===e?void 0:e.summary.map(function(e){var t,r;return{name:null!==(r=null===(t=n.order.lines.find(function(t){return t.id===e.orderLine.id}))||void 0===t?void 0:t.productVariant.name)&&void 0!==r?r:"",quantity:e.quantity}}))&&void 0!==t?t:[]}},{key:"buildCustomFieldsFormGroup",value:function(){var e,t=this.fulfillment.customFields,n=s(this.serverConfigService.getCustomFieldsFor("Fulfillment"));try{for(n.s();!(e=n.n()).done;){var r=e.value;this.customFieldFormGroup.addControl(r.name,new f.NI(t[r.name]))}}catch(i){n.e(i)}finally{n.f()}}},{key:"customFieldIsObject",value:function(e){return Array.isArray(e)||(0,gn.isObject)(e)}}]),e}();function An(e,t){if(1&e&&m._UZ(0,"vdr-fulfillment-detail",7),2&e){var n=m.oxw();m.Q6J("fulfillmentId",null==n.fulfillment?null:n.fulfillment.id)("order",n.order)}}xn.\u0275fac=function(e){return new(e||xn)(m.Y36(h.iHG))},xn.\u0275cmp=m.Xpm({type:xn,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[m.TTD],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"readonly","compact","customField","customFieldsFormGroup",4,"ngIf"],[3,"readonly","compact","customField","customFieldsFormGroup"]],template:function(e,t){1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.ALo(3,"localeDate"),m.qZA(),m.TgZ(4,"vdr-labeled-data",0),m.ALo(5,"translate"),m._uU(6),m.qZA(),m.YNc(7,hn,3,4,"vdr-labeled-data",1),m.TgZ(8,"vdr-labeled-data",0),m.ALo(9,"translate"),m._UZ(10,"vdr-simple-item-list",2),m.qZA(),m.YNc(11,yn,2,1,"ng-container",3)),2&e&&(m.Q6J("label",m.lcZ(1,8,"common.created-at")),m.xp6(2),m.hij(" ",m.xi3(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),m.xp6(2),m.Q6J("label",m.lcZ(5,13,"order.fulfillment-method")),m.xp6(2),m.hij(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),m.xp6(1),m.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),m.xp6(1),m.Q6J("label",m.lcZ(9,15,"order.contents")),m.xp6(2),m.Q6J("items",t.items),m.xp6(1),m.Q6J("ngForOf",t.customFieldConfig))},directives:[Te.W,q.O5,vn,q.sg,et.M],pipes:[C.X$,dt.H],styles:[""],changeDetection:0});var bn=function(e){return{state:e}};function Cn(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"button",14),m.NdJ("click",function(){var e=m.CHM(n).ngIf;return m.oxw(2).transitionState.emit(e)}),m._uU(2),m.ALo(3,"translate"),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.qZA(),m.BQk()}if(2&e){var r=t.ngIf;m.xp6(2),m.hij(" ",m.xi3(3,1,"order.set-fulfillment-state",m.VKq(8,bn,m.lcZ(4,4,m.lcZ(5,6,r))))," ")}}function qn(e,t){if(1&e&&(m.ynx(0),m._UZ(1,"clr-icon",18),m._uU(2),m.ALo(3,"translate"),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.BQk()),2&e){var n=m.oxw().$implicit;m.xp6(2),m.hij(" ",m.xi3(3,1,"order.transition-to-state",m.VKq(8,bn,m.lcZ(4,4,m.lcZ(5,6,n))))," ")}}function Tn(e,t){1&e&&(m._UZ(0,"clr-icon",19),m._uU(1),m.ALo(2,"translate")),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.cancel-fulfillment")," "))}function On(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"button",15),m.NdJ("click",function(){var e=m.CHM(n).$implicit;return m.oxw(2).transitionState.emit(e)}),m.YNc(2,qn,6,10,"ng-container",16),m.YNc(3,Tn,3,3,"ng-template",null,17,m.W1O),m.qZA(),m.BQk()}if(2&e){var r=t.$implicit,i=m.MAs(4);m.xp6(2),m.Q6J("ngIf","Cancelled"!==r)("ngIfElse",i)}}function _n(e,t){if(1&e&&(m.TgZ(0,"div",8),m.YNc(1,Cn,6,10,"ng-container",9),m.TgZ(2,"vdr-dropdown"),m.TgZ(3,"button",10),m._UZ(4,"clr-icon",11),m.qZA(),m.TgZ(5,"vdr-dropdown-menu",12),m.YNc(6,On,5,2,"ng-container",13),m.qZA(),m.qZA(),m.qZA()),2&e){var n=m.oxw();m.xp6(1),m.Q6J("ngIf",n.nextSuggestedState()),m.xp6(5),m.Q6J("ngForOf",n.nextOtherStates())}}var wn=function(){function e(){g(this,e),this.transitionState=new m.vpe}return v(e,[{key:"nextSuggestedState",value:function(){var e;if(this.fulfillment){var t=this.fulfillment.nextStates,n=function(e){return t.includes(e)?e:t[0]};switch(null===(e=this.fulfillment)||void 0===e?void 0:e.state){case"Pending":return n("Shipped");case"Shipped":return n("Delivered");default:return t.find(function(e){return"Cancelled"!==e})}}}},{key:"nextOtherStates",value:function(){if(!this.fulfillment)return[];var e=this.nextSuggestedState();return this.fulfillment.nextStates.filter(function(t){return t!==e})}}]),e}();function In(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.qZA()),2&e){var n=m.oxw();m.Q6J("label",m.lcZ(1,2,"order.note")),m.xp6(2),m.Oqu(n.modification.note)}}function Ln(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.ALo(3,"localeCurrency"),m.qZA()),2&e){var n,r=t.$implicit,i=m.oxw();m.Q6J("label",m.lcZ(1,3,"order.surcharges")),m.xp6(2),m.AsE(" ",null==(n=i.getSurcharge(r.id))?null:n.description," ",m.xi3(3,5,null==(n=i.getSurcharge(r.id))?null:n.priceWithTax,i.order.currencyCode),"")}}function kn(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._UZ(2,"vdr-simple-item-list",3),m.qZA()),2&e){var n=m.oxw();m.Q6J("label",m.lcZ(1,2,"order.added-items")),m.xp6(2),m.Q6J("items",n.getAddedItems())}}function Nn(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._UZ(2,"vdr-simple-item-list",3),m.qZA()),2&e){var n=m.oxw();m.Q6J("label",m.lcZ(1,2,"order.removed-items")),m.xp6(2),m.Q6J("items",n.getRemovedItems())}}wn.\u0275fac=function(e){return new(e||wn)},wn.\u0275cmp=m.Xpm({type:wn,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0),m.TgZ(1,"div",1),m.TgZ(2,"div"),m._uU(3),m.ALo(4,"translate"),m.qZA(),m.TgZ(5,"div",2),m._UZ(6,"vdr-fulfillment-state-label",3),m.qZA(),m.qZA(),m.TgZ(7,"div",4),m.YNc(8,An,1,2,"vdr-fulfillment-detail",5),m.qZA(),m.YNc(9,_n,7,2,"div",6),m.qZA()),2&e&&(m.xp6(3),m.Oqu(m.lcZ(4,4,"order.fulfillment")),m.xp6(3),m.Q6J("state",null==t.fulfillment?null:t.fulfillment.state),m.xp6(2),m.Q6J("ngIf",!!t.fulfillment),m.xp6(1),m.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.nextStates.length))},directives:[pn,q.O5,xn,We.J,Ge.U,L.qvL,Xe.N,q.sg,Ke.H],pipes:[C.X$,Pe.N],styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var Sn=function(){function e(){g(this,e),this.addedItems=new Map,this.removedItems=new Map}return v(e,[{key:"ngOnChanges",value:function(){var e=this.getModifiedLines(),t=e.added,n=e.removed;this.addedItems=t,this.removedItems=n}},{key:"getSurcharge",value:function(e){return this.order.surcharges.find(function(t){return t.id===e})}},{key:"getAddedItems",value:function(){return t(this.addedItems.entries()).map(function(e){var t=d(e,2),n=t[0],r=t[1];return{name:n.productVariant.name,quantity:r}})}},{key:"getRemovedItems",value:function(){return t(this.removedItems.entries()).map(function(e){var t=d(e,2),n=t[0],r=t[1];return{name:n.productVariant.name,quantity:r}})}},{key:"getModifiedLines",value:function(){var e,t,n,r=new Map,i=new Map,o=s(this.modification.orderItems||[]);try{for(o.s();!(n=o.n()).done;){var a=n.value,l=this.getOrderLineAndItem(a.id);if(l){var c=l.line;if(l.item.cancelled){var d=null!==(e=i.get(c))&&void 0!==e?e:0;i.set(c,d+1)}else{var u=null!==(t=r.get(c))&&void 0!==t?t:0;r.set(c,u+1)}}}}catch(f){o.e(f)}finally{o.f()}return{added:r,removed:i}}},{key:"getOrderLineAndItem",value:function(e){var t,n=s(this.order.lines);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.items.find(function(t){return t.id===e});if(i)return{line:r,item:i}}}catch(o){n.e(o)}finally{n.f()}}}]),e}();Sn.\u0275fac=function(e){return new(e||Sn)},Sn.\u0275cmp=m.Xpm({type:Sn,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[m.TTD],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(e,t){1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.qZA(),m.YNc(3,In,3,4,"vdr-labeled-data",1),m.YNc(4,Ln,4,8,"vdr-labeled-data",2),m.YNc(5,kn,3,4,"vdr-labeled-data",1),m.YNc(6,Nn,3,4,"vdr-labeled-data",1)),2&e&&(m.Q6J("label",m.lcZ(1,6,"common.ID")),m.xp6(2),m.Oqu(t.modification.id),m.xp6(1),m.Q6J("ngIf",t.modification.note),m.xp6(1),m.Q6J("ngForOf",t.modification.surcharges),m.xp6(1),m.Q6J("ngIf",t.getAddedItems().length),m.xp6(1),m.Q6J("ngIf",t.getRemovedItems().length))},directives:[Te.W,q.O5,q.sg,vn],pipes:[C.X$,T.k],styles:[""],changeDetection:0});var Fn=u(67202),Jn=u(76491),Mn=72;function Un(e,t){if(1&e&&(m.TgZ(0,"div",3),m._UZ(1,"div",4),m._UZ(2,"clr-icon",5),m.TgZ(3,"div",6),m._uU(4),m.ALo(5,"translate"),m.ALo(6,"stateI18nToken"),m.qZA(),m.qZA()),2&e){var n=m.oxw();m.xp6(4),m.hij(" ",m.lcZ(5,1,m.lcZ(6,3,n.cancelledState))," ")}}var Pn=function(){function e(t){g(this,e),this.elementRef=t,this.active$=new Jn.X(!1),this.activeTarget$=new Jn.X(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}return v(e,[{key:"ngOnChanges",value:function(e){this.isCancellable=!!this.node.to.find(function(e){return"Cancelled"===e.name}),e.active&&this.active$.next(this.active)}},{key:"getPos",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";this.elementRef.nativeElement.getBoundingClientRect();var r=null!==(t=null===(e=this.elementRef.nativeElement.querySelector(".node"))||void 0===e?void 0:e.getBoundingClientRect().height)&&void 0!==t?t:0;return{x:10,y:this.index*Mn+("bottom"===n?r:0)}}},{key:"getStyle",value:function(){var e=this.getPos();return{"top.px":e.y,"left.px":e.x}}}]),e}();Pn.\u0275fac=function(e){return new(e||Pn)(m.Y36(m.SBq))},Pn.\u0275cmp=m.Xpm({type:Pn,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[m.TTD],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0),m.ALo(1,"async"),m.TgZ(2,"div",1),m.ALo(3,"async"),m._uU(4),m.ALo(5,"translate"),m.ALo(6,"stateI18nToken"),m.qZA(),m.YNc(7,Un,7,5,"div",2),m.qZA()),2&e&&(m.ekj("active",m.lcZ(1,7,t.active$)),m.Q6J("ngStyle",t.getStyle()),m.xp6(2),m.ekj("active-target",m.lcZ(3,9,t.activeTarget$)),m.xp6(2),m.hij(" ",m.lcZ(5,11,m.lcZ(6,13,t.node.name))," "),m.xp6(3),m.Q6J("ngIf",t.isCancellable))},directives:[q.PC,q.O5,L.qvL],pipes:[q.Ov,C.X$,Pe.N],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0});var Qn=function(){function e(){g(this,e)}return v(e,[{key:"ngOnInit",value:function(){var e=this;this.active$=this.from.active$.asObservable().pipe((0,ne.b)(function(t){return e.to.activeTarget$.next(t)}))}},{key:"getStyle",value:function(){var e=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===e?"bottom":"top"),n=this.to.getPos("down"===e?"top":"bottom"),r=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y),o=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));return Object.assign({"top.px":t.y,"left.px":t.x+("down"===e?10:40)+12*this.index,"height.px":o,"width.px":1},"up"===e?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}}]),e}();function Yn(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"vdr-order-process-node",1),m.NdJ("mouseenter",function(){var e=m.CHM(n).$implicit;return m.oxw().onMouseOver(e.name)})("mouseleave",function(){return m.CHM(n),m.oxw().onMouseOut()}),m.ALo(2,"async"),m.qZA(),m.BQk()}if(2&e){var r=t.$implicit,i=t.index,o=m.oxw();m.xp6(1),m.Q6J("node",r)("index",i)("active",m.lcZ(2,3,o.activeState$)===r.name)}}function jn(e,t){if(1&e&&(m.ynx(0),m._UZ(1,"vdr-order-process-edge",2),m.BQk()),2&e){var n=t.$implicit;m.xp6(1),m.Q6J("from",n.from)("to",n.to)("index",n.index)}}Qn.\u0275fac=function(e){return new(e||Qn)},Qn.\u0275cmp=m.Xpm({type:Qn,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0),m.ALo(1,"async"),m._UZ(2,"clr-icon",1),m.qZA()),2&e&&(m.ekj("active",m.lcZ(1,5,t.active$)),m.Q6J("ngStyle",t.getStyle()),m.uIk("data-from",t.from.node.name)("data-to",t.to.node.name))},directives:[q.PC,L.qvL],pipes:[q.Ov],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0});var Dn=function(){function e(t){g(this,e),this.changeDetector=t,this.setActiveState$=new Jn.X(void 0),this.nodes=[],this.edges=[]}return v(e,[{key:"outerHeight",get:function(){return this.nodes.length*Mn}},{key:"ngOnInit",value:function(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe((0,ve.b)(150))}},{key:"ngOnChanges",value:function(e){this.populateNodes()}},{key:"ngAfterViewInit",value:function(){var e=this;setTimeout(function(){return e.populateEdges()})}},{key:"onMouseOver",value:function(e){this.setActiveState$.next(e)}},{key:"onMouseOut",value:function(){this.setActiveState$.next(this.initialState)}},{key:"getNodeFor",value:function(e){if(this.nodeComponents)return this.nodeComponents.find(function(t){return t.node.name===e})}},{key:"populateNodes",value:function(){var e,n,r,i=this,o=new Map,a=s(this.states);try{for(a.s();!(r=a.n()).done;){var l=r.value;o.set(l.name,{name:l.name,to:[]})}}catch(p){a.e(p)}finally{a.f()}var c,u=s(o.entries());try{var f=function(){var t,r=d(c.value,2),a=r[0],l=r[1],u=s(null!==(n=null===(e=i.states.find(function(e){return e.name===a}))||void 0===e?void 0:e.to)&&void 0!==n?n:[]);try{for(u.s();!(t=u.n()).done;){var f=t.value,g=o.get(f);g&&l.to.push(g)}}catch(p){u.e(p)}finally{u.f()}};for(u.s();!(c=u.n()).done;)f()}catch(p){u.e(p)}finally{u.f()}this.nodes=t(o.values()).filter(function(e){return"Cancelled"!==e.name})}},{key:"populateEdges",value:function(){var e,n=s(this.nodes);try{for(n.s();!(e=n.n()).done;){var r,i=e.value,o=this.getNodeFor(i.name),a=0,l=s(i.to);try{for(l.s();!(r=l.n()).done;){var c=r.value,d=this.getNodeFor(c.name);o&&d&&o!==d&&(this.edges.push({to:d,from:o,index:a}),a++)}}catch(u){l.e(u)}finally{l.f()}}}catch(u){n.e(u)}finally{n.f()}this.edges=t(this.edges),this.changeDetector.markForCheck()}}]),e}();function En(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.order-state-diagram"))}Dn.\u0275fac=function(e){return new(e||Dn)(m.Y36(m.sBO))},Dn.\u0275cmp=m.Xpm({type:Dn,selectors:[["vdr-order-process-graph"]],viewQuery:function(e,t){var n;(1&e&&m.Gf(Pn,5),2&e)&&(m.iGM(n=m.CRH())&&(t.nodeComponents=n))},hostVars:2,hostBindings:function(e,t){2&e&&m.Udp("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[m.TTD],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(e,t){1&e&&(m.YNc(0,Yn,3,5,"ng-container",0),m.YNc(1,jn,2,3,"ng-container",0)),2&e&&(m.Q6J("ngForOf",t.nodes),m.xp6(1),m.Q6J("ngForOf",t.edges))},directives:[q.sg,Pn,Qn],pipes:[q.Ov],styles:["[_nghost-%COMP%]{display:block;border:1px hotpink;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0});var $n=function(){function e(t){g(this,e),this.serverConfigService=t,this.states=[]}return v(e,[{key:"ngOnInit",value:function(){this.states=this.serverConfigService.getOrderProcessStates()}}]),e}();$n.\u0275fac=function(e){return new(e||$n)(m.Y36(h.iHG))},$n.\u0275cmp=m.Xpm({type:$n,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(e,t){1&e&&(m.YNc(0,En,2,3,"ng-template",0),m._UZ(1,"vdr-order-process-graph",1)),2&e&&(m.xp6(1),m.Q6J("states",t.states)("initialState",t.activeState))},directives:[Z.q,Dn],pipes:[C.X$],styles:[""],changeDetection:0});var Rn=u(87283);function Hn(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.refund-and-cancel-order"))}function Vn(e,t){if(1&e&&(m.TgZ(0,"div",36),m._uU(1),m.TgZ(2,"div",37),m._uU(3),m.ALo(4,"currency"),m.ALo(5,"number"),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw(3).$implicit,i=m.oxw();m.xp6(1),m.hij(" ",n.description," "),m.xp6(2),m.hij(" ",m.xi3(4,2,m.xi3(5,5,n.amount/100/r.quantity,"1.0-2"),i.order.currencyCode)," ")}}function Bn(e,t){if(1&e&&(m.TgZ(0,"vdr-dropdown"),m.TgZ(1,"div",32),m.TgZ(2,"button",33),m._UZ(3,"clr-icon",34),m.qZA(),m.qZA(),m.TgZ(4,"vdr-dropdown-menu"),m.YNc(5,Vn,6,8,"div",35),m.qZA(),m.qZA()),2&e){var n=m.oxw().ngIf;m.xp6(5),m.Q6J("ngForOf",n)}}function Wn(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Bn,6,1,"vdr-dropdown",26),m.BQk()),2&e){var n=t.ngIf;m.xp6(1),m.Q6J("ngIf",n.length)}}function Gn(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"input",38),m.NdJ("ngModelChange",function(e){m.CHM(n);var t=m.oxw().$implicit;return m.oxw().lineQuantities[t.id].quantity=e})("input",function(){m.CHM(n);var e=m.oxw().$implicit,t=m.oxw();return t.handleZeroQuantity(t.lineQuantities[e.id])}),m.qZA()}if(2&e){var r=m.oxw().$implicit,i=m.oxw();m.Q6J("ngModel",i.lineQuantities[r.id].quantity)("max",r.quantity)}}function Xn(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"input",39),m.NdJ("ngModelChange",function(e){m.CHM(n);var t=m.oxw().$implicit;return m.oxw().lineQuantities[t.id].refund=e}),m.qZA()}if(2&e){var r=m.oxw().$implicit,i=m.oxw();m.Q6J("disabled",0===i.lineQuantities[r.id].quantity)("ngModel",i.lineQuantities[r.id].refund)}}function Kn(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"input",39),m.NdJ("ngModelChange",function(e){m.CHM(n);var t=m.oxw().$implicit;return m.oxw().lineQuantities[t.id].cancel=e}),m.qZA()}if(2&e){var r=m.oxw().$implicit,i=m.oxw();m.Q6J("disabled",0===i.lineQuantities[r.id].quantity)("ngModel",i.lineQuantities[r.id].cancel)}}function zn(e,t){if(1&e&&(m.TgZ(0,"tr",18),m.TgZ(1,"td",19),m._UZ(2,"img",20),m.ALo(3,"assetPreview"),m.qZA(),m.TgZ(4,"td",21),m._uU(5),m.qZA(),m.TgZ(6,"td",22),m._uU(7),m.qZA(),m.TgZ(8,"td",23),m._uU(9),m._UZ(10,"vdr-line-refunds",24),m.qZA(),m.TgZ(11,"td",23),m._uU(12),m.ALo(13,"localeCurrency"),m.qZA(),m.TgZ(14,"td",23),m.TgZ(15,"div",25),m._uU(16),m.ALo(17,"localeCurrency"),m.YNc(18,Wn,2,1,"ng-container",26),m.qZA(),m.qZA(),m.TgZ(19,"td",27),m.YNc(20,Gn,1,2,"input",28),m.qZA(),m.TgZ(21,"td",29),m.TgZ(22,"div",30),m.YNc(23,Xn,1,2,"input",31),m.qZA(),m.qZA(),m.TgZ(24,"td",29),m.TgZ(25,"div",30),m.YNc(26,Kn,1,2,"input",31),m.qZA(),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw();m.xp6(2),m.Q6J("src",m.xi3(3,12,n.featuredAsset,"tiny"),m.LSH),m.xp6(3),m.Oqu(n.productVariant.name),m.xp6(2),m.Oqu(n.productVariant.sku),m.xp6(2),m.hij(" ",n.quantity," "),m.xp6(1),m.Q6J("line",n)("payments",r.order.payments),m.xp6(2),m.hij(" ",m.xi3(13,15,n.unitPriceWithTax,r.order.currencyCode)," "),m.xp6(4),m.hij(" ",m.xi3(17,18,n.proratedUnitPriceWithTax,r.order.currencyCode)," "),m.xp6(2),m.Q6J("ngIf",n.discounts),m.xp6(2),m.Q6J("ngIf",r.lineCanBeRefundedOrCancelled(n)),m.xp6(3),m.Q6J("ngIf",r.lineCanBeRefundedOrCancelled(n)),m.xp6(3),m.Q6J("ngIf",r.lineCanBeRefundedOrCancelled(n))}}function er(e,t){if(1&e&&(m.TgZ(0,"option",40),m._uU(1),m.ALo(2,"localeCurrency"),m.qZA()),2&e){var n=t.$implicit,r=m.oxw();m.Q6J("ngValue",n)("disabled","Settled"!==n.state),m.xp6(1),m.lnq(" #",n.id," ",n.method,": ",m.xi3(2,5,n.amount,r.order.currencyCode)," ")}}var tr=function(e,t){return{min:e,max:t}};function nr(e,t){if(1&e&&(m.TgZ(0,"div",41),m._uU(1),m.ALo(2,"translate"),m.ALo(3,"currency"),m.ALo(4,"localeCurrency"),m.qZA()),2&e){var n=m.oxw();m.xp6(1),m.hij(" ",m.xi3(2,1,"order.refund-total-error",m.WLB(10,tr,m.xi3(3,4,0,n.order.currencyCode),m.xi3(4,7,n.settledPaymentsTotal,n.order.currencyCode)))," ")}}function rr(e,t){1&e&&(m.TgZ(0,"div",42),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.refund-total-warning")," "))}var ir=function(e){return{amount:e}};function or(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.ALo(3,"localeCurrency"),m.BQk()),2&e){var n=m.oxw(2);m.xp6(1),m.hij(" ",m.xi3(2,1,"order.refund-with-amount",m.VKq(7,ir,m.xi3(3,4,n.refundTotal,n.order.currencyCode)))," ")}}function ar(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.hij(" ",m.lcZ(1,1,"order.cancel-selected-items")," ")}function lr(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",43),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",44),m.NdJ("click",function(){return m.CHM(n),m.oxw().select()}),m.YNc(4,or,4,9,"ng-container",45),m.YNc(5,ar,2,3,"ng-template",null,46,m.W1O),m.qZA()}if(2&e){var r=m.MAs(6),i=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,4,"common.cancel")),m.xp6(2),m.Q6J("disabled",!i.canSubmit()),m.xp6(1),m.Q6J("ngIf",i.isRefunding())("ngIfElse",r)}}var cr=function(){function e(t){var n,r=this;g(this,e),this.i18nService=t,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=null!==(n=(0,h.hq7)().cancellationReasons)&&void 0!==n?n:[(0,I.J)("order.refund-reason-customer-request"),(0,I.J)("order.refund-reason-not-available")],this.reasons=this.reasons.map(function(e){return r.i18nService.translate(e)})}return v(e,[{key:"refundTotal",get:function(){var e=this;return this.order.lines.reduce(function(t,n){var r=e.lineQuantities[n.id],i=r.refund&&r.quantity||0;return t+n.proratedUnitPriceWithTax*i},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}},{key:"settledPaymentsTotal",get:function(){return this.settledPayments.map(function(e){return e.amount-(0,gn.summate)(e.refunds.filter(function(e){return"Failed"!==e.state}),"total")}).reduce(function(e,t){return e+t},0)}},{key:"lineCanBeRefundedOrCancelled",value:function(e){var n,r,i=null!==(r=null===(n=this.order.payments)||void 0===n?void 0:n.reduce(function(e,n){return[].concat(t(e),t(n.refunds))},[]))&&void 0!==r?r:[];return 0<e.items.filter(function(e){if(e.cancelled)return!1;if(null==e.refundId)return!0;var t=i.find(function(t){return t.id===e.refundId});return"Failed"===(null==t?void 0:t.state)}).length}},{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce(function(e,t){return Object.assign(Object.assign({},e),p({},t.id,{quantity:0,refund:!1,cancel:!1}))},{}),this.settledPayments=(this.order.payments||[]).filter(function(e){return"Settled"===e.state}),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}},{key:"handleZeroQuantity",value:function(e){0===(null==e?void 0:e.quantity)&&(e.cancel=!1,e.refund=!1)}},{key:"isRefunding",value:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e||0<t.quantity&&t.refund},!1)}},{key:"isCancelling",value:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e||0<t.quantity&&t.cancel},!1)}},{key:"canSubmit",value:function(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}},{key:"select",value:function(){var e=this.selectedPayment;if(e){var t=this.getOrderLineInput(function(e){return e.refund}),n=this.getOrderLineInput(function(e){return e.cancel});this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shippingWithTax:0,adjustment:this.adjustment,paymentId:e.id},cancel:{lines:n,orderId:this.order.id,reason:this.reason,cancelShipping:this.refundShipping}})}}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getOrderLineInput",value:function(e){return Object.entries(this.lineQuantities).filter(function(t){var n=d(t,2),r=(n[0],n[1]);return 0<r.quantity&&e(r)}).map(function(e){var t=d(e,2);return{orderLineId:t[0],quantity:t[1].quantity}})}}]),e}();function dr(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.settle-refund"))}function sr(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",4),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",5),m.NdJ("click",function(){return m.CHM(n),m.oxw().submit()}),m._uU(4),m.ALo(5,"translate"),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,3,"common.cancel")),m.xp6(2),m.Q6J("disabled",!r.transactionId),m.xp6(1),m.hij(" ",m.lcZ(5,5,"order.settle-refund")," ")}}cr.\u0275fac=function(e){return new(e||cr)(m.Y36(h.Dp7))},cr.\u0275cmp=m.Xpm({type:cr,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:76,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","quantity-col"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(e,t){1&e&&(m.YNc(0,Hn,2,3,"ng-template",0),m.TgZ(1,"div",1),m.TgZ(2,"div",2),m.TgZ(3,"table",3),m.TgZ(4,"thead"),m.TgZ(5,"tr"),m._UZ(6,"th"),m.TgZ(7,"th"),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.TgZ(10,"th"),m._uU(11),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"th"),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"th"),m._uU(17),m.ALo(18,"translate"),m.qZA(),m.TgZ(19,"th"),m._uU(20),m.ALo(21,"translate"),m.qZA(),m.TgZ(22,"th"),m._uU(23),m.ALo(24,"translate"),m.qZA(),m.TgZ(25,"th"),m._uU(26),m.ALo(27,"translate"),m.qZA(),m.TgZ(28,"th"),m._uU(29),m.ALo(30,"translate"),m.qZA(),m.qZA(),m.qZA(),m.YNc(31,zn,27,21,"tr",4),m.qZA(),m.qZA(),m.TgZ(32,"div",5),m.TgZ(33,"div"),m.TgZ(34,"label",6),m._uU(35),m.ALo(36,"translate"),m.qZA(),m.TgZ(37,"ng-select",7),m.NdJ("ngModelChange",function(e){return t.reason=e}),m.ALo(38,"translate"),m.qZA(),m.qZA(),m.TgZ(39,"div"),m.TgZ(40,"clr-select-container"),m.TgZ(41,"label"),m._uU(42),m.ALo(43,"translate"),m.qZA(),m.TgZ(44,"select",8),m.NdJ("ngModelChange",function(e){return t.selectedPayment=e}),m.YNc(45,er,3,8,"option",9),m.qZA(),m.qZA(),m.TgZ(46,"clr-checkbox-wrapper"),m.TgZ(47,"input",10),m.NdJ("ngModelChange",function(e){return t.refundShipping=e}),m.qZA(),m.TgZ(48,"label"),m._uU(49),m.ALo(50,"translate"),m.ALo(51,"localeCurrency"),m.qZA(),m.qZA(),m.TgZ(52,"clr-input-container"),m.TgZ(53,"label"),m._uU(54),m.ALo(55,"translate"),m.qZA(),m.TgZ(56,"vdr-currency-input",11),m.NdJ("ngModelChange",function(e){return t.adjustment=e}),m.qZA(),m.qZA(),m.TgZ(57,"div",12),m.TgZ(58,"div",13),m._uU(59),m.ALo(60,"translate"),m.ALo(61,"localeCurrency"),m.qZA(),m.TgZ(62,"div",14),m._uU(63),m.ALo(64,"translate"),m.ALo(65,"localeCurrency"),m.qZA(),m.YNc(66,nr,5,13,"div",15),m.YNc(67,rr,3,3,"div",16),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.YNc(68,lr,7,6,"ng-template",17)),2&e&&(m.xp6(8),m.Oqu(m.lcZ(9,37,"order.product-name")),m.xp6(3),m.Oqu(m.lcZ(12,39,"order.product-sku")),m.xp6(3),m.Oqu(m.lcZ(15,41,"order.quantity")),m.xp6(3),m.Oqu(m.lcZ(18,43,"order.unit-price")),m.xp6(3),m.Oqu(m.lcZ(21,45,"order.prorated-unit-price")),m.xp6(3),m.Oqu(m.lcZ(24,47,"order.quantity")),m.xp6(3),m.Oqu(m.lcZ(27,49,"order.refund")),m.xp6(3),m.Oqu(m.lcZ(30,51,"order.cancel")),m.xp6(2),m.Q6J("ngForOf",t.order.lines),m.xp6(1),m.ekj("faded",!t.isRefunding()&&!t.isCancelling()),m.xp6(3),m.Oqu(m.lcZ(36,53,"order.refund-cancellation-reason")),m.xp6(2),m.Q6J("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",m.lcZ(38,55,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),m.xp6(5),m.Oqu(m.lcZ(43,57,"order.payment-to-refund")),m.xp6(2),m.Q6J("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),m.xp6(1),m.Q6J("ngForOf",t.settledPayments),m.xp6(2),m.Q6J("ngModel",t.refundShipping)("disabled",!t.isRefunding()),m.xp6(2),m.AsE(" ",m.lcZ(50,59,"order.refund-shipping")," (",m.xi3(51,61,t.order.shippingWithTax,t.order.currencyCode),") "),m.xp6(5),m.Oqu(m.lcZ(55,64,"order.refund-adjustment")),m.xp6(2),m.Q6J("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),m.xp6(1),m.ekj("disabled",!t.isRefunding()),m.xp6(2),m.AsE(" ",m.lcZ(60,66,"order.payment-amount"),": ",m.xi3(61,68,t.selectedPayment.amount,t.order.currencyCode)," "),m.xp6(4),m.AsE(" ",m.lcZ(64,71,"order.refund-total"),": ",m.xi3(65,73,t.refundTotal,t.order.currencyCode)," "),m.xp6(3),m.Q6J("ngIf",t.refundTotal<0||t.settledPaymentsTotal<t.refundTotal),m.xp6(1),m.Q6J("ngIf",t.selectedPayment.amount<t.refundTotal))},directives:[Z.q,q.sg,L.MgK,x.w9,f.JJ,f.On,L.dTv,A.y,f.EJ,L.otW,L.PEh,f.Wl,L.KKC,L.G55,Rn.K,L.xRP,q.O5,b.n,ct,We.J,Ge.U,L.qvL,Xe.N,f.qQ,f.wV,f.Fd,f.Fj,f.YN,f.Kr],pipes:[C.X$,T.k,k.M,q.H9,q.JJ],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.quantity-col[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.refund-details.faded[_ngcontent-%COMP%]{opacity:.5}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0});var ur=function(e){return{method:e}},fr=function(){function e(){g(this,e),this.transactionId=""}return v(e,[{key:"submit",value:function(){this.resolveWith(this.transactionId)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();fr.\u0275fac=function(e){return new(e||fr)},fr.\u0275cmp=m.Xpm({type:fr,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,dr,2,3,"ng-template",0),m.TgZ(1,"p",1),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.TgZ(4,"clr-input-container"),m.TgZ(5,"label"),m._uU(6),m.ALo(7,"translate"),m.qZA(),m.TgZ(8,"input",2),m.NdJ("ngModelChange",function(e){return t.transactionId=e}),m.qZA(),m.qZA(),m.YNc(9,sr,6,7,"ng-template",3)),2&e&&(m.xp6(2),m.hij(" ",m.xi3(3,3,"order.settle-refund-manual-instructions",m.VKq(8,ur,t.refund.method)),"\n"),m.xp6(4),m.Oqu(m.lcZ(7,6,"order.transaction-id")),m.xp6(2),m.Q6J("ngModel",t.transactionId))},directives:[Z.q,L.G55,L.MgK,A.y,f.Fj,L.xRP,f.JJ,f.On,b.n],pipes:[C.X$],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});var pr=u(38276),gr=u(82505),mr=u(82355),vr=u(64664);function hr(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.qZA()),2&e){var n=m.oxw();m.Q6J("label",m.lcZ(1,2,"order.error-message")),m.xp6(2),m.hij(" ",n.payment.errorMessage,"\n")}}function Zr(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.qZA()),2&e){var n=m.oxw();m.Q6J("label",m.lcZ(1,2,"order.transaction-id")),m.xp6(2),m.hij(" ",n.payment.transactionId,"\n")}}var yr=function e(){g(this,e)};yr.\u0275fac=function(e){return new(e||yr)},yr.\u0275cmp=m.Xpm({type:yr,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(e,t){1&e&&(m.TgZ(0,"vdr-labeled-data",0),m.ALo(1,"translate"),m._uU(2),m.qZA(),m.TgZ(3,"vdr-labeled-data",0),m.ALo(4,"translate"),m._uU(5),m.ALo(6,"localeCurrency"),m.qZA(),m.YNc(7,hr,3,4,"vdr-labeled-data",1),m.YNc(8,Zr,3,4,"vdr-labeled-data",1),m.TgZ(9,"vdr-labeled-data",0),m.ALo(10,"translate"),m._UZ(11,"vdr-object-tree",2),m.qZA()),2&e&&(m.Q6J("label",m.lcZ(1,8,"order.payment-method")),m.xp6(2),m.hij(" ",t.payment.method,"\n"),m.xp6(1),m.Q6J("label",m.lcZ(4,10,"order.amount")),m.xp6(2),m.hij(" ",m.xi3(6,12,t.payment.amount,t.currencyCode),"\n"),m.xp6(2),m.Q6J("ngIf",t.payment.errorMessage),m.xp6(1),m.Q6J("ngIf",t.payment.transactionId),m.xp6(1),m.Q6J("label",m.lcZ(10,15,"order.payment-metadata")),m.xp6(2),m.Q6J("value",t.payment.metadata))},directives:[Te.W,q.O5,Oe._],pipes:[C.X$,T.k],styles:[""],changeDetection:0});var xr=u(97388);function Ar(e,t){1&e&&(m.TgZ(0,"span",12),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.note-only-visible-to-administrators")," "))}function br(e,t){1&e&&(m.TgZ(0,"span",13),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.note-visible-to-customer")," "))}function Cr(e,t){1&e&&(m.TgZ(0,"div",11),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.history-order-fulfilled")," "))}function qr(e,t){1&e&&(m.TgZ(0,"div",11),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.history-order-cancelled")," "))}var Tr=function(e,t){return{from:e,to:t}};function Or(e,t){if(1&e&&(m._uU(0),m.ALo(1,"translate")),2&e){var n=m.oxw(2).$implicit;m.hij(" ",m.xi3(1,1,"order.history-order-transition",m.WLB(4,Tr,n.data.from,n.data.to))," ")}}function _r(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Cr,3,3,"div",17),m.YNc(2,qr,3,3,"div",17),m.YNc(3,Or,2,7,"ng-template",18),m.BQk()),2&e){var n=m.oxw().$implicit;m.xp6(1),m.Q6J("ngIf","Delivered"===n.data.to),m.xp6(1),m.Q6J("ngIf","Cancelled"===n.data.to),m.xp6(1),m.Q6J("ngIf","Cancelled"!==n.data.to&&"Delivered"!==n.data.to)}}function wr(e,t){1&e&&(m.TgZ(0,"vdr-chip",23),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"order.modification-settled")))}function Ir(e,t){1&e&&(m.TgZ(0,"vdr-chip",24),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"order.modification-not-settled")))}function Lr(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.TgZ(3,"strong"),m._uU(4),m.ALo(5,"localeCurrency"),m.qZA(),m.YNc(6,wr,3,3,"vdr-chip",20),m.YNc(7,Ir,3,3,"vdr-chip",21),m.TgZ(8,"vdr-history-entry-detail"),m._UZ(9,"vdr-modification-detail",22),m.qZA(),m.BQk()),2&e){var n=t.ngIf,r=m.oxw(3);m.xp6(1),m.hij(" ",m.lcZ(2,6,"order.modify-order-price-difference"),": "),m.xp6(3),m.Oqu(m.xi3(5,8,n.priceChange,r.order.currencyCode)),m.xp6(2),m.Q6J("ngIf",n.isSettled),m.xp6(1),m.Q6J("ngIf",!n.isSettled),m.xp6(2),m.Q6J("order",r.order)("modification",n)}}function kr(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"div",11),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.YNc(4,Lr,10,11,"ng-container",19),m.BQk()),2&e){var n=m.oxw().$implicit,r=m.oxw();m.xp6(2),m.hij(" ",m.lcZ(3,2,"order.history-order-modified")," "),m.xp6(2),m.Q6J("ngIf",r.getModification(n.data.modificationId))}}function Nr(e,t){if(1&e&&(m.TgZ(0,"vdr-history-entry-detail"),m._UZ(1,"vdr-payment-detail",27),m.qZA()),2&e){var n=t.ngIf,r=m.oxw(4);m.xp6(1),m.Q6J("payment",n)("currencyCode",r.order.currencyCode)}}function Sr(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"div",11),m._uU(2),m.ALo(3,"translate"),m.qZA(),m._uU(4),m.ALo(5,"translate"),m.YNc(6,Nr,2,2,"vdr-history-entry-detail",19),m.BQk()),2&e){var n,r=m.oxw(2).$implicit,i=m.oxw();m.xp6(2),m.hij(" ",m.lcZ(3,4,"order.history-payment-settled")," "),m.xp6(2),m.AsE(" ",m.lcZ(5,6,"order.transaction-id"),": ",null==(n=i.getPayment(r))?null:n.transactionId," "),m.xp6(2),m.Q6J("ngIf",i.getPayment(r))}}var Fr=function(e,t,n){return{from:e,to:t,id:n}};function Jr(e,t){if(1&e&&(m._uU(0),m.ALo(1,"translate")),2&e){var n,r=m.oxw(2).$implicit,i=m.oxw();m.hij(" ",m.xi3(1,1,"order.history-payment-transition",m.kEZ(4,Fr,r.data.from,r.data.to,null==(n=i.getPayment(r))?null:n.transactionId))," ")}}function Mr(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Sr,7,8,"ng-container",25),m.YNc(2,Jr,2,8,"ng-template",null,26,m.W1O),m.BQk()),2&e){var n=m.MAs(3),r=m.oxw().$implicit;m.xp6(1),m.Q6J("ngIf","Settled"===r.data.to)("ngIfElse",n)}}function Ur(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.BQk()),2&e){var n=m.oxw().$implicit;m.xp6(1),m.hij(" ",m.xi3(2,1,"order.history-refund-transition",m.kEZ(4,Fr,n.data.from,n.data.to,n.data.refundId))," ")}}function Pr(e,t){if(1&e&&(m.TgZ(0,"vdr-history-entry-detail"),m.TgZ(1,"vdr-labeled-data",28),m.ALo(2,"translate"),m._uU(3),m.qZA(),m.TgZ(4,"vdr-labeled-data",28),m.ALo(5,"translate"),m._UZ(6,"vdr-simple-item-list",29),m.qZA(),m.TgZ(7,"vdr-labeled-data",28),m.ALo(8,"translate"),m._uU(9),m.qZA(),m.qZA()),2&e){var n=t.ngIf,r=m.oxw(2).$implicit;m.xp6(1),m.Q6J("label",m.lcZ(2,6,"order.cancellation-reason")),m.xp6(2),m.hij(" ",r.data.reason," "),m.xp6(1),m.Q6J("label",m.lcZ(5,8,"order.contents")),m.xp6(2),m.Q6J("items",n),m.xp6(1),m.Q6J("label",m.lcZ(8,10,"order.shipping-cancelled")),m.xp6(2),m.hij(" ",r.data.shippingCancelled," ")}}var Qr=function(e){return{count:e}};function Yr(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.YNc(3,Pr,10,12,"vdr-history-entry-detail",19),m.BQk()),2&e){var n=m.oxw().$implicit,r=m.oxw();m.xp6(1),m.hij(" ",m.xi3(2,2,"order.history-items-cancelled",m.VKq(5,Qr,n.data.orderItemIds.length))," "),m.xp6(2),m.Q6J("ngIf",r.getCancelledItems(n))}}function jr(e,t){if(1&e&&(m.TgZ(0,"vdr-history-entry-detail"),m._UZ(1,"vdr-fulfillment-detail",30),m.qZA()),2&e){var n=t.ngIf,r=m.oxw(3);m.xp6(1),m.Q6J("fulfillmentId",n.id)("order",r.order)}}function Dr(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.YNc(3,jr,2,2,"vdr-history-entry-detail",19),m.BQk()),2&e){var n=m.oxw().$implicit,r=m.oxw();m.xp6(1),m.hij(" ",m.lcZ(2,2,"order.history-fulfillment-created")," "),m.xp6(2),m.Q6J("ngIf",r.getFulfillment(n))}}function Er(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"div",11),m._uU(2),m.ALo(3,"translate"),m.qZA(),m._uU(4),m.ALo(5,"translate"),m.BQk()),2&e){var n,r=m.oxw(2).$implicit,i=m.oxw();m.xp6(2),m.hij(" ",m.lcZ(3,3,"order.history-fulfillment-delivered")," "),m.xp6(2),m.AsE(" ",m.lcZ(5,5,"order.tracking-code"),": ",null==(n=i.getFulfillment(r))?null:n.trackingCode," ")}}function $r(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"div",11),m._uU(2),m.ALo(3,"translate"),m.qZA(),m._uU(4),m.ALo(5,"translate"),m.BQk()),2&e){var n,r=m.oxw(2).$implicit,i=m.oxw();m.xp6(2),m.hij(" ",m.lcZ(3,3,"order.history-fulfillment-shipped")," "),m.xp6(2),m.AsE(" ",m.lcZ(5,5,"order.tracking-code"),": ",null==(n=i.getFulfillment(r))?null:n.trackingCode," ")}}function Rr(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.BQk()),2&e){var n=m.oxw(2).$implicit;m.xp6(1),m.hij(" ",m.xi3(2,1,"order.history-fulfillment-transition",m.WLB(4,Tr,n.data.from,n.data.to))," ")}}function Hr(e,t){if(1&e&&(m.TgZ(0,"vdr-history-entry-detail"),m._UZ(1,"vdr-fulfillment-detail",30),m.qZA()),2&e){var n=t.ngIf,r=m.oxw(3);m.xp6(1),m.Q6J("fulfillmentId",n.id)("order",r.order)}}function Vr(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Er,6,7,"ng-container",19),m.YNc(2,$r,6,7,"ng-container",19),m.YNc(3,Rr,3,7,"ng-container",19),m.YNc(4,Hr,2,2,"vdr-history-entry-detail",19),m.BQk()),2&e){var n=m.oxw().$implicit,r=m.oxw();m.xp6(1),m.Q6J("ngIf","Delivered"===n.data.to),m.xp6(1),m.Q6J("ngIf","Shipped"===n.data.to),m.xp6(1),m.Q6J("ngIf","Delivered"!==n.data.to&&"Shipped"!==n.data.to),m.xp6(1),m.Q6J("ngIf",r.getFulfillment(n))}}function Br(e,t){1&e&&(m.TgZ(0,"span",43),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"common.public")))}function Wr(e,t){1&e&&(m.TgZ(0,"span",44),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"common.private")))}function Gr(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"div",31),m.TgZ(2,"div",32),m.YNc(3,Br,3,3,"span",33),m.YNc(4,Wr,3,3,"span",34),m._uU(5),m.qZA(),m._UZ(6,"div",35),m.TgZ(7,"vdr-dropdown"),m.TgZ(8,"button",36),m._UZ(9,"clr-icon",37),m.qZA(),m.TgZ(10,"vdr-dropdown-menu",38),m.TgZ(11,"button",39),m.NdJ("click",function(){m.CHM(n);var e=m.oxw().$implicit;return m.oxw().updateNote.emit(e)}),m.ALo(12,"hasPermission"),m._UZ(13,"clr-icon",40),m._uU(14),m.ALo(15,"translate"),m.qZA(),m._UZ(16,"div",41),m.TgZ(17,"button",39),m.NdJ("click",function(){m.CHM(n);var e=m.oxw().$implicit;return m.oxw().deleteNote.emit(e)}),m.ALo(18,"hasPermission"),m._UZ(19,"clr-icon",42),m._uU(20),m.ALo(21,"translate"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.BQk()}if(2&e){var r=m.oxw().$implicit;m.xp6(3),m.Q6J("ngIf",r.isPublic),m.xp6(1),m.Q6J("ngIf",!r.isPublic),m.xp6(1),m.hij(" ",r.data.note," "),m.xp6(6),m.Q6J("disabled",!m.lcZ(12,7,"UpdateOrder")),m.xp6(3),m.hij(" ",m.lcZ(15,9,"common.edit")," "),m.xp6(3),m.Q6J("disabled",!m.lcZ(18,11,"UpdateOrder")),m.xp6(3),m.hij(" ",m.lcZ(21,13,"common.delete")," ")}}var Xr=function(e){return["/marketing","promotions",e]};function Kr(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.TgZ(3,"vdr-chip"),m.TgZ(4,"a",45),m._uU(5),m.qZA(),m.qZA(),m.BQk()),2&e){var n=m.oxw().$implicit;m.xp6(1),m.hij(" ",m.lcZ(2,3,"order.history-coupon-code-applied"),": "),m.xp6(3),m.Q6J("routerLink",m.VKq(5,Xr,n.data.promotionId)),m.xp6(1),m.Oqu(n.data.couponCode)}}function zr(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.TgZ(3,"vdr-chip"),m.TgZ(4,"span",46),m._uU(5),m.qZA(),m.qZA(),m.BQk()),2&e){var n=m.oxw().$implicit;m.xp6(1),m.hij(" ",m.lcZ(2,2,"order.history-coupon-code-removed"),": "),m.xp6(4),m.Oqu(n.data.couponCode)}}function ei(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"vdr-timeline-entry",14),m.NdJ("expandClick",function(){m.CHM(n);var e=m.oxw();return e.expanded=!e.expanded}),m.ynx(1,15),m.YNc(2,_r,4,3,"ng-container",16),m.YNc(3,kr,5,4,"ng-container",16),m.YNc(4,Mr,4,2,"ng-container",16),m.YNc(5,Ur,3,8,"ng-container",16),m.YNc(6,Yr,4,7,"ng-container",16),m.YNc(7,Dr,4,4,"ng-container",16),m.YNc(8,Vr,5,4,"ng-container",16),m.YNc(9,Gr,22,15,"ng-container",16),m.YNc(10,Kr,6,7,"ng-container",16),m.YNc(11,zr,6,4,"ng-container",16),m.BQk(),m.qZA()}if(2&e){var r=t.$implicit,i=m.oxw();m.Q6J("displayType",i.getDisplayType(r))("iconShape",i.getTimelineIcon(r))("createdAt",r.createdAt)("name",i.getName(r))("featured",i.isFeatured(r))("collapsed",!i.expanded&&!i.isFeatured(r)),m.xp6(1),m.Q6J("ngSwitch",r.type),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_STATE_TRANSITION),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_MODIFIED),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_PAYMENT_TRANSITION),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_REFUND_TRANSITION),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_CANCELLATION),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_FULFILLMENT),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_FULFILLMENT_TRANSITION),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_NOTE),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_COUPON_APPLIED),m.xp6(1),m.Q6J("ngSwitchCase",i.type.ORDER_COUPON_REMOVED)}}var ti=function(){function e(){g(this,e),this.addNote=new m.vpe,this.updateNote=new m.vpe,this.deleteNote=new m.vpe,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=h.iYD}return v(e,[{key:"getDisplayType",value:function(e){if(e.type===h.iYD.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return"success";if("Cancelled"===e.data.to)return"error"}return e.type===h.iYD.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===e.data.to?"success":e.type===h.iYD.ORDER_PAYMENT_TRANSITION&&("Declined"===e.data.to||"Cancelled"===e.data.to)||e.type===h.iYD.ORDER_CANCELLATION?"error":e.type===h.iYD.ORDER_REFUND_TRANSITION?"warning":"default"}},{key:"getTimelineIcon",value:function(e){if(e.type===h.iYD.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return["success-standard","is-solid"];if("Cancelled"===e.data.to)return"ban"}return e.type===h.iYD.ORDER_PAYMENT_TRANSITION&&"Settled"===e.data.to?"credit-card":e.type===h.iYD.ORDER_NOTE?"note":e.type===h.iYD.ORDER_MODIFIED?"pencil":e.type!==h.iYD.ORDER_FULFILLMENT_TRANSITION||"Shipped"!==e.data.to&&"Delivered"!==e.data.to?void 0:"truck"}},{key:"isFeatured",value:function(e){switch(e.type){case h.iYD.ORDER_STATE_TRANSITION:return"Delivered"===e.data.to||"Cancelled"===e.data.to||"Settled"===e.data.to;case h.iYD.ORDER_PAYMENT_TRANSITION:return"Settled"===e.data.to||"Cancelled"===e.data.to;case h.iYD.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===e.data.to||"Shipped"===e.data.to;case h.iYD.ORDER_NOTE:case h.iYD.ORDER_MODIFIED:return!0;default:return!1}}},{key:"getFulfillment",value:function(e){if((e.type===h.iYD.ORDER_FULFILLMENT||e.type===h.iYD.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(function(t){return t.id===e.data.fulfillmentId})}},{key:"getPayment",value:function(e){if(e.type===h.iYD.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(function(t){return t.id===e.data.paymentId})}},{key:"getCancelledItems",value:function(e){var t,n=new Map,r=e.data.orderItemIds,i=s(this.order.lines);try{for(i.s();!(t=i.n()).done;){var o,a=t.value,l=s(a.items);try{for(l.s();!(o=l.n()).done;){var c=o.value;if(r.includes(c.id)){var u=n.get(a.productVariant.name);null!=u?n.set(a.productVariant.name,u+1):n.set(a.productVariant.name,1)}}}catch(f){l.e(f)}finally{l.f()}}}catch(f){i.e(f)}finally{i.f()}return Array.from(n.entries()).map(function(e){var t=d(e,2);return{name:t[0],quantity:t[1]}})}},{key:"getModification",value:function(e){return this.order.modifications.find(function(t){return t.id===e})}},{key:"getName",value:function(e){var t=e.administrator;if(t)return"".concat(t.firstName," ").concat(t.lastName);var n=this.order.customer;return n?"".concat(n.firstName," ").concat(n.lastName):""}},{key:"addNoteToOrder",value:function(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}]),e}();function ni(e,t){1&e&&m._UZ(0,"clr-icon",2)}ti.\u0275fac=function(e){return new(e||ti)},ti.\u0275cmp=m.Xpm({type:ti,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:23,vars:24,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick",4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"]],template:function(e,t){1&e&&(m.TgZ(0,"h4"),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"div",0),m.TgZ(4,"vdr-timeline-entry",1),m.TgZ(5,"div",2),m.TgZ(6,"textarea",3),m.NdJ("ngModelChange",function(e){return t.note=e}),m.qZA(),m.TgZ(7,"button",4),m.NdJ("click",function(){return t.addNoteToOrder()}),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.qZA(),m.TgZ(10,"div",5),m.TgZ(11,"clr-checkbox-wrapper"),m.TgZ(12,"input",6),m.NdJ("ngModelChange",function(e){return t.noteIsPrivate=e}),m.qZA(),m.TgZ(13,"label"),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.qZA(),m.YNc(16,Ar,3,3,"span",7),m.YNc(17,br,3,3,"span",8),m.qZA(),m.qZA(),m.YNc(18,ei,12,17,"vdr-timeline-entry",9),m.TgZ(19,"vdr-timeline-entry",10),m.TgZ(20,"div",11),m._uU(21),m.ALo(22,"translate"),m.qZA(),m.qZA(),m.qZA()),2&e&&(m.xp6(1),m.Oqu(m.lcZ(2,16,"order.order-history")),m.xp6(2),m.ekj("expanded",t.expanded),m.xp6(1),m.Q6J("featured",!0),m.xp6(2),m.Q6J("ngModel",t.note),m.xp6(1),m.Q6J("disabled",!t.note),m.xp6(1),m.hij(" ",m.lcZ(9,18,"common.add-note")," "),m.xp6(4),m.Q6J("ngModel",t.noteIsPrivate),m.xp6(2),m.Oqu(m.lcZ(15,20,"order.note-is-private")),m.xp6(2),m.Q6J("ngIf",t.noteIsPrivate),m.xp6(1),m.Q6J("ngIf",!t.noteIsPrivate),m.xp6(1),m.Q6J("ngForOf",t.history),m.xp6(1),m.Q6J("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),m.xp6(2),m.hij(" ",m.lcZ(22,22,"order.history-order-created")," "))},directives:[mr._,A.y,f.Fj,f.JJ,f.On,L.PEh,f.Wl,L.KKC,L.MgK,q.O5,q.sg,q.RF,q.n9,vr.C,Sn,V.Y,yr,Te.W,vn,xn,We.J,Ge.U,L.qvL,Xe.N,Ke.H,Ne.yS],pipes:[C.X$,T.k,xr.j],styles:["[_nghost-%COMP%]{margin-top:48px;display:block}.entry-list[_ngcontent-%COMP%]{margin-top:24px;margin-left:24px;margin-right:12px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-500)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0});var ri=function(){function e(){g(this,e)}return v(e,[{key:"chipColorType",get:function(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}]),e}();function ii(e,t){1&e&&m._UZ(0,"clr-icon",2)}ri.\u0275fac=function(e){return new(e||ri)},ri.\u0275cmp=m.Xpm({type:ri,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(m.TgZ(0,"vdr-chip",0),m.ALo(1,"translate"),m.YNc(2,ni,1,0,"clr-icon",1),m._uU(3),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.qZA()),2&e&&(m.Q6J("title",m.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),m.xp6(2),m.Q6J("ngIf","Settled"===t.state),m.xp6(1),m.hij(" ",m.lcZ(4,6,m.lcZ(5,8,t.state)),"\n"))},directives:[V.Y,q.O5,L.qvL],pipes:[C.X$,Pe.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var oi=function(){function e(){g(this,e)}return v(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}]),e}();function ai(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.BQk()),2&e){var n=m.oxw();m.xp6(1),m.hij("#",n.payment.transactionId,"")}}function li(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",11),m.ALo(1,"translate"),m._uU(2),m.qZA()),2&e){var n=m.oxw().$implicit;m.Q6J("label",m.lcZ(1,2,"order.transaction-id")),m.xp6(2),m.hij(" ",n.transactionId," ")}}function ci(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",11),m.ALo(1,"translate"),m._uU(2),m.qZA()),2&e){var n=m.oxw().$implicit;m.Q6J("label",m.lcZ(1,2,"order.refund-reason")),m.xp6(2),m.hij(" ",n.reason," ")}}function di(e,t){if(1&e&&(m.TgZ(0,"vdr-labeled-data",11),m.ALo(1,"translate"),m._UZ(2,"vdr-object-tree",13),m.qZA()),2&e){var n=m.oxw().$implicit;m.Q6J("label",m.lcZ(1,2,"order.refund-metadata")),m.xp6(2),m.Q6J("value",n.metadata)}}function si(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div",14),m.TgZ(1,"button",15),m.NdJ("click",function(){m.CHM(n);var e=m.oxw().$implicit;return m.oxw().settleRefund.emit(e)}),m._uU(2),m.ALo(3,"translate"),m.qZA(),m.qZA()}2&e&&(m.xp6(2),m.hij(" ",m.lcZ(3,1,"order.settle-refund")," "))}function ui(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"div",1),m._UZ(2,"clr-icon",9),m._uU(3),m.ALo(4,"translate"),m._UZ(5,"div",10),m._UZ(6,"vdr-refund-state-label",4),m.qZA(),m.TgZ(7,"div",5),m.TgZ(8,"vdr-labeled-data",11),m.ALo(9,"translate"),m._uU(10),m.ALo(11,"localeDate"),m.qZA(),m.TgZ(12,"vdr-labeled-data",11),m.ALo(13,"translate"),m._uU(14),m.ALo(15,"localeCurrency"),m.qZA(),m.YNc(16,li,3,4,"vdr-labeled-data",12),m.YNc(17,ci,3,4,"vdr-labeled-data",12),m.YNc(18,di,3,4,"vdr-labeled-data",12),m.qZA(),m.YNc(19,si,4,3,"div",8),m.BQk()),2&e){var n=t.$implicit,r=m.oxw();m.xp6(3),m.AsE(" ",m.lcZ(4,11,"order.refund")," #",n.id," "),m.xp6(3),m.Q6J("state",n.state),m.xp6(2),m.Q6J("label",m.lcZ(9,13,"common.created-at")),m.xp6(2),m.hij(" ",m.xi3(11,15,n.createdAt,"medium")," "),m.xp6(2),m.Q6J("label",m.lcZ(13,18,"order.refund-total")),m.xp6(2),m.hij(" ",m.xi3(15,20,n.total,r.currencyCode)," "),m.xp6(2),m.Q6J("ngIf",n.transactionId),m.xp6(1),m.Q6J("ngIf",n.reason),m.xp6(1),m.Q6J("ngIf",r.refundHasMetadata(n)),m.xp6(1),m.Q6J("ngIf","Pending"===n.state)}}function fi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",15),m.NdJ("click",function(){m.CHM(n);var e=m.oxw(2);return e.settlePayment.emit(e.payment)}),m._uU(1),m.ALo(2,"translate"),m.qZA()}2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.settle-payment")," "))}oi.\u0275fac=function(e){return new(e||oi)},oi.\u0275cmp=m.Xpm({type:oi,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(m.TgZ(0,"vdr-chip",0),m.ALo(1,"translate"),m.YNc(2,ii,1,0,"clr-icon",1),m._uU(3),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.qZA()),2&e&&(m.Q6J("title",m.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),m.xp6(2),m.Q6J("ngIf","Settled"===t.state),m.xp6(1),m.hij(" ",m.lcZ(4,6,m.lcZ(5,8,t.state)),"\n"))},directives:[V.Y,q.O5,L.qvL],pipes:[C.X$,Pe.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var pi=function(e){return{state:e}};function gi(e,t){if(1&e&&(m.ynx(0),m._UZ(1,"clr-icon",23),m._uU(2),m.ALo(3,"translate"),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.BQk()),2&e){var n=m.oxw().$implicit;m.xp6(2),m.hij(" ",m.xi3(3,1,"order.transition-to-state",m.VKq(8,pi,m.lcZ(4,4,m.lcZ(5,6,n))))," ")}}function mi(e,t){1&e&&(m._UZ(0,"clr-icon",24),m._uU(1),m.ALo(2,"translate")),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.cancel-payment")," "))}function vi(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"button",20),m.NdJ("click",function(){var e=m.CHM(n).$implicit,t=m.oxw(2);return t.transitionPaymentState.emit({payment:t.payment,state:e})}),m.YNc(2,gi,6,10,"ng-container",21),m.YNc(3,mi,3,3,"ng-template",null,22,m.W1O),m.qZA(),m.BQk()}if(2&e){var r=t.$implicit,i=m.MAs(4);m.xp6(2),m.Q6J("ngIf","Cancelled"!==r)("ngIfElse",i)}}function hi(e,t){if(1&e&&(m.TgZ(0,"div",14),m.YNc(1,fi,3,3,"button",16),m.TgZ(2,"vdr-dropdown"),m.TgZ(3,"button",17),m._UZ(4,"clr-icon",18),m.qZA(),m.TgZ(5,"vdr-dropdown-menu",19),m.YNc(6,vi,5,2,"ng-container",7),m.qZA(),m.qZA(),m.qZA()),2&e){var n=m.oxw();m.xp6(1),m.Q6J("ngIf",n.payment.nextStates.includes("Settled")),m.xp6(5),m.Q6J("ngForOf",n.nextOtherStates())}}var Zi=function(){function e(){g(this,e),this.settlePayment=new m.vpe,this.transitionPaymentState=new m.vpe,this.settleRefund=new m.vpe}return v(e,[{key:"refundHasMetadata",value:function(e){return!!e&&Object.keys(e.metadata).length>0}},{key:"nextOtherStates",value:function(){return this.payment?this.payment.nextStates.filter(function(e){return"Settled"!==e&&"Error"!==e}):[]}}]),e}();function yi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",16),m.NdJ("click",function(){m.CHM(n);var e=m.oxw().ngIf;return m.oxw().addManualPayment(e)}),m._uU(1),m.ALo(2,"translate"),m.ALo(3,"localeCurrency"),m.qZA()}if(2&e){var r=m.oxw().ngIf,i=m.oxw();m.xp6(1),m.AsE(" ",m.lcZ(2,2,"order.add-payment-to-order")," (",m.xi3(3,4,i.outstandingPaymentAmount(r),r.currencyCode),") ")}}function xi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",16),m.NdJ("click",function(){return m.CHM(n),m.oxw(2).transitionToState("ArrangingAdditionalPayment")}),m._uU(1),m.ALo(2,"translate"),m.qZA()}2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.arrange-additional-payment")," "))}function Ai(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"button",14),m.NdJ("click",function(){return m.CHM(n),m.oxw(2).transitionToModifying()}),m._UZ(2,"clr-icon",17),m._uU(3),m.ALo(4,"translate"),m.qZA(),m._UZ(5,"div",13),m.BQk()}2&e&&(m.xp6(3),m.hij(" ",m.lcZ(4,1,"order.modify-order")," "))}function bi(e,t){1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"translate"),m.BQk()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.refund-and-cancel-order")," "))}function Ci(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.hij(" ",m.lcZ(1,1,"order.cancel-order")," ")}function qi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",14),m.NdJ("click",function(){m.CHM(n);var e=m.oxw().ngIf;return m.oxw().cancelOrRefund(e)}),m._UZ(1,"clr-icon",18),m.YNc(2,bi,3,3,"ng-container",19),m.YNc(3,Ci,2,3,"ng-template",null,20,m.W1O),m.qZA()}if(2&e){var r=m.MAs(4),i=m.oxw().ngIf,o=m.oxw();m.xp6(2),m.Q6J("ngIf",o.orderHasSettledPayments(i))("ngIfElse",r)}}Zi.\u0275fac=function(e){return new(e||Zi)},Zi.\u0275cmp=m.Xpm({type:Zi,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(m.TgZ(0,"div",0),m.TgZ(1,"div",1),m.TgZ(2,"div"),m._uU(3),m.ALo(4,"translate"),m.YNc(5,ai,2,1,"ng-container",2),m.qZA(),m.TgZ(6,"div",3),m._UZ(7,"vdr-payment-state-label",4),m.qZA(),m.qZA(),m.TgZ(8,"div",5),m._UZ(9,"vdr-payment-detail",6),m.qZA(),m.YNc(10,ui,20,23,"ng-container",7),m.YNc(11,hi,7,2,"div",8),m.qZA()),2&e&&(m.xp6(3),m.hij(" ",m.lcZ(4,7,"order.payment")," "),m.xp6(2),m.Q6J("ngIf",t.payment.transactionId),m.xp6(2),m.Q6J("state",t.payment.state),m.xp6(2),m.Q6J("payment",t.payment)("currencyCode",t.currencyCode),m.xp6(1),m.Q6J("ngForOf",t.payment.refunds),m.xp6(1),m.Q6J("ngIf",t.payment.nextStates.length))},directives:[q.O5,ri,yr,q.sg,L.qvL,ot.Lv,oi,Te.W,Oe._,We.J,Ge.U,Xe.N,Ke.H],pipes:[C.X$,dt.H,T.k,Pe.N],styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var Ti=function(e){return{state:e}};function Oi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",14),m.NdJ("click",function(){var e=m.CHM(n).$implicit;return m.oxw(3).transitionToState(e)}),m._UZ(1,"clr-icon",22),m._uU(2),m.ALo(3,"translate"),m.ALo(4,"translate"),m.ALo(5,"stateI18nToken"),m.qZA()}if(2&e){var r=t.$implicit;m.xp6(2),m.hij(" ",m.xi3(3,1,"order.transition-to-state",m.VKq(8,Ti,m.lcZ(4,4,m.lcZ(5,6,r))))," ")}}function _i(e,t){if(1&e&&(m.ynx(0),m._UZ(1,"div",13),m.YNc(2,Oi,6,10,"button",21),m.ALo(3,"async"),m.BQk()),2&e){var n=m.oxw(2);m.xp6(2),m.Q6J("ngForOf",m.lcZ(3,1,n.nextStates$))}}function wi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"vdr-action-bar"),m.TgZ(1,"vdr-ab-left"),m.TgZ(2,"div",1),m._UZ(3,"vdr-entity-info",2),m.ALo(4,"async"),m.TgZ(5,"vdr-order-state-label",3),m.TgZ(6,"button",4),m.NdJ("click",function(){return m.CHM(n),m.oxw().openStateDiagram()}),m.ALo(7,"translate"),m._UZ(8,"clr-icon",5),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(9,"vdr-ab-right"),m._UZ(10,"vdr-action-bar-items",6),m.YNc(11,yi,4,7,"button",7),m.YNc(12,xi,3,3,"button",7),m.TgZ(13,"button",8),m.NdJ("click",function(){return m.CHM(n),m.oxw().fulfillOrder()}),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"vdr-dropdown"),m.TgZ(17,"button",9),m._UZ(18,"clr-icon",10),m.qZA(),m.TgZ(19,"vdr-dropdown-menu",11),m.YNc(20,Ai,6,3,"ng-container",0),m.YNc(21,qi,5,2,"button",12),m.YNc(22,_i,4,3,"ng-container",0),m.ALo(23,"async"),m._UZ(24,"div",13),m.TgZ(25,"button",14),m.NdJ("click",function(){var e=m.CHM(n).ngIf;return m.oxw().manuallyTransitionToState(e)}),m._UZ(26,"clr-icon",15),m._uU(27),m.ALo(28,"translate"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r,i=t.ngIf,o=m.oxw();m.xp6(3),m.Q6J("entity",m.lcZ(4,11,o.entity$)),m.xp6(2),m.Q6J("state",i.state),m.xp6(1),m.Q6J("title",m.lcZ(7,13,"order.order-state-diagram")),m.xp6(5),m.Q6J("ngIf",("ArrangingPayment"===i.state||"ArrangingAdditionalPayment"===i.state)&&(o.hasUnsettledModifications(i)||0<o.outstandingPaymentAmount(i))),m.xp6(1),m.Q6J("ngIf",!1===i.active&&"ArrangingAdditionalPayment"!==i.state&&"ArrangingPayment"!==i.state&&0<o.outstandingPaymentAmount(i)),m.xp6(1),m.Q6J("disabled",!o.canAddFulfillment(i)),m.xp6(1),m.hij(" ",m.lcZ(15,15,"order.fulfill-order")," "),m.xp6(6),m.Q6J("ngIf",i.nextStates.includes("Modifying")),m.xp6(1),m.Q6J("ngIf",i.nextStates.includes("Cancelled")),m.xp6(1),m.Q6J("ngIf",null==(r=m.lcZ(23,17,o.nextStates$))?null:r.length),m.xp6(5),m.hij(" ",m.lcZ(28,19,"order.manually-transition-to-state")," ")}}function Ii(e,t){if(1&e&&(m.TgZ(0,"tr"),m.TgZ(1,"td"),m._uU(2),m.qZA(),m.TgZ(3,"td"),m._uU(4),m.ALo(5,"percent"),m.qZA(),m.TgZ(6,"td"),m._uU(7),m.ALo(8,"localeCurrency"),m.qZA(),m.TgZ(9,"td"),m._uU(10),m.ALo(11,"localeCurrency"),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw().ngIf;m.xp6(2),m.Oqu(n.description),m.xp6(2),m.Oqu(m.lcZ(5,4,n.taxRate/100)),m.xp6(3),m.Oqu(m.xi3(8,6,n.taxBase,r.currencyCode)),m.xp6(3),m.Oqu(m.xi3(11,9,n.taxTotal,r.currencyCode))}}function Li(e,t){1&e&&(m.TgZ(0,"h6"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.shipping-address")," "))}function ki(e,t){1&e&&(m.TgZ(0,"h6"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.billing-address")," "))}function Ni(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"vdr-order-payment-card",39),m.NdJ("settlePayment",function(e){return m.CHM(n),m.oxw(3).settlePayment(e)})("transitionPaymentState",function(e){return m.CHM(n),m.oxw(3).transitionPaymentState(e)})("settleRefund",function(e){return m.CHM(n),m.oxw(3).settleRefund(e)}),m.qZA()}if(2&e){var r=t.$implicit,i=m.oxw(2).ngIf;m.Q6J("currencyCode",i.currencyCode)("payment",r)}}function Si(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Ni,1,2,"vdr-order-payment-card",38),m.BQk()),2&e){var n=m.oxw().ngIf;m.xp6(1),m.Q6J("ngForOf",n.payments)}}function Fi(e,t){if(1&e){var n=m.EpF();m.ynx(0),m.TgZ(1,"vdr-fulfillment-card",40),m.NdJ("transitionState",function(e){var t=m.CHM(n).$implicit;return m.oxw(2).transitionFulfillment(t.id,e)}),m.qZA(),m.BQk()}if(2&e){var r=t.$implicit,i=m.oxw().ngIf;m.xp6(1),m.Q6J("fulfillment",r)("order",i)}}function Ji(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div"),m.TgZ(1,"div",23),m.TgZ(2,"div",24),m._UZ(3,"vdr-order-table",25),m.TgZ(4,"h4"),m._uU(5),m.ALo(6,"translate"),m.qZA(),m.TgZ(7,"table",26),m.TgZ(8,"thead"),m.TgZ(9,"tr"),m.TgZ(10,"th"),m._uU(11),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"th"),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"th"),m._uU(17),m.ALo(18,"translate"),m.qZA(),m.TgZ(19,"th"),m._uU(20),m.ALo(21,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(22,"tbody"),m.YNc(23,Ii,12,12,"tr",27),m.qZA(),m.qZA(),m._UZ(24,"vdr-custom-detail-component-host",28),m.TgZ(25,"vdr-order-history",29),m.NdJ("addNote",function(e){return m.CHM(n),m.oxw().addNote(e)})("updateNote",function(e){return m.CHM(n),m.oxw().updateNote(e)})("deleteNote",function(e){return m.CHM(n),m.oxw().deleteNote(e)}),m.ALo(26,"async"),m.qZA(),m.qZA(),m.TgZ(27,"div",30),m.TgZ(28,"vdr-order-custom-fields-card",31),m.NdJ("updateClick",function(e){return m.CHM(n),m.oxw().updateCustomFields(e)}),m.qZA(),m.TgZ(29,"div",32),m.TgZ(30,"div",33),m._uU(31),m.ALo(32,"translate"),m.qZA(),m.TgZ(33,"div",34),m.TgZ(34,"div",35),m._UZ(35,"vdr-customer-label",36),m.YNc(36,Li,3,3,"h6",0),m._UZ(37,"vdr-formatted-address",37),m.YNc(38,ki,3,3,"h6",0),m._UZ(39,"vdr-formatted-address",37),m.qZA(),m.qZA(),m.qZA(),m.YNc(40,Si,2,1,"ng-container",0),m.YNc(41,Fi,2,2,"ng-container",27),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(3),m.Q6J("order",r)("orderLineCustomFields",i.orderLineCustomFields),m.xp6(2),m.Oqu(m.lcZ(6,22,"order.tax-summary")),m.xp6(6),m.Oqu(m.lcZ(12,24,"common.description")),m.xp6(3),m.Oqu(m.lcZ(15,26,"order.tax-rate")),m.xp6(3),m.Oqu(m.lcZ(18,28,"order.tax-base")),m.xp6(3),m.Oqu(m.lcZ(21,30,"order.tax-total")),m.xp6(3),m.Q6J("ngForOf",r.taxSummary),m.xp6(1),m.Q6J("entity$",i.entity$)("detailForm",i.detailForm),m.xp6(1),m.Q6J("order",r)("history",m.lcZ(26,32,i.history$)),m.xp6(3),m.Q6J("customFieldsConfig",i.customFields)("customFieldValues",r.customFields),m.xp6(3),m.hij(" ",m.lcZ(32,34,"order.customer")," "),m.xp6(4),m.Q6J("customer",r.customer),m.xp6(1),m.Q6J("ngIf",i.getOrderAddressLines(r.shippingAddress).length),m.xp6(1),m.Q6J("address",r.shippingAddress),m.xp6(1),m.Q6J("ngIf",i.getOrderAddressLines(r.billingAddress).length),m.xp6(1),m.Q6J("address",r.billingAddress),m.xp6(1),m.Q6J("ngIf",r.payments&&r.payments.length),m.xp6(1),m.Q6J("ngForOf",r.fulfillments)}}var Mi=function(e){r(i,e);var n=o(i);function i(e,t,r,o,a,l,c,d){var s;return g(this,i),(s=n.call(this,t,e,r,a)).changeDetector=o,s.dataService=a,s.notificationService=l,s.modalService=c,s.orderTransitionService=d,s.detailForm=new f.cw({}),s.fetchHistory=new j.xQ,s.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"],s}return v(i,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.entity$.pipe((0,z.q)(1)).subscribe(function(t){"Modifying"===t.state&&e.router.navigate(["./","modify"],{relativeTo:e.route})}),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.history$=this.fetchHistory.pipe((0,H.O)(null),(0,$.w)(function(){return e.dataService.order.getOrderHistory(e.id,{sort:{createdAt:h.Asd.DESC}}).mapStream(function(e){var t;return null===(t=e.order)||void 0===t?void 0:t.history.items})})),this.nextStates$=this.entity$.pipe((0,R.U)(function(t){return e.defaultStates.includes(t.state)?t.nextStates.filter(function(t){return!e.defaultStates.includes(t)}):t.nextStates}))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"openStateDiagram",value:function(){var e=this;this.entity$.pipe((0,z.q)(1),(0,$.w)(function(t){return e.modalService.fromComponent($n,{closable:!0,locals:{activeState:t.state}})})).subscribe()}},{key:"transitionToState",value:function(e){var t=this;this.dataService.order.transitionToState(this.id,e).subscribe(function(n){var r=n.transitionOrderToState;switch(null==r?void 0:r.__typename){case"Order":t.notificationService.success((0,I.J)("order.transitioned-to-state-success"),{state:e}),t.fetchHistory.next();break;case"OrderStateTransitionError":t.notificationService.error(r.transitionError)}})}},{key:"manuallyTransitionToState",value:function(e){this.orderTransitionService.manuallyTransitionToState({orderId:e.id,nextStates:e.nextStates,cancellable:!0,message:(0,I.J)("order.manually-transition-to-state-message"),retry:0}).subscribe()}},{key:"transitionToModifying",value:function(){var e=this;this.dataService.order.transitionToState(this.id,"Modifying").subscribe(function(t){var n=t.transitionOrderToState;switch(null==n?void 0:n.__typename){case"Order":e.router.navigate(["./modify"],{relativeTo:e.route});break;case"OrderStateTransitionError":e.notificationService.error(n.transitionError)}})}},{key:"updateCustomFields",value:function(e){var t=this;this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe(function(){t.notificationService.success((0,I.J)("common.notify-update-success"),{entity:"Order"})})}},{key:"getOrderAddressLines",value:function(e){return e?Object.values(e).filter(function(e){return"OrderAddress"!==e}).filter(function(e){return!!e}):[]}},{key:"settlePayment",value:function(e){var t=this;this.dataService.order.settlePayment(e.id).subscribe(function(e){var n=e.settlePayment;switch(n.__typename){case"Payment":"Settled"===n.state?t.notificationService.success((0,I.J)("order.settle-payment-success")):t.notificationService.error((0,I.J)("order.settle-payment-error")),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":t.notificationService.error(n.message)}})}},{key:"transitionPaymentState",value:function(e){var t=this,n=e.payment,r=e.state;"Cancelled"===r?this.dataService.order.cancelPayment(n.id).subscribe(function(e){var n=e.cancelPayment;switch(n.__typename){case"Payment":t.notificationService.success((0,I.J)("order.transitioned-payment-to-state-success"),{state:r}),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"PaymentStateTransitionError":t.notificationService.error(n.transitionError);break;case"CancelPaymentError":t.notificationService.error(n.paymentErrorMessage)}}):this.dataService.order.transitionPaymentToState(n.id,r).subscribe(function(e){var n=e.transitionPaymentToState;switch(n.__typename){case"Payment":t.notificationService.success((0,I.J)("order.transitioned-payment-to-state-success"),{state:r}),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"PaymentStateTransitionError":t.notificationService.error(n.message)}})}},{key:"canAddFulfillment",value:function(e){var n,r,i=(null!==(n=e.fulfillments)&&void 0!==n?n:[]).reduce(function(e,n){return[].concat(t(e),t(n.summary))},[]),o=!0,a=s(e.lines);try{var l=function(){var e=r.value;i.filter(function(t){return t.orderLine.id===e.id}).reduce(function(e,t){return e+t.quantity},0)<e.quantity&&(o=!1)};for(a.s();!(r=a.n()).done;)l()}catch(c){a.e(c)}finally{a.f()}return!o&&!this.hasUnsettledModifications(e)&&0===this.outstandingPaymentAmount(e)&&(e.nextStates.includes("Shipped")||e.nextStates.includes("PartiallyShipped")||e.nextStates.includes("Delivered"))}},{key:"hasUnsettledModifications",value:function(e){return 0<e.modifications.filter(function(e){return!e.isSettled}).length}},{key:"getOutstandingModificationAmount",value:function(e){return(0,gn.summate)(e.modifications.filter(function(e){return!e.isSettled}),"priceChange")}},{key:"outstandingPaymentAmount",value:function(e){var t,n,r,i,o=0,a=s(null!==(n=null===(t=e.payments)||void 0===t?void 0:t.filter(function(e){return"Cancelled"!==e.state&&"Declined"!==e.state&&"Error"!==e.state}))&&void 0!==n?n:[]);try{for(a.s();!(i=a.n()).done;){var l=i.value,c=null!==(r=l.refunds.filter(function(e){return"Failed"!==e.state}))&&void 0!==r?r:[],d=(0,gn.summate)(c,"total");o+=l.amount-d}}catch(u){a.e(u)}finally{a.f()}return e.totalWithTax-o}},{key:"addManualPayment",value:function(e){var t=this,n=e.state;this.modalService.fromComponent(w,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(e),currencyCode:e.currencyCode}}).pipe((0,$.w)(function(e){return e?t.dataService.order.addManualPaymentToOrder({orderId:t.id,transactionId:e.transactionId,method:e.method,metadata:e.metadata||{}}):Se.E}),(0,$.w)(function(r){var i=r.addManualPaymentToOrder;switch(i.__typename){case"Order":return t.notificationService.success((0,I.J)("order.add-payment-to-order-success")),"ArrangingAdditionalPayment"===n?t.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates):t.dataService.order.transitionToState(t.id,"PaymentSettled").pipe((0,Fn.h)("PaymentSettled"));case"ManualPaymentStateError":return t.notificationService.error(i.message),Se.E;default:return Se.E}})).subscribe(function(e){e&&t.refetchOrder({result:e})})}},{key:"fulfillOrder",value:function(){var e=this;this.entity$.pipe((0,z.q)(1),(0,$.w)(function(t){return e.modalService.fromComponent(un,{size:"xl",locals:{order:t}})}),(0,$.w)(function(t){return t?e.dataService.order.createFulfillment(t):(0,te.of)(void 0)}),(0,$.w)(function(t){return e.refetchOrder(t).pipe((0,Fn.h)(t))})).subscribe(function(t){if(t){var n=t.addFulfillmentToOrder;switch(n.__typename){case"Fulfillment":e.notificationService.success((0,I.J)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":case"InvalidFulfillmentHandlerError":e.notificationService.error(n.message);break;case"FulfillmentStateTransitionError":e.notificationService.error(n.transitionError);break;case"CreateFulfillmentError":e.notificationService.error(n.fulfillmentHandlerError);break;case void 0:e.notificationService.error(JSON.stringify(n));break;default:(0,gn.assertNever)(n)}}})}},{key:"transitionFulfillment",value:function(e,t){var n=this;this.dataService.order.transitionFulfillmentToState(e,t).pipe((0,$.w)(function(e){return n.refetchOrder(e)})).subscribe(function(){n.notificationService.success((0,I.J)("order.successfully-updated-fulfillment"))})}},{key:"cancelOrRefund",value:function(e){var t=this.orderHasSettledPayments(e);"PaymentAuthorized"!==e.state&&!0!==e.active&&t?this.refundOrder(e):this.cancelOrder(e)}},{key:"settleRefund",value:function(e){var t=this;this.modalService.fromComponent(fr,{size:"md",locals:{refund:e}}).pipe((0,$.w)(function(n){return n?t.dataService.order.settleRefund({transactionId:n,id:e.id},t.id):(0,te.of)(void 0)})).subscribe(function(e){e&&t.notificationService.success((0,I.J)("order.settle-refund-success"))})}},{key:"addNote",value:function(e){var t=this,n=e.note,r=e.isPublic;this.dataService.order.addNoteToOrder({id:this.id,note:n,isPublic:r}).pipe((0,$.w)(function(e){return t.refetchOrder(e)})).subscribe(function(e){t.notificationService.success((0,I.J)("common.notify-create-success"),{entity:"Note"})})}},{key:"updateNote",value:function(e){var t=this;this.modalService.fromComponent(h.UlA,{closable:!0,locals:{displayPrivacyControls:!0,note:e.data.note,noteIsPrivate:!e.isPublic}}).pipe((0,$.w)(function(n){return n?t.dataService.order.updateOrderNote({noteId:e.id,isPublic:!n.isPrivate,note:n.note}):Se.E})).subscribe(function(e){t.fetchHistory.next(),t.notificationService.success((0,I.J)("common.notify-update-success"),{entity:"Note"})})}},{key:"deleteNote",value:function(e){var t=this;return this.modalService.dialog({title:(0,I.J)("common.confirm-delete-note"),body:e.data.note,buttons:[{type:"secondary",label:(0,I.J)("common.cancel")},{type:"danger",label:(0,I.J)("common.delete"),returnValue:!0}]}).pipe((0,$.w)(function(n){return n?t.dataService.order.deleteOrderNote(e.id):Se.E})).subscribe(function(){t.fetchHistory.next(),t.notificationService.success((0,I.J)("common.notify-delete-success"),{entity:"Note"})})}},{key:"orderHasSettledPayments",value:function(e){var t;return!!(null===(t=e.payments)||void 0===t?void 0:t.find(function(e){return"Settled"===e.state}))}},{key:"cancelOrder",value:function(e){var t=this;this.modalService.fromComponent(Y,{size:"xl",locals:{order:e}}).pipe((0,$.w)(function(e){return e?t.dataService.order.cancelOrder(e):(0,te.of)(void 0)}),(0,$.w)(function(e){return t.refetchOrder(e)})).subscribe(function(e){e&&t.notificationService.success((0,I.J)("order.cancelled-order-success"))})}},{key:"refundOrder",value:function(e){var t=this;this.modalService.fromComponent(cr,{size:"xl",locals:{order:e}}).pipe((0,$.w)(function(e){var n;return e?(null===(n=e.cancel.lines)||void 0===n?void 0:n.length)?t.dataService.order.cancelOrder(e.cancel).pipe((0,R.U)(function(n){var r=n.cancelOrder;switch(r.__typename){case"Order":return t.refetchOrder(r).subscribe(),t.notificationService.success((0,I.J)("order.cancelled-order-success")),e;case"CancelActiveOrderError":case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"EmptyOrderLineSelectionError":return void t.notificationService.error(r.message)}})):[e]:(0,te.of)(void 0)}),(0,$.w)(function(e){return e?e.refund.lines.length?t.dataService.order.refundOrder(e.refund).pipe((0,R.U)(function(e){return e.refundOrder})):[void 0]:(0,te.of)(void 0)})).subscribe(function(e){if(e)switch(e.__typename){case"Refund":t.refetchOrder(e).subscribe(),"Failed"===e.state?t.notificationService.error((0,I.J)("order.refund-order-failed")):t.notificationService.success((0,I.J)("order.refund-order-success"));break;case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":t.notificationService.error(e.message)}})}},{key:"refetchOrder",value:function(e){return this.fetchHistory.next(),e?this.dataService.order.getOrder(this.id).single$:(0,te.of)(void 0)}},{key:"setFormValues",value:function(e){}}]),i}(h.UT_);Mi.\u0275fac=function(e){return new(e||Mi)(m.Y36(Ne.F0),m.Y36(Ne.gz),m.Y36(h.iHG),m.Y36(m.sBO),m.Y36(h.DoR),m.Y36(h.gqp),m.Y36(h.Z7U),m.Y36(Re))},Mi.\u0275cmp=m.Xpm({type:Mi,selectors:[["vdr-order-detail"]],features:[m.qOj],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],["locationId","order-detail"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"btn","btn-primary",3,"click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"order","orderLineCustomFields"],[1,"table"],[4,"ngFor","ngForOf"],["locationId","order-detail",3,"entity$","detailForm"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"clr-col-lg-4","order-cards"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text"],[3,"customer"],[3,"address"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState"]],template:function(e,t){1&e&&(m.YNc(0,wi,29,21,"vdr-action-bar",0),m.ALo(1,"async"),m.YNc(2,Ji,42,36,"div",0),m.ALo(3,"async")),2&e&&(m.Q6J("ngIf",m.lcZ(1,2,t.entity$)),m.xp6(2),m.Q6J("ngIf",m.lcZ(3,4,t.entity$)))},directives:[q.O5,He.Kk,He.BN,Ve.V,Be.G,L.qvL,He.mz,pr.W,We.J,Ge.U,Xe.N,Ke.H,q.sg,St,gr.C,ti,Qt,Yt.d,ae.b,Zi,wn],pipes:[q.Ov,C.X$,T.k,Pe.N,q.Zx],styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0});var Ui,Pi,Qi=u(3372),Yi=u(22663),ji=u(92597);function Di(e,t){1&e&&(m._uU(0),m.ALo(1,"translate")),2&e&&m.Oqu(m.lcZ(1,1,"order.confirm-modifications"))}function Ei(e,t){if(1&e&&(m.TgZ(0,"option",9),m._uU(1),m.ALo(2,"localeCurrency"),m.qZA()),2&e){var n=t.$implicit,r=m.oxw(2);m.Q6J("ngValue",n),m.xp6(1),m.lnq(" #",n.id," ",n.method,": ",m.xi3(2,4,n.amount,r.order.currencyCode)," ")}}function $i(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div"),m.TgZ(1,"clr-select-container"),m.TgZ(2,"label"),m._uU(3),m.ALo(4,"translate"),m.qZA(),m.TgZ(5,"select",5),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().selectedPayment=e}),m.YNc(6,Ei,3,7,"option",6),m.qZA(),m.qZA(),m.TgZ(7,"label",7),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.TgZ(10,"textarea",8),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().refundNote=e}),m.qZA(),m.qZA()}if(2&e){var r=m.oxw();m.xp6(3),m.Oqu(m.lcZ(4,5,"order.payment-to-refund")),m.xp6(2),m.Q6J("ngModel",r.selectedPayment),m.xp6(1),m.Q6J("ngForOf",r.order.payments),m.xp6(2),m.Oqu(m.lcZ(9,7,"order.refund-cancellation-reason")),m.xp6(2),m.Q6J("ngModel",r.refundNote)}}function Ri(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",10),m.NdJ("click",function(){return m.CHM(n),m.oxw().cancel()}),m._uU(1),m.ALo(2,"translate"),m.qZA(),m.TgZ(3,"button",11),m.NdJ("click",function(){return m.CHM(n),m.oxw().submit()}),m._uU(4),m.ALo(5,"translate"),m.qZA()}if(2&e){var r=m.oxw();m.xp6(1),m.Oqu(m.lcZ(2,3,"common.cancel")),m.xp6(2),m.Q6J("disabled",r.priceDifference<0&&!r.selectedPayment),m.xp6(1),m.hij(" ",m.lcZ(5,5,"common.confirm")," ")}}(Pi=Ui||(Ui={}))[Pi.Refund=0]="Refund",Pi[Pi.Payment=1]="Payment",Pi[Pi.PriceUnchanged=2]="PriceUnchanged",Pi[Pi.Cancel=3]="Cancel";var Hi=function(){function e(){g(this,e)}return v(e,[{key:"priceDifference",get:function(){return this.order.totalWithTax-this.originalTotalWithTax}},{key:"ngOnInit",value:function(){this.refundNote=this.modifyOrderInput.note||""}},{key:"cancel",value:function(){this.resolveWith({result:Ui.Cancel})}},{key:"submit",value:function(){0<this.priceDifference?this.resolveWith({result:Ui.Payment}):this.priceDifference<0?this.resolveWith({result:Ui.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:Ui.PriceUnchanged})}}]),e}();Hi.\u0275fac=function(e){return new(e||Hi)},Hi.\u0275cmp=m.Xpm({type:Hi,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(m.YNc(0,Di,2,3,"ng-template",0),m._UZ(1,"vdr-order-table",1),m.TgZ(2,"h4",2),m._uU(3),m.ALo(4,"translate"),m.TgZ(5,"strong"),m._uU(6),m.ALo(7,"localeCurrency"),m.qZA(),m.qZA(),m.YNc(8,$i,11,9,"div",3),m.YNc(9,Ri,6,7,"ng-template",4)),2&e&&(m.xp6(1),m.Q6J("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),m.xp6(2),m.hij(" ",m.lcZ(4,5,"order.modify-order-price-difference"),": "),m.xp6(3),m.Oqu(m.xi3(7,7,t.priceDifference,t.order.currencyCode)),m.xp6(2),m.Q6J("ngIf",t.priceDifference<0))},directives:[Z.q,St,q.O5,b.n,L.dTv,L.MgK,A.y,f.EJ,L.otW,f.JJ,f.On,q.sg,f.Fj,L.XE5,f.Q7,f.YN,f.Kr],pipes:[C.X$,T.k],styles:[""],changeDetection:0});var Vi=u(37122);function Bi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"vdr-action-bar"),m.TgZ(1,"vdr-ab-left"),m.TgZ(2,"div",1),m._UZ(3,"vdr-entity-info",2),m.ALo(4,"async"),m._UZ(5,"vdr-order-state-label",3),m.qZA(),m.qZA(),m.TgZ(6,"vdr-ab-right"),m.TgZ(7,"button",4),m.NdJ("click",function(){var e=m.CHM(n).ngIf;return m.oxw().transitionToPriorState(e)}),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(3),m.Q6J("entity",m.lcZ(4,3,i.entity$)),m.xp6(2),m.Q6J("state",r.state),m.xp6(3),m.hij(" ",m.lcZ(9,5,"order.cancel-modification")," ")}}function Wi(e,t){1&e&&(m.TgZ(0,"th"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.Oqu(m.lcZ(2,1,"common.custom-fields")))}function Gi(e,t){if(1&e&&(m._UZ(0,"img",41),m.ALo(1,"assetPreview")),2&e){var n=m.oxw().$implicit;m.Q6J("src",m.xi3(1,1,n.featuredAsset,"tiny"),m.LSH)}}var Xi=function(e){return[e]};function Ki(e,t){if(1&e&&(m.TgZ(0,"td",42),m._UZ(1,"vdr-tabbed-custom-fields",43),m.qZA()),2&e){var n=m.oxw().index,r=m.oxw(2);m.xp6(1),m.Q6J("customFields",r.orderLineCustomFields)("customFieldsFormGroup",r.orderLineCustomFieldsFormArray.get(m.VKq(3,Xi,n)))("compact",!0)}}function zi(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"tr",29),m.TgZ(1,"td",30),m.YNc(2,Gi,2,4,"img",31),m.qZA(),m.TgZ(3,"td",32),m._uU(4),m.qZA(),m.TgZ(5,"td",33),m._uU(6),m.qZA(),m.TgZ(7,"td",34),m._uU(8),m.ALo(9,"localeCurrency"),m.TgZ(10,"div",16),m.ALo(11,"translate"),m._uU(12),m.ALo(13,"localeCurrency"),m.qZA(),m.qZA(),m.TgZ(14,"td",35),m.TgZ(15,"input",36),m.NdJ("input",function(e){var t=m.CHM(n).$implicit;return m.oxw(2).updateLineQuantity(t,e.target.value)}),m.qZA(),m._UZ(16,"vdr-line-refunds",37),m._UZ(17,"vdr-line-fulfillment",38),m.qZA(),m.YNc(18,Ki,2,5,"td",39),m.TgZ(19,"td",40),m._uU(20),m.ALo(21,"localeCurrency"),m.TgZ(22,"div",16),m.ALo(23,"translate"),m._uU(24),m.ALo(25,"localeCurrency"),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r=t.$implicit,i=m.oxw().ngIf,o=m.oxw();m.ekj("is-cancelled",0===r.quantity)("modified",o.isLineModified(r)),m.xp6(2),m.Q6J("ngIf",r.featuredAsset),m.xp6(2),m.Oqu(r.productVariant.name),m.xp6(2),m.Oqu(r.productVariant.sku),m.xp6(2),m.hij(" ",m.xi3(9,19,r.unitPriceWithTax,i.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(11,22,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(13,24,r.unitPrice,i.currencyCode)," "),m.xp6(3),m.Q6J("value",r.quantity),m.xp6(1),m.Q6J("line",r)("payments",i.payments),m.xp6(1),m.Q6J("line",r)("orderState",i.state),m.xp6(1),m.Q6J("ngIf",o.orderLineCustomFields.length),m.xp6(2),m.hij(" ",m.xi3(21,27,r.linePriceWithTax,i.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(23,30,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(25,32,r.linePrice,i.currencyCode)," ")}}function eo(e,t){if(1&e&&(m._UZ(0,"img",41),m.ALo(1,"assetPreview")),2&e){var n=m.oxw().$implicit;m.Q6J("src",m.xi3(1,1,n.productAsset,"tiny"),m.LSH)}}function to(e,t){if(1&e&&(m.ynx(0),m._UZ(1,"vdr-custom-field-control",48),m.BQk()),2&e){var n=t.$implicit,r=m.oxw(2).index,i=m.oxw(2);m.xp6(1),m.Q6J("customField",n)("customFieldsFormGroup",i.addItemCustomFieldsFormArray.get(m.VKq(3,Xi,r)))("compact",!0)}}function no(e,t){if(1&e&&(m.TgZ(0,"td",42),m.YNc(1,to,2,5,"ng-container",47),m.qZA()),2&e){var n=m.oxw(3);m.xp6(1),m.Q6J("ngForOf",n.orderLineCustomFields)}}function ro(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"tr",44),m.TgZ(1,"td",30),m.YNc(2,eo,2,4,"img",31),m.qZA(),m.TgZ(3,"td",32),m._uU(4),m.qZA(),m.TgZ(5,"td",33),m._uU(6),m.qZA(),m.TgZ(7,"td",34),m._uU(8),m.ALo(9,"localeCurrency"),m.TgZ(10,"div",16),m.ALo(11,"translate"),m._uU(12),m.ALo(13,"localeCurrency"),m.qZA(),m.qZA(),m.TgZ(14,"td",35),m.TgZ(15,"input",36),m.NdJ("input",function(e){var t=m.CHM(n).$implicit;return m.oxw(2).updateAddedItemQuantity(t,e.target.value)}),m.qZA(),m.TgZ(16,"button",45),m.NdJ("click",function(){var e=m.CHM(n).index;return m.oxw(2).removeAddedItem(e)}),m._UZ(17,"clr-icon",46),m.qZA(),m.qZA(),m.YNc(18,no,2,1,"td",39),m.TgZ(19,"td",40),m._uU(20),m.ALo(21,"currency"),m.TgZ(22,"div",16),m.ALo(23,"translate"),m._uU(24),m.ALo(25,"currency"),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r=t.$implicit,i=m.oxw().ngIf,o=m.oxw();m.xp6(2),m.Q6J("ngIf",r.productAsset),m.xp6(2),m.Oqu(r.productVariantName),m.xp6(2),m.Oqu(r.sku),m.xp6(2),m.hij(" ",m.xi3(9,11,r.priceWithTax,i.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(11,14,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(13,16,r.price,i.currencyCode)," "),m.xp6(3),m.Q6J("value",r.quantity),m.xp6(3),m.Q6J("ngIf",o.orderLineCustomFields.length),m.xp6(2),m.hij(" ",m.xi3(21,19,r.priceWithTax*r.quantity/100,i.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(23,22,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(25,24,r.price*r.quantity/100,i.currencyCode)," ")}}function io(e,t){1&e&&m._UZ(0,"td")}function oo(e,t){if(1&e&&(m.TgZ(0,"tr",49),m.TgZ(1,"td",50),m._uU(2),m.qZA(),m.TgZ(3,"td",33),m._uU(4),m.qZA(),m._UZ(5,"td",51),m._UZ(6,"td"),m.YNc(7,io,1,0,"td",0),m.TgZ(8,"td",40),m._uU(9),m.ALo(10,"localeCurrency"),m.TgZ(11,"div",16),m.ALo(12,"translate"),m._uU(13),m.ALo(14,"localeCurrency"),m.qZA(),m.qZA(),m.qZA()),2&e){var n=t.$implicit,r=m.oxw().ngIf,i=m.oxw();m.xp6(2),m.Oqu(n.description),m.xp6(2),m.Oqu(n.sku),m.xp6(3),m.Q6J("ngIf",i.orderLineCustomFields.length),m.xp6(2),m.hij(" ",m.xi3(10,6,n.priceWithTax,r.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(12,9,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(14,11,n.price,r.currencyCode)," ")}}function ao(e,t){1&e&&m._UZ(0,"td")}function lo(e,t){if(1&e&&(m.ynx(0),m._uU(1),m.ALo(2,"localeCurrency"),m.TgZ(3,"div",16),m.ALo(4,"translate"),m._uU(5),m.ALo(6,"localeCurrency"),m.qZA(),m.BQk()),2&e){var n=t.ngIf,r=m.oxw(2).ngIf;m.xp6(1),m.hij(" ",m.xi3(2,3,n.priceWithTax,r.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(4,6,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(6,8,n.price,r.currencyCode)," ")}}function co(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"tr",52),m.TgZ(1,"td",50),m._uU(2),m.TgZ(3,"button",45),m.NdJ("click",function(){var e=m.CHM(n).index;return m.oxw(2).removeSurcharge(e)}),m._UZ(4,"clr-icon",46),m.qZA(),m.qZA(),m.TgZ(5,"td",33),m._uU(6),m.qZA(),m._UZ(7,"td",51),m._UZ(8,"td"),m.YNc(9,ao,1,0,"td",0),m.TgZ(10,"td",40),m.YNc(11,lo,7,11,"ng-container",0),m.qZA(),m.qZA()}if(2&e){var r=t.$implicit,i=m.oxw(2);m.xp6(2),m.hij(" ",r.description," "),m.xp6(4),m.Oqu(r.sku),m.xp6(3),m.Q6J("ngIf",i.orderLineCustomFields.length),m.xp6(2),m.Q6J("ngIf",i.getSurchargePrices(r))}}function so(e,t){1&e&&m._UZ(0,"td")}function uo(e,t){if(1&e&&(m._UZ(0,"img",59),m.ALo(1,"assetPreview")),2&e){var n=t.ngIf;m.Q6J("src",m.xi3(1,1,n,"tiny"),m.LSH)}}function fo(e,t){if(1&e&&(m.TgZ(0,"div",56),m.YNc(1,uo,2,4,"img",57),m.TgZ(2,"div"),m.TgZ(3,"strong",58),m._uU(4),m.qZA(),m.TgZ(5,"small"),m._uU(6),m.qZA(),m.TgZ(7,"div"),m._uU(8),m.ALo(9,"localeCurrency"),m.qZA(),m.qZA(),m.qZA()),2&e){var n=m.oxw(2).ngIf,r=m.oxw();m.xp6(1),m.Q6J("ngIf",r.addItemSelectedVariant.productAsset),m.xp6(3),m.Oqu(r.addItemSelectedVariant.productVariantName),m.xp6(2),m.Oqu(r.addItemSelectedVariant.sku),m.xp6(2),m.hij(" ",m.xi3(9,4,r.getSelectedItemPrice(r.addItemSelectedVariant),n.currencyCode)," ")}}function po(e,t){if(1&e&&(m.ynx(0),m._UZ(1,"vdr-custom-field-control",60),m.BQk()),2&e){var n=t.$implicit,r=m.oxw(3);m.xp6(1),m.Q6J("readonly",!r.addItemSelectedVariant)("customField",n)("customFieldsFormGroup",r.addItemCustomFieldsForm)("compact",!0)}}function go(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"clr-accordion-content"),m.TgZ(1,"vdr-product-selector",53),m.NdJ("productSelected",function(e){return m.CHM(n),m.oxw(2).addItemSelectedVariant=e}),m.qZA(),m.YNc(2,fo,10,7,"div",54),m.YNc(3,po,2,4,"ng-container",47),m.TgZ(4,"button",55),m.NdJ("click",function(){m.CHM(n);var e=m.oxw(2);return e.addItemToOrder(e.addItemSelectedVariant)}),m._uU(5),m.ALo(6,"translate"),m.qZA(),m.qZA()}if(2&e){var r=m.oxw(2);m.xp6(2),m.Q6J("ngIf",r.addItemSelectedVariant),m.xp6(1),m.Q6J("ngForOf",r.orderLineCustomFields),m.xp6(1),m.Q6J("disabled",!r.addItemSelectedVariant||r.addItemCustomFieldsForm.invalid),m.xp6(1),m.hij(" ",m.lcZ(6,4,"order.add-item-to-order")," ")}}function mo(e,t){if(1&e&&(m.TgZ(0,"clr-accordion-content"),m._UZ(1,"vdr-coupon-code-selector",61),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.Q6J("control",n.couponCodesControl)}}var vo=function(e){return{rate:e}};function ho(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"clr-accordion-content"),m.TgZ(1,"form",62),m.NdJ("submit",function(){m.CHM(n);var e=m.oxw(2);return e.addSurcharge(e.surchargeForm.value)}),m.TgZ(2,"vdr-form-field",63),m.ALo(3,"translate"),m._UZ(4,"input",64),m.qZA(),m.TgZ(5,"vdr-form-field",65),m.ALo(6,"translate"),m._UZ(7,"input",66),m.qZA(),m.TgZ(8,"vdr-form-field",67),m.ALo(9,"translate"),m._UZ(10,"vdr-currency-input",68),m.qZA(),m.TgZ(11,"vdr-form-field",69),m.ALo(12,"translate"),m._UZ(13,"input",70),m.qZA(),m.TgZ(14,"vdr-form-field",71),m.ALo(15,"translate"),m.TgZ(16,"vdr-affixed-input",72),m._UZ(17,"input",73),m.qZA(),m.qZA(),m.TgZ(18,"vdr-form-field",74),m.ALo(19,"translate"),m._UZ(20,"input",75),m.qZA(),m.TgZ(21,"button",76),m._uU(22),m.ALo(23,"translate"),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r,i,o=m.oxw().ngIf,a=m.oxw();m.xp6(1),m.Q6J("formGroup",a.surchargeForm),m.xp6(1),m.Q6J("label",m.lcZ(3,10,"common.description")),m.xp6(3),m.Q6J("label",m.lcZ(6,12,"order.product-sku")),m.xp6(3),m.Q6J("label",m.lcZ(9,14,"common.price")),m.xp6(2),m.Q6J("currencyCode",o.currencyCode),m.xp6(1),m.Q6J("label",m.xi3(12,16,"catalog.price-includes-tax-at",m.VKq(25,vo,null==(r=a.surchargeForm.get("taxRate"))?null:r.value))),m.xp6(3),m.Q6J("label",m.lcZ(15,19,"order.tax-rate")),m.xp6(4),m.Q6J("label",m.lcZ(19,21,"order.tax-description")),m.xp6(3),m.Q6J("disabled",a.surchargeForm.invalid||a.surchargeForm.pristine||0===(null==(i=a.surchargeForm.get("price"))?null:i.value)),m.xp6(1),m.hij(" ",m.lcZ(23,23,"order.add-surcharge")," ")}}function Zo(e,t){if(1&e&&(m.TgZ(0,"clr-accordion-content"),m._UZ(1,"vdr-address-form",77),m.ALo(2,"async"),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.Q6J("formGroup",n.shippingAddressForm)("availableCountries",m.lcZ(2,3,n.availableCountries$))("customFields",n.addressCustomFields)}}function yo(e,t){if(1&e&&(m.TgZ(0,"clr-accordion-content"),m._UZ(1,"vdr-address-form",77),m.ALo(2,"async"),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.Q6J("formGroup",n.billingAddressForm)("availableCountries",m.lcZ(2,3,n.availableCountries$))("customFields",n.addressCustomFields)}}var xo=function(e){return{count:e}};function Ao(e,t){if(1&e&&(m.TgZ(0,"li"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.hij(" ",m.xi3(2,1,"order.modification-adding-items",m.VKq(4,xo,null==n.modifyOrderInput.addItems?null:n.modifyOrderInput.addItems.length))," ")}}function bo(e,t){if(1&e&&(m.TgZ(0,"li"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.hij(" ",m.xi3(2,1,"order.modification-adjusting-lines",m.VKq(4,xo,null==n.modifyOrderInput.adjustOrderLines?null:n.modifyOrderInput.adjustOrderLines.length))," ")}}function Co(e,t){if(1&e&&(m.TgZ(0,"li"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e){var n=m.oxw(2);m.xp6(1),m.hij(" ",m.xi3(2,1,"order.modification-adding-surcharges",m.VKq(4,xo,null==n.modifyOrderInput.surcharges?null:n.modifyOrderInput.surcharges.length))," ")}}function qo(e,t){1&e&&(m.TgZ(0,"li"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.modification-updating-shipping-address")," "))}function To(e,t){1&e&&(m.TgZ(0,"li"),m._uU(1),m.ALo(2,"translate"),m.qZA()),2&e&&(m.xp6(1),m.hij(" ",m.lcZ(2,1,"order.modification-updating-billing-address")," "))}function Oo(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div"),m.TgZ(1,"div",5),m.TgZ(2,"div",6),m.TgZ(3,"table",7),m.TgZ(4,"thead"),m.TgZ(5,"tr"),m._UZ(6,"th"),m.TgZ(7,"th"),m._uU(8),m.ALo(9,"translate"),m.qZA(),m.TgZ(10,"th"),m._uU(11),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"th"),m._uU(14),m.ALo(15,"translate"),m.qZA(),m.TgZ(16,"th"),m._uU(17),m.ALo(18,"translate"),m.qZA(),m.YNc(19,Wi,3,3,"th",0),m.TgZ(20,"th"),m._uU(21),m.ALo(22,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(23,"tbody"),m.YNc(24,zi,26,35,"tr",8),m.YNc(25,ro,26,27,"tr",9),m.YNc(26,oo,15,14,"tr",10),m.YNc(27,co,12,4,"tr",11),m.TgZ(28,"tr",12),m.TgZ(29,"td",13),m._uU(30),m.ALo(31,"translate"),m.qZA(),m.TgZ(32,"td",14),m._uU(33),m.qZA(),m._UZ(34,"td",15),m.YNc(35,so,1,0,"td",0),m.TgZ(36,"td",14),m._uU(37),m.ALo(38,"localeCurrency"),m.TgZ(39,"div",16),m.ALo(40,"translate"),m._uU(41),m.ALo(42,"localeCurrency"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(43,"h4",17),m._uU(44),m.ALo(45,"translate"),m.qZA(),m.TgZ(46,"clr-accordion"),m.TgZ(47,"clr-accordion-panel"),m.TgZ(48,"clr-accordion-title"),m._uU(49),m.ALo(50,"translate"),m.qZA(),m.YNc(51,go,7,6,"clr-accordion-content",18),m.qZA(),m.TgZ(52,"clr-accordion-panel"),m.TgZ(53,"clr-accordion-title"),m._uU(54),m.ALo(55,"translate"),m.qZA(),m.YNc(56,mo,2,1,"clr-accordion-content",18),m.qZA(),m.TgZ(57,"clr-accordion-panel"),m.TgZ(58,"clr-accordion-title"),m._uU(59),m.ALo(60,"translate"),m.qZA(),m.YNc(61,ho,24,27,"clr-accordion-content",18),m.qZA(),m.TgZ(62,"clr-accordion-panel"),m.TgZ(63,"clr-accordion-title"),m._uU(64),m.ALo(65,"translate"),m.qZA(),m.YNc(66,Zo,3,5,"clr-accordion-content",18),m.qZA(),m.TgZ(67,"clr-accordion-panel"),m.TgZ(68,"clr-accordion-title"),m._uU(69),m.ALo(70,"translate"),m.qZA(),m.YNc(71,yo,3,5,"clr-accordion-content",18),m.qZA(),m.qZA(),m.qZA(),m.TgZ(72,"div",19),m.TgZ(73,"div",20),m.TgZ(74,"div",21),m._uU(75),m.ALo(76,"translate"),m.qZA(),m.TgZ(77,"div",22),m.TgZ(78,"ul"),m.YNc(79,Ao,3,6,"li",0),m.YNc(80,bo,3,6,"li",0),m.YNc(81,Co,3,6,"li",0),m.YNc(82,qo,3,3,"li",0),m.YNc(83,To,3,3,"li",0),m.qZA(),m.qZA(),m.TgZ(84,"div",22),m.TgZ(85,"label",23),m._uU(86),m.ALo(87,"translate"),m.qZA(),m.TgZ(88,"textarea",24),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().note=e}),m.qZA(),m.TgZ(89,"clr-checkbox-wrapper",25),m.TgZ(90,"input",26),m.NdJ("ngModelChange",function(e){return m.CHM(n),m.oxw().recalculateShipping=e}),m.qZA(),m.TgZ(91,"label"),m._uU(92),m.ALo(93,"translate"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(94,"div",27),m.TgZ(95,"button",28),m.NdJ("click",function(){var e=m.CHM(n).ngIf;return m.oxw().previewAndModify(e)}),m._uU(96),m.ALo(97,"translate"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(8),m.Oqu(m.lcZ(9,35,"order.product-name")),m.xp6(3),m.Oqu(m.lcZ(12,37,"order.product-sku")),m.xp6(3),m.Oqu(m.lcZ(15,39,"order.unit-price")),m.xp6(3),m.Oqu(m.lcZ(18,41,"order.quantity")),m.xp6(2),m.Q6J("ngIf",i.orderLineCustomFields.length),m.xp6(2),m.Oqu(m.lcZ(22,43,"order.total")),m.xp6(3),m.Q6J("ngForOf",r.lines),m.xp6(1),m.Q6J("ngForOf",i.addedLines)("ngForTrackBy",i.trackByProductVariantId),m.xp6(1),m.Q6J("ngForOf",r.surcharges),m.xp6(1),m.Q6J("ngForOf",i.modifyOrderInput.surcharges),m.xp6(3),m.Oqu(m.lcZ(31,45,"order.shipping")),m.xp6(3),m.Oqu(null==r.shippingLines[0]||null==r.shippingLines[0].shippingMethod?null:r.shippingLines[0].shippingMethod.name),m.xp6(2),m.Q6J("ngIf",i.orderLineCustomFields.length),m.xp6(2),m.hij(" ",m.xi3(38,47,r.shippingWithTax,r.currencyCode)," "),m.xp6(2),m.Q6J("title",m.lcZ(40,50,"order.net-price")),m.xp6(2),m.hij(" ",m.xi3(42,52,r.shipping,r.currencyCode)," "),m.xp6(3),m.Oqu(m.lcZ(45,55,"order.modifications")),m.xp6(5),m.Oqu(m.lcZ(50,57,"order.add-item-to-order")),m.xp6(5),m.Oqu(m.lcZ(55,59,"order.set-coupon-codes")),m.xp6(5),m.Oqu(m.lcZ(60,61,"order.add-surcharge")),m.xp6(5),m.Oqu(m.lcZ(65,63,"order.edit-shipping-address")),m.xp6(5),m.Oqu(m.lcZ(70,65,"order.edit-billing-address")),m.xp6(6),m.hij(" ",m.lcZ(76,67,"order.modification-summary")," "),m.xp6(4),m.Q6J("ngIf",null==i.modifyOrderInput.addItems?null:i.modifyOrderInput.addItems.length),m.xp6(1),m.Q6J("ngIf",null==i.modifyOrderInput.adjustOrderLines?null:i.modifyOrderInput.adjustOrderLines.length),m.xp6(1),m.Q6J("ngIf",null==i.modifyOrderInput.surcharges?null:i.modifyOrderInput.surcharges.length),m.xp6(1),m.Q6J("ngIf",i.shippingAddressForm.dirty),m.xp6(1),m.Q6J("ngIf",i.billingAddressForm.dirty),m.xp6(3),m.Oqu(m.lcZ(87,69,"order.note")),m.xp6(2),m.Q6J("ngModel",i.note),m.xp6(2),m.Q6J("ngModel",i.recalculateShipping),m.xp6(2),m.Oqu(m.lcZ(93,71,"order.modification-recalculate-shipping")),m.xp6(3),m.Q6J("disabled",!i.canPreviewChanges()),m.xp6(1),m.hij(" ",m.lcZ(97,73,"order.preview-changes")," ")}}var _o=function(e){r(n,e);var t=o(n);function n(e,r,i,o,a,l,c,d){var s;return g(this,n),(s=t.call(this,r,e,i,a)).changeDetector=o,s.dataService=a,s.notificationService=l,s.modalService=c,s.orderTransitionService=d,s.detailForm=new f.cw({}),s.couponCodesControl=new f.NI,s.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},s.note="",s.recalculateShipping=!0,s.addedVariants=new Map,s}return v(n,[{key:"addedLines",get:function(){var e=this,t=function(e){return"SinglePrice"===e.__typename?e.value:0};return(this.modifyOrderInput.addItems||[]).map(function(n){var r=e.addedVariants.get(n.productVariantId);if(r)return Object.assign(Object.assign({},r),{price:t(r.price),priceWithTax:t(r.priceWithTax),quantity:n.quantity})}).filter(gn.notNullOrUndefined)}},{key:"ngOnInit",value:function(){var e=this;this.init(),this.dataService.promotion.getPromotions(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe((0,Yi.R)(this.destroy$)).subscribe(function(t){var n,r,i,o,a,l,c,d,u,p,g,m,v,h,Z,y,x,A;t.couponCodes.length&&e.couponCodesControl.setValue(t.couponCodes),e.surchargeForm=new f.cw({description:new f.NI("",f.kI.required),sku:new f.NI(""),price:new f.NI(0,f.kI.required),priceIncludesTax:new f.NI(!0),taxRate:new f.NI(0),taxDescription:new f.NI("")}),e.shippingAddressForm||(e.shippingAddressForm=new f.cw({fullName:new f.NI(null===(n=t.shippingAddress)||void 0===n?void 0:n.fullName),company:new f.NI(null===(r=t.shippingAddress)||void 0===r?void 0:r.company),streetLine1:new f.NI(null===(i=t.shippingAddress)||void 0===i?void 0:i.streetLine1),streetLine2:new f.NI(null===(o=t.shippingAddress)||void 0===o?void 0:o.streetLine2),city:new f.NI(null===(a=t.shippingAddress)||void 0===a?void 0:a.city),province:new f.NI(null===(l=t.shippingAddress)||void 0===l?void 0:l.province),postalCode:new f.NI(null===(c=t.shippingAddress)||void 0===c?void 0:c.postalCode),countryCode:new f.NI(null===(d=t.shippingAddress)||void 0===d?void 0:d.countryCode),phoneNumber:new f.NI(null===(u=t.shippingAddress)||void 0===u?void 0:u.phoneNumber)}),e.addAddressCustomFieldsFormGroup(e.shippingAddressForm,t.shippingAddress)),e.billingAddressForm||(e.billingAddressForm=new f.cw({fullName:new f.NI(null===(p=t.billingAddress)||void 0===p?void 0:p.fullName),company:new f.NI(null===(g=t.billingAddress)||void 0===g?void 0:g.company),streetLine1:new f.NI(null===(m=t.billingAddress)||void 0===m?void 0:m.streetLine1),streetLine2:new f.NI(null===(v=t.billingAddress)||void 0===v?void 0:v.streetLine2),city:new f.NI(null===(h=t.billingAddress)||void 0===h?void 0:h.city),province:new f.NI(null===(Z=t.billingAddress)||void 0===Z?void 0:Z.province),postalCode:new f.NI(null===(y=t.billingAddress)||void 0===y?void 0:y.postalCode),countryCode:new f.NI(null===(x=t.billingAddress)||void 0===x?void 0:x.countryCode),phoneNumber:new f.NI(null===(A=t.billingAddress)||void 0===A?void 0:A.phoneNumber)}),e.addAddressCustomFieldsFormGroup(e.billingAddressForm,t.billingAddress)),e.orderLineCustomFieldsFormArray=new f.Oe([]);var b,C=s(t.lines);try{var q=function(){var t,n=b.value,r=new f.cw({}),i=s(e.orderLineCustomFields);try{for(i.s();!(t=i.n()).done;){var o=t.value.name;r.addControl(o,new f.NI(n.customFields[o]))}}catch(a){i.e(a)}finally{i.f()}r.valueChanges.pipe((0,Yi.R)(e.destroy$)).subscribe(function(t){var r=e.modifyOrderInput.adjustOrderLines.find(function(e){return e.orderLineId===n.id});r||(r={orderLineId:n.id,quantity:n.quantity},e.modifyOrderInput.adjustOrderLines.push(r)),e.orderLineCustomFields.length&&(r.customFields=t)}),e.orderLineCustomFieldsFormArray.push(r)};for(C.s();!(b=C.n()).done;)q()}catch(T){C.e(T)}finally{C.f()}}),this.addItemCustomFieldsFormArray=new f.Oe([]),this.addItemCustomFieldsForm=new f.cw({});var t,n=s(this.orderLineCustomFields);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.addItemCustomFieldsForm.addControl(r.name,new f.NI)}}catch(i){n.e(i)}finally{n.f()}this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(function(e){return e.countries.items}).pipe((0,ji.d)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:h.Asd.DESC},filter:{type:{eq:h.iYD.ORDER_STATE_TRANSITION}}}).single$.subscribe(function(t){var n=t.order;e.previousState=null==n?void 0:n.history.items[0].data.from})}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"transitionToPriorState",value:function(e){var t=this;this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates).subscribe(function(e){t.router.navigate([".."],{relativeTo:t.route})})}},{key:"canPreviewChanges",value:function(){var e=this.modifyOrderInput,t=e.addItems,n=e.adjustOrderLines,r=e.surcharges;return!!(null==t?void 0:t.length)||!!(null==r?void 0:r.length)||!!(null==n?void 0:n.length)||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid||this.couponCodesControl.dirty}},{key:"isLineModified",value:function(e){var t;return!!(null===(t=this.modifyOrderInput.adjustOrderLines)||void 0===t?void 0:t.find(function(t){return t.orderLineId===e.id&&t.quantity!==e.quantity}))}},{key:"updateLineQuantity",value:function(e,t){var n=this.modifyOrderInput.adjustOrderLines,r=null==n?void 0:n.find(function(t){return t.orderLineId===e.id});r&&+t===e.quantity&&(null==n||n.splice(null==n?void 0:n.indexOf(r),1)),r||(r={orderLineId:e.id,quantity:+t},null==n||n.push(r)),r.quantity=+t}},{key:"updateAddedItemQuantity",value:function(e,t){var n,r=null===(n=this.modifyOrderInput.addItems)||void 0===n?void 0:n.find(function(t){return t.productVariantId===e.productVariantId});r&&(r.quantity=+t)}},{key:"trackByProductVariantId",value:function(e,t){return t.productVariantId}},{key:"getSelectedItemPrice",value:function(e){switch(null==e?void 0:e.priceWithTax.__typename){case"SinglePrice":return e.priceWithTax.value;default:return 0}}},{key:"addItemToOrder",value:function(e){var t,n,r=this;if(e){var i=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0,o=null===(t=this.modifyOrderInput.addItems)||void 0===t?void 0:t.find(function(t){return r.isMatchingAddItemRow(t,e,i)});if(o?o.quantity++:(o={productVariantId:e.productVariantId,quantity:1},i&&(o.customFields=i),null===(n=this.modifyOrderInput.addItems)||void 0===n||n.push(o)),i){for(var a=new f.cw({}),l=0,c=Object.entries(i);l<c.length;l++){var s=d(c[l],2),u=s[0],p=s[1];a.addControl(u,new f.NI(p))}this.addItemCustomFieldsFormArray.push(a),a.valueChanges.pipe((0,Yi.R)(this.destroy$)).subscribe(function(e){o&&(o.customFields=e)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(e.productVariantId,e)}}},{key:"isMatchingAddItemRow",value:function(e,t,n){return e.productVariantId===t.productVariantId&&JSON.stringify(e.customFields)===JSON.stringify(n)}},{key:"removeAddedItem",value:function(e){this.modifyOrderInput.addItems.splice(e,1),-1<e&&this.addItemCustomFieldsFormArray.removeAt(e)}},{key:"getSurchargePrices",value:function(e){var t=e.priceIncludesTax?e.price:Math.round(e.price*((100+(e.taxRate||0))/100));return{price:e.priceIncludesTax?Math.round(e.price/((100+(e.taxRate||0))/100)):e.price,priceWithTax:t}}},{key:"addSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.push(e),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}},{key:"removeSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.splice(e,1)}},{key:"previewAndModify",value:function(e){var t,n=this,r=Object.assign(Object.assign({},this.modifyOrderInput),{adjustOrderLines:this.modifyOrderInput.adjustOrderLines.map(function(e){return(0,h.EJQ)((0,Qi.I)(e),n.orderLineCustomFields)})}),i=Object.assign(Object.assign(Object.assign(Object.assign({},r),this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{}),this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{}),{dryRun:!0,couponCodes:this.couponCodesControl.dirty?this.couponCodesControl.value:void 0,note:null!==(t=this.note)&&void 0!==t?t:"",options:{recalculateShipping:this.recalculateShipping}}),o=e.totalWithTax;this.dataService.order.modifyOrder(i).pipe((0,$.w)(function(e){var t=e.modifyOrder;switch(t.__typename){case"Order":return n.modalService.fromComponent(Hi,{size:"xl",closable:!1,locals:{originalTotalWithTax:o,order:t,orderLineCustomFields:n.orderLineCustomFields,modifyOrderInput:i}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":case"CouponCodeLimitError":case"CouponCodeExpiredError":case"CouponCodeInvalidError":return n.notificationService.error(t.message),(0,te.of)(!1);case null:case void 0:return(0,te.of)(!1);default:(0,gn.assertNever)(t)}}),(0,$.w)(function(t){if(!t||t.result===Ui.Cancel)return n.dataService.order.getOrder(n.id).mapSingle(function(){return!1});var r=Object.assign(Object.assign({},i),{dryRun:!1});return t.result===Ui.Refund&&(r.refund={paymentId:t.refundPaymentId,reason:t.refundNote}),n.dataService.order.modifyOrder(r).pipe((0,$.w)(function(t){var r=t.modifyOrder;if("Order"===r.__typename){var i=0<r.totalWithTax-o?"ArrangingAdditionalPayment":n.previousState;return n.dataService.order.transitionToState(e.id,i).pipe((0,Fn.h)(!0))}return n.notificationService.error(r.message),Se.E}))})).subscribe(function(e){e&&n.router.navigate(["../"],{relativeTo:n.route})})}},{key:"addAddressCustomFieldsFormGroup",value:function(e,t){var n;if(t&&this.addressCustomFields.length){var r,i=new f.cw({}),o=s(this.addressCustomFields);try{for(o.s();!(r=o.n()).done;){var a=r.value.name,l=null===(n=t.customFields)||void 0===n?void 0:n[a];i.addControl(a,new f.NI(l))}}catch(c){o.e(c)}finally{o.f()}e.addControl("customFields",i)}}},{key:"setFormValues",value:function(e,t){}}]),n}(h.UT_);_o.\u0275fac=function(e){return new(e||_o)(m.Y36(Ne.F0),m.Y36(Ne.gz),m.Y36(h.iHG),m.Y36(m.sBO),m.Y36(h.DoR),m.Y36(h.gqp),m.Y36(h.Z7U),m.Y36(Re))},_o.\u0275cmp=m.Xpm({type:_o,selectors:[["vdr-order-editor"]],features:[m.qOj],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],["entityName","OrderLine",3,"customFields","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb4",3,"productSelected"],["class","flex mb4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb4"],["class","mr4",3,"src",4,"ngIf"],[1,"mr4"],[1,"mr4",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"control"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(e,t){1&e&&(m.YNc(0,Bi,10,7,"vdr-action-bar",0),m.ALo(1,"async"),m.YNc(2,Oo,98,75,"div",0),m.ALo(3,"async")),2&e&&(m.Q6J("ngIf",m.lcZ(1,2,t.entity$)),m.xp6(2),m.Q6J("ngIf",m.lcZ(3,4,t.entity$)))},directives:[q.O5,He.Kk,He.BN,Ve.V,Be.G,He.mz,q.sg,L.q0d,L.bZL,L.twP,L.GmI,L.dxz,L.UJ5,L.Nz$,L.DbV,L.MgK,A.y,f.Fj,L.XE5,f.Q7,f.JJ,f.On,L.PEh,f.Wl,L.KKC,ct,At,Ft.y,L.qvL,et.M,L.r6y,ze.c,W,f._Y,f.JL,f.sg,y.h,f.u,Rn.K,Vi.K,f.qQ,f.Fd,f.wV,le.C],pipes:[q.Ov,C.X$,T.k,k.M,q.H9],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:bold;border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{text-align:start}"],changeDetection:0});var wo=u(3786),Io=u(47491),Lo=u.n(Io),ko=u(89919),No=u(9170),So=u(56852),Fo=u(20365),Jo=u(30901),Mo=u(59416),Uo=u(95606),Po=u(33594),Qo=u(28899);function Yo(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"button",22),m.NdJ("click",function(){var e=m.CHM(n).$implicit;return m.oxw(2).selectFilterPreset(e.name)}),m._uU(1),m.ALo(2,"translate"),m.qZA()}if(2&e){var r=t.$implicit,i=m.oxw().ngIf;m.ekj("btn-primary",i===r.name),m.xp6(1),m.hij(" ",m.lcZ(2,3,r.label)," ")}}function jo(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"div",20),m.YNc(1,Yo,3,5,"button",21),m.TgZ(2,"button",22),m.NdJ("click",function(){return m.CHM(n),m.oxw().selectFilterPreset("custom")}),m._uU(3),m.ALo(4,"translate"),m._UZ(5,"clr-icon",23),m.qZA(),m.qZA()}if(2&e){var r=t.ngIf,i=m.oxw();m.xp6(1),m.Q6J("ngForOf",i.filterPresets),m.xp6(1),m.ekj("btn-primary","custom"===r),m.xp6(1),m.hij(" ",m.lcZ(4,4,"order.filter-custom")," ")}}function Do(e,t){if(1&e&&(m._uU(0),m.ALo(1,"translate"),m.ALo(2,"stateI18nToken")),2&e){var n=t.item;m.Oqu(m.lcZ(1,1,m.lcZ(2,3,n)))}}function Eo(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"span",24),m._uU(1),m.ALo(2,"translate"),m.ALo(3,"stateI18nToken"),m.qZA(),m.TgZ(4,"span",25),m.NdJ("click",function(){var e=m.CHM(n),t=e.item;return e.clear(t)}),m._uU(5,"\xd7"),m.qZA()}if(2&e){var r=t.item;m.xp6(1),m.hij(" ",m.lcZ(2,1,m.lcZ(3,3,r)),"")}}var $o=function(){return["./draft/create"]};function Ro(e,t){1&e&&(m.TgZ(0,"a",27),m._UZ(1,"clr-icon",28),m._uU(2),m.ALo(3,"translate"),m.qZA()),2&e&&(m.Q6J("routerLink",m.DdM(4,$o)),m.xp6(2),m.hij(" ",m.lcZ(3,2,"catalog.create-draft-order")," "))}var Ho=function(){return["CreateOrder"]};function Vo(e,t){1&e&&(m.ynx(0),m.YNc(1,Ro,4,5,"a",26),m.BQk()),2&e&&(m.xp6(1),m.Q6J("vdrIfPermissions",m.DdM(1,Ho)))}function Bo(e,t){if(1&e){var n=m.EpF();m.TgZ(0,"vdr-table-row-action",37),m.NdJ("click",function(){m.CHM(n);var e=m.oxw().item;return m.oxw().toNextState(e)}),m.qZA()}if(2&e){var r=m.oxw().item,i=m.oxw();m.Q6J("large",!0)("label",i.getNextState(r,!0))}}function Wo(e,t){if(1&e&&(m.TgZ(0,"td",29),m._UZ(1,"vdr-order-label",30),m.qZA(),m.TgZ(2,"td",29),m._UZ(3,"vdr-customer-label",31),m.qZA(),m.TgZ(4,"td",29),m._UZ(5,"vdr-order-state-label",32),m.qZA(),m.TgZ(6,"td",29),m._uU(7),m.ALo(8,"localeCurrency"),m.qZA(),m.TgZ(9,"td",29),m._uU(10),m._UZ(11,"br"),m._uU(12),m.qZA(),m.TgZ(13,"td",33),m._UZ(14,"vdr-cd-timer",34),m.qZA(),m.TgZ(15,"td",29),m._uU(16),m.qZA(),m.TgZ(17,"td",35),m.YNc(18,Bo,1,2,"vdr-table-row-action",36),m.qZA()),2&e){var n=t.item,r=m.oxw();m.xp6(1),m.Q6J("order",n),m.xp6(2),m.Q6J("customer",n.customer),m.xp6(2),m.Q6J("state",n.state),m.xp6(2),m.Oqu(m.xi3(8,11,n.totalWithTax,n.currencyCode)),m.xp6(3),m.hij(" ",r.formatTime(n.orderPlacedAt),""),m.xp6(2),m.hij("",r.formatDate(n.orderPlacedAt)," "),m.xp6(2),m.Q6J("scheduledTime",n.customFields.scheduledTime)("processingTime",r.processingTime)("placedTime",n.orderPlacedAt),m.xp6(2),m.Oqu(r.getShippingNames(n)),m.xp6(2),m.Q6J("ngIf",n.nextStates.length>0)}}var Go=function(e){r(i,e);var t=o(i);function i(e,r,o,a,d,s,u){var p,m,v;g(this,i),(m=t.call(this,a,d)).serverConfigService=e,m.dataService=r,m.localStorageService=o,m.modalService=s,m.notificationService=u,m.itemList=[],m.audioOn=!1,m.searchControl=new f.NI(""),m.searchOrderCodeControl=new f.NI(""),m.searchLastNameControl=new f.NI(""),m.orderStates=m.serverConfigService.getOrderProcessStates().map(function(e){return e.name}),m.filterPresets=[{name:"open",label:(0,I.J)("order.filter-preset-open"),config:{active:!1,states:m.orderStates.filter(function(e){return"Completed"!==e&&"Cancelled"!==e&&"Draft"!==e})}},{name:"completed",label:(0,I.J)("order.filter-preset-completed"),config:{states:["Completed","Cancelled"]}},{name:"active",label:(0,I.J)("order.filter-preset-active"),config:{active:!0}},{name:"draft",label:(0,I.J)("order.filter-preset-draft"),config:{active:!1,states:["Draft"]}}],m.canCreateDraftOrder=!1,n((p=l(m),c(i.prototype)),"setQueryFn",p).call(p,function(e,t){return m.dataService.order.getOrders({take:e,skip:t}).refetchOnChannelChange()},function(e){return e.orders},function(e,t){return m.createQueryOptions(e,t,m.searchControl.value,m.route.snapshot.queryParamMap.get("filter")||"open")});var h=m.localStorageService.get("orderListLastCustomFilters");return h&&m.setQueryParam(h,{replaceUrl:!0}),m.canCreateDraftOrder=!!(null===(v=m.serverConfigService.getOrderProcessStates().find(function(e){return"Created"===e.name}))||void 0===v?void 0:v.to.includes("Draft")),m.canCreateDraftOrder||(m.filterPresets=m.filterPresets.filter(function(e){return"draft"!==e.name})),m}return v(i,[{key:"ngOnInit",value:function(){var e,t=this,r=Object.create(null,{ngOnInit:{get:function(){return n(c(i.prototype),"ngOnInit",t)}}});return(0,wo.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.ngOnInit.call(this),this.activePreset$=this.route.queryParamMap.pipe((0,R.U)(function(e){return e.get("filter")||"open"}),(0,E.x)()),this.dataService.settings.getActiveChannel().single$.subscribe(function(e){o.processingTime=e.activeChannel.customFields.processingTime}),n=(0,ko.T)(this.searchControl.valueChanges).pipe((0,No.h)(function(e){return 2<e.length||0===e.length}),(0,ve.b)(250)),(0,ko.T)(n,this.route.queryParamMap).pipe((0,Yi.R)(this.destroy$)).subscribe(function(e){o.refresh()}),i=this.route.snapshot.queryParamMap,this.customFilterForm=new f.cw({states:new f.NI(null!==(e=i.getAll("states"))&&void 0!==e?e:[]),placedAtStart:new f.NI(i.get("placedAtStart")),placedAtEnd:new f.NI(i.get("placedAtEnd"))}),this.setItemsPerPage(50),this.refreshInterval=setInterval(function(){o.refresh()},15e3),this.audioElem=document.getElementById("audio_player"),this.audioElem.muted=!0,this.audioElem.addEventListener("play",function(){o.audioOn=!0,o.audioElem.addEventListener("ended",function(){o.audioOn=!0,o.audioElem.muted=!1})},{once:!0}),this.audioElem.play().then(function(){o.audioOn=!0}),this.items$.subscribe(function(e){0!==o.itemList.length&&o.itemList.length<e.length&&o.playAudio(),o.itemList=e});case 5:case"end":return t.stop()}},t,this)}))}},{key:"toggleAudio",value:function(){this.audioOn?(this.audioOn=!this.audioOn,this.audioElem.muted=!this.audioOn):this.audioElem.play()}},{key:"playAudio",value:function(){var e;null===(e=this.audioElem)||void 0===e||e.play()}},{key:"formatTime",value:function(e){return Lo()(e).format("hh:mm A")}},{key:"formatDate",value:function(e){return Lo()(e).format("DD/MMM")}},{key:"getNextState",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null===(t=e.payments)||void 0===t?void 0:t.filter(function(e){return"Authorized"===e.state&&"cash"===e.method})[0];return"PaymentSettled"===e.state||"PaymentAuthorized"===e.state?"Processing":"Processing"===e.state?n?"Ready For Pickup":"ReadyForPickup":"ReadyForPickup"===e.state?"delivery"===e.shippingLines[0].shippingMethod.code?"Delivering":r&&n?"Collect Cash":"Completed":"Delivering"===e.state?r&&n?"Collect Cash":"Completed":"Processing"}},{key:"toNextState",value:function(e){var t=this;return this.modalService.dialog({title:"Proceed to ".concat(this.getNextState(e,!0),"?"),body:"Are you sure you want to proceed to '".concat(this.getNextState(e,!0),"'?"),buttons:[{type:"secondary",label:(0,I.J)("common.cancel")},{type:"primary",label:"Confirm",returnValue:!0}]}).pipe((0,$.w)(function(n){return(0,wo.mG)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}if("Completed"!==this.getNextState(e)){t.next=6;break}if(!(i=null===(r=e.payments)||void 0===r?void 0:r.filter(function(e){return"Authorized"===e.state&&"cash"===e.method})[0])){t.next=6;break}return t.next=6,this.dataService.order.settlePayment(null==i?void 0:i.id.toString()).toPromise();case 6:return t.next=8,this.dataService.order.transitionToState(e.id.toString(),this.getNextState(e)).toPromise();case 8:return t.abrupt("return",!0);case 9:return t.abrupt("return",Se.E);case 10:case"end":return t.stop()}},t,this)}))})).subscribe(function(){t.notificationService.success("Successfully Updated Order State"),t.refresh()},function(e){t.notificationService.error("Error Updating Order State")})}},{key:"selectFilterPreset",value:function(e){var t,n=null!==(t=this.localStorageService.get("orderListLastCustomFilters"))&&void 0!==t?t:{},r="custom"===e?n:{states:void 0,placedAtStart:void 0,placedAtEnd:void 0};this.setQueryParam(Object.assign({filter:e,page:1},r),{replaceUrl:!0})}},{key:"applyCustomFilters",value:function(){var e=this.customFilterForm.value,t={states:e.states,placedAtStart:e.placedAtStart,placedAtEnd:e.placedAtEnd};this.setQueryParam(Object.assign({filter:"custom"},t)),this.customFilterForm.markAsPristine(),this.localStorageService.set("orderListLastCustomFilters",t)}},{key:"createQueryOptions",value:function(e,t,n,r){var i,o=this.filterPresets.find(function(e){return e.name===r}),a={},l=h.FnJ.AND;if(o)null!=o.config.active&&(a.active={eq:o.config.active}),o.config.states&&(a.state={in:o.config.states});else if("custom"===r){var c=this.route.snapshot.queryParamMap,d=null!==(i=c.getAll("states"))&&void 0!==i?i:[],s=c.get("placedAtStart"),u=c.get("placedAtEnd");d.length&&(a.state={in:d}),s&&u?a.orderPlacedAt={between:{start:s,end:u}}:s?a.orderPlacedAt={after:s}:u&&(a.orderPlacedAt={before:u})}return n&&(a={customerLastName:{contains:n},transactionId:{contains:n},code:{contains:n}},l=h.FnJ.OR),{options:{skip:e,take:t,filter:Object.assign({},null!=a?a:{}),sort:{updatedAt:h.Asd.DESC},filterOperator:l}}}},{key:"getShippingNames",value:function(e){return e.shippingLines.length?e.shippingLines.map(function(e){return e.shippingMethod.name}).join(", "):""}},{key:"ngOnDestroy",value:function(){this.refreshInterval&&clearInterval(this.refreshInterval)}}]),i}(h.t7C);Go.\u0275fac=function(e){return new(e||Go)(m.Y36(h.iHG),m.Y36(h.DoR),m.Y36(h.n2A),m.Y36(Ne.F0),m.Y36(Ne.gz),m.Y36(h.Z7U),m.Y36(h.gqp))},Go.\u0275cmp=m.Xpm({type:Go,selectors:[["vdr-order-list"]],features:[m.qOj],decls:67,vars:66,consts:[["src","assets/notification.mp3","id","audio_player"],["id","audioToggle","type","checkbox","clrToggle","","name","enabled",3,"checked","change"],[1,"visible-toggle"],[1,"search-form"],["class","filter-presets btn-group btn-outline-primary",4,"ngIf"],["type","text","name","searchTerm",1,"search-input",3,"formControl","placeholder"],[1,"custom-filters"],[3,"formGroup"],[1,"flex","align-center"],["appendTo","body","formControlName","states",3,"items","addTag","multiple","placeholder","clearable","searchable"],["ng-option-tmp",""],["ng-label-tmp",""],[1,"btn","btn-secondary",3,"disabled","click"],["shape","filter"],[1,"flex"],["formControlName","placedAtStart"],["formControlName","placedAtEnd"],["locationId","order-list"],[4,"ngIf"],[3,"customRowHeight","items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"filter-presets","btn-group","btn-outline-primary"],["class","btn",3,"btn-primary","click",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["shape","angle down"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"],["class","btn btn-primary mt1",3,"routerLink",4,"vdrIfPermissions"],[1,"btn","btn-primary","mt1",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"order"],[3,"customer"],[3,"state"],[1,"left","align-middle",2,"font-size","16px"],["format","ms","maxTimeUnit","hour",3,"autoStart","scheduledTime","processingTime","placedTime"],[1,"right","align-middle"],["iconShape","step-forward-2",3,"large","label","click",4,"ngIf"],["iconShape","step-forward-2",3,"large","label","click"]],template:function(e,t){1&e&&(m._UZ(0,"audio",0),m.TgZ(1,"clr-toggle-wrapper"),m.TgZ(2,"input",1),m.NdJ("change",function(){return t.toggleAudio()}),m.qZA(),m.TgZ(3,"label",2),m.TgZ(4,"span"),m._uU(5,"Play Notification Sound"),m.qZA(),m.qZA(),m.qZA(),m.TgZ(6,"vdr-action-bar"),m.TgZ(7,"vdr-ab-left"),m.TgZ(8,"div",3),m.YNc(9,jo,6,6,"div",4),m.ALo(10,"async"),m._UZ(11,"input",5),m.ALo(12,"translate"),m.qZA(),m.TgZ(13,"div",6),m.ALo(14,"async"),m.TgZ(15,"form",7),m.TgZ(16,"div",8),m.TgZ(17,"ng-select",9),m.ALo(18,"translate"),m.YNc(19,Do,3,5,"ng-template",10),m.YNc(20,Eo,6,5,"ng-template",11),m.qZA(),m.TgZ(21,"button",12),m.NdJ("click",function(){return t.applyCustomFilters()}),m._uU(22),m.ALo(23,"translate"),m._UZ(24,"clr-icon",13),m.qZA(),m.qZA(),m.TgZ(25,"div",14),m.TgZ(26,"div"),m.TgZ(27,"label"),m._uU(28),m.ALo(29,"translate"),m.qZA(),m._UZ(30,"vdr-datetime-picker",15),m.qZA(),m.TgZ(31,"div"),m.TgZ(32,"label"),m._uU(33),m.ALo(34,"translate"),m.qZA(),m._UZ(35,"vdr-datetime-picker",16),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(36,"vdr-ab-right"),m._UZ(37,"vdr-action-bar-items",17),m.YNc(38,Vo,2,2,"ng-container",18),m.qZA(),m.qZA(),m.TgZ(39,"vdr-data-table",19),m.NdJ("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),m.ALo(40,"async"),m.ALo(41,"async"),m.ALo(42,"async"),m.ALo(43,"async"),m.TgZ(44,"vdr-dt-column"),m._uU(45),m.ALo(46,"translate"),m.qZA(),m.TgZ(47,"vdr-dt-column"),m._uU(48),m.ALo(49,"translate"),m.qZA(),m.TgZ(50,"vdr-dt-column"),m._uU(51),m.ALo(52,"translate"),m.qZA(),m.TgZ(53,"vdr-dt-column"),m._uU(54),m.ALo(55,"translate"),m.qZA(),m.TgZ(56,"vdr-dt-column"),m._uU(57),m.ALo(58,"translate"),m.qZA(),m.TgZ(59,"vdr-dt-column"),m._uU(60),m.ALo(61,"translate"),m.qZA(),m.TgZ(62,"vdr-dt-column"),m._uU(63),m.ALo(64,"translate"),m.qZA(),m._UZ(65,"vdr-dt-column"),m.YNc(66,Wo,19,14,"ng-template"),m.qZA()),2&e&&(m.xp6(2),m.Q6J("checked",t.audioOn),m.xp6(7),m.Q6J("ngIf",m.lcZ(10,30,t.activePreset$)),m.xp6(2),m.Q6J("formControl",t.searchControl)("placeholder",m.lcZ(12,32,"order.search-by-order-filters")),m.xp6(2),m.ekj("expanded","custom"===m.lcZ(14,34,t.activePreset$)),m.xp6(2),m.Q6J("formGroup",t.customFilterForm),m.xp6(2),m.Q6J("items",t.orderStates)("addTag",!1)("multiple",!0)("placeholder",m.lcZ(18,36,"state.all-orders"))("clearable",!0)("searchable",!1),m.xp6(4),m.Q6J("disabled",t.customFilterForm.pristine),m.xp6(1),m.hij(" ",m.lcZ(23,38,"order.apply-filters")," "),m.xp6(6),m.Oqu(m.lcZ(29,40,"order.placed-at-start")),m.xp6(5),m.Oqu(m.lcZ(34,42,"order.placed-at-end")),m.xp6(5),m.Q6J("ngIf",t.canCreateDraftOrder),m.xp6(1),m.Q6J("customRowHeight",5)("items",m.lcZ(40,44,t.items$))("itemsPerPage",m.lcZ(41,46,t.itemsPerPage$))("totalItems",m.lcZ(42,48,t.totalItems$))("currentPage",m.lcZ(43,50,t.currentPage$)),m.xp6(6),m.Oqu(m.lcZ(46,52,"common.code")),m.xp6(3),m.Oqu(m.lcZ(49,54,"order.customer")),m.xp6(3),m.Oqu(m.lcZ(52,56,"order.state")),m.xp6(3),m.Oqu(m.lcZ(55,58,"order.total")),m.xp6(3),m.Oqu(m.lcZ(58,60,"order.placed-at")),m.xp6(3),m.Oqu(m.lcZ(61,62,"common.time-left")),m.xp6(3),m.Oqu(m.lcZ(64,64,"order.shipping")))},directives:[L.PEh,A.y,L.KKC,L.MgK,He.Kk,He.BN,q.O5,f.Fj,f.JJ,f.oH,f._Y,f.JL,f.sg,x.w9,f.u,x.Z2,x.bb,L.qvL,So.I,He.mz,pr.W,Fo.Q,Jo.E,q.sg,Mo.H,Ne.yS,Uo.z,Yt.d,Be.G,Po.I,Qo.v],pipes:[q.Ov,C.X$,Pe.N,T.k],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;max-width:100vw;margin-bottom:6px}.filter-presets[_ngcontent-%COMP%]{max-width:90vw;overflow-x:auto}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:none;max-height:initial}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px;height:36px}ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:5rem!important}"],changeDetection:0});var Xo=function(){function e(t,n){g(this,e),this.router=t,this.dataService=n}return v(e,[{key:"resolve",value:function(e,t){var n=this,r=e.paramMap.get("id"),i=this.router.events.pipe((0,No.h)(function(e){return e instanceof Ne.wM})),o=this.dataService.order.getOrder(r).mapStream(function(e){return e.order}).pipe((0,$.w)(function(t){return"Draft"===(null==t?void 0:t.state)&&e.component!==rn?(n.router.navigate(["/orders/draft",r]),Se.E):[t]}),(0,Yi.R)(i),(0,No.h)(gn.notNullOrUndefined),(0,ji.d)(1));return o.pipe((0,z.q)(1),(0,R.U)(function(){return o}))}}]),e}();Xo.\u0275fac=function(e){return new(e||Xo)(m.LFG(Ne.F0),m.LFG(h.DoR))},Xo.\u0275prov=m.Yz7({token:Xo,factory:Xo.\u0275fac,providedIn:"root"});var Ko=function(){function e(t,n){g(this,e),this.dataService=t,this.router=n}return v(e,[{key:"canActivate",value:function(e,t){var n=this,r=t.url.includes("orders/draft"),i=e.paramMap.get("id");return!r||"create"!==i||this.dataService.order.createDraftOrder().pipe((0,R.U)(function(e){var t=e.createDraftOrder;return n.router.parseUrl("/orders/draft/".concat(t.id))}))}}]),e}();Ko.\u0275fac=function(e){return new(e||Ko)(m.LFG(h.DoR),m.LFG(Ne.F0))},Ko.\u0275prov=m.Yz7({token:Ko,factory:Ko.\u0275fac,providedIn:"root"});var zo=[{path:"",component:Go,data:{breadcrumb:(0,I.J)("breadcrumb.orders")}},{path:"draft/:id",component:rn,resolve:{entity:Xo},canActivate:[Ko],canDeactivate:[h.TSp],data:{breadcrumb:ea}},{path:":id",component:Mi,resolve:{entity:Xo},canActivate:[Ko],canDeactivate:[h.TSp],data:{breadcrumb:ea}},{path:":id/modify",component:_o,resolve:{entity:Xo},data:{breadcrumb:ta}}];function ea(e,t){return(0,h.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.orders",getName:function(e){return e.code},route:""})}function ta(e,t){return ea(e,t).pipe((0,R.U)(function(e){var t=e.slice();return t[0].link[0]="../",t[1].link[0]="../orders",t.concat({label:(0,I.J)("breadcrumb.modifying"),link:[""]})}))}var na=function e(){g(this,e)};na.\u0275fac=function(e){return new(e||na)},na.\u0275mod=m.oAB({type:na}),na.\u0275inj=m.cJS({imports:[[h.m81,Ne.Bz.forChild(zo)]]})}}])}();
//# sourceMappingURL=212-es5.3ef09442f67c03fef388.js.map