!function(){"use strict";var e,t,n,o;function i(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function a(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw a}}}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var o,i,a=[],r=!0,c=!1;try{for(n=n.call(e);!(r=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(l){c=!0,i=l}finally{try{r||null==n.return||n.return()}finally{if(c)throw i}}return a}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function f(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,o=y(e);if(t){var i=y(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return Z(this,n)}}function Z(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}(self.webpackChunk_vendure_admin_ui=self.webpackChunk_vendure_admin_ui||[]).push([[227],{63227:function(l,s,g){g.r(s),g.d(s,{ApplyFacetDialogComponent:function(){return xn},AssetDetailComponent:function(){return J},AssetListComponent:function(){return K},AssetResolver:function(){return vi},AssetsComponent:function(){return we},AssignProductsToChannelDialogComponent:function(){return $n},AssignToChannelDialogComponent:function(){return _i},BulkAddFacetValuesDialogComponent:function(){return Gi},CatalogModule:function(){return Tr},CollectionContentsComponent:function(){return Ye},CollectionDetailComponent:function(){return ft},CollectionListComponent:function(){return Pt},CollectionResolver:function(){return hi},CollectionTreeComponent:function(){return bt},CollectionTreeNodeComponent:function(){return ga},ConfirmVariantDeletionDialogComponent:function(){return Ro},FacetDetailComponent:function(){return Et},FacetListComponent:function(){return sn},FacetResolver:function(){return Zi},GET_PRODUCTS_WITH_FACET_VALUES_BY_IDS:function(){return Li},GET_VARIANTS_WITH_FACET_VALUES_BY_IDS:function(){return Ui},GenerateProductVariantsComponent:function(){return Pa},GeneratedVariant:function(){return fi},OPTION_VALUE_INPUT_VALUE_ACCESSOR:function(){return ei},OptionValueInputComponent:function(){return ti},ProductDetailComponent:function(){return bo},ProductDetailService:function(){return Yn},ProductListComponent:function(){return No},ProductOptionsEditorComponent:function(){return Yo},ProductResolver:function(){return bi},ProductVariantsEditorComponent:function(){return mi},ProductVariantsListComponent:function(){return fr},ProductVariantsResolver:function(){return yi},ProductVariantsTableComponent:function(){return kr},UPDATE_PRODUCTS_BULK:function(){return Vi},UPDATE_VARIANTS_BULK:function(){return Ni},UpdateProductOptionDialogComponent:function(){return Ja},VariantPriceDetailComponent:function(){return $a},arrayToTree:function(){return ht},assetBreadcrumb:function(){return Oi},assignCollectionsToChannelBulkAction:function(){return Bi},assignFacetValuesToProductsBulkAction:function(){return qa},assignFacetsToChannelBulkAction:function(){return ma},assignProductsToChannelBulkAction:function(){return Oa},catalogRoutes:function(){return Ci},collectionBreadcrumb:function(){return Ti},deleteCollectionsBulkAction:function(){return Hi},deleteFacetsBulkAction:function(){return fa},deleteProductsBulkAction:function(){return Ta},facetBreadcrumb:function(){return Pi},productBreadcrumb:function(){return xi},productOptionsEditorBreadcrumb:function(){return ki},productVariantEditorBreadcrumb:function(){return Ai},removeCollectionsFromChannelBulkAction:function(){return Ri},removeFacetsFromChannelBulkAction:function(){return va},removeProductsFromChannelBulkAction:function(){return Fa},replaceLast:function(){return Qn}});var v=g(16320),Z=g(15455),C=g(30724),x=g(33927),A=g(1707),k=g(30464),P=g(27346),T=g(33146),O=g(38276),F=g(59416),q=g(83616),I=g(54364),w=g(70325);function M(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",4),k.NdJ("click",function(){return k.CHM(n),k.oxw().save()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw();k.Q6J("disabled",o.detailForm.invalid||o.detailForm.pristine),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.update")," ")}}var _=function(){return["UpdateCatalog","UpdateAsset"]},J=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r,c){var l;return p(this,n),(l=t.call(this,o,e,i,r)).notificationService=a,l.dataService=r,l.formBuilder=c,l.detailForm=new A.cw({}),l.customFields=l.getCustomFieldConfig("Asset"),l}return f(n,[{key:"ngOnInit",value:function(){this.detailForm=new A.cw({name:new A.NI(""),tags:new A.NI([]),customFields:this.formBuilder.group(this.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),d({},t.name,""))},{}))}),this.init()}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"onAssetChange",value:function(e){var t,n;null===(t=this.detailForm.get("name"))||void 0===t||t.setValue(e.name),null===(n=this.detailForm.get("tags"))||void 0===n||n.setValue(e.tags),this.detailForm.markAsDirty()}},{key:"save",value:function(){var e=this;this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe(function(){e.notificationService.success((0,C.J)("common.notify-update-success"),{entity:"Asset"})},function(t){e.notificationService.error((0,C.J)("common.notify-update-error"),{entity:"Asset"})})}},{key:"setFormValues",value:function(e,t){var n,o;null===(n=this.detailForm.get("name"))||void 0===n||n.setValue(e.name),null===(o=this.detailForm.get("tags"))||void 0===o||o.setValue(e.tags),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),e)}}]),n}(Z.UT_);J.\u0275fac=function(e){return new(e||J)(k.Y36(v.F0),k.Y36(v.gz),k.Y36(Z.iHG),k.Y36(Z.gqp),k.Y36(Z.DoR),k.Y36(A.qu))},J.\u0275cmp=k.Xpm({type:J,selectors:[["vdr-asset-detail"]],features:[k.qOj],decls:9,vars:11,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","customFields","customFieldsForm","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left"),k._UZ(2,"vdr-entity-info",0),k.ALo(3,"async"),k.qZA(),k.TgZ(4,"vdr-ab-right"),k._UZ(5,"vdr-action-bar-items",1),k.YNc(6,M,3,4,"button",2),k.qZA(),k.qZA(),k.TgZ(7,"vdr-asset-preview",3),k.NdJ("assetChange",function(e){return t.onAssetChange(e)}),k.ALo(8,"async"),k.qZA()),2&e&&(k.xp6(2),k.Q6J("entity",k.lcZ(3,6,t.entity$)),k.xp6(4),k.Q6J("vdrIfPermissions",k.DdM(10,_)),k.xp6(1),k.Q6J("asset",k.lcZ(8,8,t.entity$))("editable",!0)("customFields",t.customFields)("customFieldsForm",t.detailForm.get("customFields")))},directives:[P.Kk,P.BN,T.V,P.mz,O.W,F.H,q.A],pipes:[I.Ov,w.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0});var L=g(76491),U=g(61486),V=g(8117),N=g(80639),S=g(22663),$=g(71435),D=g(79902),Q=g(12688),Y=g(84042),j=g(89206),E=g(6940),G=g(50322),H=g(57483),B=g(97388),R=function(){return{}},z=function(){return["DeleteCatalog","DeleteAsset"]},K=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r){var c,l;return p(this,n),(l=t.call(this,a,r)).notificationService=e,l.modalService=o,l.dataService=i,l.searchTerm$=new L.X(void 0),l.filterByTags$=new L.X(void 0),l.uploading=!1,u((c=b(l),y(n.prototype)),"setQueryFn",c).call(c,function(){var e;return(e=l.dataService.product).getAssetList.apply(e,arguments)},function(e){return e.assets},function(e,t){var n,o=l.searchTerm$.value,i=null===(n=l.filterByTags$.value)||void 0===n?void 0:n.map(function(e){return e.value});return{options:Object.assign(Object.assign({skip:e,take:t},o?{filter:{name:{contains:o}}}:{}),{sort:{createdAt:Z.Asd.DESC},tags:i,tagsOperator:Z.FnJ.AND})}},{take:25,skip:0}),l}return f(n,[{key:"ngOnInit",value:function(){var e=this;u(y(n.prototype),"ngOnInit",this).call(this),this.paginationConfig$=(0,U.aj)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe((0,x.U)(function(e){var t=c(e,3);return{itemsPerPage:t[0],currentPage:t[1],totalItems:t[2]}})),this.searchTerm$.pipe((0,N.b)(250),(0,S.R)(this.destroy$)).subscribe(function(){return e.refresh()}),this.filterByTags$.pipe((0,S.R)(this.destroy$)).subscribe(function(){return e.refresh()}),this.allTags$=this.dataService.product.getTagList().mapStream(function(e){return e.tags.items})}},{key:"filesSelected",value:function(e){var t=this;e.length&&(this.uploading=!0,this.dataService.product.createAssets(e).pipe((0,$.x)(function(){return t.uploading=!1})).subscribe(function(e){var o,i=0,a=r(e.createAssets);try{for(a.s();!(o=a.n()).done;){var c=o.value;switch(c.__typename){case"Asset":i++;break;case"MimeTypeError":t.notificationService.error(c.message)}}}catch(l){a.e(l)}finally{a.f()}0<i&&(u(y(n.prototype),"refresh",t).call(t),t.notificationService.success((0,C.J)("asset.notify-create-assets-success"),{count:i}))}))}},{key:"deleteAssets",value:function(e){var t=this;this.showModalAndDelete(e.map(function(e){return e.id})).pipe((0,D.w)(function(n){return n.result===Z.PcR.DELETED?[!0]:t.showModalAndDelete(e.map(function(e){return e.id}),n.message||"").pipe((0,x.U)(function(e){return e.result===Z.PcR.DELETED}))})).subscribe(function(){t.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"Assets"}),t.refresh()},function(e){t.notificationService.error((0,C.J)("common.notify-delete-error"),{entity:"Assets"})})}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-assets"),translationVars:{count:e.length},body:t,buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(o){return o?n.dataService.product.deleteAssets(e,!!t):V.E}),(0,x.U)(function(e){return e.deleteAssets}))}}]),n}(Z.t7C);K.\u0275fac=function(e){return new(e||K)(k.Y36(Z.gqp),k.Y36(Z.Z7U),k.Y36(Z.DoR),k.Y36(v.F0),k.Y36(v.gz))},K.\u0275cmp=k.Xpm({type:K,selectors:[["vdr-asset-list"]],features:[k.qOj],decls:19,vars:31,consts:[[3,"grow"],[1,"pr4","mt1",3,"tags","searchTermChange","tagsChange"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(e,t){1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left",0),k.TgZ(2,"vdr-asset-search-input",1),k.NdJ("searchTermChange",function(e){return t.searchTerm$.next(e)})("tagsChange",function(e){return t.filterByTags$.next(e)}),k.ALo(3,"async"),k.qZA(),k.qZA(),k.TgZ(4,"vdr-ab-right"),k._UZ(5,"vdr-action-bar-items",2),k.TgZ(6,"vdr-asset-file-input",3),k.NdJ("selectFiles",function(e){return t.filesSelected(e)}),k.qZA(),k.qZA(),k.qZA(),k.TgZ(7,"vdr-asset-gallery",4),k.NdJ("deleteAssets",function(e){return t.deleteAssets(e)}),k.ALo(8,"paginate"),k.ALo(9,"async"),k.ALo(10,"async"),k.ALo(11,"hasPermission"),k.qZA(),k.TgZ(12,"div",5),k.TgZ(13,"vdr-items-per-page-controls",6),k.NdJ("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),k.ALo(14,"async"),k.qZA(),k.TgZ(15,"vdr-pagination-controls",7),k.NdJ("pageChange",function(e){return t.setPageNumber(e)}),k.ALo(16,"async"),k.ALo(17,"async"),k.ALo(18,"async"),k.qZA(),k.qZA()),2&e&&(k.xp6(1),k.Q6J("grow",!0),k.xp6(1),k.Q6J("tags",k.lcZ(3,10,t.allTags$)),k.xp6(4),k.Q6J("uploading",t.uploading),k.xp6(1),k.Q6J("assets",k.xi3(8,12,k.lcZ(9,15,t.items$),k.lcZ(10,17,t.paginationConfig$)||k.DdM(29,R)))("multiSelect",!0)("canDelete",k.lcZ(11,19,k.DdM(30,z))),k.xp6(6),k.Q6J("itemsPerPage",k.lcZ(14,21,t.itemsPerPage$)),k.xp6(2),k.Q6J("currentPage",k.lcZ(16,23,t.currentPage$))("itemsPerPage",k.lcZ(17,25,t.itemsPerPage$))("totalItems",k.lcZ(18,27,t.totalItems$)))},directives:[P.Kk,P.BN,Q.V,P.mz,O.W,Y.e,j.K,E.w,G.L],pipes:[I.Ov,H._s,B.j],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});var W=g(22490),X=g(79441),ee=g(89919),te=g(81134),ne=g(9170),oe=g(53466),ie=g(85816),ae=g(87425),re=g(34652),ce=g(65671),le=g(57890),se=g(63516),ue=g(13628),de=g(82505),pe=g(6411),ge=g(31643),fe=g(30735),me=g(41519),ve=g(28854),he=g(15111),Ze=g(51353);function be(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"img",11),k.NdJ("click",function(){k.CHM(n);var e=k.oxw(2);return e.previewAsset(e.featuredAsset)}),k.ALo(1,"assetPreview"),k.qZA()}if(2&e){var o=k.oxw(2);k.Q6J("src",k.xi3(1,1,o.featuredAsset,"small"),k.LSH)}}function ye(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",12),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).selectAssets()}),k._UZ(1,"clr-icon",13),k.TgZ(2,"div"),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.qZA()}2&e&&(k.xp6(3),k.Oqu(k.lcZ(4,1,"catalog.no-featured-asset")))}function Ce(e,t){1&e&&k.GkF(0)}function xe(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",14),k.TgZ(1,"button",15),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).selectAssets()}),k._UZ(2,"clr-icon",16),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.qZA()}2&e&&(k.xp6(3),k.hij(" ",k.lcZ(4,1,"asset.add-asset")," "))}function Ae(e,t){if(1&e&&(k.TgZ(0,"div",3),k.TgZ(1,"div",4),k.TgZ(2,"div",5),k.YNc(3,be,2,4,"img",6),k.YNc(4,ye,5,3,"div",7),k.qZA(),k.qZA(),k.TgZ(5,"div",8),k.YNc(6,Ce,1,0,"ng-container",9),k.qZA(),k.YNc(7,xe,5,3,"div",10),k.qZA()),2&e){var n=k.oxw(),o=k.MAs(4);k.xp6(3),k.Q6J("ngIf",n.featuredAsset),k.xp6(1),k.Q6J("ngIf",!n.featuredAsset),k.xp6(2),k.Q6J("ngTemplateOutlet",o),k.xp6(1),k.Q6J("vdrIfPermissions",n.updatePermissions)}}function ke(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"img",11),k.NdJ("click",function(){k.CHM(n);var e=k.oxw(2);return e.previewAsset(e.featuredAsset)}),k.ALo(1,"assetPreview"),k.qZA()}if(2&e){var o=k.oxw(2);k.Q6J("src",k.xi3(1,1,o.featuredAsset,"thumb"),k.LSH)}}function Pe(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",12),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).selectAssets()}),k._UZ(1,"clr-icon",19),k.qZA()}}function Te(e,t){1&e&&k.GkF(0)}function Oe(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",20),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).selectAssets()}),k.ALo(1,"translate"),k._UZ(2,"clr-icon",16),k._uU(3),k.ALo(4,"translate"),k.qZA()}2&e&&(k.Q6J("title",k.lcZ(1,2,"asset.add-asset")),k.xp6(3),k.hij(" ",k.lcZ(4,4,"asset.add-asset")," "))}function Fe(e,t){if(1&e&&(k.TgZ(0,"div",17),k.YNc(1,ke,2,4,"img",6),k.YNc(2,Pe,2,0,"div",7),k.qZA(),k.YNc(3,Te,1,0,"ng-container",9),k.YNc(4,Oe,5,6,"button",18)),2&e){var n=k.oxw(),o=k.MAs(4);k.xp6(1),k.Q6J("ngIf",n.featuredAsset),k.xp6(1),k.Q6J("ngIf",!n.featuredAsset),k.xp6(1),k.Q6J("ngTemplateOutlet",o),k.xp6(1),k.Q6J("vdrIfPermissions",n.updatePermissions)}}function qe(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",23),k.NdJ("cdkDropListDropped",function(e){return k.CHM(n),k.oxw(2).dropListDropped(e)}),k.ALo(1,"hasPermission"),k.TgZ(2,"vdr-dropdown",24),k.TgZ(3,"div",25),k._UZ(4,"img",26),k.ALo(5,"assetPreview"),k.qZA(),k.TgZ(6,"vdr-dropdown-menu",27),k.TgZ(7,"button",28),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw(2).previewAsset(e)}),k._uU(8),k.ALo(9,"translate"),k.qZA(),k.TgZ(10,"button",29),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw(2).setAsFeatured(e)}),k.ALo(11,"hasPermission"),k._uU(12),k.ALo(13,"translate"),k.qZA(),k._UZ(14,"div",30),k.TgZ(15,"button",31),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw(2).removeAsset(e)}),k.ALo(16,"hasPermission"),k._uU(17),k.ALo(18,"translate"),k.qZA(),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.$implicit,i=t.index,a=k.oxw(2);k.Q6J("cdkDropListData",i)("cdkDropListDisabled",!k.lcZ(1,10,a.updatePermissions)),k.xp6(3),k.ekj("featured",a.isFeatured(o)),k.xp6(1),k.Q6J("src",k.xi3(5,12,o,"tiny"),k.LSH),k.xp6(4),k.hij(" ",k.lcZ(9,15,"asset.preview")," "),k.xp6(2),k.Q6J("disabled",a.isFeatured(o)||!k.lcZ(11,17,a.updatePermissions)),k.xp6(2),k.hij(" ",k.lcZ(13,19,"asset.set-as-featured-asset")," "),k.xp6(3),k.Q6J("disabled",!k.lcZ(16,21,a.updatePermissions)),k.xp6(2),k.hij(" ",k.lcZ(18,23,"asset.remove-asset")," ")}}function Ie(e,t){if(1&e&&(k.TgZ(0,"div",21),k.YNc(1,qe,19,25,"div",22),k.qZA()),2&e){var n=k.oxw();k.ekj("compact",n.compact),k.xp6(1),k.Q6J("ngForOf",n.assets)}}var we=function(){function e(t,n){p(this,e),this.modalService=t,this.changeDetector=n,this.compact=!1,this.change=new k.vpe,this.assets=[]}return f(e,[{key:"assetsSetter",set:function(e){this.assets=(e||[]).slice()}},{key:"selectAssets",value:function(){var e=this;this.modalService.fromComponent(Z.V61,{size:"xl"}).subscribe(function(t){t&&t.length&&(e.assets=(0,ge.T)(e.assets.concat(t),"id"),e.featuredAsset||(e.featuredAsset=t[0]),e.emitChangeEvent(e.assets,e.featuredAsset),e.changeDetector.markForCheck())})}},{key:"setAsFeatured",value:function(e){this.featuredAsset=e,this.emitChangeEvent(this.assets,e)}},{key:"isFeatured",value:function(e){return!!this.featuredAsset&&this.featuredAsset.id===e.id}},{key:"previewAsset",value:function(e){this.modalService.fromComponent(Z.IW,{size:"xl",closable:!0,locals:{asset:e}}).subscribe()}},{key:"removeAsset",value:function(e){this.assets=this.assets.filter(function(t){return t.id!==e.id}),this.featuredAsset&&this.featuredAsset.id===e.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}},{key:"emitChangeEvent",value:function(e,t){this.change.emit({assets:e,featuredAsset:t})}},{key:"dropListDropped",value:function(e){(0,pe.bA)(this.assets,e.previousContainer.data,e.container.data),this.emitChangeEvent(this.assets,this.featuredAsset)}}]),e}();we.\u0275fac=function(e){return new(e||we)(k.Y36(Z.Z7U),k.Y36(k.sBO))},we.\u0275cmp=k.Xpm({type:we,selectors:[["vdr-assets"]],hostVars:2,hostBindings:function(e,t){2&e&&k.ekj("compact",t.compact)},inputs:{assetsSetter:["assets","assetsSetter"],featuredAsset:"featuredAsset",compact:"compact",updatePermissions:"updatePermissions"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["class","drop-list","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"drop-list",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["cdkDrag",""],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(e,t){if(1&e&&(k.YNc(0,Ae,8,4,"div",0),k.YNc(1,Fe,5,4,"ng-template",null,1,k.W1O),k.YNc(3,Ie,2,3,"ng-template",null,2,k.W1O)),2&e){var n=k.MAs(2);k.Q6J("ngIf",!t.compact)("ngIfElse",n)}},directives:[I.O5,I.tP,F.H,ce.qvL,pe.Fd,I.sg,pe.Wj,fe.J,pe.Zt,me.U,ve.N,he.H],pipes:[Ze.M,w.X$,B.j],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer;border-radius:var(--border-radius-img)}.featured-asset[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:60px}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);border-radius:var(--border-radius-img);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:var(--border-radius-img)}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500);border-radius:calc(var(--border-radius-img) + 2px)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:54px}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{width:50px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){display:none}"],changeDetection:0});var Me=g(1143),_e=g(83720),Je=g(14921),Le=g(18293),Ue=g(20365),Ve=g(28899);function Ne(e,t){1&e&&k.GkF(0)}var Se=function(){return{tab:"variants"}},$e=function(e,t){return["/catalog/products",e,t]};function De(e,t){if(1&e&&(k.TgZ(0,"td",7),k._uU(1),k.qZA(),k.TgZ(2,"td",7),k.TgZ(3,"small",8),k._uU(4),k.qZA(),k.qZA(),k.TgZ(5,"td",9),k._UZ(6,"vdr-table-row-action",10),k.ALo(7,"translate"),k.qZA()),2&e){var n=t.item;k.xp6(1),k.Oqu(n.name),k.xp6(3),k.Oqu(n.sku),k.xp6(2),k.Q6J("label",k.lcZ(7,4,"common.edit"))("linkTo",k.WLB(7,$e,n.productId,k.DdM(6,Se)))}}var Qe=function(e){return{$implicit:e}},Ye=function(){function e(t,n,o){p(this,e),this.route=t,this.router=n,this.dataService=o,this.previewUpdatedFilters=!1,this.filterTermControl=new A.NI(""),this.isLoading=!1,this.collectionIdChange$=new L.X(""),this.parentIdChange$=new L.X(""),this.filterChanges$=new L.X([]),this.refresh$=new L.X(!0),this.destroy$=new X.xQ}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.contentsCurrentPage$=this.route.queryParamMap.pipe((0,x.U)(function(e){return e.get("contentsPage")}),(0,x.U)(function(e){return e?+e:1}),(0,Me.O)(1),(0,_e.x)()),this.contentsItemsPerPage$=this.route.queryParamMap.pipe((0,x.U)(function(e){return e.get("contentsPerPage")}),(0,x.U)(function(e){return e?+e:10}),(0,Me.O)(10),(0,_e.x)());var t=this.filterTermControl.valueChanges.pipe((0,N.b)(250),(0,Je.b)(function(){return e.setContentsPageNumber(1)}),(0,Me.O)("")),n=this.filterChanges$.asObservable().pipe((0,ne.h)(function(){return e.previewUpdatedFilters}),(0,Je.b)(function(){return e.setContentsPageNumber(1)}),(0,Me.O)([])),o=(0,U.aj)(this.collectionIdChange$,this.parentIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,t,n,this.refresh$).pipe((0,S.R)(this.destroy$),(0,Je.b)(function(){return e.isLoading=!0}),(0,N.b)(50),(0,D.w)(function(t){var n=c(t,6),o=n[0],i=n[1],a=n[2],r=n[3],l=n[4],s=n[5],u=r,d=(a-1)*r;if(s.length&&e.previewUpdatedFilters){var p=l?{name:{contains:l}}:void 0;return e.dataService.collection.previewCollectionVariants({parentId:i,filters:s},{take:u,skip:d,filter:p}).mapSingle(function(e){return e.previewCollectionVariants}).pipe((0,Le.K)(function(){return(0,te.of)({items:[],totalItems:0})}))}return o?e.dataService.collection.getCollectionContents(o,u,d,l).mapSingle(function(e){var t;return null===(t=e.collection)||void 0===t?void 0:t.productVariants}):(0,te.of)(null)}),(0,Je.b)(function(){return e.isLoading=!1}),(0,$.x)(function(){return e.isLoading=!1}));this.contents$=o.pipe((0,x.U)(function(e){return e?e.items:[]})),this.contentsTotalItems$=o.pipe((0,x.U)(function(e){return e?e.totalItems:0}))}},{key:"ngOnChanges",value:function(e){"collectionId"in e&&this.collectionIdChange$.next(e.collectionId.currentValue),"parentId"in e&&this.parentIdChange$.next(e.parentId.currentValue),"updatedFilters"in e&&this.updatedFilters&&this.filterChanges$.next(this.updatedFilters)}},{key:"ngOnDestroy",value:function(){this.destroy$.next(),this.destroy$.complete()}},{key:"setContentsPageNumber",value:function(e){this.setParam("contentsPage",e)}},{key:"setContentsItemsPerPage",value:function(e){this.setParam("contentsPerPage",e)}},{key:"refresh",value:function(){this.refresh$.next(!0)}},{key:"setParam",value:function(e,t){this.router.navigate(["./"],{relativeTo:this.route,queryParams:d({},e,t),queryParamsHandling:"merge",replaceUrl:!0})}}]),e}();Ye.\u0275fac=function(e){return new(e||Ye)(k.Y36(v.gz),k.Y36(v.F0),k.Y36(Z.DoR))},Ye.\u0275cmp=k.Xpm({type:Ye,selectors:[["vdr-collection-contents"]],contentQueries:function(e,t,n){var o;(1&e&&k.Suo(n,k.Rgc,7),2&e)&&(k.iGM(o=k.CRH())&&(t.headerTemplate=o.first))},inputs:{collectionId:"collectionId",parentId:"parentId",updatedFilters:"updatedFilters",previewUpdatedFilters:"previewUpdatedFilters"},features:[k.TTD],decls:14,vars:26,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",3,"placeholder","formControl"],[1,"table-wrapper"],[1,"progress","loop"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"sku"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(e,t){1&e&&(k.TgZ(0,"div",0),k.TgZ(1,"div",1),k.YNc(2,Ne,1,0,"ng-container",2),k.ALo(3,"async"),k.qZA(),k._UZ(4,"input",3),k.ALo(5,"translate"),k.qZA(),k.TgZ(6,"div",4),k._UZ(7,"div",5),k.TgZ(8,"vdr-data-table",6),k.NdJ("pageChange",function(e){return t.setContentsPageNumber(e)})("itemsPerPageChange",function(e){return t.setContentsItemsPerPage(e)}),k.ALo(9,"async"),k.ALo(10,"async"),k.ALo(11,"async"),k.ALo(12,"async"),k.YNc(13,De,8,10,"ng-template"),k.qZA(),k.qZA()),2&e&&(k.xp6(2),k.Q6J("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",k.VKq(24,Qe,k.lcZ(3,12,t.contentsTotalItems$))),k.xp6(2),k.Q6J("placeholder",k.lcZ(5,14,"catalog.filter-by-name"))("formControl",t.filterTermControl),k.xp6(3),k.ekj("visible",t.isLoading),k.xp6(1),k.ekj("loading",t.isLoading),k.Q6J("items",k.lcZ(9,16,t.contents$))("itemsPerPage",k.lcZ(10,18,t.contentsItemsPerPage$))("totalItems",k.lcZ(11,20,t.contentsTotalItems$))("currentPage",k.lcZ(12,22,t.contentsCurrentPage$)))},directives:[I.tP,le.y,A.Fj,A.JJ,A.oH,Ue.Q,Ve.v],pipes:[I.Ov,w.X$],styles:[".contents-header[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     table{margin-top:-1px}vdr-data-table[_ngcontent-%COMP%]{opacity:1;transition:opacity .3s}vdr-data-table.loading[_ngcontent-%COMP%]{opacity:.5}.table-wrapper[_ngcontent-%COMP%]{position:relative}.progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;overflow:hidden;height:6px;opacity:0;transition:opacity .1s}.progress.visible[_ngcontent-%COMP%]{opacity:1}.sku[_ngcontent-%COMP%]{color:var(--color-text-200)}"],changeDetection:0});var je=g(50837),Ee=g(54116),Ge=["collectionContents"];function He(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",6),k.NdJ("click",function(){return k.CHM(n),k.oxw().create()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw();k.Q6J("disabled",o.detailForm.invalid||o.detailForm.pristine),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.create")," ")}}function Be(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",6),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).save()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw(2);k.Q6J("disabled",(o.detailForm.invalid||o.detailForm.pristine)&&!o.assetsChanged()),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.update")," ")}}function Re(e,t){if(1&e&&k.YNc(0,Be,3,4,"button",7),2&e){var n=k.oxw();k.Q6J("vdrIfPermissions",n.updatePermission)}}var ze=function(){return["/catalog/collections"]};function Ke(e,t){1&e&&(k.TgZ(0,"a",35),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&e&&(k.Q6J("routerLink",k.DdM(4,ze)),k.xp6(1),k.Oqu(k.lcZ(2,2,"catalog.root-collection")))}var We=function(e){return["/catalog/collections",e]};function Xe(e,t){if(1&e&&(k.TgZ(0,"a",35),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&e){var n=k.oxw().$implicit;k.Q6J("routerLink",k.VKq(4,We,n.id)),k.xp6(1),k.Oqu(k.lcZ(2,2,n.name))}}function et(e,t){if(1&e&&(k.ynx(0),k._uU(1),k.ALo(2,"translate"),k.BQk()),2&e){var n=k.oxw().$implicit;k.xp6(1),k.Oqu(k.lcZ(2,1,n.name))}}function tt(e,t){if(1&e&&(k.TgZ(0,"li"),k.YNc(1,Ke,3,5,"a",33),k.YNc(2,Xe,3,6,"a",33),k.YNc(3,et,3,3,"ng-container",34),k.qZA()),2&e){var n=t.first,o=t.last;k.xp6(1),k.Q6J("ngIf",n),k.xp6(1),k.Q6J("ngIf",!n&&!o),k.xp6(1),k.Q6J("ngIf",o)}}function nt(e,t){1&e&&(k.ynx(0),k._uU(1),k.ALo(2,"translate"),k.BQk()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"catalog.public")))}function ot(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.Oqu(k.lcZ(1,1,"catalog.private"))}var it=function(){return["customFields"]};function at(e,t){if(1&e&&(k.TgZ(0,"section",36),k.TgZ(1,"label"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k._UZ(4,"vdr-tabbed-custom-fields",37),k.ALo(5,"hasPermission"),k.qZA()),2&e){var n=k.oxw(2);k.xp6(2),k.Oqu(k.lcZ(3,4,"common.custom-fields")),k.xp6(2),k.Q6J("customFields",n.customFields)("customFieldsFormGroup",n.detailForm.get(k.DdM(8,it)))("readonly",!k.lcZ(5,6,n.updatePermission))}}function rt(e,t){if(1&e){var n=k.EpF();k.ynx(0),k.TgZ(1,"vdr-configurable-input",38),k.NdJ("remove",function(){var e=k.CHM(n).index;return k.oxw(2).removeFilter(e)}),k.ALo(2,"hasPermission"),k.qZA(),k.BQk()}if(2&e){var o=t.$implicit,i=t.index,a=k.oxw(2);k.xp6(1),k.Q6J("position",i)("operation",o)("operationDefinition",a.getFilterDefinition(o))("formControlName",i)("readonly",!k.lcZ(2,5,a.updatePermission))}}function ct(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",43),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw(3).addFilter(e)}),k._uU(1),k.qZA()}if(2&e){var o=t.$implicit;k.xp6(1),k.hij(" ",o.description," ")}}function lt(e,t){if(1&e&&(k.TgZ(0,"div"),k.TgZ(1,"vdr-dropdown"),k.TgZ(2,"button",39),k._UZ(3,"clr-icon",40),k._uU(4),k.ALo(5,"translate"),k.qZA(),k.TgZ(6,"vdr-dropdown-menu",41),k.YNc(7,ct,2,1,"button",42),k.qZA(),k.qZA(),k.qZA()),2&e){var n=k.oxw(2);k.xp6(4),k.hij(" ",k.lcZ(5,2,"marketing.add-condition")," "),k.xp6(3),k.Q6J("ngForOf",n.allFilters)}}var st=function(e){return{count:e}},ut=function(){return{standalone:!0}};function dt(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",44),k._uU(1),k.ALo(2,"translate"),k.ALo(3,"translate"),k.qZA(),k.TgZ(4,"clr-checkbox-wrapper"),k.TgZ(5,"input",45),k.NdJ("ngModelChange",function(){return k.CHM(n),k.oxw(2).toggleLivePreview()}),k.qZA(),k.TgZ(6,"label"),k._uU(7),k.ALo(8,"translate"),k.qZA(),k.qZA()}if(2&e){var o,i,a=t.$implicit,r=k.oxw(2);k.xp6(1),k.AsE(" ",k.lcZ(2,8,"catalog.collection-contents")," (",k.xi3(3,10,"common.results-count",k.VKq(15,st,a)),") "),k.xp6(3),k.ekj("disabled",null==(o=r.detailForm.get("filters"))?null:o.pristine),k.xp6(1),k.Q6J("ngModelOptions",k.DdM(17,ut))("disabled",null==(i=r.detailForm.get("filters"))?null:i.pristine)("ngModel",r.livePreview),k.xp6(2),k.Oqu(k.lcZ(8,13,"catalog.live-preview-contents"))}}var pt=function(e){return{pattern:e}};function gt(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"form",8),k.TgZ(1,"nav",9),k.TgZ(2,"ul",10),k.YNc(3,tt,4,3,"li",11),k.qZA(),k.qZA(),k.TgZ(4,"div",12),k.TgZ(5,"div",13),k.TgZ(6,"vdr-form-field",14),k.ALo(7,"translate"),k.TgZ(8,"clr-toggle-wrapper"),k._UZ(9,"input",15),k.ALo(10,"hasPermission"),k.TgZ(11,"label",16),k.YNc(12,nt,3,3,"ng-container",17),k.YNc(13,ot,2,3,"ng-template",null,18,k.W1O),k.qZA(),k.qZA(),k.qZA(),k.TgZ(15,"vdr-form-field",19),k.ALo(16,"translate"),k.TgZ(17,"input",20),k.NdJ("input",function(e){return k.CHM(n),k.oxw().updateSlug(e.target.value)}),k.ALo(18,"hasPermission"),k.qZA(),k.qZA(),k.TgZ(19,"vdr-form-field",21),k.ALo(20,"translate"),k.ALo(21,"translate"),k._UZ(22,"input",22),k.ALo(23,"hasPermission"),k.qZA(),k._UZ(24,"vdr-rich-text-editor",23),k.ALo(25,"hasPermission"),k.ALo(26,"translate"),k.YNc(27,at,6,9,"section",24),k._UZ(28,"vdr-custom-detail-component-host",25),k.qZA(),k.TgZ(29,"div",26),k.TgZ(30,"vdr-assets",27),k.NdJ("change",function(e){return k.CHM(n),k.oxw().assetChanges=e}),k.qZA(),k.qZA(),k.qZA(),k.TgZ(31,"div",28),k.TgZ(32,"div",13),k.TgZ(33,"label"),k._uU(34),k.ALo(35,"translate"),k.qZA(),k.YNc(36,rt,3,7,"ng-container",29),k.YNc(37,lt,8,4,"div",30),k.qZA(),k.TgZ(38,"div",13),k.TgZ(39,"vdr-collection-contents",31,32),k.ALo(41,"async"),k.ALo(42,"async"),k.YNc(43,dt,9,18,"ng-template"),k.qZA(),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.ngIf,i=k.MAs(14),a=k.oxw();k.Q6J("formGroup",a.detailForm),k.xp6(3),k.Q6J("ngForOf",o.breadcrumbs),k.xp6(3),k.Q6J("label",k.lcZ(7,27,"catalog.visibility")),k.xp6(3),k.Q6J("vdrDisabled",!k.lcZ(10,29,a.updatePermission)),k.xp6(3),k.Q6J("ngIf",a.detailForm.value.visible)("ngIfElse",i),k.xp6(3),k.Q6J("label",k.lcZ(16,31,"common.name")),k.xp6(2),k.Q6J("readonly",!k.lcZ(18,33,a.updatePermission)),k.xp6(2),k.Q6J("label",k.lcZ(20,35,"catalog.slug"))("errors",k.VKq(51,pt,k.lcZ(21,37,"catalog.slug-pattern-error"))),k.xp6(3),k.Q6J("readonly",!k.lcZ(23,39,a.updatePermission)),k.xp6(2),k.Q6J("readonly",!k.lcZ(25,41,a.updatePermission))("label",k.lcZ(26,43,"common.description")),k.xp6(3),k.Q6J("ngIf",a.customFields.length),k.xp6(1),k.Q6J("entity$",a.entity$)("detailForm",a.detailForm),k.xp6(2),k.Q6J("assets",o.assets)("featuredAsset",o.featuredAsset)("updatePermissions",a.updatePermission),k.xp6(4),k.Oqu(k.lcZ(35,45,"catalog.filters")),k.xp6(2),k.Q6J("ngForOf",a.filters)("ngForTrackBy",a.trackByFn),k.xp6(1),k.Q6J("vdrIfPermissions",a.updatePermission),k.xp6(2),k.Q6J("collectionId",a.id)("parentId",k.lcZ(41,47,a.parentId$))("updatedFilters",k.lcZ(42,49,a.updatedFilters$))("previewUpdatedFilters",a.livePreview)}}var ft=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r,c,l,s,u){var g,f;return p(this,n),(g=t.call(this,o,e,i,r)).changeDetector=a,g.dataService=r,g.formBuilder=c,g.notificationService=l,g.modalService=s,g.localStorageService=u,g.assetChanges={},g.filters=[],g.allFilters=[],g.livePreview=!1,g.updatePermission=[Z.y3$.UpdateCatalog,Z.y3$.UpdateCollection],g.filterRemoved$=new X.xQ,g.customFields=g.getCustomFieldConfig("Collection"),g.detailForm=g.formBuilder.group({name:["",A.kI.required],slug:["",(0,Z.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",visible:!1,filters:g.formBuilder.array([]),customFields:g.formBuilder.group(g.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),d({},t.name,""))},{}))}),g.livePreview=null!==(f=g.localStorageService.get("livePreviewCollectionContents"))&&void 0!==f&&f,g}return f(n,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe(function(t){e.allFilters=t.collectionFilters});var t=this.detailForm.get("filters");this.updatedFilters$=(0,ee.T)(t.statusChanges,this.filterRemoved$).pipe((0,N.b)(200),(0,ne.h)(function(){return t.touched}),(0,x.U)(function(){return e.mapOperationsToInputs(e.filters,t.value).filter(function(e){var t,n=r(e.arguments);try{for(n.s();!(t=n.n()).done;){if(""===t.value.value)return!1}}catch(o){n.e(o)}finally{n.f()}return!0})})),this.parentId$=this.route.paramMap.pipe((0,x.U)(function(e){return e.get("parentId")||void 0}),(0,D.w)(function(t){return t?(0,te.of)(t):e.entity$.pipe((0,x.U)(function(e){var t;return null===(t=e.parent)||void 0===t?void 0:t.id}))}))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"getFilterDefinition",value:function(e){return this.allFilters.find(function(t){return t.code===e.code})}},{key:"assetsChanged",value:function(){return!!Object.values(this.assetChanges).length}},{key:"updateSlug",value:function(e){var t=this;(0,U.aj)(this.entity$,this.languageCode$).pipe((0,oe.q)(1)).subscribe(function(n){var o=c(n,2),i=o[0],a=o[1],r=t.detailForm.get(["slug"]),l=(0,Z.ZIM)(i,a),s=!l||!l.slug;r&&r.pristine&&s&&r.setValue((0,W.U)("".concat(e),"-"))})}},{key:"addFilter",value:function(e){var t=this.detailForm.get("filters"),n=e.args.reduce(function(e,t){return Object.assign(Object.assign({},e),d({},t.name,(0,Z.sux)(t.value)))},{});t.push(this.formBuilder.control({code:e.code,args:n})),this.filters.push({code:e.code,args:e.args.map(function(e){return{name:e.name,value:(0,Z.sux)(e.value)}})})}},{key:"removeFilter",value:function(e){var t=this.detailForm.get("filters");-1!==e&&(t.removeAt(e),t.markAsDirty(),t.markAsTouched(),this.filters.splice(e,1),this.filterRemoved$.next())}},{key:"create",value:function(){var e=this;!this.detailForm.dirty||(0,U.aj)(this.entity$,this.languageCode$).pipe((0,oe.q)(1),(0,ie.zg)(function(t){var n=c(t,2),o=n[0],i=n[1],a=e.getUpdatedCollection(o,e.detailForm,i),r=e.route.snapshot.paramMap.get("parentId");return r&&(a.parentId=r),e.dataService.collection.createCollection(a)})).subscribe(function(t){e.notificationService.success((0,C.J)("common.notify-create-success"),{entity:"Collection"}),e.assetChanges={},e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.router.navigate(["../",t.createCollection.id],{relativeTo:e.route})},function(t){e.notificationService.error((0,C.J)("common.notify-create-error"),{entity:"Collection"})})}},{key:"save",value:function(){var e=this;(0,U.aj)(this.entity$,this.languageCode$).pipe((0,oe.q)(1),(0,ie.zg)(function(t){var n=c(t,2),o=n[0],i=n[1],a=e.getUpdatedCollection(o,e.detailForm,i);return e.dataService.collection.updateCollection(a)})).subscribe(function(){e.assetChanges={},e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.notificationService.success((0,C.J)("common.notify-update-success"),{entity:"Collection"}),e.contentsComponent.refresh()},function(t){e.notificationService.error((0,C.J)("common.notify-update-error"),{entity:"Collection"})})}},{key:"canDeactivate",value:function(){return u(y(n.prototype),"canDeactivate",this).call(this)&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}},{key:"toggleLivePreview",value:function(){this.livePreview=!this.livePreview,this.localStorageService.set("livePreviewCollectionContents",this.livePreview)}},{key:"trackByFn",value:function(e,t){return JSON.stringify(t)}},{key:"setFormValues",value:function(e,t){var n=this,o=(0,Z.ZIM)(e,t);this.detailForm.patchValue({name:o?o.name:"",slug:o?o.slug:"",description:o?o.description:"",visible:!e.isPrivate});var i=this.detailForm.get("filters");i.length!==e.filters.length&&(i.clear(),this.filters=[],e.filters.forEach(function(e){return n.addFilter(e)})),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),e,o)}},{key:"getUpdatedCollection",value:function(e,t,n){var o,i,a=(0,Z.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},a),{assetIds:null===(o=this.assetChanges.assets)||void 0===o?void 0:o.map(function(e){return e.id}),featuredAssetId:null===(i=this.assetChanges.featuredAsset)||void 0===i?void 0:i.id,isPrivate:!t.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}},{key:"mapOperationsToInputs",value:function(e,t){return e.map(function(e,n){return{code:e.code,arguments:Object.entries(t[n].args).map(function(e,t){var n=c(e,2),o=n[0],i=n[1];return{name:o,value:(0,Z.qrw)(i)}})}})}}]),n}(Z.UT_);ft.\u0275fac=function(e){return new(e||ft)(k.Y36(v.F0),k.Y36(v.gz),k.Y36(Z.iHG),k.Y36(k.sBO),k.Y36(Z.DoR),k.Y36(A.qu),k.Y36(Z.gqp),k.Y36(Z.Z7U),k.Y36(Z.n2A))},ft.\u0275cmp=k.Xpm({type:ft,selectors:[["vdr-collection-detail"]],viewQuery:function(e,t){var n;(1&e&&k.Gf(Ge,5),2&e)&&(k.iGM(n=k.CRH())&&(t.contentsComponent=n.first))},features:[k.qOj],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["role","navigation"],[1,"collection-breadcrumbs"],[4,"ngFor","ngForOf"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],["locationId","collection-detail",3,"entity$","detailForm"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","updatePermissions","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"vdrIfPermissions"],[3,"collectionId","parentId","updatedFilters","previewUpdatedFilters"],["collectionContents",""],[3,"routerLink",4,"ngIf"],[4,"ngIf"],[3,"routerLink"],["formGroupName","customFields"],["entityName","Collection",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","operation","operationDefinition","formControlName","readonly","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"],["type","checkbox","clrCheckbox","",3,"ngModelOptions","disabled","ngModel","ngModelChange"]],template:function(e,t){if(1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left"),k._UZ(2,"vdr-entity-info",0),k.ALo(3,"async"),k.TgZ(4,"vdr-language-selector",1),k.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),k.ALo(5,"async"),k.ALo(6,"async"),k.ALo(7,"async"),k.qZA(),k.qZA(),k.TgZ(8,"vdr-ab-right"),k._UZ(9,"vdr-action-bar-items",2),k.YNc(10,He,3,4,"button",3),k.ALo(11,"async"),k.YNc(12,Re,1,1,"ng-template",null,4,k.W1O),k.qZA(),k.qZA(),k.YNc(14,gt,44,53,"form",5),k.ALo(15,"async")),2&e){var n=k.MAs(13);k.xp6(2),k.Q6J("entity",k.lcZ(3,7,t.entity$)),k.xp6(2),k.Q6J("disabled",k.lcZ(5,9,t.isNew$))("availableLanguageCodes",k.lcZ(6,11,t.availableLanguages$))("currentLanguageCode",k.lcZ(7,13,t.languageCode$)),k.xp6(6),k.Q6J("ngIf",k.lcZ(11,15,t.isNew$))("ngIfElse",n),k.xp6(4),k.Q6J("ngIf",k.lcZ(15,17,t.entity$))}},directives:[P.Kk,P.BN,T.V,ae.S,P.mz,O.W,I.O5,F.H,A._Y,A.JL,A.sg,I.sg,re.h,ce.PEh,le.y,A.Wl,ce.KKC,A.JJ,A.u,se.x,ce.MgK,A.Fj,ue.Y,de.C,we,A.CE,ce.q0d,Ye,v.yS,A.x0,je.y,Ee.q,fe.J,me.U,ce.qvL,ve.N,he.H,A.On],pipes:[I.Ov,w.X$,B.j],styles:['@charset "UTF-8";.visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}clr-checkbox-wrapper[_ngcontent-%COMP%]{transition:opacity .3s}clr-checkbox-wrapper.disabled[_ngcontent-%COMP%]{opacity:.5}.collection-breadcrumbs[_ngcontent-%COMP%]{list-style-type:none;background-color:var(--color-component-bg-200);padding:2px 6px;margin-bottom:6px;border-radius:var(--clr-global-borderradius)}.collection-breadcrumbs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:.65rem;display:inline-block;margin-right:10px}.collection-breadcrumbs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:not(:last-child):after{content:"\\203a";top:0;color:var(--color-grey-400);margin-left:10px}'],changeDetection:0});var mt=g(92597),vt=g(85236);function ht(e,t){var n,o,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=[],l={},s=function(e){var t=new Map;return e&&function e(n){t.set(n.id,n),n.children.forEach(e)}(e),t}(t),u=r(e);try{for(u.s();!(i=u.n()).done;){var d=i.value;l[d.id]=Object.assign(Object.assign({},d),{children:[]})}}catch(h){u.e(h)}finally{u.f()}var p,g=r(e.map(function(e){return e.id}));try{for(g.s();!(p=g.n()).done;){var f=p.value;if(l.hasOwnProperty(f)){var m=l[f];m.expanded=null!==(o=null===(n=s.get(f))||void 0===n?void 0:n.expanded)&&void 0!==o?o:a.includes(f);var v=m.parent;if(!v)continue;l[v.id]?l[v.id]?l[v.id].children.push(m):l[v.id]={children:[m]}:c.push(m)}}}catch(h){g.e(h)}finally{g.f()}return{id:c.length?c[0].parent.id:void 0,children:c}}function Zt(e,t){if(1&e&&k._UZ(0,"vdr-collection-tree-node",1),2&e){var n=k.oxw();k.Q6J("expandAll",n.expandAll)("collectionTree",n.collectionTree)("selectionManager",n.selectionManager)("activeCollectionId",n.activeCollectionId)}}var bt=function(){function e(){p(this,e),this.expandAll=!1,this.expandedIds=[],this.rearrange=new k.vpe,this.deleteCollection=new k.vpe,this.allMoveListItems=[]}return f(e,[{key:"ngOnChanges",value:function(e){"collections"in e&&this.collections&&(this.collectionTree=ht(this.collections,this.collectionTree,this.expandedIds),this.allMoveListItems=[])}},{key:"onDrop",value:function(e){var t=e.item.data,n=e.container.data.id;if(null==n)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:t.id,parentId:n,index:e.currentIndex})}},{key:"onMove",value:function(e){this.rearrange.emit(e)}},{key:"onDelete",value:function(e){this.deleteCollection.emit(e)}},{key:"getMoveListItems",value:function(e){return 0===this.allMoveListItems.length&&(this.allMoveListItems=this.calculateAllMoveListItems()),this.allMoveListItems.filter(function(t){var n;return t.id!==e.id&&!t.ancestorIdPath.has(e.id)&&t.id!==(null===(n=e.parent)||void 0===n?void 0:n.id)})}},{key:"calculateAllMoveListItems",value:function(){return function e(t,n,o,i){var r=n.concat(t.name);return i.push({path:r.slice(1).join(" / ")||"root",id:t.id,ancestorIdPath:o}),t.children.forEach(function(n){return e(n,r,new Set([].concat(a(o),[t.id])),i)}),i}(this.collectionTree,[],new Set,[])}},{key:"isRootNode",value:function(e){return!e.hasOwnProperty("parent")}}]),e}();bt.\u0275fac=function(e){return new(e||bt)},bt.\u0275cmp=k.Xpm({type:bt,selectors:[["vdr-collection-tree"]],inputs:{collections:"collections",activeCollectionId:"activeCollectionId",expandAll:"expandAll",expandedIds:"expandedIds",selectionManager:"selectionManager"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[k.TTD],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","selectionManager","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","selectionManager","activeCollectionId"]],template:function(e,t){1&e&&k.YNc(0,Zt,1,4,"vdr-collection-tree-node",0),2&e&&k.Q6J("ngIf",t.collectionTree)},styles:[""],changeDetection:0});var yt=function(){return["./create"]};function Ct(e,t){1&e&&(k.TgZ(0,"a",15),k._UZ(1,"clr-icon",16),k._uU(2),k.ALo(3,"translate"),k.qZA()),2&e&&(k.Q6J("routerLink",k.DdM(4,yt)),k.xp6(2),k.hij(" ",k.lcZ(3,2,"catalog.create-new-collection")," "))}var xt=function(e){return{count:e}};function At(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",17),k._uU(1),k.ALo(2,"async"),k.ALo(3,"translate"),k.qZA(),k.TgZ(4,"button",18),k.NdJ("click",function(){return k.CHM(n),k.oxw().closeContents()}),k._UZ(5,"clr-icon",19),k.qZA()}if(2&e){var o=t.$implicit,i=k.oxw();k.xp6(1),k.AsE(" ",k.lcZ(2,2,i.activeCollectionTitle$)," (",k.xi3(3,4,"common.results-count",k.VKq(7,xt,o)),") ")}}var kt=function(){return["CreateCatalog","CreateCollection"]},Pt=function(){function e(t,n,o,i,a,r,c){p(this,e),this.dataService=t,this.notificationService=n,this.modalService=o,this.router=i,this.route=a,this.serverConfigService=r,this.changeDetectorRef=c,this.filterTermControl=new A.NI(""),this.expandAll=!1,this.expandedIds=[],this.destroy$=new X.xQ,this.selectionManager=new Z.ZE0({additiveMode:!0,multiSelect:!0,itemsAreEqual:function(e,t){return e.id===t.id}})}return f(e,[{key:"ngOnInit",value:function(){var e,t,n=this;this.queryResult=this.dataService.collection.getCollections(1e3,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream(function(e){return e.collections.items}).pipe((0,Je.b)(function(e){return n.selectionManager.setCurrentItems(e)}),(0,mt.d)(1)),this.activeCollectionId$=this.route.paramMap.pipe((0,x.U)(function(e){return e.get("contents")}),(0,_e.x)()),this.expandedIds=null!==(t=null===(e=this.route.snapshot.queryParamMap.get("expanded"))||void 0===e?void 0:e.split(","))&&void 0!==t?t:[],this.expandAll="all"===this.route.snapshot.queryParamMap.get("expanded"),this.activeCollectionTitle$=(0,U.aj)(this.activeCollectionId$,this.items$).pipe((0,x.U)(function(e){var t=c(e,2),n=t[0],o=t[1];if(n){var i=o.find(function(e){return e.id===n});return i?i.name:""}return""})),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(function(e){return e.uiState.contentLanguage}).pipe((0,Je.b)(function(){return n.refresh()})),this.filterTermControl.valueChanges.pipe((0,N.b)(250),(0,S.R)(this.destroy$)).subscribe(function(e){n.router.navigate(["./"],{queryParams:{q:e||void 0},queryParamsHandling:"merge",relativeTo:n.route})}),this.route.queryParamMap.pipe((0,x.U)(function(e){return e.get("q")}),(0,_e.x)(),(0,S.R)(this.destroy$)).subscribe(function(){return n.refresh()}),this.filterTermControl.patchValue(this.route.snapshot.queryParamMap.get("q"))}},{key:"ngOnDestroy",value:function(){this.queryResult.completed$.next(),this.destroy$.next(void 0),this.destroy$.complete()}},{key:"toggleExpandAll",value:function(){this.router.navigate(["./"],{queryParams:{expanded:this.expandAll?"all":void 0},queryParamsHandling:"merge",relativeTo:this.route})}},{key:"onRearrange",value:function(e){var t=this;this.dataService.collection.moveCollection([e]).subscribe({next:function(){t.notificationService.success((0,C.J)("common.notify-saved-changes")),t.refresh()},error:function(e){t.notificationService.error((0,C.J)("common.notify-save-changes-error"))}})}},{key:"deleteCollection",value:function(e){var t=this;this.items$.pipe((0,oe.q)(1),(0,x.U)(function(t){return-1<t.findIndex(function(t){return t.parent&&t.parent.id===e})}),(0,D.w)(function(e){return t.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-collection"),body:e?(0,C.J)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]})}),(0,D.w)(function(n){return n?t.dataService.collection.deleteCollection(e):V.E})).subscribe(function(){t.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"Collection"}),t.refresh()},function(e){t.notificationService.error((0,C.J)("common.notify-delete-error"),{entity:"Collection"})})}},{key:"closeContents",value:function(){var e=Object.assign({},this.route.snapshot.params);delete e.contents,this.router.navigate(["./",e],{relativeTo:this.route,queryParamsHandling:"preserve"})}},{key:"setLanguage",value:function(e){this.dataService.client.setContentLanguage(e).subscribe()}},{key:"refresh",value:function(){var e=this.route.snapshot.queryParamMap.get("q");this.queryResult.ref.refetch({options:Object.assign({skip:0,take:1e3},e?{filter:{name:{contains:e}}}:{})})}}]),e}();Pt.\u0275fac=function(e){return new(e||Pt)(k.Y36(Z.DoR),k.Y36(Z.gqp),k.Y36(Z.Z7U),k.Y36(v.F0),k.Y36(v.gz),k.Y36(Z.iHG),k.Y36(k.sBO))},Pt.\u0275cmp=k.Xpm({type:Pt,selectors:[["vdr-collection-list"]],decls:29,vars:35,consts:[[1,""],["type","text","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],[1,"flex","center"],[1,"expand-all-toggle","mt2"],["type","checkbox","clrToggle","",3,"ngModel","ngModelChange","change"],[1,"mt2",3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"bulk-select-controls"],["type","checkbox","clrCheckbox","",3,"checked","click"],["locationId","collection-list",1,"ml2",3,"hostComponent","selectionManager"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","expandedIds","selectionManager","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(e,t){1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left"),k.TgZ(2,"div",0),k._UZ(3,"input",1),k.ALo(4,"translate"),k.TgZ(5,"div",2),k.TgZ(6,"clr-toggle-wrapper",3),k.TgZ(7,"input",4),k.NdJ("ngModelChange",function(e){return t.expandAll=e})("change",function(){return t.toggleExpandAll()}),k.qZA(),k.TgZ(8,"label"),k._uU(9),k.ALo(10,"translate"),k.qZA(),k.qZA(),k.TgZ(11,"vdr-language-selector",5),k.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),k.ALo(12,"async"),k.ALo(13,"async"),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.TgZ(14,"vdr-ab-right"),k._UZ(15,"vdr-action-bar-items",6),k.YNc(16,Ct,4,5,"a",7),k.qZA(),k.qZA(),k.TgZ(17,"div",8),k.TgZ(18,"input",9),k.NdJ("click",function(){return t.selectionManager.toggleSelectAll()}),k.qZA(),k._UZ(19,"vdr-bulk-action-menu",10),k.qZA(),k.TgZ(20,"div",11),k.TgZ(21,"vdr-collection-tree",12),k.NdJ("rearrange",function(e){return t.onRearrange(e)})("deleteCollection",function(e){return t.deleteCollection(e)}),k.ALo(22,"async"),k.ALo(23,"async"),k.qZA(),k.TgZ(24,"div",13),k.ALo(25,"async"),k.TgZ(26,"vdr-collection-contents",14),k.ALo(27,"async"),k.YNc(28,At,6,9,"ng-template"),k.qZA(),k.qZA(),k.qZA()),2&e&&(k.xp6(3),k.Q6J("formControl",t.filterTermControl)("placeholder",k.lcZ(4,18,"catalog.filter-by-name")),k.xp6(4),k.Q6J("ngModel",t.expandAll),k.xp6(2),k.hij(" ",k.lcZ(10,20,"catalog.expand-all-collections")," "),k.xp6(2),k.Q6J("availableLanguageCodes",k.lcZ(12,22,t.availableLanguages$))("currentLanguageCode",k.lcZ(13,24,t.contentLanguage$)),k.xp6(5),k.Q6J("vdrIfPermissions",k.DdM(34,kt)),k.xp6(2),k.Q6J("checked",t.selectionManager.areAllCurrentItemsSelected()),k.xp6(1),k.Q6J("hostComponent",t)("selectionManager",t.selectionManager),k.xp6(2),k.Q6J("collections",k.lcZ(22,26,t.items$))("activeCollectionId",k.lcZ(23,28,t.activeCollectionId$))("expandAll",t.expandAll)("expandedIds",t.expandedIds)("selectionManager",t.selectionManager),k.xp6(3),k.ekj("expanded",k.lcZ(25,30,t.activeCollectionId$)),k.xp6(2),k.Q6J("collectionId",k.lcZ(27,32,t.activeCollectionId$)))},directives:[P.Kk,P.BN,le.y,A.Fj,A.JJ,A.oH,ce.PEh,A.Wl,ce.KKC,A.On,ce.MgK,ae.S,P.mz,O.W,F.H,vt.c,bt,Ye,v.yS,ce.qvL],pipes:[w.X$,I.Ov],styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.bulk-select-controls[_ngcontent-%COMP%]{min-height:36px;padding-left:14px;display:flex;align-items:center;border-bottom:1px solid var(--color-component-border-200)}.expand-all-toggle[_ngcontent-%COMP%]{display:block}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:none;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"],changeDetection:0});var Tt=g(87187),Ot=g(42720),Ft=g(67202);function qt(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",6),k.NdJ("click",function(){return k.CHM(n),k.oxw().create()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw();k.Q6J("disabled",o.detailForm.invalid||o.detailForm.pristine),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.create")," ")}}function It(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",6),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).save()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw(2);k.Q6J("disabled",o.detailForm.invalid||o.detailForm.pristine),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.update")," ")}}function wt(e,t){if(1&e&&k.YNc(0,It,3,4,"button",7),2&e){var n=k.oxw();k.Q6J("vdrIfPermissions",n.updatePermission)}}function Mt(e,t){1&e&&(k.ynx(0),k._uU(1),k.ALo(2,"translate"),k.BQk()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"catalog.public")))}function _t(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.Oqu(k.lcZ(1,1,"catalog.private"))}var Jt=function(){return["facet","customFields"]};function Lt(e,t){if(1&e&&(k.TgZ(0,"section",22),k.TgZ(1,"label"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k._UZ(4,"vdr-tabbed-custom-fields",23),k.ALo(5,"hasPermission"),k.qZA()),2&e){var n=k.oxw(2);k.xp6(2),k.Oqu(k.lcZ(3,4,"common.custom-fields")),k.xp6(2),k.Q6J("customFields",n.customFields)("customFieldsFormGroup",n.detailForm.get(k.DdM(8,Jt)))("readonly",!k.lcZ(5,6,n.updatePermission))}}function Ut(e,t){1&e&&(k.ynx(0),k.TgZ(1,"th"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k.BQk()),2&e&&(k.xp6(2),k.Oqu(k.lcZ(3,1,"common.custom-fields")))}var Vt=function(e){return["values",e,"customFields"]};function Nt(e,t){if(1&e&&(k.TgZ(0,"td",40),k._UZ(1,"vdr-tabbed-custom-fields",41),k.ALo(2,"hasPermission"),k.qZA()),2&e){var n=k.oxw().index,o=k.oxw(4);k.xp6(1),k.Q6J("customFields",o.customValueFields)("compact",!0)("customFieldsFormGroup",o.detailForm.get(k.VKq(6,Vt,n)))("readonly",!k.lcZ(2,4,o.updatePermission))}}function St(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"tr",30),k.TgZ(1,"td",31),k._UZ(2,"vdr-entity-info",0),k.qZA(),k.TgZ(3,"td",31),k.TgZ(4,"input",32),k.NdJ("input",function(e){var t=k.CHM(n).index,o=k.oxw(3).ngIf;return k.oxw().updateValueCode(null==o.values[t]?null:o.values[t].code,e.target.value,t)}),k.ALo(5,"hasPermission"),k.qZA(),k.qZA(),k.TgZ(6,"td",31),k._UZ(7,"input",33),k.qZA(),k.YNc(8,Nt,3,8,"td",34),k.TgZ(9,"td",31),k.TgZ(10,"vdr-dropdown"),k.TgZ(11,"button",35),k._uU(12),k.ALo(13,"translate"),k._UZ(14,"clr-icon",36),k.qZA(),k.TgZ(15,"vdr-dropdown-menu",37),k.TgZ(16,"button",38),k.NdJ("click",function(){var e=k.CHM(n).index,t=k.oxw(3).ngIf;return k.oxw().deleteFacetValue(null==t.values[e]?null:t.values[e].id,e)}),k.ALo(17,"hasPermission"),k._UZ(18,"clr-icon",39),k._uU(19),k.ALo(20,"translate"),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.$implicit,i=t.index,a=k.oxw(4);k.Q6J("formGroupName",i),k.xp6(2),k.Q6J("entity",o),k.xp6(2),k.Q6J("readonly",!k.lcZ(5,7,a.updatePermission)),k.xp6(4),k.Q6J("ngIf",a.customValueFields.length),k.xp6(4),k.hij(" ",k.lcZ(13,9,"common.actions")," "),k.xp6(4),k.Q6J("disabled",!k.lcZ(17,11,a.updatePermission)),k.xp6(3),k.hij(" ",k.lcZ(20,13,"common.delete")," ")}}function $t(e,t){if(1&e&&(k.TgZ(0,"table",27),k.TgZ(1,"thead"),k.TgZ(2,"tr"),k._UZ(3,"th"),k.TgZ(4,"th"),k._uU(5),k.ALo(6,"translate"),k.qZA(),k.TgZ(7,"th"),k._uU(8),k.ALo(9,"translate"),k.qZA(),k.YNc(10,Ut,4,3,"ng-container",28),k._UZ(11,"th"),k.qZA(),k.qZA(),k.TgZ(12,"tbody"),k.YNc(13,St,21,15,"tr",29),k.qZA(),k.qZA()),2&e){var n=k.oxw(3);k.xp6(5),k.Oqu(k.lcZ(6,4,"common.name")),k.xp6(3),k.Oqu(k.lcZ(9,6,"common.code")),k.xp6(2),k.Q6J("ngIf",n.customValueFields.length),k.xp6(3),k.Q6J("ngForOf",n.values)}}function Dt(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",42),k.NdJ("click",function(){return k.CHM(n),k.oxw(3).addFacetValue()}),k._UZ(1,"clr-icon",43),k._uU(2),k.ALo(3,"translate"),k.qZA()}2&e&&(k.xp6(2),k.hij(" ",k.lcZ(3,1,"catalog.add-facet-value")," "))}var Qt=function(){return["CreateCatalog","CreateFacet"]};function Yt(e,t){if(1&e&&(k.TgZ(0,"section",24),k.TgZ(1,"label"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k.YNc(4,$t,14,8,"table",25),k.TgZ(5,"div"),k.YNc(6,Dt,4,3,"button",26),k.qZA(),k.qZA()),2&e){var n=k.oxw(2);k.xp6(2),k.Oqu(k.lcZ(3,3,"catalog.facet-values")),k.xp6(2),k.Q6J("ngIf",0<n.getValuesFormArray().length),k.xp6(2),k.Q6J("vdrIfPermissions",k.DdM(5,Qt))}}function jt(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"form",8),k.TgZ(1,"section",9),k.TgZ(2,"vdr-form-field",10),k.ALo(3,"translate"),k.TgZ(4,"clr-toggle-wrapper"),k._UZ(5,"input",11),k.ALo(6,"hasPermission"),k.TgZ(7,"label",12),k.YNc(8,Mt,3,3,"ng-container",13),k.YNc(9,_t,2,3,"ng-template",null,14,k.W1O),k.qZA(),k.qZA(),k.qZA(),k.TgZ(11,"vdr-form-field",15),k.ALo(12,"translate"),k.TgZ(13,"input",16),k.NdJ("input",function(e){var t=k.CHM(n).ngIf;return k.oxw().updateCode(t.code,e.target.value)}),k.ALo(14,"hasPermission"),k.qZA(),k.qZA(),k.TgZ(15,"vdr-form-field",17),k.ALo(16,"translate"),k.ALo(17,"hasPermission"),k._UZ(18,"input",18),k.ALo(19,"hasPermission"),k.qZA(),k.YNc(20,Lt,6,9,"section",19),k._UZ(21,"vdr-custom-detail-component-host",20),k.qZA(),k.YNc(22,Yt,7,6,"section",21),k.ALo(23,"async"),k.qZA()}if(2&e){var o=k.MAs(10),i=k.oxw();k.Q6J("formGroup",i.detailForm),k.xp6(2),k.Q6J("label",k.lcZ(3,14,"catalog.visibility")),k.xp6(3),k.Q6J("vdrDisabled",!k.lcZ(6,16,i.updatePermission)),k.xp6(3),k.Q6J("ngIf",i.detailForm.value.facet.visible)("ngIfElse",o),k.xp6(3),k.Q6J("label",k.lcZ(12,18,"common.name")),k.xp6(2),k.Q6J("readonly",!k.lcZ(14,20,i.updatePermission)),k.xp6(2),k.Q6J("label",k.lcZ(16,22,"common.code"))("readOnlyToggle",k.lcZ(17,24,i.updatePermission)),k.xp6(3),k.Q6J("readonly",!k.lcZ(19,26,i.updatePermission)),k.xp6(2),k.Q6J("ngIf",i.customFields.length),k.xp6(1),k.Q6J("entity$",i.entity$)("detailForm",i.detailForm),k.xp6(1),k.Q6J("ngIf",!k.lcZ(23,28,i.isNew$))}}var Et=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r,c,l,s){var u;return p(this,n),(u=t.call(this,o,e,i,r)).changeDetector=a,u.dataService=r,u.formBuilder=c,u.notificationService=l,u.modalService=s,u.updatePermission=[Z.y3$.UpdateCatalog,Z.y3$.UpdateFacet],u.customFields=u.getCustomFieldConfig("Facet"),u.customValueFields=u.getCustomFieldConfig("FacetValue"),u.detailForm=u.formBuilder.group({facet:u.formBuilder.group({code:["",A.kI.required],name:"",visible:!0,customFields:u.formBuilder.group(u.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),d({},t.name,""))},{}))}),values:u.formBuilder.array([])}),u}return f(n,[{key:"ngOnInit",value:function(){this.init()}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"updateCode",value:function(e,t){if(!e){var n=this.detailForm.get(["facet","code"]);n&&n.pristine&&n.setValue((0,W.U)(t,"-"))}}},{key:"updateValueCode",value:function(e,t,n){if(!e){var o=this.detailForm.get(["values",n,"code"]);o&&o.pristine&&o.setValue((0,W.U)(t,"-"))}}},{key:"customValueFieldIsSet",value:function(e,t){return!!this.detailForm.get(["values",e,"customFields",t])}},{key:"getValuesFormArray",value:function(){return this.detailForm.get("values")}},{key:"addFacetValue",value:function(){var e=this.detailForm.get("values");if(e){var t=this.formBuilder.group({id:"",name:["",A.kI.required],code:""}),n={name:"",code:""};if(this.customValueFields.length){var o=new A.cw({});n.customFields={};var i,a=r(this.customValueFields);try{for(a.s();!(i=a.n()).done;){var c=i.value.name;o.addControl(c,new A.NI)}}catch(l){a.e(l)}finally{a.f()}t.addControl("customFields",o)}e.insert(e.length,t),this.values.push(n)}}},{key:"create",value:function(){var e=this,t=this.detailForm.get("facet");!t||!t.dirty||(0,U.aj)(this.entity$,this.languageCode$).pipe((0,oe.q)(1),(0,ie.zg)(function(n){var o=c(n,2),i=o[0],a=o[1],r=e.getUpdatedFacet(i,t,a);return e.dataService.facet.createFacet(r)}),(0,D.w)(function(t){return e.dataService.facet.getAllFacets().single$.pipe((0,Ft.h)(t))})).subscribe(function(t){e.notificationService.success((0,C.J)("common.notify-create-success"),{entity:"Facet"}),e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.router.navigate(["../",t.createFacet.id],{relativeTo:e.route})},function(t){e.notificationService.error((0,C.J)("common.notify-create-error"),{entity:"Facet"})})}},{key:"save",value:function(){var e=this;(0,U.aj)(this.entity$,this.languageCode$).pipe((0,oe.q)(1),(0,ie.zg)(function(t){var n=c(t,2),o=n[0],i=n[1],a=e.detailForm.get("facet"),r=[];if(a&&a.dirty){var l=e.getUpdatedFacet(o,a,i);l&&r.push(e.dataService.facet.updateFacet(l))}var s=e.detailForm.get("values");if(s&&s.dirty){var u=e.getCreatedFacetValues(o,s,i);u.length&&r.push(e.dataService.facet.createFacetValues(u).pipe((0,D.w)(function(){return e.dataService.facet.getFacet(e.id).single$})));var d=e.getUpdatedFacetValues(o,s,i);d.length&&r.push(e.dataService.facet.updateFacetValues(d))}return(0,Ot.D)(r)}),(0,D.w)(function(){return e.dataService.facet.getAllFacets().single$})).subscribe(function(){e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.notificationService.success((0,C.J)("common.notify-update-success"),{entity:"Facet"})},function(t){e.notificationService.error((0,C.J)("common.notify-update-error"),{entity:"Facet"})})}},{key:"deleteFacetValue",value:function(e,t){var n=this;if(!e){var o=this.detailForm.get("values");return o&&o.removeAt(t),void this.values.splice(t,1)}this.showModalAndDelete(e).pipe((0,D.w)(function(t){return t.result===Z.PcR.DELETED?[!0]:n.showModalAndDelete(e,t.message||"").pipe((0,x.U)(function(e){return e.result===Z.PcR.DELETED}))}),(0,D.w)(function(e){return e?n.dataService.facet.getFacet(n.id).single$:[]})).subscribe(function(){n.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"FacetValue"})},function(e){n.notificationService.error((0,C.J)("common.notify-delete-error"),{entity:"FacetValue"})})}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-facet-value"),body:t,buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(o){return o?n.dataService.facet.deleteFacetValues([e],!!t):V.E}),(0,x.U)(function(e){return e.deleteFacetValues[0]}))}},{key:"setFormValues",value:function(e,t){var n,o=this,i=(0,Z.ZIM)(e,t);this.detailForm.patchValue({facet:{code:e.code,visible:!e.isPrivate,name:null!==(n=null==i?void 0:i.name)&&void 0!==n?n:""}}),this.customFields.length&&(this.detailForm.get(["facet","customFields"]),this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["facet","customFields"]),e,i));var c=this.detailForm.get("values");this.values=a(e.values),e.values.forEach(function(e,n){var i,a,l,s,u,d=(0,Z.ZIM)(e,t),p={id:e.id,code:e.code,name:d?d.name:""},g=c.at(n);if(g?(null===(i=g.get("id"))||void 0===i||i.setValue(p.id),null===(a=g.get("code"))||void 0===a||a.setValue(p.code),null===(l=g.get("name"))||void 0===l||l.setValue(p.name)):c.insert(n,o.formBuilder.group(p)),o.customValueFields.length){var f=o.detailForm.get(["values",n,"customFields"]);if(f||(f=new A.cw({}),o.detailForm.get(["values",n]).addControl("customFields",f)),f){var m,v=r(o.customValueFields);try{for(v.s();!(m=v.n()).done;){var h=m.value,b=h.name,y="localeString"===h.type?null===(u=null===(s=d)||void 0===s?void 0:s.customFields)||void 0===u?void 0:u[b]:e.customFields[b],C=f.get(b);C?C.setValue(y):f.addControl(b,new A.NI(y))}}catch(x){v.e(x)}finally{v.f()}}}})}},{key:"getUpdatedFacet",value:function(e,t,n){var o=(0,Z.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}});return o.isPrivate=!t.value.visible,o}},{key:"getCreatedFacetValues",value:function(e,t,n){var o=this;return t.controls.filter(function(e){return!e.value.id}).map(function(e){return e.value}).map(function(e){return(0,Z.iSy)({translatable:Object.assign(Object.assign({},e),{translations:[]}),updatedFields:e,customFieldConfig:o.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})}).map(function(t){return Object.assign({facetId:e.id},t)})}},{key:"getUpdatedFacetValues",value:function(e,t,n){var o=this,i=e.values.filter(function(e,n){var o=t.get(n.toString());return o&&o.dirty&&o.value.id}),a=t.controls.filter(function(e){return e.dirty&&e.value.id}).map(function(e){return e.value});if(i.length!==a.length)throw new Error((0,C.J)("error.facet-value-form-values-do-not-match"));return i.map(function(e,t){return(0,Z.iSy)({translatable:e,updatedFields:a[t],customFieldConfig:o.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})}).filter(Tt.notNullOrUndefined)}}]),n}(Z.UT_);Et.\u0275fac=function(e){return new(e||Et)(k.Y36(v.F0),k.Y36(v.gz),k.Y36(Z.iHG),k.Y36(k.sBO),k.Y36(Z.DoR),k.Y36(A.qu),k.Y36(Z.gqp),k.Y36(Z.Z7U))},Et.\u0275cmp=k.Xpm({type:Et,selectors:[["vdr-facet-detail"]],features:[k.qOj],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","facet-detail",3,"entity$","detailForm"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],["entityName","Facet",3,"customFields","customFieldsFormGroup","readonly"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],[4,"ngIf"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["class","",4,"ngIf"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[1,""],["entityName","FacetValue",3,"customFields","compact","customFieldsFormGroup","readonly"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(e,t){if(1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left"),k._UZ(2,"vdr-entity-info",0),k.ALo(3,"async"),k.TgZ(4,"vdr-language-selector",1),k.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),k.ALo(5,"async"),k.ALo(6,"async"),k.ALo(7,"async"),k.qZA(),k.qZA(),k.TgZ(8,"vdr-ab-right"),k._UZ(9,"vdr-action-bar-items",2),k.YNc(10,qt,3,4,"button",3),k.ALo(11,"async"),k.YNc(12,wt,1,1,"ng-template",null,4,k.W1O),k.qZA(),k.qZA(),k.YNc(14,jt,24,30,"form",5),k.ALo(15,"async")),2&e){var n=k.MAs(13);k.xp6(2),k.Q6J("entity",k.lcZ(3,7,t.entity$)),k.xp6(2),k.Q6J("disabled",k.lcZ(5,9,t.isNew$))("availableLanguageCodes",k.lcZ(6,11,t.availableLanguages$))("currentLanguageCode",k.lcZ(7,13,t.languageCode$)),k.xp6(6),k.Q6J("ngIf",k.lcZ(11,15,t.isNew$))("ngIfElse",n),k.xp6(4),k.Q6J("ngIf",k.lcZ(15,17,t.entity$))}},directives:[P.Kk,P.BN,T.V,ae.S,P.mz,O.W,I.O5,F.H,A._Y,A.JL,A.sg,A.x0,re.h,ce.PEh,le.y,A.Wl,ce.KKC,A.JJ,A.u,se.x,ce.MgK,A.Fj,de.C,je.y,A.CE,I.sg,fe.J,me.U,ce.qvL,ve.N,he.H],pipes:[I.Ov,w.X$,B.j],styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0});var Gt=g(430),Ht=g(30901),Bt=g(74447),Rt=g(26074),zt=function(){return["./create"]};function Kt(e,t){1&e&&(k.TgZ(0,"a",8),k._UZ(1,"clr-icon",9),k._uU(2),k.ALo(3,"translate"),k.qZA()),2&e&&(k.Q6J("routerLink",k.DdM(4,zt)),k.xp6(2),k.hij(" ",k.lcZ(3,2,"catalog.create-new-facet")," "))}function Wt(e,t){if(1&e&&k._UZ(0,"vdr-facet-value-chip",22),2&e){var n=t.$implicit;k.Q6J("facetValue",n)("removable",!1)("displayFacetName",!1)}}function Xt(e,t){if(1&e&&(k.ynx(0),k._UZ(1,"clr-icon",9),k._uU(2),k.BQk()),2&e){var n=k.oxw(2).item,o=k.oxw();k.xp6(2),k.hij(" ",n.values.length-o.initialLimit," ")}}function en(e,t){1&e&&k._UZ(0,"clr-icon",25)}function tn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",23),k.NdJ("click",function(){k.CHM(n);var e=k.oxw().item;return k.oxw().toggleDisplayLimit(e)}),k.YNc(1,Xt,3,1,"ng-container",13),k.YNc(2,en,1,0,"ng-template",null,24,k.W1O),k.qZA()}if(2&e){var o=k.MAs(3),i=k.oxw().item,a=k.oxw();k.xp6(1),k.Q6J("ngIf",(a.displayLimit[i.id]||0)<i.values.length)("ngIfElse",o)}}function nn(e,t){1&e&&(k.ynx(0),k._uU(1),k.ALo(2,"translate"),k.BQk()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"catalog.public")))}function on(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.Oqu(k.lcZ(1,1,"catalog.private"))}var an=function(e){return["./",e]},rn=function(){return["DeleteCatalog","DeleteFacet"]};function cn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"td",10),k._uU(1),k.qZA(),k.TgZ(2,"td",10),k._uU(3),k.qZA(),k.TgZ(4,"td",10),k.YNc(5,Wt,1,3,"vdr-facet-value-chip",11),k.ALo(6,"slice"),k.YNc(7,tn,4,2,"button",12),k.qZA(),k.TgZ(8,"td",10),k.TgZ(9,"vdr-chip"),k.YNc(10,nn,3,3,"ng-container",13),k.YNc(11,on,2,3,"ng-template",null,14,k.W1O),k.qZA(),k.qZA(),k.TgZ(13,"td",15),k._UZ(14,"vdr-table-row-action",16),k.ALo(15,"translate"),k.qZA(),k.TgZ(16,"td",15),k.TgZ(17,"vdr-dropdown"),k.TgZ(18,"button",17),k._uU(19),k.ALo(20,"translate"),k._UZ(21,"clr-icon",18),k.qZA(),k.TgZ(22,"vdr-dropdown-menu",19),k.TgZ(23,"button",20),k.NdJ("click",function(){var e=k.CHM(n).item;return k.oxw().deleteFacet(e.id)}),k.ALo(24,"hasPermission"),k._UZ(25,"clr-icon",21),k._uU(26),k.ALo(27,"translate"),k.qZA(),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.item,i=k.MAs(12),a=k.oxw();k.ekj("private",o.isPrivate),k.xp6(1),k.Oqu(o.code),k.xp6(1),k.ekj("private",o.isPrivate),k.xp6(1),k.Oqu(o.name),k.xp6(1),k.ekj("private",o.isPrivate),k.xp6(1),k.Q6J("ngForOf",k.Dn7(6,23,o.values,0,a.displayLimit[o.id]||3)),k.xp6(2),k.Q6J("ngIf",o.values.length>a.initialLimit),k.xp6(1),k.ekj("private",o.isPrivate),k.xp6(2),k.Q6J("ngIf",!o.isPrivate)("ngIfElse",i),k.xp6(3),k.ekj("private",o.isPrivate),k.xp6(1),k.Q6J("label",k.lcZ(15,27,"common.edit"))("linkTo",k.VKq(35,an,o.id)),k.xp6(2),k.ekj("private",o.isPrivate),k.xp6(3),k.hij(" ",k.lcZ(20,29,"common.actions")," "),k.xp6(4),k.Q6J("disabled",!k.lcZ(24,31,k.DdM(37,rn))),k.xp6(3),k.hij(" ",k.lcZ(27,33,"common.delete")," ")}}var ln=function(){return["CreateCatalog","CreateFacet"]},sn=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r,c){var l,s;return p(this,n),(s=t.call(this,r,c)).dataService=e,s.modalService=o,s.notificationService=i,s.serverConfigService=a,s.filterTermControl=new A.NI(""),s.initialLimit=3,s.displayLimit={},u((l=b(s),y(n.prototype)),"setQueryFn",l).call(l,function(){var e;return(e=s.dataService.facet).getFacets.apply(e,arguments).refetchOnChannelChange()},function(e){return e.facets},function(e,t){return{options:{skip:e,take:t,filter:{name:{contains:s.filterTermControl.value}},sort:{createdAt:Gt.As.DESC}}}}),s.selectionManager=new Z.ZE0({multiSelect:!0,itemsAreEqual:function(e,t){return e.id===t.id},additiveMode:!0}),s}return f(n,[{key:"ngOnInit",value:function(){var e=this;u(y(n.prototype),"ngOnInit",this).call(this),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(function(e){return e.uiState.contentLanguage}).pipe((0,Je.b)(function(){return e.refresh()})),this.filterTermControl.valueChanges.pipe((0,ne.h)(function(e){return 2<=e.length||0===e.length}),(0,N.b)(250),(0,S.R)(this.destroy$)).subscribe(function(){return e.refresh()})}},{key:"toggleDisplayLimit",value:function(e){this.displayLimit[e.id]===e.values.length?this.displayLimit[e.id]=this.initialLimit:this.displayLimit[e.id]=e.values.length}},{key:"deleteFacet",value:function(e){var t=this;this.showModalAndDelete(e).pipe((0,D.w)(function(n){return n.result===Z.PcR.DELETED?[!0]:t.showModalAndDelete(e,n.message||"").pipe((0,x.U)(function(e){return e.result===Z.PcR.DELETED}))}),(0,D.w)(function(){return t.dataService.facet.getAllFacets().single$})).subscribe(function(){t.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"FacetValue"}),t.refresh()},function(e){t.notificationService.error((0,C.J)("common.notify-delete-error"),{entity:"FacetValue"})})}},{key:"setLanguage",value:function(e){this.dataService.client.setContentLanguage(e).subscribe()}},{key:"showModalAndDelete",value:function(e,t){var n=this;return this.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-facet"),body:t,buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:t?(0,C.J)("common.force-delete"):(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(o){return o?n.dataService.facet.deleteFacet(e,!!t):V.E}),(0,x.U)(function(e){return e.deleteFacet}))}}]),n}(Z.t7C);sn.\u0275fac=function(e){return new(e||sn)(k.Y36(Z.DoR),k.Y36(Z.Z7U),k.Y36(Z.gqp),k.Y36(Z.iHG),k.Y36(v.F0),k.Y36(v.gz))},sn.\u0275cmp=k.Xpm({type:sn,selectors:[["vdr-facet-list"]],features:[k.qOj],decls:33,vars:40,consts:[[1,""],["type","text","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","selectionManager","pageChange","itemsPerPageChange"],["locationId","facet-list",3,"hostComponent","selectionManager"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(e,t){1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left"),k.TgZ(2,"div",0),k._UZ(3,"input",1),k.ALo(4,"translate"),k.TgZ(5,"div"),k.TgZ(6,"vdr-language-selector",2),k.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),k.ALo(7,"async"),k.ALo(8,"async"),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.TgZ(9,"vdr-ab-right"),k._UZ(10,"vdr-action-bar-items",3),k.YNc(11,Kt,4,5,"a",4),k.qZA(),k.qZA(),k.TgZ(12,"vdr-data-table",5),k.NdJ("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),k.ALo(13,"async"),k.ALo(14,"async"),k.ALo(15,"async"),k.ALo(16,"async"),k._UZ(17,"vdr-bulk-action-menu",6),k.TgZ(18,"vdr-dt-column"),k._uU(19),k.ALo(20,"translate"),k.qZA(),k.TgZ(21,"vdr-dt-column"),k._uU(22),k.ALo(23,"translate"),k.qZA(),k.TgZ(24,"vdr-dt-column",7),k._uU(25),k.ALo(26,"translate"),k.qZA(),k.TgZ(27,"vdr-dt-column"),k._uU(28),k.ALo(29,"translate"),k.qZA(),k._UZ(30,"vdr-dt-column"),k._UZ(31,"vdr-dt-column"),k.YNc(32,cn,28,38,"ng-template"),k.qZA()),2&e&&(k.xp6(3),k.Q6J("formControl",t.filterTermControl)("placeholder",k.lcZ(4,17,"catalog.filter-by-name")),k.xp6(3),k.Q6J("availableLanguageCodes",k.lcZ(7,19,t.availableLanguages$))("currentLanguageCode",k.lcZ(8,21,t.contentLanguage$)),k.xp6(5),k.Q6J("vdrIfPermissions",k.DdM(39,ln)),k.xp6(1),k.Q6J("items",k.lcZ(13,23,t.items$))("itemsPerPage",k.lcZ(14,25,t.itemsPerPage$))("totalItems",k.lcZ(15,27,t.totalItems$))("currentPage",k.lcZ(16,29,t.currentPage$))("selectionManager",t.selectionManager),k.xp6(5),k.Q6J("hostComponent",t)("selectionManager",t.selectionManager),k.xp6(2),k.Oqu(k.lcZ(20,31,"common.code")),k.xp6(3),k.Oqu(k.lcZ(23,33,"common.name")),k.xp6(2),k.Q6J("expand",!0),k.xp6(1),k.Oqu(k.lcZ(26,35,"catalog.values")),k.xp6(3),k.Oqu(k.lcZ(29,37,"catalog.visibility")))},directives:[P.Kk,P.BN,le.y,A.Fj,A.JJ,A.oH,ae.S,P.mz,O.W,F.H,Ue.Q,vt.c,Ht.E,v.yS,ce.qvL,I.sg,I.O5,Bt.Y,Ve.v,fe.J,me.U,ve.N,he.H,Rt.q],pipes:[w.X$,I.Ov,I.OU,B.j],styles:["td.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]});var un=g(76879),dn=g(30400),pn=g(27272),gn=function(){function e(t){p(this,e),this.notifier=t}return f(e,[{key:"call",value:function(e,t){return t.subscribe(new fn(e,this.notifier))}}]),e}(),fn=function(e){m(n,e);var t=h(n);function n(e,o){var i;p(this,n),(i=t.call(this,e)).hasValue=!1;var a=new pn.IY(b(i));i.add(a),i.innerSubscription=a;var r=(0,pn.ft)(o,a);return r!==a&&(i.add(r),i.innerSubscription=r),i}return f(n,[{key:"_next",value:function(e){this.hasValue&&u(y(n.prototype),"_next",this).call(this,e)}},{key:"notifyNext",value:function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()}},{key:"notifyComplete",value:function(){}}]),n}(pn.Ds),mn=g(84515),vn=g(17163),hn=g(20309),Zn=g(77206),bn=g(98318);function yn(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.Oqu(k.lcZ(1,1,"catalog.add-facets"))}function Cn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",3),k.NdJ("click",function(){return k.CHM(n),k.oxw().cancel()}),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.TgZ(3,"button",4),k.NdJ("click",function(){return k.CHM(n),k.oxw().selectValues()}),k._uU(4),k.ALo(5,"translate"),k.qZA()}if(2&e){var o=k.oxw();k.xp6(1),k.Oqu(k.lcZ(2,3,"common.cancel")),k.xp6(2),k.Q6J("disabled",0===o.selectedValues.length),k.xp6(1),k.hij(" ",k.lcZ(5,5,"catalog.add-facets")," ")}}var xn=function(){function e(t){p(this,e),this.changeDetector=t,this.selectedValues=[]}return f(e,[{key:"ngAfterViewInit",value:function(){var e=this;setTimeout(function(){return e.selector.focus()},0)}},{key:"selectValues",value:function(){this.resolveWith(this.selectedValues)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();xn.\u0275fac=function(e){return new(e||xn)(k.Y36(k.sBO))},xn.\u0275cmp=k.Xpm({type:xn,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(e,t){var n;(1&e&&k.Gf(Z.$MF,5),2&e)&&(k.iGM(n=k.CRH())&&(t.selector=n.first))},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(k.YNc(0,yn,2,3,"ng-template",0),k.TgZ(1,"vdr-facet-value-selector",1),k.NdJ("selectedValuesChange",function(e){return t.selectedValues=e}),k.qZA(),k.YNc(2,Cn,6,7,"ng-template",2)),2&e&&(k.xp6(1),k.Q6J("facets",t.facets))},directives:[hn.q,Zn.$,bn.n],pipes:[w.X$],styles:[""],changeDetection:0});var An=g(3786),kn=g(15646),Pn=g(28766),Tn=g(4187);function On(e,t){1&e&&(k.ynx(0),k._uU(1),k.ALo(2,"translate"),k.BQk()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"catalog.assign-variants-to-channel")))}function Fn(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.Oqu(k.lcZ(1,1,"catalog.assign-products-to-channel"))}function qn(e,t){if(1&e&&(k.YNc(0,On,3,3,"ng-container",12),k.YNc(1,Fn,2,3,"ng-template",null,13,k.W1O)),2&e){var n=k.MAs(2),o=k.oxw();k.Q6J("ngIf",o.isProductVariantMode)("ngIfElse",n)}}var In=function(e){return{channel:e}};function wn(e,t){if(1&e&&(k._uU(0),k.ALo(1,"translate")),2&e){var n=k.oxw();k.hij(" ",k.xi3(1,1,"catalog.price-in-channel",k.VKq(4,In,null==n.selectedChannel?null:n.selectedChannel.code))," ")}}function Mn(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.hij(" ",k.lcZ(1,1,"catalog.no-channel-selected")," ")}function _n(e,t){if(1&e&&(k._uU(0),k.ALo(1,"localeCurrency")),2&e){var n=k.oxw().$implicit,o=k.oxw();k.hij(" ",k.xi3(1,1,n.pricePreview,null==o.selectedChannel?null:o.selectedChannel.currencyCode)," ")}}function Jn(e,t){1&e&&k._uU(0," - ")}function Ln(e,t){if(1&e&&(k.TgZ(0,"tr"),k.TgZ(1,"td"),k._uU(2),k.qZA(),k.TgZ(3,"td"),k._uU(4),k.ALo(5,"localeCurrency"),k.qZA(),k.TgZ(6,"td"),k.YNc(7,_n,2,4,"ng-template",8),k.YNc(8,Jn,1,0,"ng-template",null,14,k.W1O),k.qZA(),k.qZA()),2&e){var n=t.$implicit,o=k.MAs(9),i=k.oxw();k.xp6(2),k.Oqu(n.name),k.xp6(2),k.Oqu(k.xi3(5,4,n.price,null==i.currentChannel?null:i.currentChannel.currencyCode)),k.xp6(3),k.Q6J("ngIf",i.selectedChannel)("ngIfElse",o)}}var Un=function(e){return{channelCode:e}};function Vn(e,t){if(1&e&&(k._uU(0),k.ALo(1,"translate")),2&e){var n=k.oxw(2);k.hij(" ",k.xi3(1,1,"catalog.assign-to-named-channel",k.VKq(4,Un,null==n.selectedChannel?null:n.selectedChannel.code))," ")}}function Nn(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.hij(" ",k.lcZ(1,1,"catalog.no-channel-selected")," ")}function Sn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",15),k.NdJ("click",function(){return k.CHM(n),k.oxw().cancel()}),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.TgZ(3,"button",16),k.NdJ("click",function(){return k.CHM(n),k.oxw().assign()}),k.YNc(4,Vn,2,6,"ng-template",8),k.YNc(5,Nn,2,3,"ng-template",null,9,k.W1O),k.qZA()}if(2&e){var o=k.MAs(6),i=k.oxw();k.xp6(1),k.Oqu(k.lcZ(2,4,"common.cancel")),k.xp6(2),k.Q6J("disabled",!i.selectedChannel),k.xp6(1),k.Q6J("ngIf",i.selectedChannel)("ngIfElse",o)}}var $n=function(){function e(t,n){p(this,e),this.dataService=t,this.notificationService=n,this.priceFactorControl=new A.NI(1),this.selectedChannelIdControl=new A.NI}return f(e,[{key:"isProductVariantMode",get:function(){return null!=this.productVariantIds}},{key:"ngOnInit",value:function(){var e=this,t=this.dataService.client.userStatus().mapSingle(function(e){return e.userStatus.activeChannelId}),n=this.dataService.settings.getChannels().mapSingle(function(e){return e.channels});(0,U.aj)(t,n).subscribe(function(t){var n=c(t,2),o=n[0],i=n[1];e.currentChannel=i.find(function(e){return e.id===o}),e.availableChannels=i}),this.selectedChannelIdControl.valueChanges.subscribe(function(t){e.selectChannel(t)}),this.variantsPreview$=(0,U.aj)((0,dn.D)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe((0,Me.O)(1))).pipe((0,x.U)(function(e){var t=c(e,2),n=t[0],o=t[1];return n.map(function(e){return{id:e.id,name:e.name,price:e.price,pricePreview:e.price*+o}})}))}},{key:"selectChannel",value:function(e){this.selectedChannel=this.availableChannels.find(function(t){return t.id===e[0]})}},{key:"assign",value:function(){var e=this,t=this.selectedChannel;t&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:t.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe(function(){e.notificationService.success((0,C.J)("catalog.assign-variant-to-channel-success"),{channel:t.code,count:e.productVariantIds.length}),e.resolveWith(!0)}):this.dataService.product.assignProductsToChannel({channelId:t.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(function(){e.notificationService.success((0,C.J)("catalog.assign-product-to-channel-success"),{channel:t.code,count:e.productIds.length}),e.resolveWith(!0)}))}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getTopVariants",value:function(e){return(0,An.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,o,i,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=[],o=0;case 2:if(!(o<this.productIds.length&&n.length<e)){t.next=10;break}return t.next=5,this.dataService.product.getProduct(this.productIds[o],{take:this.isProductVariantMode?void 0:e}).mapSingle(function(e){var t=e.product;return(t?t.variantList.items:[]).filter(function(e){var t;return!r.isProductVariantMode||(null===(t=r.productVariantIds)||void 0===t?void 0:t.includes(e.id))})}).toPromise();case 5:i=t.sent,n.push.apply(n,a(i||[]));case 7:o++,t.next=2;break;case 10:return t.abrupt("return",n.slice(0,e));case 11:case"end":return t.stop()}},t,this)}))}}]),e}();$n.\u0275fac=function(e){return new(e||$n)(k.Y36(Z.DoR),k.Y36(Z.gqp))},$n.\u0275cmp=k.Xpm({type:$n,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:32,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","disableChannelIds","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],[4,"ngIf","ngIfElse"],["productModeTitle",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(k.YNc(0,qn,3,2,"ng-template",0),k.TgZ(1,"div",1),k.TgZ(2,"clr-input-container"),k.TgZ(3,"label"),k._uU(4),k.ALo(5,"translate"),k.qZA(),k._UZ(6,"vdr-channel-assignment-control",2),k.qZA(),k._UZ(7,"div",3),k.TgZ(8,"clr-input-container"),k.TgZ(9,"label"),k._uU(10),k.ALo(11,"translate"),k.qZA(),k._UZ(12,"input",4),k.qZA(),k.qZA(),k.TgZ(13,"div",5),k.TgZ(14,"label",6),k._uU(15),k.ALo(16,"translate"),k.qZA(),k.TgZ(17,"table",7),k.TgZ(18,"thead"),k.TgZ(19,"tr"),k.TgZ(20,"th"),k._uU(21),k.ALo(22,"translate"),k.qZA(),k.TgZ(23,"th"),k._uU(24),k.ALo(25,"translate"),k.ALo(26,"translate"),k.ALo(27,"channelCodeToLabel"),k.qZA(),k.TgZ(28,"th"),k.YNc(29,wn,2,6,"ng-template",8),k.YNc(30,Mn,2,3,"ng-template",null,9,k.W1O),k.qZA(),k.qZA(),k.qZA(),k.TgZ(32,"tbody"),k.YNc(33,Ln,10,7,"tr",10),k.ALo(34,"async"),k.qZA(),k.qZA(),k.qZA(),k.YNc(35,Sn,7,6,"ng-template",11)),2&e){var n=k.MAs(31);k.xp6(4),k.Oqu(k.lcZ(5,13,"common.channel")),k.xp6(2),k.Q6J("multiple",!1)("includeDefaultChannel",!1)("disableChannelIds",t.currentChannelIds)("formControl",t.selectedChannelIdControl),k.xp6(4),k.Oqu(k.lcZ(11,15,"catalog.price-conversion-factor")),k.xp6(2),k.Q6J("formControl",t.priceFactorControl),k.xp6(3),k.Oqu(k.lcZ(16,17,"catalog.channel-price-preview")),k.xp6(6),k.Oqu(k.lcZ(22,19,"common.name")),k.xp6(3),k.hij(" ",k.xi3(25,21,"catalog.price-in-channel",k.VKq(30,In,k.lcZ(26,24,k.lcZ(27,26,null==t.currentChannel?null:t.currentChannel.code))))," "),k.xp6(5),k.Q6J("ngIf",t.selectedChannel)("ngIfElse",n),k.xp6(4),k.Q6J("ngForOf",k.lcZ(34,28,t.variantsPreview$))}},directives:[hn.q,ce.G55,ce.MgK,kn.S,ce.xRP,A.JJ,A.oH,le.y,A.qQ,A.Fd,A.wV,A.Fj,I.O5,I.sg,bn.n],pipes:[w.X$,Pn.E,I.Ov,Tn.k],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0});var Dn=g(45871);function Qn(e,t,n){if(!e)return"";var o=e.lastIndexOf(t);return-1===o?e:e.substr(0,o)+e.substr(o).replace(t,n)}var Yn=function(){function e(t){p(this,e),this.dataService=t}return f(e,[{key:"getFacets",value:function(){return this.dataService.facet.getAllFacets().mapSingle(function(e){return e.facets.items})}},{key:"getTaxCategories",value:function(){return this.dataService.settings.getTaxCategories().mapSingle(function(e){return e.taxCategories}).pipe((0,mt.d)(1))}},{key:"createProductWithVariants",value:function(e,t,n){var o=this,i=this.dataService.product.createProduct(e),r=t.groups.filter(function(e){return 0<e.values.length}),l=this.createProductOptionGroups(r,n);return(0,Ot.D)(i,l).pipe((0,ie.zg)(function(e){var t=c(e,2),n=t[0].createProduct,i=t[1];return(i.length?(0,Ot.D)(i.map(function(e){return o.dataService.product.addOptionGroupToProduct({productId:n.id,optionGroupId:e.id})})):(0,te.of)([])).pipe((0,x.U)(function(){return{createProduct:n,optionGroups:i}}))}),(0,ie.zg)(function(e){var i=e.createProduct,r=e.optionGroups,c=t.variants.map(function(e){var t=r.length?e.optionValues.map(function(e,t){var n=r[t].options.find(function(t){return t.name===e});if(!n)throw new Error('Could not find a matching ProductOption "'.concat(e,'" when creating variant'));return n.id}):[];return Object.assign(Object.assign({},e),{optionIds:t})}),l=r.map(function(e){return e.options}).reduce(function(e,t){return[].concat(a(e),a(t))},[]);return o.createProductVariants(i,c,l,n)}))}},{key:"createProductOptionGroups",value:function(e,t){var n=this;return e.length?(0,Ot.D)(e.map(function(e){return n.dataService.product.createProductOptionGroups({code:(0,W.U)(e.name,"-"),translations:[{languageCode:t,name:e.name}],options:e.values.map(function(e){return{code:(0,W.U)(e,"-"),translations:[{languageCode:t,name:e}]}})}).pipe((0,x.U)(function(e){return e.createProductOptionGroup}))})):(0,te.of)([])}},{key:"createProductVariants",value:function(e,t,n,o){var i=t.map(function(t){var i=n.length?"".concat(e.name," ").concat(t.optionIds.map(function(e){return n.find(function(t){return t.id===e})}).filter(Tt.notNullOrUndefined).map(function(e){return e.name}).join(" ")):e.name;return{productId:e.id,price:t.price,sku:t.sku,stockOnHand:t.stock,translations:[{languageCode:o,name:i}],optionIds:t.optionIds}});return this.dataService.product.createProductVariants(i).pipe((0,x.U)(function(t){return{createProductVariants:t.createProductVariants,productId:e.id}}))}},{key:"updateProduct",value:function(e){var t=this,n=e.product,o=e.languageCode,i=e.autoUpdate,c=e.productInput,l=e.variantsInput,s=[],u=l||[];return(i?this.dataService.product.getProductVariants({},n.id).mapSingle(function(e){return e.productVariants.items}):(0,te.of)([])).pipe((0,ie.zg)(function(e){var l,d,p,g;if(c){s.push(t.dataService.product.updateProduct(c));var f=null!==(d=null===(l=(0,Z.ZIM)(n,o))||void 0===l?void 0:l.name)&&void 0!==d?d:"",m=null===(p=(0,Z.ZIM)(c,o))||void 0===p?void 0:p.name;if(m&&f!==m&&i){var v,h=r(e);try{var b=function(){var e=v.value,t=(null===(g=(0,Z.ZIM)(e,o))||void 0===g?void 0:g.name)||"",n=void 0,i=u.find(function(t){return t.id===e.id});i?n=i:(n={id:e.id,translations:[{languageCode:o,name:t}]},u.push(n));var r=(0,Z.ZIM)(n,o);r&&(r.name?r.name=Qn(r.name,f,m):r.name=[m].concat(a(e.options.map(function(e){return e.name}))).join(" "))};for(h.s();!(v=h.n()).done;)b()}catch(y){h.e(y)}finally{h.f()}}}return u.length&&s.push(t.dataService.product.updateProductVariants(u)),(0,Ot.D)(s)}))}},{key:"updateProductOption",value:function(e,t,n){var o=this;return(e.autoUpdate?this.dataService.product.getProductVariants({},t.id).mapSingle(function(e){return e.productVariants.items}):(0,te.of)([])).pipe((0,ie.zg)(function(t){var i,a,c,l=(0,te.of)([]);if(e.autoUpdate){var s,u=null===(i=(0,Z.ZIM)(e,n))||void 0===i?void 0:i.name;u||(l=(0,te.of)([]));var d,p=[],g=r(t);try{for(g.s();!(d=g.n()).done;){var f=d.value;if(f.options.map(function(e){return e.id}).includes(e.id)){s||(s=null===(a=(0,Z.ZIM)(f.options.find(function(t){return t.id===e.id}),n))||void 0===a?void 0:a.name);var m=(null===(c=(0,Z.ZIM)(f,n))||void 0===c?void 0:c.name)||"";s&&u&&m.includes(s)&&p.push({id:f.id,translations:[{languageCode:n,name:Qn(m,s,u)}]})}}}catch(v){g.e(v)}finally{g.f()}p.length&&(l=o.dataService.product.updateProductVariants(p))}return o.dataService.product.updateProductOption(e).pipe((0,ie.zg)(function(){return l}))}))}},{key:"deleteProductVariant",value:function(e,t){var n=this;return this.dataService.product.deleteProductVariant(e).pipe((0,D.w)(function(e){return e.deleteProductVariant.result===Z.PcR.DELETED?n.dataService.product.getProduct(t).single$:(0,Dn._)(e.deleteProductVariant.message)}))}}]),e}();Yn.\u0275fac=function(e){return new(e||Yn)(k.LFG(Z.DoR))},Yn.\u0275prov=k.Yz7({token:Yn,factory:Yn.\u0275fac,providedIn:"root"});var jn=function(){return["product","enabled"]};function En(e,t){if(1&e&&(k.TgZ(0,"clr-toggle-wrapper"),k._UZ(1,"input",8),k.TgZ(2,"label"),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.qZA()),2&e){var n=k.oxw();k.xp6(1),k.Q6J("formControl",n.detailForm.get(k.DdM(4,jn))),k.xp6(2),k.Oqu(k.lcZ(4,2,"common.enabled"))}}function Gn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",9),k.NdJ("click",function(){return k.CHM(n),k.oxw().create()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw();k.Q6J("disabled",o.detailForm.invalid||o.detailForm.pristine||!o.variantsToCreateAreValid()),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.create")," ")}}function Hn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",9),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).save()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw(2);k.Q6J("disabled",(o.detailForm.invalid||o.detailForm.pristine)&&!o.assetsChanged()&&!o.variantAssetsChanged()),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.update")," ")}}var Bn=function(){return["UpdateCatalog","UpdateProduct"]};function Rn(e,t){1&e&&k.YNc(0,Hn,3,4,"button",10),2&e&&k.Q6J("vdrIfPermissions",k.DdM(1,Bn))}function zn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-chip",42),k.NdJ("iconClick",function(){k.CHM(n);var e=k.oxw().$implicit;return k.oxw(6).removeFromChannel(e.id)}),k._UZ(1,"vdr-channel-badge",43),k._uU(2),k.ALo(3,"channelCodeToLabel"),k.qZA()}if(2&e){var o=k.oxw().$implicit;k.xp6(1),k.Q6J("channelCode",o.code),k.xp6(1),k.hij(" ",k.lcZ(3,2,o.code)," ")}}function Kn(e,t){if(1&e&&(k.ynx(0),k.YNc(1,zn,4,4,"vdr-chip",41),k.BQk()),2&e){var n=t.$implicit,o=k.oxw(6);k.xp6(1),k.Q6J("ngIf",!o.isDefaultChannel(n.code))}}function Wn(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-form-item",36),k.ALo(1,"translate"),k.TgZ(2,"div",37),k.YNc(3,Kn,2,1,"ng-container",38),k.ALo(4,"async"),k.TgZ(5,"button",39),k.NdJ("click",function(){return k.CHM(n),k.oxw(5).assignToChannel()}),k._UZ(6,"clr-icon",40),k._uU(7),k.ALo(8,"translate"),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=k.oxw(5);k.Q6J("label",k.lcZ(1,3,"common.channels")),k.xp6(3),k.Q6J("ngForOf",k.lcZ(4,5,o.productChannels$)),k.xp6(4),k.hij(" ",k.lcZ(8,7,"catalog.assign-to-channel")," ")}}function Xn(e,t){1&e&&(k.ynx(0),k.YNc(1,Wn,9,9,"vdr-form-item",35),k.BQk())}function eo(e,t){1&e&&(k.ynx(0),k.YNc(1,Xn,2,0,"ng-container",34),k.BQk())}var to=function(){return["product","customFields"]};function no(e,t){if(1&e&&(k.TgZ(0,"section",44),k.TgZ(1,"label"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k._UZ(4,"vdr-tabbed-custom-fields",45),k.ALo(5,"hasPermission"),k.qZA()),2&e){var n=k.oxw(3);k.xp6(2),k.Oqu(k.lcZ(3,4,"common.custom-fields")),k.xp6(2),k.Q6J("customFields",n.customFields)("customFieldsFormGroup",n.detailForm.get(k.DdM(8,to)))("readonly",!k.lcZ(5,6,k.DdM(9,Bn)))}}function oo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-facet-value-chip",46),k.NdJ("remove",function(){var e=k.CHM(n).$implicit;return k.oxw(3).removeProductFacetValue(e.id)}),k.ALo(1,"hasPermission"),k.qZA()}if(2&e){var o=t.$implicit;k.Q6J("facetValue",o)("removable",k.lcZ(1,2,k.DdM(4,Bn)))}}function io(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",47),k.NdJ("click",function(){return k.CHM(n),k.oxw(3).selectProductFacetValue()}),k._UZ(1,"clr-icon",48),k._uU(2),k.ALo(3,"translate"),k.qZA()}2&e&&(k.xp6(2),k.hij(" ",k.lcZ(3,1,"catalog.add-facets")," "))}function ao(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div"),k.TgZ(1,"h4"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k.TgZ(4,"vdr-generate-product-variants",49),k.NdJ("variantsChange",function(e){return k.CHM(n),k.oxw(3).createVariantsConfig=e}),k.qZA(),k.qZA()}2&e&&(k.xp6(2),k.Oqu(k.lcZ(3,1,"catalog.product-variants")))}var ro=function(){return["product","name"]},co=function(e){return{pattern:e}};function lo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"clr-tab-content"),k.TgZ(1,"div",16),k.TgZ(2,"div",17),k.TgZ(3,"section",18),k.YNc(4,eo,2,0,"ng-container",15),k.ALo(5,"async"),k.TgZ(6,"vdr-form-field",19),k.ALo(7,"translate"),k.TgZ(8,"input",20),k.NdJ("input",function(e){return k.CHM(n),k.oxw(2).updateSlug(e.target.value)}),k.ALo(9,"hasPermission"),k.qZA(),k.qZA(),k.TgZ(10,"div",21),k.ALo(11,"async"),k.TgZ(12,"clr-checkbox-wrapper"),k._UZ(13,"input",22),k.TgZ(14,"label"),k._uU(15),k.ALo(16,"translate"),k.qZA(),k.qZA(),k.qZA(),k.TgZ(17,"vdr-form-field",23),k.ALo(18,"translate"),k.ALo(19,"translate"),k._UZ(20,"input",24),k.ALo(21,"hasPermission"),k.qZA(),k.TgZ(22,"vdr-form-field",25),k.ALo(23,"translate"),k.ALo(24,"translate"),k._UZ(25,"textarea",26),k.ALo(26,"hasPermission"),k.qZA(),k.YNc(27,no,6,10,"section",27),k._UZ(28,"vdr-custom-detail-component-host",28),k.qZA(),k.qZA(),k.TgZ(29,"div",29),k.TgZ(30,"vdr-assets",30),k.NdJ("change",function(e){return k.CHM(n),k.oxw(2).assetChanges=e}),k.qZA(),k.TgZ(31,"div",31),k.YNc(32,oo,2,5,"vdr-facet-value-chip",32),k.ALo(33,"async"),k.YNc(34,io,4,3,"button",33),k.qZA(),k.qZA(),k.qZA(),k.YNc(35,ao,5,3,"div",15),k.ALo(36,"async"),k.qZA()}if(2&e){var o,i=k.oxw().ngIf,a=k.oxw();k.xp6(4),k.Q6J("ngIf",!k.lcZ(5,21,a.isNew$)),k.xp6(2),k.Q6J("label",k.lcZ(7,23,"catalog.product-name")),k.xp6(2),k.Q6J("readonly",!k.lcZ(9,25,k.DdM(47,Bn))),k.xp6(2),k.ekj("visible",!1===k.lcZ(11,27,a.isNew$)&&(null==(o=a.detailForm.get(k.DdM(48,ro)))?null:o.dirty)),k.xp6(5),k.Oqu(k.lcZ(16,29,"catalog.auto-update-product-variant-name")),k.xp6(2),k.Q6J("label",k.lcZ(18,31,"catalog.slug"))("errors",k.VKq(49,co,k.lcZ(19,33,"catalog.slug-pattern-error"))),k.xp6(3),k.Q6J("readonly",!k.lcZ(21,35,k.DdM(51,Bn))),k.xp6(2),k.Q6J("label",k.lcZ(23,37,"common.description"))("errors",k.VKq(52,co,k.lcZ(24,39,"catalog.description-pattern-error"))),k.xp6(3),k.Q6J("readonly",!k.lcZ(26,41,k.DdM(54,Bn))),k.xp6(2),k.Q6J("ngIf",a.customFields.length),k.xp6(1),k.Q6J("entity$",a.entity$)("detailForm",a.detailForm),k.xp6(2),k.Q6J("assets",a.assetChanges.assets||i.assets)("featuredAsset",a.assetChanges.featuredAsset||i.featuredAsset)("updatePermissions",a.updatePermissions),k.xp6(2),k.Q6J("ngForOf",k.lcZ(33,43,a.facetValues$)),k.xp6(2),k.Q6J("vdrIfPermissions",k.DdM(55,Bn)),k.xp6(1),k.Q6J("ngIf",k.lcZ(36,45,a.isNew$))}}var so=function(){return["./","manage-variants"]};function uo(e,t){1&e&&(k.TgZ(0,"a",67),k._UZ(1,"clr-icon",68),k._uU(2),k.ALo(3,"translate"),k.qZA()),2&e&&(k.Q6J("routerLink",k.DdM(4,so)),k.xp6(2),k.hij(" ",k.lcZ(3,2,"catalog.manage-variants")," "))}function po(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",69),k.TgZ(1,"vdr-items-per-page-controls",70),k.NdJ("itemsPerPageChange",function(e){return k.CHM(n),k.oxw(4).setItemsPerPage(e)}),k.ALo(2,"async"),k.qZA(),k.TgZ(3,"vdr-pagination-controls",71),k.NdJ("pageChange",function(e){return k.CHM(n),k.oxw(4).setPage(e)}),k.ALo(4,"async"),k.ALo(5,"async"),k.ALo(6,"async"),k.qZA(),k.qZA()}if(2&e){var o,i=k.oxw(4);k.xp6(1),k.Q6J("itemsPerPage",k.lcZ(2,4,i.itemsPerPage$)),k.xp6(2),k.Q6J("id",null==(o=k.lcZ(4,6,i.paginationConfig$))?null:o.id)("currentPage",k.lcZ(5,8,i.currentPage$))("itemsPerPage",k.lcZ(6,10,i.itemsPerPage$))}}function go(e,t){if(1&e&&(k._UZ(0,"vdr-product-variants-table",72),k.ALo(1,"async"),k.ALo(2,"async"),k.ALo(3,"async")),2&e){var n=k.oxw(3).ngIf,o=k.oxw();k.Q6J("variants",k.lcZ(1,6,o.variants$))("paginationConfig",k.lcZ(2,8,o.paginationConfig$))("optionGroups",n.optionGroups)("channelPriceIncludesTax",k.lcZ(3,10,o.channelPriceIncludesTax$))("productVariantsFormArray",o.detailForm.get("variants"))("pendingAssetChanges",o.variantAssetChanges)}}function fo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-product-variants-list",73),k.NdJ("assignToChannel",function(e){return k.CHM(n),k.oxw(4).assignVariantToChannel(e)})("removeFromChannel",function(e){return k.CHM(n),k.oxw(4).removeVariantFromChannel(e)})("assetChange",function(e){return k.CHM(n),k.oxw(4).variantAssetChange(e)})("updateProductOption",function(e){return k.CHM(n),k.oxw(4).updateProductOption(e)})("selectionChange",function(e){return k.CHM(n),k.oxw(4).selectedVariantIds=e})("selectFacetValueClick",function(e){return k.CHM(n),k.oxw(4).selectVariantFacetValue(e)}),k.ALo(1,"async"),k.ALo(2,"async"),k.ALo(3,"async"),k.ALo(4,"async"),k.ALo(5,"async"),k.ALo(6,"async"),k.qZA()}if(2&e){var o=k.oxw(3).ngIf,i=k.oxw();k.Q6J("variants",k.lcZ(1,11,i.variants$))("paginationConfig",k.lcZ(2,13,i.paginationConfig$))("channelPriceIncludesTax",k.lcZ(3,15,i.channelPriceIncludesTax$))("facets",k.lcZ(4,17,i.facets$))("optionGroups",o.optionGroups)("productVariantsFormArray",i.detailForm.get("variants"))("taxCategories",k.lcZ(5,19,i.taxCategories$))("customFields",i.customVariantFields)("customOptionFields",i.customOptionFields)("activeLanguage",k.lcZ(6,21,i.languageCode$))("pendingAssetChanges",i.variantAssetChanges)}}function mo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",69),k.TgZ(1,"vdr-items-per-page-controls",70),k.NdJ("itemsPerPageChange",function(e){return k.CHM(n),k.oxw(4).setItemsPerPage(e)}),k.ALo(2,"async"),k.qZA(),k.TgZ(3,"vdr-pagination-controls",71),k.NdJ("pageChange",function(e){return k.CHM(n),k.oxw(4).setPage(e)}),k.ALo(4,"async"),k.ALo(5,"async"),k.ALo(6,"async"),k.qZA(),k.qZA()}if(2&e){var o,i=k.oxw(4);k.xp6(1),k.Q6J("itemsPerPage",k.lcZ(2,4,i.itemsPerPage$)),k.xp6(2),k.Q6J("id",null==(o=k.lcZ(4,6,i.paginationConfig$))?null:o.id)("currentPage",k.lcZ(5,8,i.currentPage$))("itemsPerPage",k.lcZ(6,10,i.itemsPerPage$))}}function vo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"clr-tab-content"),k.TgZ(1,"section",50),k.TgZ(2,"div",51),k.TgZ(3,"div",52),k.TgZ(4,"button",53),k.NdJ("click",function(){return k.CHM(n),k.oxw(3).variantDisplayMode="card"}),k._UZ(5,"clr-icon",54),k.TgZ(6,"span",55),k._uU(7),k.ALo(8,"translate"),k.qZA(),k.qZA(),k.TgZ(9,"button",56),k.NdJ("click",function(){return k.CHM(n),k.oxw(3).variantDisplayMode="table"}),k._UZ(10,"clr-icon",57),k.TgZ(11,"span",55),k._uU(12),k.ALo(13,"translate"),k.qZA(),k.qZA(),k.qZA(),k.TgZ(14,"div",58),k._UZ(15,"input",59),k.ALo(16,"translate"),k.TgZ(17,"button",60),k.NdJ("click",function(){return k.CHM(n),k.oxw(3).filterInput.setValue("")}),k._UZ(18,"clr-icon",61),k.qZA(),k.qZA(),k._UZ(19,"div",62),k.YNc(20,uo,4,5,"a",63),k.qZA(),k.YNc(21,po,7,12,"div",64),k.ALo(22,"async"),k.YNc(23,go,4,12,"vdr-product-variants-table",65),k.YNc(24,fo,7,23,"vdr-product-variants-list",66),k.qZA(),k.YNc(25,mo,7,12,"div",64),k.ALo(26,"async"),k.qZA()}if(2&e){var o,i,a=k.oxw(3);k.xp6(4),k.ekj("btn-primary","card"===a.variantDisplayMode),k.xp6(3),k.Oqu(k.lcZ(8,13,"catalog.display-variant-cards")),k.xp6(2),k.ekj("btn-primary","table"===a.variantDisplayMode),k.xp6(3),k.Oqu(k.lcZ(13,15,"catalog.display-variant-table")),k.xp6(3),k.Q6J("formControl",a.filterInput)("placeholder",k.lcZ(16,17,"catalog.filter-by-name-or-sku")),k.xp6(5),k.Q6J("vdrIfPermissions",k.DdM(23,Bn)),k.xp6(1),k.Q6J("ngIf",10<(null==(o=k.lcZ(22,19,a.paginationConfig$))?null:o.totalItems)),k.xp6(2),k.Q6J("ngIf","table"===a.variantDisplayMode),k.xp6(1),k.Q6J("ngIf","card"===a.variantDisplayMode),k.xp6(1),k.Q6J("ngIf",10<(null==(i=k.lcZ(26,21,a.paginationConfig$))?null:i.totalItems))}}function ho(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"clr-tab"),k.TgZ(1,"button",13),k.NdJ("click",function(){return k.CHM(n),k.oxw(2).navigateToTab("variants")}),k._uU(2),k.ALo(3,"translate"),k.qZA(),k.YNc(4,vo,27,24,"clr-tab-content",14),k.ALo(5,"async"),k.qZA()}if(2&e){var o=k.oxw(2);k.xp6(2),k.hij(" ",k.lcZ(3,2,"catalog.product-variants")," "),k.xp6(2),k.Q6J("clrIfActive","variants"===k.lcZ(5,4,o.activeTab$))}}function Zo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"form",11),k._UZ(1,"button",12),k.TgZ(2,"clr-tabs"),k.TgZ(3,"clr-tab"),k.TgZ(4,"button",13),k.NdJ("click",function(){return k.CHM(n),k.oxw().navigateToTab("details")}),k._uU(5),k.ALo(6,"translate"),k.qZA(),k.YNc(7,lo,37,56,"clr-tab-content",14),k.ALo(8,"async"),k.qZA(),k.YNc(9,ho,6,6,"clr-tab",15),k.ALo(10,"async"),k.qZA(),k.qZA()}if(2&e){var o=k.oxw();k.Q6J("formGroup",o.detailForm),k.xp6(5),k.hij(" ",k.lcZ(6,4,"catalog.product-details")," "),k.xp6(2),k.Q6J("clrIfActive","details"===k.lcZ(8,6,o.activeTab$)),k.xp6(2),k.Q6J("ngIf",!k.lcZ(10,8,o.isNew$))}}var bo=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r,c,l,s,u,g){var f;return p(this,n),(f=t.call(this,e,o,i,s)).productDetailService=a,f.formBuilder=r,f.modalService=c,f.notificationService=l,f.dataService=s,f.location=u,f.changeDetector=g,f.filterInput=new A.NI(""),f.assetChanges={},f.variantAssetChanges={},f.variantFacetValueChanges={},f.currentPage$=new L.X(1),f.itemsPerPage$=new L.X(10),f.selectedVariantIds=[],f.variantDisplayMode="card",f.createVariantsConfig={groups:[],variants:[]},f.productVariantMap=new Map,f.updatePermissions=[Z.y3$.UpdateCatalog,Z.y3$.UpdateProduct],f.customFields=f.getCustomFieldConfig("Product"),f.customVariantFields=f.getCustomFieldConfig("ProductVariant"),f.customOptionGroupFields=f.getCustomFieldConfig("ProductOptionGroup"),f.customOptionFields=f.getCustomFieldConfig("ProductOption"),f.detailForm=f.formBuilder.group({product:f.formBuilder.group({enabled:!0,name:["",A.kI.required],autoUpdateVariantNames:!0,slug:["",(0,Z.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",facetValueIds:[[]],customFields:f.formBuilder.group(f.customFields.reduce(function(e,t){return Object.assign(Object.assign({},e),d({},t.name,""))},{}))}),variants:f.formBuilder.array([])}),f}return f(n,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.product$=this.entity$,this.totalItems$=this.product$.pipe((0,x.U)(function(e){return e.variantList.totalItems})),this.paginationConfig$=(0,U.aj)(this.totalItems$,this.itemsPerPage$,this.currentPage$).pipe((0,x.U)(function(e){var t=c(e,3);return{totalItems:t[0],itemsPerPage:t[1],currentPage:t[2]}})),this.product$.pipe((0,x.U)(function(e){return e.variantList.items}));var t,n=this.filterInput.valueChanges.pipe((0,Me.O)(""),(0,N.b)(200),(0,mt.d)()),o=this.product$.pipe((0,x.U)(function(e){return e.variantList.items})),i=(0,U.aj)(n,this.currentPage$,this.itemsPerPage$).pipe((t=o,function(e){return e.lift(new gn(t))}),(0,mn.T)(1),(0,D.w)(function(t){var n=c(t,3),o=n[0],i=n[1],a=n[2];return e.dataService.product.getProductVariants(Object.assign(Object.assign({skip:(i-1)*a,take:a},o?{filter:{name:{contains:o},sku:{contains:o}}}:{}),{filterOperator:Z.FnJ.OR}),e.id).mapStream(function(e){return e.productVariants.items})}),(0,mt.d)({bufferSize:1,refCount:!0}));this.variants$=(0,ee.T)(o,i).pipe((0,Je.b)(function(t){var n,o=r(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;e.productVariantMap.set(i.id,i)}}catch(a){o.e(a)}finally{o.f()}})),this.taxCategories$=this.productDetailService.getTaxCategories().pipe((0,S.R)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe((0,x.U)(function(e){return e.get("tab")})),(0,U.aj)(i,this.languageCode$).pipe((0,S.R)(this.destroy$)).subscribe(function(t){var n=c(t,2),o=n[0],i=n[1];e.buildVariantFormArray(o,i)}),this.facets$=this.productDetailService.getFacets();var l=this.product$.pipe((0,x.U)(function(e){return e.facetValues})),s=this.facets$.pipe((0,x.U)(Z.k2u)),u=this.getProductFormGroup().valueChanges.pipe((0,x.U)(function(e){return e.facetValueIds}),(0,_e.x)()),d=(0,U.aj)(u,l,s).pipe((0,x.U)(function(e){var t=c(e,3),n=t[0],o=t[1],i=t[2],r=[].concat(a(o),a(i));return n.map(function(e){return r.find(function(t){return t.id===e})}).filter(Tt.notNullOrUndefined)}));this.facetValues$=(0,ee.T)(l,d),this.productChannels$=this.product$.pipe((0,x.U)(function(e){return e.channels})),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(function(e){return e.activeChannel.pricesIncludeTax}).pipe((0,mt.d)(1))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"navigateToTab",value:function(e){this.location.replaceState(this.router.createUrlTree(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:e})],{queryParamsHandling:"merge",relativeTo:this.route}).toString())}},{key:"isDefaultChannel",value:function(e){return e===un.z$}},{key:"setPage",value:function(e){this.currentPage$.next(e)}},{key:"setItemsPerPage",value:function(e){this.itemsPerPage$.next(+e),this.currentPage$.next(1)}},{key:"assignToChannel",value:function(){var e=this;this.productChannels$.pipe((0,oe.q)(1),(0,D.w)(function(t){return e.modalService.fromComponent($n,{size:"lg",locals:{productIds:[e.id],currentChannelIds:t.map(function(e){return e.id})}})})).subscribe()}},{key:"removeFromChannel",value:function(e){var t=this;(0,dn.D)((0,Z.PDO)(this.dataService,e)).pipe((0,D.w)(function(e){var n=e.channelCode;return t.modalService.dialog({title:(0,C.J)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("catalog.remove-from-channel"),translationVars:{channelCode:n},returnValue:!0}]})}),(0,D.w)(function(n){return n?t.dataService.product.removeProductsFromChannel({channelId:e,productIds:[t.id]}):V.E})).subscribe(function(){t.notificationService.success((0,C.J)("catalog.notify-remove-product-from-channel-success"))},function(e){t.notificationService.error((0,C.J)("catalog.notify-remove-product-from-channel-error"))})}},{key:"assignVariantToChannel",value:function(e){return this.modalService.fromComponent($n,{size:"lg",locals:{productIds:[this.id],productVariantIds:[e.id],currentChannelIds:e.channels.map(function(e){return e.id})}}).subscribe()}},{key:"removeVariantFromChannel",value:function(e){var t=this,n=e.channelId,o=e.variant;(0,dn.D)((0,Z.PDO)(this.dataService,n)).pipe((0,D.w)(function(e){var n=e.channelCode;return t.modalService.dialog({title:(0,C.J)("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("catalog.remove-from-channel"),translationVars:{channelCode:n},returnValue:!0}]})}),(0,D.w)(function(e){return e?t.dataService.product.removeVariantsFromChannel({channelId:n,productVariantIds:[o.id]}):V.E})).subscribe(function(){t.notificationService.success((0,C.J)("catalog.notify-remove-variant-from-channel-success"))},function(e){t.notificationService.error((0,C.J)("catalog.notify-remove-variant-from-channel-error"))})}},{key:"assetsChanged",value:function(){return!!Object.values(this.assetChanges).length}},{key:"variantAssetsChanged",value:function(){return!!Object.keys(this.variantAssetChanges).length}},{key:"variantAssetChange",value:function(e){this.variantAssetChanges[e.variantId]=e}},{key:"updateSlug",value:function(e){var t=this;(0,U.aj)(this.entity$,this.languageCode$).pipe((0,oe.q)(1)).subscribe(function(n){var o=c(n,2),i=o[0],a=o[1],r=t.detailForm.get(["product","slug"]),l=(0,Z.ZIM)(i,a),s=!l||!l.slug;r&&r.pristine&&s&&r.setValue((0,W.U)("".concat(e),"-"))})}},{key:"selectProductFacetValue",value:function(){var e=this;this.displayFacetValueModal().subscribe(function(t){if(t){var n=e.getProductFormGroup(),o=n.value.facetValueIds;n.patchValue({facetValueIds:(0,ge.T)([].concat(a(o),a(t)))}),n.markAsDirty()}})}},{key:"updateProductOption",value:function(e){var t=this;(0,U.aj)(this.product$,this.languageCode$).pipe((0,oe.q)(1),(0,ie.zg)(function(n){var o=c(n,2),i=o[0],a=o[1];return t.productDetailService.updateProductOption(e,i,a)})).subscribe(function(){t.notificationService.success((0,C.J)("common.notify-update-success"),{entity:"ProductOption"})},function(e){t.notificationService.error((0,C.J)("common.notify-update-error"),{entity:"ProductOption"})})}},{key:"removeProductFacetValue",value:function(e){var t=this.getProductFormGroup(),n=t.value.facetValueIds;t.patchValue({facetValueIds:n.filter(function(t){return t!==e})}),t.markAsDirty()}},{key:"selectVariantFacetValue",value:function(e){var t=this;this.displayFacetValueModal().pipe((0,vn.M)(this.variants$)).subscribe(function(n){var o=c(n,2),i=o[0],l=o[1];if(i){var s,u=r(e);try{var d=function(){var e=s.value,n=l.findIndex(function(t){return t.id===e}),o=l[n],r=o?o.facetValues.map(function(e){return e.id}):[],c=t.detailForm.get("variants").controls.find(function(t){return t.value.id===e});if(c){var u=(0,ge.T)([].concat(a(r),a(i)));c.patchValue({facetValueIds:u}),c.markAsDirty(),t.variantFacetValueChanges[e]=u}};for(u.s();!(s=u.n()).done;)d()}catch(p){u.e(p)}finally{u.f()}t.changeDetector.markForCheck()}})}},{key:"variantsToCreateAreValid",value:function(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every(function(e){return""!==e.sku})}},{key:"displayFacetValueModal",value:function(){var e=this;return this.productDetailService.getFacets().pipe((0,ie.zg)(function(t){return e.modalService.fromComponent(xn,{size:"md",closable:!0,locals:{facets:t}})}),(0,x.U)(function(e){return e&&e.map(function(e){return e.id})}))}},{key:"create",value:function(){var e=this,t=this.getProductFormGroup();!t.dirty||(0,U.aj)(this.product$,this.languageCode$).pipe((0,oe.q)(1),(0,ie.zg)(function(n){var o=c(n,2),i=o[0],a=o[1],r=e.getUpdatedProduct(i,t,a);return e.productDetailService.createProductWithVariants(r,e.createVariantsConfig,a)})).subscribe(function(t){t.createProductVariants;var n=t.productId;e.notificationService.success((0,C.J)("common.notify-create-success"),{entity:"Product"}),e.assetChanges={},e.variantAssetChanges={},e.detailForm.markAsPristine(),e.router.navigate(["../",n],{relativeTo:e.route})},function(t){console.error(t),e.notificationService.error((0,C.J)("common.notify-create-error"),{entity:"Product"})})}},{key:"save",value:function(){var e=this;(0,U.aj)(this.product$,this.languageCode$,this.channelPriceIncludesTax$).pipe((0,oe.q)(1),(0,ie.zg)(function(t){var n,o,i,a,r=c(t,3),l=r[0],s=r[1],u=r[2],d=e.getProductFormGroup();(d.dirty||e.assetsChanged())&&(i=e.getUpdatedProduct(l,d,s));var p=e.detailForm.get("variants");return(p&&p.dirty||e.variantAssetsChanged())&&(a=e.getUpdatedProductVariants(l,p,s,u)),e.productDetailService.updateProduct({product:l,languageCode:s,autoUpdate:null!==(o=null===(n=e.detailForm.get(["product","autoUpdateVariantNames"]))||void 0===n?void 0:n.value)&&void 0!==o&&o,productInput:i,variantsInput:a})})).subscribe(function(t){e.updateSlugAfterSave(t),e.detailForm.markAsPristine(),e.assetChanges={},e.variantAssetChanges={},e.notificationService.success((0,C.J)("common.notify-update-success"),{entity:"Product"}),e.changeDetector.markForCheck()},function(t){e.notificationService.error((0,C.J)("common.notify-update-error"),{entity:"Product"})})}},{key:"canDeactivate",value:function(){return u(y(n.prototype),"canDeactivate",this).call(this)&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}},{key:"setFormValues",value:function(e,t){var n=(0,Z.ZIM)(e,t);this.detailForm.patchValue({product:{enabled:e.enabled,name:n?n.name:"",slug:n?n.slug:"",description:n?n.description:"",facetValueIds:e.facetValues.map(function(e){return e.id})}}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["product","customFields"]),e,n),this.buildVariantFormArray(e.variantList.items,t)}},{key:"buildVariantFormArray",value:function(e,t){var n=this,o=this.detailForm.get("variants");e.forEach(function(e,i){var a=(0,Z.ZIM)(e,t),r=n.variantFacetValueChanges[e.id]||e.facetValues.map(function(e){return e.id}),c={id:e.id,enabled:e.enabled,sku:e.sku,name:a?a.name:"",price:e.price,priceWithTax:e.priceWithTax,taxCategoryId:e.taxCategory.id,stockOnHand:e.stockOnHand,useGlobalOutOfStockThreshold:e.useGlobalOutOfStockThreshold,outOfStockThreshold:e.outOfStockThreshold,trackInventory:e.trackInventory,facetValueIds:r},l=o.controls.find(function(t){return t.value.id===e.id});if(l?l.pristine&&l.patchValue(c):(l=n.formBuilder.group(Object.assign(Object.assign({},c),{facetValueIds:n.formBuilder.control(r)})),o.insert(i,l)),n.customVariantFields.length){var s=l.get(["customFields"]);s||(s=n.formBuilder.group(n.customVariantFields.reduce(function(e,t){return Object.assign(Object.assign({},e),d({},t.name,""))},{})),l.addControl("customFields",s)),n.setCustomFieldFormValues(n.customVariantFields,s,e,a)}})}},{key:"getUpdatedProduct",value:function(e,t,n){var o,i,a=(0,Z.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},a),{assetIds:null===(o=this.assetChanges.assets)||void 0===o?void 0:o.map(function(e){return e.id}),featuredAssetId:null===(i=this.assetChanges.featuredAsset)||void 0===i?void 0:i.id,facetValueIds:t.value.facetValueIds})}},{key:"getUpdatedProductVariants",value:function(e,t,n,o){var i=this,a=t.controls.filter(function(e){return e.dirty}),r=a.map(function(e){return i.productVariantMap.get(e.value.id)}).filter(Tt.notNullOrUndefined),c=a.map(function(e){return e.value});if(r.length!==c.length)throw new Error((0,C.J)("error.product-variant-form-values-do-not-match"));return r.map(function(e,t){var a,r,l=c.find(function(t){return t.id===e.id}),s=(0,Z.iSy)({translatable:e,updatedFields:l,customFieldConfig:i.customVariantFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}});s.taxCategoryId=l.taxCategoryId,s.facetValueIds=l.facetValueIds,s.price=o?l.priceWithTax:l.price;var u=i.variantAssetChanges[e.id];return u&&(s.featuredAssetId=null===(a=u.featuredAsset)||void 0===a?void 0:a.id,s.assetIds=null===(r=u.assets)||void 0===r?void 0:r.map(function(e){return e.id})),s}).filter(Tt.notNullOrUndefined)}},{key:"getProductFormGroup",value:function(){return this.detailForm.get("product")}},{key:"updateSlugAfterSave",value:function(e){var t=e[0],n=this.detailForm.get(["product","slug"]);n&&t.hasOwnProperty("updateProduct")&&n.setValue(t.updateProduct.slug,{emitEvent:!1})}}]),n}(Z.UT_);bo.\u0275fac=function(e){return new(e||bo)(k.Y36(v.gz),k.Y36(v.F0),k.Y36(Z.iHG),k.Y36(Yn),k.Y36(A.qu),k.Y36(Z.Z7U),k.Y36(Z.gqp),k.Y36(Z.DoR),k.Y36(I.Ye),k.Y36(k.sBO))},bo.\u0275cmp=k.Xpm({type:bo,selectors:[["vdr-product-detail"]],features:[k.qOj],decls:18,vars:21,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["type","submit","hidden","","x-data","prevents enter key from triggering other buttons"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],[1,"auto-rename-wrapper"],["clrCheckbox","","type","checkbox","id","auto-update","formControlName","autoUpdateVariantNames"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["for","description",3,"label","errors"],["rows","9","id","slug","type","text","formControlName","description",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","product-detail",3,"entity$","detailForm"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","updatePermissions","change"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFields","customFieldsFormGroup","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"full-label"],[1,"btn",3,"click"],["shape","table"],[1,"variant-filter"],[3,"formControl","placeholder"],[1,"icon-button",3,"click"],["shape","times"],[1,"flex-spacer"],["class","btn btn-secondary edit-variants-btn mb0 mr0",3,"routerLink",4,"vdrIfPermissions"],["class","pagination-row mt4",4,"ngIf"],[3,"variants","paginationConfig","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges",4,"ngIf"],[3,"variants","paginationConfig","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","edit-variants-btn","mb0","mr0",3,"routerLink"],["shape","add-text"],[1,"pagination-row","mt4"],[3,"itemsPerPage","itemsPerPageChange"],[3,"id","currentPage","itemsPerPage","pageChange"],[3,"variants","paginationConfig","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges"],[3,"variants","paginationConfig","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(e,t){if(1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left"),k.TgZ(2,"div",0),k._UZ(3,"vdr-entity-info",1),k.ALo(4,"async"),k.YNc(5,En,5,5,"clr-toggle-wrapper",2),k.qZA(),k.TgZ(6,"vdr-language-selector",3),k.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),k.ALo(7,"async"),k.ALo(8,"async"),k.ALo(9,"async"),k.qZA(),k.qZA(),k.TgZ(10,"vdr-ab-right"),k._UZ(11,"vdr-action-bar-items",4),k.YNc(12,Gn,3,4,"button",5),k.ALo(13,"async"),k.YNc(14,Rn,1,2,"ng-template",null,6,k.W1O),k.qZA(),k.qZA(),k.YNc(16,Zo,11,10,"form",7),k.ALo(17,"async")),2&e){var n=k.MAs(15);k.xp6(3),k.Q6J("entity",k.lcZ(4,8,t.entity$)),k.xp6(2),k.Q6J("vdrIfPermissions",k.DdM(20,Bn)),k.xp6(1),k.Q6J("disabled",k.lcZ(7,10,t.isNew$))("availableLanguageCodes",k.lcZ(8,12,t.availableLanguages$))("currentLanguageCode",k.lcZ(9,14,t.languageCode$)),k.xp6(6),k.Q6J("ngIf",k.lcZ(13,16,t.isNew$))("ngIfElse",n),k.xp6(4),k.Q6J("ngIf",k.lcZ(17,18,t.product$))}},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}textarea[_ngcontent-%COMP%]{width:100%}.facets[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;align-items:center}@media screen and (min-width: 768px){.facets[_ngcontent-%COMP%]{max-width:340px}}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:none;max-width:initial;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}@media screen and (min-width: 768px){.view-mode[_ngcontent-%COMP%]{flex-direction:row}}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap;max-height:144px;overflow-y:auto}.auto-rename-wrapper[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible[_ngcontent-%COMP%]{max-height:24px;margin-bottom:12px}.pagination-row[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between}"],changeDetection:0});var yo=g(65318),Co=g(62875),xo=g(40809),Ao=["productSearchInputComponent"];function ko(e,t){1&e&&k._UZ(0,"vdr-status-badge",20)}var Po=function(){return["UpdateCatalog","UpdateProduct"]},To=function(e){return{count:e}};function Oo(e,t){if(1&e){var n=k.EpF();k.ynx(0),k.TgZ(1,"button",21),k.NdJ("click",function(){return k.CHM(n),k.oxw().runPendingSearchIndexUpdates()}),k.ALo(2,"hasPermission"),k._UZ(3,"vdr-status-badge",20),k._uU(4),k.ALo(5,"translate"),k.qZA(),k._UZ(6,"div",22),k.BQk()}if(2&e){var o=k.oxw();k.xp6(1),k.Q6J("disabled",!k.lcZ(2,2,k.DdM(7,Po))),k.xp6(3),k.hij(" ",k.xi3(5,4,"catalog.run-pending-search-index-updates",k.VKq(8,To,o.pendingSearchIndexUpdates))," ")}}var Fo=function(){return["./create"]};function qo(e,t){1&e&&(k.TgZ(0,"a",23),k._UZ(1,"clr-icon",24),k._uU(2),k.ALo(3,"translate"),k.qZA()),2&e&&(k.Q6J("routerLink",k.DdM(4,Fo)),k.xp6(2),k.hij(" ",k.lcZ(3,2,"catalog.create-new-product")," "))}function Io(e,t){if(1&e&&(k._UZ(0,"img",38),k.ALo(1,"assetPreview")),2&e){var n=t.ngIf;k.Q6J("src",k.xi3(1,1,n,"tiny"),k.LSH)}}function wo(e,t){1&e&&(k.TgZ(0,"div",39),k._UZ(1,"clr-icon",40),k.qZA())}function Mo(e,t){if(1&e&&(k.TgZ(0,"div",41),k._uU(1),k.qZA()),2&e){var n=k.oxw().item;k.xp6(1),k.Oqu(n.sku)}}function _o(e,t){1&e&&(k.TgZ(0,"vdr-chip"),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"common.disabled")))}var Jo=function(e){return["./",e]},Lo=function(){return["DeleteCatalog","DeleteProduct"]};function Uo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"td",25),k.TgZ(1,"div",26),k.YNc(2,Io,2,4,"img",27),k.YNc(3,wo,2,0,"ng-template",null,28,k.W1O),k.qZA(),k.qZA(),k.TgZ(5,"td",29),k.TgZ(6,"div"),k._uU(7),k.qZA(),k.YNc(8,Mo,2,1,"div",30),k.qZA(),k.TgZ(9,"td",31),k.YNc(10,_o,3,3,"vdr-chip",10),k.qZA(),k.TgZ(11,"td",32),k._UZ(12,"vdr-table-row-action",33),k.ALo(13,"translate"),k.TgZ(14,"vdr-dropdown"),k.TgZ(15,"button",34),k._uU(16),k.ALo(17,"translate"),k._UZ(18,"clr-icon",35),k.qZA(),k.TgZ(19,"vdr-dropdown-menu",8),k.TgZ(20,"button",36),k.NdJ("click",function(){var e=k.CHM(n).item;return k.oxw().deleteProduct(e.productId)}),k.ALo(21,"hasPermission"),k._UZ(22,"clr-icon",37),k._uU(23),k.ALo(24,"translate"),k.qZA(),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.item,i=k.MAs(4),a=k.oxw();k.ekj("disabled",!o.enabled),k.xp6(2),k.Q6J("ngIf",a.groupByProduct?o.productAsset:o.productVariantAsset||o.productAsset)("ngIfElse",i),k.xp6(3),k.ekj("disabled",!o.enabled),k.xp6(2),k.Oqu(a.groupByProduct?o.productName:o.productVariantName),k.xp6(1),k.Q6J("ngIf",!a.groupByProduct),k.xp6(1),k.ekj("disabled",!o.enabled),k.xp6(1),k.Q6J("ngIf",!o.enabled),k.xp6(1),k.ekj("disabled",!o.enabled),k.xp6(1),k.Q6J("label",k.lcZ(13,18,"common.edit"))("linkTo",k.VKq(26,Jo,o.productId)),k.xp6(4),k.hij(" ",k.lcZ(17,20,"common.actions")," "),k.xp6(4),k.Q6J("disabled",!k.lcZ(21,22,k.DdM(28,Lo))),k.xp6(3),k.hij(" ",k.lcZ(24,24,"common.delete")," ")}}var Vo=function(){return["CreateCatalog","CreateProduct"]},No=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r,c,l){var s,d;return p(this,n),(d=t.call(this,c,l)).dataService=e,d.modalService=o,d.notificationService=i,d.jobQueueService=a,d.serverConfigService=r,d.searchTerm="",d.facetValueIds=[],d.groupByProduct=!0,d.pendingSearchIndexUpdates=0,d.route.queryParamMap.pipe((0,x.U)(function(e){return e.get("q")}),(0,S.R)(d.destroy$)).subscribe(function(e){d.searchTerm=e||"",d.productSearchInput&&d.productSearchInput.setSearchTerm(e)}),d.selectedFacetValueIds$=d.route.queryParamMap.pipe((0,x.U)(function(e){return e.getAll("fvids")})),d.selectedFacetValueIds$.pipe((0,S.R)(d.destroy$)).subscribe(function(e){d.facetValueIds=e,d.productSearchInput&&d.productSearchInput.setFacetValues(e)}),u((s=b(d),y(n.prototype)),"setQueryFn",s).call(s,function(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=d.dataService.product).searchProducts.apply(e,[d.searchTerm].concat(n)).refetchOnChannelChange()},function(e){return e.search},function(e,t){return{input:{skip:e,take:t,term:d.searchTerm,facetValueIds:d.facetValueIds,facetValueOperator:Z.FnJ.AND,groupByProduct:d.groupByProduct}}}),d.selectionManager=new Z.ZE0({multiSelect:!0,itemsAreEqual:function(e,t){return d.groupByProduct?e.productId===t.productId:e.productVariantId===t.productVariantId},additiveMode:!0}),d}return f(n,[{key:"ngOnInit",value:function(){var e=this;u(y(n.prototype),"ngOnInit",this).call(this),this.facetValues$=this.result$.pipe((0,x.U)(function(e){return e.search.facetValues})),this.facetValues$.pipe((0,oe.q)(1),(0,yo.g)(100),(0,vn.M)(this.selectedFacetValueIds$)).subscribe(function(t){var n=c(t,2),o=(n[0],n[1]);e.productSearchInput.setFacetValues(o)}),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(function(e){return e.uiState.contentLanguage}).pipe((0,Je.b)(function(){return e.refresh()})),this.dataService.product.getPendingSearchIndexUpdates().mapSingle(function(e){return e.pendingSearchIndexUpdates}).subscribe(function(t){return e.pendingSearchIndexUpdates=t})}},{key:"ngAfterViewInit",value:function(){var e=this;this.productSearchInput&&this.searchTerm&&setTimeout(function(){return e.productSearchInput.setSearchTerm(e.searchTerm)})}},{key:"setSearchTerm",value:function(e){this.searchTerm=e,this.setQueryParam({q:e||null,page:1}),this.refresh()}},{key:"setFacetValueIds",value:function(e){this.facetValueIds=e,this.setQueryParam({fvids:e,page:1}),this.refresh()}},{key:"rebuildSearchIndex",value:function(){var e=this;this.dataService.product.reindex().subscribe(function(t){var n=t.reindex;e.notificationService.info((0,C.J)("catalog.reindexing")),e.jobQueueService.addJob(n.id,function(t){if(t.state===Z.Zyh.COMPLETED){var n=(new Intl.NumberFormat).format(t.duration||0);e.notificationService.success((0,C.J)("catalog.reindex-successful"),{count:t.result.indexedItemCount,time:n}),e.refresh()}else e.notificationService.error((0,C.J)("catalog.reindex-error"))})})}},{key:"runPendingSearchIndexUpdates",value:function(){var e=this;this.dataService.product.runPendingSearchIndexUpdates().subscribe(function(t){e.notificationService.info((0,C.J)("catalog.running-search-index-updates"),{count:e.pendingSearchIndexUpdates}),e.pendingSearchIndexUpdates=0})}},{key:"deleteProduct",value:function(e){var t=this;this.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(n){return n?t.dataService.product.deleteProduct(e):V.E}),(0,yo.g)(500)).subscribe(function(){t.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"Product"}),t.refresh()},function(e){t.notificationService.error((0,C.J)("common.notify-delete-error"),{entity:"Product"})})}},{key:"setLanguage",value:function(e){this.dataService.client.setContentLanguage(e).subscribe()}}]),n}(Z.t7C);function So(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",6),k.NdJ("click",function(){return k.CHM(n),k.oxw().save()}),k._uU(1),k.ALo(2,"translate"),k.qZA()}if(2&e){var o=k.oxw();k.Q6J("disabled",o.detailForm.pristine||o.detailForm.invalid),k.xp6(1),k.hij(" ",k.lcZ(2,2,"common.update")," ")}}function $o(e,t){if(1&e&&(k.TgZ(0,"tr",22),k.TgZ(1,"td",23),k._UZ(2,"vdr-entity-info",13),k.qZA(),k.TgZ(3,"td",23),k._UZ(4,"input",24),k.ALo(5,"hasPermission"),k.qZA(),k.TgZ(6,"td",23),k._UZ(7,"input",25),k.qZA(),k.qZA()),2&e){var n=t.$implicit,o=t.index,i=k.oxw(3);k.Q6J("formGroupName",o),k.xp6(2),k.Q6J("entity",n.value),k.xp6(2),k.Q6J("readonly",!k.lcZ(5,3,i.updatePermission))}}function Do(e,t){if(1&e&&(k.TgZ(0,"div",10),k.TgZ(1,"section",11),k.TgZ(2,"div",12),k._UZ(3,"vdr-entity-info",13),k.TgZ(4,"div",14),k._uU(5),k.qZA(),k.qZA(),k.TgZ(6,"div",15),k.TgZ(7,"vdr-form-field",16),k.ALo(8,"translate"),k._UZ(9,"input",17),k.ALo(10,"hasPermission"),k.qZA(),k.TgZ(11,"vdr-form-field",18),k.ALo(12,"translate"),k._UZ(13,"input",19),k.ALo(14,"hasPermission"),k.qZA(),k.qZA(),k.TgZ(15,"section",15),k.TgZ(16,"table",20),k.TgZ(17,"thead"),k.TgZ(18,"tr"),k._UZ(19,"th"),k.TgZ(20,"th"),k._uU(21),k.ALo(22,"translate"),k.qZA(),k.TgZ(23,"th"),k._uU(24),k.ALo(25,"translate"),k.qZA(),k.qZA(),k.qZA(),k.TgZ(26,"tbody"),k.YNc(27,$o,8,5,"tr",21),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.qZA()),2&e){var n=t.$implicit,o=t.index,i=k.oxw(2);k.xp6(1),k.Q6J("formArrayName",o),k.xp6(2),k.Q6J("entity",n.value),k.xp6(2),k.Oqu(n.value.code),k.xp6(2),k.Q6J("label",k.lcZ(8,12,"common.name")),k.xp6(2),k.Q6J("id","name-"+o)("readonly",!k.lcZ(10,14,i.updatePermission)),k.xp6(2),k.Q6J("label",k.lcZ(12,16,"common.code")),k.xp6(2),k.Q6J("id","code-"+o)("readonly",!k.lcZ(14,18,i.updatePermission)),k.xp6(8),k.Oqu(k.lcZ(22,20,"common.name")),k.xp6(3),k.Oqu(k.lcZ(25,22,"common.code")),k.xp6(3),k.Q6J("ngForOf",i.getOptions(n))}}function Qo(e,t){if(1&e&&(k.TgZ(0,"form",7),k.TgZ(1,"div",8),k.YNc(2,Do,28,24,"div",9),k.qZA(),k.qZA()),2&e){var n=k.oxw();k.Q6J("formGroup",n.detailForm),k.xp6(2),k.Q6J("ngForOf",n.getOptionGroups())}}No.\u0275fac=function(e){return new(e||No)(k.Y36(Z.DoR),k.Y36(Z.Z7U),k.Y36(Z.gqp),k.Y36(Z.u8d),k.Y36(Z.iHG),k.Y36(v.F0),k.Y36(v.gz))},No.\u0275cmp=k.Xpm({type:No,selectors:[["vdr-products-list"]],viewQuery:function(e,t){var n;(1&e&&k.Gf(Ao,7),2&e)&&(k.iGM(n=k.CRH())&&(t.productSearchInput=n.first))},features:[k.qOj],decls:43,vars:46,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu","mr3"],["type","button","vdrDropdownTrigger","",1,"icon-button","search-index-button",3,"title"],["shape","cog"],["type","warning",4,"ngIf"],["vdrPosition","bottom-right"],[1,"dropdown-header"],[4,"ngIf"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"flex","wrap"],[1,"mt2"],["type","checkbox","clrToggle","",3,"ngModel","ngModelChange"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","selectionManager","pageChange","itemsPerPageChange"],["locationId","product-list",3,"hostComponent","selectionManager"],["type","warning"],["type","button","vdrDropdownItem","",1,"run-updates-button",3,"disabled","click"],[1,"dropdown-divider"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle","image-col"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"left","align-middle"],["class","sku",4,"ngIf"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",1,"edit-button",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"sku"]],template:function(e,t){1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left",0),k.TgZ(2,"div",1),k.TgZ(3,"vdr-product-search-input",2,3),k.NdJ("searchTermChange",function(e){return t.setSearchTerm(e)})("facetValueChange",function(e){return t.setFacetValueIds(e)}),k.ALo(5,"async"),k.qZA(),k.TgZ(6,"vdr-dropdown",4),k.TgZ(7,"button",5),k.ALo(8,"translate"),k._UZ(9,"clr-icon",6),k.YNc(10,ko,1,0,"vdr-status-badge",7),k.qZA(),k.TgZ(11,"vdr-dropdown-menu",8),k.TgZ(12,"h4",9),k._uU(13),k.ALo(14,"translate"),k.qZA(),k.YNc(15,Oo,7,10,"ng-container",10),k.TgZ(16,"button",11),k.NdJ("click",function(){return t.rebuildSearchIndex()}),k.ALo(17,"hasPermission"),k._uU(18),k.ALo(19,"translate"),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.TgZ(20,"div",12),k.TgZ(21,"clr-toggle-wrapper",13),k.TgZ(22,"input",14),k.NdJ("ngModelChange",function(e){return t.groupByProduct=e})("ngModelChange",function(){return t.refresh()}),k.qZA(),k.TgZ(23,"label"),k._uU(24),k.ALo(25,"translate"),k.qZA(),k.qZA(),k.TgZ(26,"vdr-language-selector",15),k.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),k.ALo(27,"async"),k.ALo(28,"async"),k.qZA(),k.qZA(),k.qZA(),k.TgZ(29,"vdr-ab-right"),k._UZ(30,"vdr-action-bar-items",16),k.YNc(31,qo,4,5,"a",17),k.qZA(),k.qZA(),k.TgZ(32,"vdr-data-table",18),k.NdJ("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),k.ALo(33,"async"),k.ALo(34,"async"),k.ALo(35,"async"),k.ALo(36,"async"),k._UZ(37,"vdr-bulk-action-menu",19),k._UZ(38,"vdr-dt-column"),k._UZ(39,"vdr-dt-column"),k._UZ(40,"vdr-dt-column"),k._UZ(41,"vdr-dt-column"),k.YNc(42,Uo,25,29,"ng-template"),k.qZA()),2&e&&(k.xp6(1),k.Q6J("grow",!0),k.xp6(2),k.Q6J("facetValueResults",k.lcZ(5,20,t.facetValues$)),k.xp6(4),k.Q6J("title",k.lcZ(8,22,t.pendingSearchIndexUpdates?"catalog.pending-search-index-updates":"catalog.search-index-controls")),k.xp6(3),k.Q6J("ngIf",t.pendingSearchIndexUpdates),k.xp6(3),k.Oqu(k.lcZ(14,24,"catalog.search-index-controls")),k.xp6(2),k.Q6J("ngIf",t.pendingSearchIndexUpdates),k.xp6(1),k.Q6J("disabled",!k.lcZ(17,26,k.DdM(44,Po))),k.xp6(2),k.hij(" ",k.lcZ(19,28,"catalog.rebuild-search-index")," "),k.xp6(4),k.Q6J("ngModel",t.groupByProduct),k.xp6(2),k.hij(" ",k.lcZ(25,30,"catalog.group-by-product")," "),k.xp6(2),k.Q6J("availableLanguageCodes",k.lcZ(27,32,t.availableLanguages$))("currentLanguageCode",k.lcZ(28,34,t.contentLanguage$)),k.xp6(5),k.Q6J("vdrIfPermissions",k.DdM(45,Vo)),k.xp6(1),k.Q6J("items",k.lcZ(33,36,t.items$))("itemsPerPage",k.lcZ(34,38,t.itemsPerPage$))("totalItems",k.lcZ(35,40,t.totalItems$))("currentPage",k.lcZ(36,42,t.currentPage$))("selectionManager",t.selectionManager),k.xp6(5),k.Q6J("hostComponent",t)("selectionManager",t.selectionManager))},directives:[P.Kk,P.BN,Co.j,fe.J,me.U,ce.qvL,I.O5,ve.N,he.H,ce.PEh,le.y,A.Wl,ce.KKC,A.JJ,A.On,ce.MgK,ae.S,P.mz,O.W,F.H,Ue.Q,vt.c,Ht.E,xo.e,v.yS,Ve.v,Bt.Y],pipes:[I.Ov,w.X$,B.j,Ze.M],styles:[".image-col[_ngcontent-%COMP%]{width:70px}.image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}vdr-product-search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width: 768px){vdr-product-search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.search-index-button[_ngcontent-%COMP%]{position:relative}.search-index-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{right:0;top:0}.run-updates-button[_ngcontent-%COMP%]{position:relative}.run-updates-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{left:10px;top:10px}.edit-button[_ngcontent-%COMP%]{margin-right:24px}.sku[_ngcontent-%COMP%]{color:var(--color-text-300)}"]});var Yo=function(e){m(n,e);var t=h(n);function n(e,o,i,a,r,c,l,s){var u;return p(this,n),(u=t.call(this,e,o,i,a)).route=e,u.router=o,u.serverConfigService=i,u.dataService=a,u.productDetailService=r,u.formBuilder=c,u.changeDetector=l,u.notificationService=s,u.autoUpdateVariantNames=!0,u.updatePermission=[Z.y3$.UpdateCatalog,Z.y3$.UpdateProduct],u.optionGroupCustomFields=u.getCustomFieldConfig("ProductOptionGroup"),u.optionCustomFields=u.getCustomFieldConfig("ProductOption"),u}return f(n,[{key:"ngOnInit",value:function(){this.optionGroups$=this.route.snapshot.data.entity.pipe((0,x.U)(function(e){return e.optionGroups})),this.detailForm=new A.cw({optionGroups:new A.Oe([])}),u(y(n.prototype),"init",this).call(this)}},{key:"getOptionGroups",value:function(){return this.detailForm.get("optionGroups").controls}},{key:"getOptions",value:function(e){return e.get("options").controls}},{key:"save",value:function(){var e=this;if(!this.detailForm.invalid&&!this.detailForm.pristine){var t=this.dataService.product.getProduct(this.id).mapSingle(function(e){return e.product});(0,U.aj)(this.entity$,this.languageCode$,t).pipe((0,oe.q)(1),(0,ie.zg)(function(t){var n,o,i,a,l,s,u=c(t,3),d=u[0].optionGroups,p=u[1],g=u[2],f=[],m=r(e.getOptionGroups());try{var v=function(){var t=s.value;if((null===(n=t.get("name"))||void 0===n?void 0:n.dirty)||(null===(o=t.get("code"))||void 0===o?void 0:o.dirty)){var c=d.find(function(e){return e.id===t.value.id});if(c){var u=e.getUpdatedOptionGroup(c,t,p);f.push(e.dataService.product.updateProductOptionGroup(u))}}var m,v=r(e.getOptions(t));try{var h=function(){var n=m.value;if((null===(i=n.get("name"))||void 0===i?void 0:i.dirty)||(null===(a=n.get("code"))||void 0===a?void 0:a.dirty)){var o=null===(l=d.find(function(e){return e.id===t.value.id}))||void 0===l?void 0:l.options.find(function(e){return e.id===n.value.id});if(o){var r=e.getUpdatedOption(o,n,p);f.push(e.productDetailService.updateProductOption(Object.assign(Object.assign({},r),{autoUpdate:e.autoUpdateVariantNames}),g,p))}}};for(v.s();!(m=v.n()).done;)h()}catch(Z){v.e(Z)}finally{v.f()}};for(m.s();!(s=m.n()).done;)v()}catch(h){m.e(h)}finally{m.f()}return(0,Ot.D)(f)})).subscribe(function(){e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.notificationService.success((0,C.J)("common.notify-update-success"),{entity:"ProductOptionGroup"})},function(t){e.notificationService.error((0,C.J)("common.notify-update-error"),{entity:"ProductOptionGroup"})})}}},{key:"getUpdatedOptionGroup",value:function(e,t,n){return(0,Z.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.optionGroupCustomFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}})}},{key:"getUpdatedOption",value:function(e,t,n){return(0,Z.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.optionGroupCustomFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}})}},{key:"setFormValues",value:function(e,t){var n,o=new A.Oe([]),i=r(e.optionGroups);try{for(i.s();!(n=i.n()).done;){var a,c=n.value,l=(0,Z.ZIM)(c,t),s={id:c.id,createdAt:c.createdAt,updatedAt:c.updatedAt,code:c.code,name:l?l.name:""},u=new A.Oe([]),d=r(c.options);try{for(d.s();!(a=d.n()).done;){var p=a.value,g=(0,Z.ZIM)(p,t),f=this.formBuilder.group({id:p.id,createdAt:p.createdAt,updatedAt:p.updatedAt,code:p.code,name:g?g.name:""});u.push(f)}}catch(v){d.e(v)}finally{d.f()}var m=this.formBuilder.group(s);m.addControl("options",u),o.push(m)}}catch(v){i.e(v)}finally{i.f()}this.detailForm.setControl("optionGroups",o)}}]),n}(Z.UT_);Yo.\u0275fac=function(e){return new(e||Yo)(k.Y36(v.gz),k.Y36(v.F0),k.Y36(Z.iHG),k.Y36(Z.DoR),k.Y36(Yn),k.Y36(A.qu),k.Y36(k.sBO),k.Y36(Z.gqp))},Yo.\u0275cmp=k.Xpm({type:Yo,selectors:[["vdr-product-options-editor"]],features:[k.qOj],decls:16,vars:14,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"flex","center"],[1,"mr2"],["clrCheckbox","","type","checkbox","id","auto-update",3,"ngModel","ngModelChange"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"form",3,"formGroup"],["formGroupName","optionGroups",1,"clr-row"],["class","clr-col-12 clr-col-xl-6",4,"ngFor","ngForOf"],[1,"clr-col-12","clr-col-xl-6"],[1,"card",3,"formArrayName"],[1,"card-header","option-group-header"],[3,"entity"],[1,"ml2"],[1,"card-block"],["for","name",3,"label"],["type","text","formControlName","name",3,"id","readonly"],["for","code",3,"label"],["type","text","formControlName","code",3,"id","readonly"],["formGroupName","options",1,"facet-values-list","table","mt2","mb4"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly"],["type","text","formControlName","code"]],template:function(e,t){1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-left"),k.TgZ(2,"vdr-language-selector",0),k.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),k.ALo(3,"async"),k.ALo(4,"async"),k.qZA(),k.qZA(),k.TgZ(5,"vdr-ab-right"),k.TgZ(6,"div",1),k.TgZ(7,"div",2),k.TgZ(8,"clr-checkbox-wrapper"),k.TgZ(9,"input",3),k.NdJ("ngModelChange",function(e){return t.autoUpdateVariantNames=e}),k.qZA(),k.TgZ(10,"label"),k._uU(11),k.ALo(12,"translate"),k.qZA(),k.qZA(),k.qZA(),k.YNc(13,So,3,4,"button",4),k.qZA(),k.qZA(),k.qZA(),k.YNc(14,Qo,3,2,"form",5),k.ALo(15,"async")),2&e&&(k.xp6(2),k.Q6J("availableLanguageCodes",k.lcZ(3,6,t.availableLanguages$))("currentLanguageCode",k.lcZ(4,8,t.languageCode$)),k.xp6(7),k.Q6J("ngModel",t.autoUpdateVariantNames),k.xp6(2),k.Oqu(k.lcZ(12,10,"catalog.auto-update-product-variant-name")),k.xp6(2),k.Q6J("vdrIfPermissions",t.updatePermission),k.xp6(1),k.Q6J("ngIf",k.lcZ(15,12,t.optionGroups$)))},directives:[P.Kk,P.BN,ae.S,P.mz,ce.PEh,le.y,A.Wl,ce.KKC,A.JJ,A.On,ce.MgK,F.H,I.O5,A._Y,A.JL,A.sg,A.x0,I.sg,A.CE,T.V,re.h,A.Fj,A.u],pipes:[I.Ov,w.X$,B.j],styles:[".option-group-header[_ngcontent-%COMP%]{display:flex;align-items:baseline}"],changeDetection:0});var jo=g(65762),Eo=g(51253);function Go(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.hij(" ",k.lcZ(1,1,"catalog.confirm-deletion-of-unused-variants-title"),"\n")}function Ho(e,t){if(1&e&&(k.TgZ(0,"li"),k._uU(1),k.qZA()),2&e){var n=t.$implicit;k.xp6(1),k.AsE("",n.name," (",n.sku,")")}}function Bo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",3),k.NdJ("click",function(){return k.CHM(n),k.oxw().cancel()}),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.TgZ(3,"button",4),k.NdJ("click",function(){return k.CHM(n),k.oxw().confirm()}),k._uU(4),k.ALo(5,"translate"),k.qZA()}2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,2,"common.cancel")),k.xp6(3),k.hij(" ",k.lcZ(5,4,"common.confirm")," "))}var Ro=function(){function e(){p(this,e),this.variants=[]}return f(e,[{key:"confirm",value:function(){this.resolveWith(!0)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();Ro.\u0275fac=function(e){return new(e||Ro)},Ro.\u0275cmp=k.Xpm({type:Ro,selectors:[["vdr-confirm-variant-deletion-dialog"]],decls:6,vars:4,consts:[["vdrDialogTitle",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(k.YNc(0,Go,2,3,"ng-template",0),k._uU(1),k.ALo(2,"translate"),k.TgZ(3,"ul"),k.YNc(4,Ho,2,2,"li",1),k.qZA(),k.YNc(5,Bo,6,6,"ng-template",2)),2&e&&(k.xp6(1),k.hij("\n",k.lcZ(2,2,"catalog.confirm-deletion-of-unused-variants-body"),"\n"),k.xp6(3),k.Q6J("ngForOf",t.variants))},directives:[hn.q,I.sg,bn.n],pipes:[w.X$],styles:[""],changeDetection:0});var zo=["textArea"],Ko=["editNameInput"];function Wo(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-chip",6),k.NdJ("iconClick",function(){var e=k.CHM(n).$implicit;return k.oxw(2).removeOption(e)}),k.TgZ(1,"span",7),k.TgZ(2,"input",8,9),k.NdJ("blur",function(e){var t=k.CHM(n).index;return k.oxw(2).updateOption(t,e)})("click",function(e){return e.cancelBubble=!0}),k.qZA(),k.qZA(),k.TgZ(4,"span",10),k.NdJ("click",function(e){var t=k.CHM(n).index;return k.oxw(2).editName(t,e)}),k._uU(5),k.qZA(),k.qZA()}if(2&e){var o=t.$implicit,i=t.last,a=t.index,r=k.oxw(2);k.ekj("selected",i&&r.lastSelected)("locked",o.locked),k.Q6J("icon",o.locked?"lock":"times")("colorFrom",r.groupName),k.xp6(1),k.Q6J("hidden",r.editingIndex!==a),k.xp6(1),k.Q6J("ngModel",o.name),k.xp6(2),k.ekj("editable",!o.locked&&!o.id),k.Q6J("hidden",r.editingIndex===a),k.xp6(1),k.Oqu(o.name)}}function Xo(e,t){if(1&e&&(k.TgZ(0,"div",4),k.YNc(1,Wo,6,12,"vdr-chip",5),k.qZA()),2&e){var n=k.oxw();k.xp6(1),k.Q6J("ngForOf",n.optionValues)}}var ei={provide:A.JU,useExisting:(0,k.Gpc)(function(){return ti}),multi:!0},ti=function(){function e(t){p(this,e),this.changeDetector=t,this.groupName="",this.add=new k.vpe,this.remove=new k.vpe,this.edit=new k.vpe,this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1,this.editingIndex=-1}return f(e,[{key:"optionValues",get:function(){var e,t;return null!==(t=null!==(e=this.formValue)&&void 0!==e?e:this.options)&&void 0!==t?t:[]}},{key:"registerOnChange",value:function(e){this.onChangeFn=e}},{key:"registerOnTouched",value:function(e){this.onTouchFn=e}},{key:"setDisabledState",value:function(e){this.disabled=e,this.changeDetector.markForCheck()}},{key:"writeValue",value:function(e){this.formValue=e||[]}},{key:"focus",value:function(){this.textArea.nativeElement.focus()}},{key:"editName",value:function(e,t){var n,o=this.optionValues[e];if(!o.locked&&!o.id){t.cancelBubble=!0,this.editingIndex=e;var i=null===(n=this.nameInputs.get(e))||void 0===n?void 0:n.nativeElement;setTimeout(function(){return null==i?void 0:i.focus()})}}},{key:"updateOption",value:function(e,t){var n=this.optionValues[e],o=t.target.value;n&&(o&&(n.name=o,this.edit.emit({index:e,option:n})),this.editingIndex=-1)}},{key:"removeOption",value:function(e){var t;e.locked||(this.formValue?(this.formValue=null===(t=this.formValue)||void 0===t?void 0:t.filter(function(t){return t.name!==e.name}),this.onChangeFn(this.formValue)):this.remove.emit(e))}},{key:"handleKey",value:function(e){switch(e.key){case",":case"Enter":this.addOptionValue(),e.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}},{key:"handleBlur",value:function(){this.isFocussed=!1,this.addOptionValue()}},{key:"addOptionValue",value:function(){var e=this,t=this.parseInputIntoOptions(this.input).filter(function(t){var n,o=null!==(n=e.options)&&void 0!==n?n:e.formValue;return!(null==o?void 0:o.find(function(e){return(null==e?void 0:e.name)===t.name}))});if(!this.formValue&&this.options){var n,o=r(t);try{for(o.s();!(n=o.n()).done;){var i=n.value;this.add.emit(i)}}catch(c){o.e(c)}finally{o.f()}}else this.formValue=(0,ge.T)([].concat(a(this.formValue),a(t))),this.onChangeFn(this.formValue);this.input=""}},{key:"parseInputIntoOptions",value:function(e){return e.split(/[,\n]/).map(function(e){return e.trim()}).filter(function(e){return""!==e}).map(function(e){return{name:e,locked:!1}})}},{key:"removeLastOption",value:function(){if(this.optionValues.length){var e=this.optionValues[this.optionValues.length-1];this.removeOption(e)}}}]),e}();ti.\u0275fac=function(e){return new(e||ti)(k.Y36(k.sBO))},ti.\u0275cmp=k.Xpm({type:ti,selectors:[["vdr-option-value-input"]],viewQuery:function(e,t){var n;(1&e&&(k.Gf(zo,7),k.Gf(Ko,5,k.SBq)),2&e)&&(k.iGM(n=k.CRH())&&(t.textArea=n.first),k.iGM(n=k.CRH())&&(t.nameInputs=n))},inputs:{groupName:"groupName",options:"options",disabled:"disabled"},outputs:{add:"add",remove:"remove",edit:"edit"},features:[k._Bn([ei])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"],[3,"hidden"],["type","text",3,"ngModel","blur","click"],["editNameInput",""],[1,"option-name",3,"hidden","click"]],template:function(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",0),k.NdJ("click",function(){return k.CHM(n),k.MAs(3).focus()}),k.YNc(1,Xo,2,1,"div",1),k.TgZ(2,"textarea",2,3),k.NdJ("keyup",function(e){return t.handleKey(e)})("focus",function(){return t.isFocussed=!0})("blur",function(){return t.handleBlur()})("ngModelChange",function(e){return t.input=e}),k.qZA(),k.qZA()}2&e&&(k.ekj("focus",t.isFocussed),k.xp6(1),k.Q6J("ngIf",0<t.optionValues.length),k.xp6(1),k.Q6J("ngModel",t.input)("disabled",t.disabled))},directives:[I.O5,le.y,A.Fj,A.JJ,A.On,I.sg,Bt.Y],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}vdr-chip[_ngcontent-%COMP%]   .option-name.editable[_ngcontent-%COMP%]:hover{outline:1px solid var(--color-component-bg-300);outline-offset:1px;border-radius:1px}vdr-chip[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:0!important;margin-top:-2px;margin-bottom:-2px}"]});var ni=g(87283);function oi(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",7),k.TgZ(1,"div",8),k.TgZ(2,"label"),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.TgZ(5,"input",9),k.NdJ("ngModelChange",function(e){return k.CHM(n).$implicit.name=e}),k.qZA(),k.qZA(),k.TgZ(6,"div",10),k.TgZ(7,"label"),k._uU(8),k.ALo(9,"translate"),k.qZA(),k.TgZ(10,"vdr-option-value-input",11,12),k.NdJ("add",function(e){var t=k.CHM(n).index;return k.oxw().addOption(t,e.name)})("remove",function(e){var t=k.CHM(n).index;return k.oxw().removeOption(t,e)}),k.qZA(),k.qZA(),k.TgZ(12,"div"),k.TgZ(13,"button",13),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw().removeOptionGroup(e)}),k._UZ(14,"clr-icon",14),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.$implicit;k.xp6(3),k.Oqu(k.lcZ(4,8,"catalog.option")),k.xp6(2),k.Q6J("ngModel",o.name)("readonly",!o.isNew),k.xp6(3),k.Oqu(k.lcZ(9,10,"catalog.option-values")),k.xp6(2),k.Q6J("options",o.values)("groupName",o.name)("disabled",""===o.name),k.xp6(3),k.Q6J("disabled",o.locked)}}function ii(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"clr-checkbox-wrapper"),k.TgZ(1,"input",18),k.NdJ("ngModelChange",function(e){return k.CHM(n),k.oxw().$implicit.enabled=e})("ngModelChange",function(){return k.CHM(n),k.oxw(2).formValueChanged=!0}),k.qZA(),k.TgZ(2,"label"),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.qZA()}if(2&e){var o=k.oxw().$implicit;k.xp6(1),k.Q6J("ngModel",o.enabled),k.xp6(2),k.Oqu(k.lcZ(4,2,"common.create"))}}function ai(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"clr-input-container"),k.TgZ(1,"input",19),k.NdJ("ngModelChange",function(e){return k.CHM(n),k.oxw().$implicit.sku=e})("ngModelChange",function(){k.CHM(n);var e=k.oxw().$implicit;return k.oxw().onFormChanged(e)}),k.ALo(2,"translate"),k.qZA(),k.qZA()}if(2&e){var o=k.oxw().$implicit;k.xp6(1),k.Q6J("ngModel",o.sku)("placeholder",k.lcZ(2,2,"catalog.sku"))}}function ri(e,t){if(1&e&&(k.TgZ(0,"span"),k._uU(1),k.qZA()),2&e){var n=k.oxw().$implicit;k.xp6(1),k.Oqu(n.sku)}}function ci(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"clr-input-container"),k.TgZ(1,"vdr-currency-input",20),k.NdJ("ngModelChange",function(e){return k.CHM(n),k.oxw().$implicit.price=e})("ngModelChange",function(){k.CHM(n);var e=k.oxw().$implicit;return k.oxw().onFormChanged(e)}),k.qZA(),k.qZA()}if(2&e){var o=k.oxw().$implicit,i=k.oxw();k.xp6(1),k.Q6J("ngModel",o.price)("currencyCode",i.currencyCode)}}function li(e,t){if(1&e&&(k.TgZ(0,"span"),k._uU(1),k.ALo(2,"localeCurrency"),k.qZA()),2&e){var n=k.oxw().$implicit,o=k.oxw();k.xp6(1),k.Oqu(k.xi3(2,1,n.price,o.currencyCode))}}function si(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"clr-input-container"),k.TgZ(1,"input",21),k.NdJ("ngModelChange",function(e){return k.CHM(n),k.oxw().$implicit.stock=e})("ngModelChange",function(){k.CHM(n);var e=k.oxw().$implicit;return k.oxw().onFormChanged(e)}),k.qZA(),k.qZA()}if(2&e){var o=k.oxw().$implicit;k.xp6(1),k.Q6J("ngModel",o.stock)}}function ui(e,t){if(1&e&&(k.TgZ(0,"span"),k._uU(1),k.qZA()),2&e){var n=k.oxw().$implicit;k.xp6(1),k.Oqu(n.stock)}}function di(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-dropdown"),k.TgZ(1,"button",22),k._UZ(2,"clr-icon",23),k.qZA(),k.TgZ(3,"vdr-dropdown-menu",24),k.TgZ(4,"button",25),k.NdJ("click",function(){var e=k.CHM(n).ngIf,t=k.oxw().$implicit;return k.oxw().deleteVariant(e,t.options)}),k._UZ(5,"clr-icon",26),k._uU(6),k.ALo(7,"translate"),k.qZA(),k.qZA(),k.qZA()}2&e&&(k.xp6(6),k.hij(" ",k.lcZ(7,1,"common.delete")," "))}function pi(e,t){if(1&e&&(k.TgZ(0,"tr"),k.TgZ(1,"td",15),k.YNc(2,ii,5,4,"clr-checkbox-wrapper",16),k.qZA(),k.TgZ(3,"td"),k._uU(4),k.ALo(5,"translate"),k.qZA(),k.TgZ(6,"td"),k.TgZ(7,"div",17),k.YNc(8,ai,3,4,"clr-input-container",16),k.YNc(9,ri,2,1,"span",16),k.qZA(),k.qZA(),k.TgZ(10,"td"),k.TgZ(11,"div",17),k.YNc(12,ci,2,2,"clr-input-container",16),k.YNc(13,li,3,4,"span",16),k.qZA(),k.qZA(),k.TgZ(14,"td"),k.TgZ(15,"div",17),k.YNc(16,si,2,1,"clr-input-container",16),k.YNc(17,ui,2,1,"span",16),k.qZA(),k.qZA(),k.TgZ(18,"td"),k.YNc(19,di,8,3,"vdr-dropdown",16),k.qZA(),k.qZA()),2&e){var n=t.$implicit,o=k.oxw();k.ekj("disabled",!n.enabled||n.existing),k.xp6(2),k.Q6J("ngIf",!n.existing),k.xp6(2),k.hij(" ",k.lcZ(5,11,o.getVariantName(n))," "),k.xp6(4),k.Q6J("ngIf",!n.existing),k.xp6(1),k.Q6J("ngIf",n.existing),k.xp6(3),k.Q6J("ngIf",!n.existing),k.xp6(1),k.Q6J("ngIf",n.existing),k.xp6(3),k.Q6J("ngIf",!n.existing),k.xp6(1),k.Q6J("ngIf",n.existing),k.xp6(2),k.Q6J("ngIf",n.productVariantId)}}var gi=function(e){return{count:e}},fi=function e(t){p(this,e);for(var n=0,o=Object.keys(t);n<o.length;n++){var i=o[n];this[i]=t[i]}},mi=function(){function e(t,n,o,i,a){p(this,e),this.route=t,this.dataService=n,this.productDetailService=o,this.notificationService=i,this.modalService=a,this.formValueChanged=!1,this.optionsChanged=!1,this.generatedVariants=[]}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||(0,Z.kAh)(),this.dataService.settings.getActiveChannel().single$.subscribe(function(t){e.currencyCode=t.activeChannel.currencyCode})}},{key:"onFormChanged",value:function(e){this.formValueChanged=!0,e.enabled=!0}},{key:"canDeactivate",value:function(){return!this.formValueChanged}},{key:"getVariantsToAdd",value:function(){return this.generatedVariants.filter(function(e){return!e.existing&&e.enabled})}},{key:"getVariantName",value:function(e){return 0===e.options.length?(0,C.J)("catalog.default-variant"):e.options.map(function(e){return e.name}).join(" ")}},{key:"addOptionGroup",value:function(){this.optionGroups.push({isNew:!0,locked:!1,name:"",values:[]}),this.optionsChanged=!0}},{key:"removeOptionGroup",value:function(e){var t=this,n=e.id;e.isNew?(this.optionGroups=this.optionGroups.filter(function(t){return t!==e}),this.generateVariants(),this.optionsChanged=!0):n&&this.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-product-option-group"),translationVars:{name:e.name},buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(e){return e?t.dataService.product.removeOptionGroupFromProduct({optionGroupId:n,productId:t.product.id}):V.E})).subscribe(function(e){var n,o=e.removeOptionGroupFromProduct;"Product"===o.__typename?(t.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"ProductOptionGroup"}),t.initOptionsAndVariants(),t.optionsChanged=!0):"ProductOptionInUseError"===o.__typename&&t.notificationService.error(null!==(n=o.message)&&void 0!==n?n:"")})}},{key:"addOption",value:function(e,t){var n=this.optionGroups[e];n&&(n.values.push({name:t,locked:!1}),this.generateVariants(),this.optionsChanged=!0)}},{key:"removeOption",value:function(e,t){var n=this,o=t.id,i=t.name,a=this.optionGroups[e];a&&(o?this.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-product-option"),translationVars:{name:i},buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(e){return e?n.dataService.product.deleteProductOption(o):V.E})).subscribe(function(e){var t,i=e.deleteProductOption;i.result===Z.PcR.DELETED?(n.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"ProductOption"}),a.values=a.values.filter(function(e){return e.id!==o}),n.generateVariants(),n.optionsChanged=!0):n.notificationService.error(null!==(t=i.message)&&void 0!==t?t:"")}):(a.values=a.values.filter(function(e){return e.name!==i}),this.generateVariants()))}},{key:"generateVariants",value:function(){var e=this,t=this.optionGroups.map(function(e){return e.values}),n=this.generatedVariants,o=function(t,o,i,a){var r,c,l,s,u,d,p=e.getVariantPrototype(o,n);return new fi({enabled:!0,existing:!!i,productVariantId:null==i?void 0:i.id,isDefault:t,options:o,price:null!==(c=null!==(r=null==i?void 0:i.price)&&void 0!==r?r:null==a?void 0:a.price)&&void 0!==c?c:p.price,sku:null!==(s=null!==(l=null==i?void 0:i.sku)&&void 0!==l?l:null==a?void 0:a.sku)&&void 0!==s?s:p.sku,stock:null!==(d=null!==(u=null==i?void 0:i.stockOnHand)&&void 0!==u?u:null==a?void 0:a.stockOnHand)&&void 0!==d?d:p.stock})};this.generatedVariants=t.length?(0,Tt.generateAllCombinations)(t).map(function(t){var n=e.product.variants.find(function(n){return e.optionsAreEqual(n.options,t)}),i=e.product.variants.find(function(n){return e.optionsAreSubset(n.options,t)});return o(!1,t,n,i)}):[o(!0,[],this.product.variants[0])]}},{key:"getVariantPrototype",value:function(e,t){return t.filter(function(t){return e.map(function(e){return e.name}).filter(function(e){return t.options.map(function(e){return e.name}).includes(e)})}).length?(0,jo.e)(t[0],["sku","price","stock"]):{sku:"",price:0,stock:0}}},{key:"deleteVariant",value:function(e,t){var n=this;this.modalService.dialog({title:(0,C.J)("catalog.confirm-delete-product-variant"),translationVars:{name:t.map(function(e){return e.name}).join(" ")},buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(t){return t?n.productDetailService.deleteProductVariant(e,n.product.id):V.E}),(0,D.w)(function(){return n.reFetchProduct(null)})).subscribe(function(){n.notificationService.success((0,C.J)("common.notify-delete-success"),{entity:"ProductVariant"}),n.initOptionsAndVariants()},function(e){n.notificationService.error((0,C.J)("common.notify-delete-error"),{entity:"ProductVariant"})})}},{key:"save",value:function(){var e=this;this.optionGroups=this.optionGroups.filter(function(e){return e.values.length});var t=this.optionGroups.filter(function(e){return e.isNew}).map(function(e){return{name:e.name,values:[]}});this.checkUniqueSkus().pipe((0,ie.zg)(function(){return e.confirmDeletionOfObsoleteVariants()}),(0,ie.zg)(function(){return e.productDetailService.createProductOptionGroups(t,e.languageCode)}),(0,ie.zg)(function(t){return e.addOptionGroupsToProduct(t)}),(0,ie.zg)(function(t){return e.addNewOptionsToGroups(t)}),(0,ie.zg)(function(t){return e.fetchOptionGroups(t)}),(0,ie.zg)(function(t){return e.createNewProductVariants(t)}),(0,ie.zg)(function(t){return e.deleteObsoleteVariants(t.createProductVariants)}),(0,ie.zg)(function(t){return e.reFetchProduct(t)})).subscribe({next:function(t){e.formValueChanged=!1,e.notificationService.success((0,C.J)("catalog.created-new-variants-success"),{count:t.length}),e.initOptionsAndVariants(),e.optionsChanged=!1}})}},{key:"checkUniqueSkus",value:function(){var e=this,t=this.generatedVariants.filter(function(t,n){return t.enabled&&e.generatedVariants.find(function(e){return e.sku.trim()===t.sku.trim()&&e!==t})});return t.length?this.modalService.dialog({title:(0,C.J)("catalog.duplicate-sku-warning"),body:(0,ge.T)(t.map(function(e){return"".concat(e.sku)})).join(", "),buttons:[{label:(0,C.J)("common.close"),returnValue:!1,type:"primary"}]}).pipe((0,ie.zg)(function(e){return V.E})):(0,te.of)(!0)}},{key:"confirmDeletionOfObsoleteVariants",value:function(){var e=this.getObsoleteVariants();return e.length?this.modalService.fromComponent(Ro,{locals:{variants:e}}).pipe((0,ie.zg)(function(e){return!0===e?(0,te.of)(!0):V.E})):(0,te.of)(!0)}},{key:"getObsoleteVariants",value:function(){var e=this;return this.product.variants.filter(function(t){return!e.generatedVariants.find(function(e){return e.productVariantId===t.id})})}},{key:"hasOnlyDefaultVariant",value:function(e){return 1===e.variants.length&&0===e.optionGroups.length}},{key:"addOptionGroupsToProduct",value:function(e){var t=this;return e.length?(0,Ot.D)(e.map(function(e){return t.dataService.product.addOptionGroupToProduct({productId:t.product.id,optionGroupId:e.id})})).pipe((0,x.U)(function(){return e})):(0,te.of)([])}},{key:"addNewOptionsToGroups",value:function(e){var t=this,n=this.optionGroups.map(function(n){var o=e.find(function(e){return e.name===n.name}),i=o?o.id:n.id;if(!i)throw new Error("Could not get a productOptionGroupId");return n.values.filter(function(e){return!e.locked}).map(function(e){return{productOptionGroupId:i,code:(0,W.U)(e.name,"-"),translations:[{name:e.name,languageCode:t.languageCode}]}})}).reduce(function(e,t){return[].concat(a(e),a(t))},[]),o=[].concat(a(e.map(function(e){return e.id})),a(this.optionGroups.map(function(e){return e.id}).filter(Tt.notNullOrUndefined)));return n.length?(0,Ot.D)(n.map(function(e){return t.dataService.product.addOptionToGroup(e)})).pipe((0,x.U)(function(){return o})):(0,te.of)(o)}},{key:"fetchOptionGroups",value:function(e){var t=this;return(0,Ot.D)(e.map(function(e){return t.dataService.product.getProductOptionGroup(e).mapSingle(function(e){return e.productOptionGroup}).pipe((0,ne.h)(Tt.notNullOrUndefined))})).pipe((0,Eo.d)([]))}},{key:"createNewProductVariants",value:function(e){var t=e.filter(Tt.notNullOrUndefined).map(function(e){return e.options}).reduce(function(e,t){return[].concat(a(e),a(t))},[]),n=this.generatedVariants.filter(function(e){return e.enabled&&!e.existing}).map(function(t){var n=e.map(function(e,n){var o=e.options.find(function(e){return e.name===t.options[n].name});if(o)return o.id;throw new Error("Could not find a matching option for group ".concat(e.name))});return{price:t.price,sku:t.sku,stock:t.stock,optionIds:n}});return this.productDetailService.createProductVariants(this.product,n,t,this.languageCode)}},{key:"deleteObsoleteVariants",value:function(e){var t=this,n=this.getObsoleteVariants();if(n.length){var o=n.map(function(n){return t.dataService.product.deleteProductVariant(n.id).pipe((0,x.U)(function(){return e}))});return Ot.D.apply(void 0,a(o))}return(0,te.of)(e)}},{key:"reFetchProduct",value:function(e){var t=this.route.snapshot.paramMap.get("id");return t?this.dataService.product.getProduct(t).single$.pipe((0,x.U)(function(){return e})):(0,te.of)(e)}},{key:"initOptionsAndVariants",value:function(){var e=this;this.dataService.product.getProductVariantsOptions(this.route.snapshot.paramMap.get("id")).mapSingle(function(e){return e.product}).subscribe(function(t){e.product=t;var n=t.variants.map(function(e){return e.options.map(function(e){return e.id})}).flat(),o=t.variants.map(function(e){return e.options.map(function(e){return e.groupId})}).flat();e.optionGroups=t.optionGroups.map(function(e){return{id:e.id,isNew:!1,name:e.name,locked:o.includes(e.id),values:e.options.map(function(e){return{id:e.id,name:e.name,locked:n.includes(e.id)}})}}),e.generateVariants()})}},{key:"optionsAreEqual",value:function(e,t){return this.toOptionString(e)===this.toOptionString(t)}},{key:"optionsAreSubset",value:function(e,t){return this.toOptionString(t).includes(this.toOptionString(e))}},{key:"toOptionString",value:function(e){return e.map(function(e){return e.name}).sort().join("|")}}]),e}();mi.\u0275fac=function(e){return new(e||mi)(k.Y36(v.gz),k.Y36(Z.DoR),k.Y36(Yn),k.Y36(Z.gqp),k.Y36(Z.Z7U))},mi.\u0275cmp=k.Xpm({type:mi,selectors:[["vdr-product-variants-editor"]],decls:29,vars:24,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"options","groupName","disabled","add","remove"],["optionValueInputComponent",""],[1,"btn","btn-icon","btn-danger-outline","mt5",3,"disabled","click"],["shape","trash"],[1,"left"],[4,"ngIf"],[1,"flex","center"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(e,t){1&e&&(k.TgZ(0,"vdr-action-bar"),k.TgZ(1,"vdr-ab-right"),k.TgZ(2,"button",0),k.NdJ("click",function(){return t.save()}),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.qZA(),k.qZA(),k.YNc(5,oi,15,12,"div",1),k.TgZ(6,"button",2),k.NdJ("click",function(){return t.addOptionGroup()}),k._UZ(7,"clr-icon",3),k._uU(8),k.ALo(9,"translate"),k.qZA(),k.TgZ(10,"div",4),k.TgZ(11,"table",5),k.TgZ(12,"thead"),k.TgZ(13,"tr"),k._UZ(14,"th"),k.TgZ(15,"th"),k._uU(16),k.ALo(17,"translate"),k.qZA(),k.TgZ(18,"th"),k._uU(19),k.ALo(20,"translate"),k.qZA(),k.TgZ(21,"th"),k._uU(22),k.ALo(23,"translate"),k.qZA(),k.TgZ(24,"th"),k._uU(25),k.ALo(26,"translate"),k.qZA(),k._UZ(27,"th"),k.qZA(),k.qZA(),k.YNc(28,pi,20,13,"tr",6),k.qZA(),k.qZA()),2&e&&(k.xp6(2),k.Q6J("disabled",!t.formValueChanged&&!t.optionsChanged||0===t.getVariantsToAdd().length),k.xp6(1),k.hij(" ",k.xi3(4,9,"common.add-new-variants",k.VKq(22,gi,t.getVariantsToAdd().length))," "),k.xp6(2),k.Q6J("ngForOf",t.optionGroups),k.xp6(3),k.hij(" ",k.lcZ(9,12,"catalog.add-option"),"\n"),k.xp6(8),k.Oqu(k.lcZ(17,14,"catalog.variant")),k.xp6(3),k.Oqu(k.lcZ(20,16,"catalog.sku")),k.xp6(3),k.Oqu(k.lcZ(23,18,"catalog.price")),k.xp6(3),k.Oqu(k.lcZ(26,20,"catalog.stock-on-hand")),k.xp6(3),k.Q6J("ngForOf",t.generatedVariants))},directives:[P.Kk,P.mz,I.sg,ce.qvL,ce.MgK,le.y,A.Fj,ce.xRP,A.JJ,A.On,ti,I.O5,ce.PEh,A.Wl,ce.KKC,ce.G55,A.Q7,ni.K,A.qQ,A.wV,fe.J,me.U,ve.N,he.H],pipes:[w.X$,Tn.k],styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});var vi=function(e){m(n,e);var t=h(n);function n(e,o){return p(this,n),t.call(this,e,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:Z.h3s.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},function(e){return o.product.getAsset(e).mapStream(function(e){return e.asset})})}return n}(Z.p_9);vi.\u0275fac=function(e){return new(e||vi)(k.LFG(v.F0),k.LFG(Z.DoR))},vi.\u0275prov=k.Yz7({token:vi,factory:vi.\u0275fac,providedIn:"root"});var hi=function(e){m(n,e);var t=h(n);function n(e,o){return p(this,n),t.call(this,e,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:(0,Z.kAh)(),name:"",slug:"",isPrivate:!1,breadcrumbs:[],description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},function(e){return o.collection.getCollection(e).mapStream(function(e){return e.collection})})}return n}(Z.p_9);hi.\u0275fac=function(e){return new(e||hi)(k.LFG(v.F0),k.LFG(Z.DoR))},hi.\u0275prov=k.Yz7({token:hi,factory:hi.\u0275fac,providedIn:"root"});var Zi=function(e){m(n,e);var t=h(n);function n(e,o){return p(this,n),t.call(this,e,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:(0,Z.kAh)(),name:"",code:"",translations:[],values:[]},function(e){return o.facet.getFacet(e).mapStream(function(e){return e.facet})})}return n}(Z.p_9);Zi.\u0275fac=function(e){return new(e||Zi)(k.LFG(v.F0),k.LFG(Z.DoR))},Zi.\u0275prov=k.Yz7({token:Zi,factory:Zi.\u0275fac,providedIn:"root"});var bi=function(e){m(n,e);var t=h(n);function n(e,o){return p(this,n),t.call(this,o,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:(0,Z.kAh)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variantList:{items:[],totalItems:0},channels:[]},function(t){return e.product.getProduct(t,{take:10}).refetchOnChannelChange().mapStream(function(e){return e.product})})}return n}(Z.p_9);bi.\u0275fac=function(e){return new(e||bi)(k.LFG(Z.DoR),k.LFG(v.F0))},bi.\u0275prov=k.Yz7({token:bi,factory:bi.\u0275fac,providedIn:"root"});var yi=function(e){m(n,e);var t=h(n);function n(e,o){return p(this,n),t.call(this,e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},function(e){return o.product.getProductVariantsOptions(e).mapStream(function(e){return e.product})})}return n}(Z.p_9);yi.\u0275fac=function(e){return new(e||yi)(k.LFG(v.F0),k.LFG(Z.DoR))},yi.\u0275prov=k.Yz7({token:yi,factory:yi.\u0275fac,providedIn:"root"});var Ci=[{path:"products",component:No,data:{breadcrumb:(0,C.J)("breadcrumb.products")}},{path:"products/:id",component:bo,resolve:(0,Z.Po4)(bi),canDeactivate:[Z.TSp],data:{breadcrumb:xi}},{path:"products/:id/manage-variants",component:mi,resolve:(0,Z.Po4)(yi),canDeactivate:[Z.TSp],data:{breadcrumb:Ai}},{path:"products/:id/options",component:Yo,resolve:(0,Z.Po4)(yi),canDeactivate:[Z.TSp],data:{breadcrumb:ki}},{path:"facets",component:sn,data:{breadcrumb:(0,C.J)("breadcrumb.facets")}},{path:"facets/:id",component:Et,resolve:(0,Z.Po4)(Zi),canDeactivate:[Z.TSp],data:{breadcrumb:Pi}},{path:"collections",component:Pt,data:{breadcrumb:(0,C.J)("breadcrumb.collections")}},{path:"collections/:id",component:ft,resolve:(0,Z.Po4)(hi),canDeactivate:[Z.TSp],data:{breadcrumb:Ti}},{path:"assets",component:K,data:{breadcrumb:(0,C.J)("breadcrumb.assets")}},{path:"assets/:id",component:J,resolve:(0,Z.Po4)(vi),data:{breadcrumb:Oi}}];function xi(e,t){return(0,Z.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.products",getName:function(e){return e.name},route:"products"})}function Ai(e,t){return e.entity.pipe((0,x.U)(function(e){return[{label:(0,C.J)("breadcrumb.products"),link:["../","products"]},{label:"".concat(e.name),link:["../","products",t.id,{tab:"variants"}]},{label:(0,C.J)("breadcrumb.manage-variants"),link:["manage-variants"]}]}))}function ki(e,t){return e.entity.pipe((0,x.U)(function(e){return[{label:(0,C.J)("breadcrumb.products"),link:["../","products"]},{label:"".concat(e.name),link:["../","products",t.id,{tab:"variants"}]},{label:(0,C.J)("breadcrumb.product-options"),link:["options"]}]}))}function Pi(e,t){return(0,Z.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.facets",getName:function(e){return e.name},route:"facets"})}function Ti(e,t){return(0,Z.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.collections",getName:function(e){return e.name},route:"collections"})}function Oi(e,t){return(0,Z.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.assets",getName:function(e){return e.name},route:"assets"})}function Fi(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.hij(" ",k.lcZ(1,1,"catalog.assign-to-channel"),"\n")}var qi=function(e){return{channelCode:e}};function Ii(e,t){if(1&e&&(k._uU(0),k.ALo(1,"translate")),2&e){var n=k.oxw(2);k.hij(" ",k.xi3(1,1,"catalog.assign-to-named-channel",k.VKq(4,qi,null==n.selectedChannel?null:n.selectedChannel.code))," ")}}function wi(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.hij(" ",k.lcZ(1,1,"catalog.no-channel-selected")," ")}function Mi(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",4),k.NdJ("click",function(){return k.CHM(n),k.oxw().cancel()}),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.TgZ(3,"button",5),k.NdJ("click",function(){return k.CHM(n),k.oxw().assign()}),k.YNc(4,Ii,2,6,"ng-template",6),k.YNc(5,wi,2,3,"ng-template",null,7,k.W1O),k.qZA()}if(2&e){var o=k.MAs(6),i=k.oxw();k.xp6(1),k.Oqu(k.lcZ(2,4,"common.cancel")),k.xp6(2),k.Q6J("disabled",!i.selectedChannel),k.xp6(1),k.Q6J("ngIf",i.selectedChannel)("ngIfElse",o)}}var _i=function(){function e(t,n){p(this,e),this.dataService=t,this.notificationService=n,this.selectedChannelIdControl=new A.NI}return f(e,[{key:"ngOnInit",value:function(){var e=this,t=this.dataService.client.userStatus().mapSingle(function(e){return e.userStatus.activeChannelId}),n=this.dataService.settings.getChannels().mapSingle(function(e){return e.channels});(0,U.aj)(t,n).subscribe(function(t){var n=c(t,2),o=n[0],i=n[1];e.currentChannel=i.find(function(e){return e.id===o}),e.availableChannels=i}),this.selectedChannelIdControl.valueChanges.subscribe(function(t){e.selectChannel(t)})}},{key:"selectChannel",value:function(e){this.selectedChannel=this.availableChannels.find(function(t){return t.id===e[0]})}},{key:"assign",value:function(){var e=this.selectedChannel;e&&this.resolveWith(e)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();_i.\u0275fac=function(e){return new(e||_i)(k.Y36(Z.DoR),k.Y36(Z.gqp))},_i.\u0275cmp=k.Xpm({type:_i,selectors:[["vdr-assign-to-channel-dialog"]],decls:7,vars:6,consts:[["vdrDialogTitle",""],[1,"mb4"],["clrInput","",3,"multiple","includeDefaultChannel","formControl"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[3,"ngIf","ngIfElse"],["noSelection",""]],template:function(e,t){1&e&&(k.YNc(0,Fi,2,3,"ng-template",0),k.TgZ(1,"clr-input-container",1),k.TgZ(2,"label"),k._uU(3),k.ALo(4,"translate"),k.qZA(),k._UZ(5,"vdr-channel-assignment-control",2),k.qZA(),k.YNc(6,Mi,7,6,"ng-template",3)),2&e&&(k.xp6(3),k.Oqu(k.lcZ(4,4,"common.channel")),k.xp6(2),k.Q6J("multiple",!1)("includeDefaultChannel",!1)("formControl",t.selectedChannelIdControl))},directives:[hn.q,ce.G55,ce.MgK,kn.S,ce.xRP,A.JJ,A.oH,bn.n,I.O5],pipes:[w.X$],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}"],changeDetection:0});var Ji=g(32928),Li=Ji.Ps(e||(e=i(["\n    query GetProductsWithFacetValuesByIds($ids: [String!]!) {\n        products(options: { filter: { id: { in: $ids } } }) {\n            items {\n                id\n                name\n                facetValues {\n                    id\n                    name\n                    code\n                    facet {\n                        id\n                        name\n                        code\n                    }\n                }\n            }\n        }\n    }\n"]))),Ui=Ji.Ps(t||(t=i(["\n    query GetVariantsWithFacetValuesByIds($ids: [String!]!) {\n        productVariants(options: { filter: { id: { in: $ids } } }) {\n            items {\n                id\n                name\n                sku\n                facetValues {\n                    id\n                    name\n                    code\n                    facet {\n                        id\n                        name\n                        code\n                    }\n                }\n            }\n        }\n    }\n"]))),Vi=Ji.Ps(n||(n=i(["\n    mutation UpdateProductsBulk($input: [UpdateProductInput!]!) {\n        updateProducts(input: $input) {\n            id\n            name\n            facetValues {\n                id\n                name\n                code\n            }\n        }\n    }\n"]))),Ni=Ji.Ps(o||(o=i(["\n    mutation UpdateVariantsBulk($input: [UpdateProductVariantInput!]!) {\n        updateProductVariants(input: $input) {\n            id\n            name\n            facetValues {\n                id\n                name\n                code\n            }\n        }\n    }\n"])));function Si(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.hij(" ",k.lcZ(1,1,"catalog.edit-facet-values"),"\n")}function $i(e,t){if(1&e&&(k.TgZ(0,"div",14),k._uU(1),k.qZA()),2&e){var n=k.oxw().$implicit;k.xp6(1),k.Oqu(n.sku)}}function Di(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-facet-value-chip",15),k.NdJ("remove",function(){var e=k.CHM(n).$implicit,t=k.oxw().$implicit;return k.oxw(2).removeFacetValue(t,e.id)}),k.qZA()}if(2&e){var o=t.$implicit;k.Q6J("facetValue",o)}}function Qi(e,t){if(1&e&&(k.TgZ(0,"tr"),k.TgZ(1,"td",10),k.TgZ(2,"div"),k._uU(3),k.qZA(),k.YNc(4,$i,2,1,"div",11),k.qZA(),k.TgZ(5,"td",12),k.YNc(6,Di,1,1,"vdr-facet-value-chip",13),k.qZA(),k.qZA()),2&e){var n=t.$implicit;k.xp6(3),k.Oqu(n.name),k.xp6(1),k.Q6J("ngIf",n.sku),k.xp6(2),k.Q6J("ngForOf",n.facetValues)}}function Yi(e,t){if(1&e&&(k.TgZ(0,"table",8),k.TgZ(1,"tbody"),k.YNc(2,Qi,7,3,"tr",9),k.qZA(),k.qZA()),2&e){var n=k.oxw();k.xp6(2),k.Q6J("ngForOf",n.items)}}function ji(e,t){1&e&&(k.TgZ(0,"div",16),k._UZ(1,"clr-spinner"),k.qZA())}function Ei(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",17),k.NdJ("click",function(){return k.CHM(n),k.oxw().cancel()}),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.TgZ(3,"button",18),k.NdJ("click",function(){return k.CHM(n),k.oxw().addFacetValues()}),k._uU(4),k.ALo(5,"translate"),k.qZA()}if(2&e){var o=k.oxw();k.xp6(1),k.Oqu(k.lcZ(2,3,"common.cancel")),k.xp6(2),k.Q6J("disabled",0===o.selectedValues.length&&!1===o.facetValuesRemoved),k.xp6(1),k.hij(" ",k.lcZ(5,5,"common.update")," ")}}var Gi=function(){function e(t,n){p(this,e),this.dataService=t,this.changeDetectorRef=n,this.mode="product",this.facets=[],this.state="loading",this.selectedValues=[],this.items=[],this.facetValuesRemoved=!1}return f(e,[{key:"ngOnInit",value:function(){var e,t,n=this,o="product"===this.mode?this.dataService.query(Li,{ids:null!==(e=this.ids)&&void 0!==e?e:[]}).mapSingle(function(e){return e.products.items.map(function(e){return Object.assign(Object.assign({},e),{facetValues:a(e.facetValues)})})}):this.dataService.query(Ui,{ids:null!==(t=this.ids)&&void 0!==t?t:[]}).mapSingle(function(e){return e.productVariants.items.map(function(e){return Object.assign(Object.assign({},e),{facetValues:a(e.facetValues)})})});this.subscription=o.subscribe({next:function(e){n.items=e,n.state="ready",n.changeDetectorRef.markForCheck()}})}},{key:"ngOnDestroy",value:function(){var e;null===(e=this.subscription)||void 0===e||e.unsubscribe()}},{key:"cancel",value:function(){this.resolveWith()}},{key:"removeFacetValue",value:function(e,t){e.facetValues=e.facetValues.filter(function(e){return e.id!==t}),this.facetValuesRemoved=!0}},{key:"addFacetValues",value:function(){var e,t,n=this,o=this.selectedValues.map(function(e){return e.id});return this.state="saving",("product"===this.mode?this.dataService.mutate(Vi,{input:null===(e=this.items)||void 0===e?void 0:e.map(function(e){return{id:e.id,facetValueIds:(0,ge.T)([].concat(a(e.facetValues.map(function(e){return e.id})),a(o)))}})}):this.dataService.mutate(Ni,{input:null===(t=this.items)||void 0===t?void 0:t.map(function(e){return{id:e.id,facetValueIds:(0,ge.T)([].concat(a(e.facetValues.map(function(e){return e.id})),a(o)))}})})).subscribe(function(e){n.resolveWith(n.selectedValues)})}}]),e}();Gi.\u0275fac=function(e){return new(e||Gi)(k.Y36(Z.DoR),k.Y36(k.sBO))},Gi.\u0275cmp=k.Xpm({type:Gi,selectors:[["vdr-bulk-add-facet-values-dialog"]],decls:11,vars:6,consts:[["vdrDialogTitle",""],[1,"flex"],[1,"flex","center"],[1,"mr2"],[3,"facets","selectedValuesChange"],["class","table",4,"ngIf","ngIfElse"],["placeholder",""],["vdrDialogButtons",""],[1,"table"],[4,"ngFor","ngForOf"],[1,"left","align-middle"],["class","sku",4,"ngIf"],[1,"left"],[3,"facetValue","remove",4,"ngFor","ngForOf"],[1,"sku"],[3,"facetValue","remove"],[1,"loading"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(k.YNc(0,Si,2,3,"ng-template",0),k.TgZ(1,"div",1),k.TgZ(2,"div",2),k.TgZ(3,"div",3),k._uU(4),k.ALo(5,"translate"),k.qZA(),k.TgZ(6,"vdr-facet-value-selector",4),k.NdJ("selectedValuesChange",function(e){return t.selectedValues=e}),k.qZA(),k.qZA(),k.qZA(),k.YNc(7,Yi,3,1,"table",5),k.YNc(8,ji,2,0,"ng-template",null,6,k.W1O),k.YNc(10,Ei,6,7,"ng-template",7)),2&e){var n=k.MAs(9);k.xp6(4),k.hij(" ",k.lcZ(5,4,"catalog.add-facet-value")," "),k.xp6(2),k.Q6J("facets",t.facets),k.xp6(1),k.Q6J("ngIf","loading"!==t.state)("ngIfElse",n)}},directives:[hn.q,Zn.$,I.O5,bn.n,I.sg,Rt.q,ce.vNO],pipes:[w.X$],styles:[".loading[_ngcontent-%COMP%]{min-height:25vh;display:flex;justify-content:center;align-items:center}.sku[_ngcontent-%COMP%]{color:var(--color-text-300)}"],changeDetection:0});var Hi={location:"collection-list",label:(0,C.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:function(e){return e.includes(Z.y3$.DeleteCollection)||e.includes(Z.y3$.DeleteCatalog)},onClick:function(e){var t=e.injector,n=e.selection,o=e.hostComponent,i=e.clearSelection,a=t.get(Z.Z7U),c=t.get(Z.DoR),l=t.get(Z.gqp);a.dialog({title:(0,C.J)("catalog.confirm-bulk-delete-collections"),translationVars:{count:n.length},buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(e){return e?c.collection.deleteCollections((0,ge.T)(n.map(function(e){return e.id}))):V.E})).subscribe(function(e){var t,n=0,a=[],c=r(e.deleteCollections);try{for(c.s();!(t=c.n()).done;){var s=t.value;s.result===Z.PcR.DELETED?n++:s.message&&a.push(s.message)}}catch(u){c.e(u)}finally{c.f()}0<n&&l.success((0,C.J)("catalog.notify-bulk-delete-collections-success"),{count:n}),0<a.length&&l.error(a.join("\n")),o.refresh(),i()})}},Bi={location:"collection-list",label:(0,C.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:function(e){return e.includes(Z.y3$.UpdateCatalog)||e.includes(Z.y3$.UpdateProduct)},isVisible:function(e){var t=e.injector;return(0,Z.SDV)(t.get(Z.DoR))},onClick:function(e){var t=e.injector,n=e.selection,o=(e.hostComponent,e.clearSelection),i=t.get(Z.Z7U),a=t.get(Z.DoR),r=t.get(Z.gqp);i.fromComponent(_i,{size:"md",locals:{}}).pipe((0,D.w)(function(e){return e?a.collection.assignCollectionsToChannel({collectionIds:n.map(function(e){return e.id}),channelId:e.id}).pipe((0,Ft.h)(e)):V.E})).subscribe(function(e){r.success((0,C.J)("catalog.assign-collections-to-channel-success"),{count:n.length,channelCode:e.code}),o()})}},Ri={location:"collection-list",label:(0,C.J)("catalog.remove-from-channel"),requiresPermission:function(e){return e.includes(Z.y3$.UpdateChannel)||e.includes(Z.y3$.UpdateProduct)},getTranslationVars:function(e){var t=e.injector;return(0,Z.PDO)(t.get(Z.DoR))},icon:"layers",iconClass:"is-warning",isVisible:function(e){var t=e.injector;return(0,Z._Nz)(t.get(Z.DoR))},onClick:function(e){var t=e.injector,n=e.selection,o=e.hostComponent,i=e.clearSelection,a=t.get(Z.Z7U),r=t.get(Z.DoR),c=t.get(Z.gqp),l=r.client.userStatus().mapSingle(function(e){return e.userStatus.activeChannelId});(0,dn.D)((0,Z.PDO)(t.get(Z.DoR))).pipe((0,D.w)(function(e){var t=e.channelCode;return a.dialog({title:(0,C.J)("catalog.remove-from-channel"),translationVars:{channelCode:t},buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.remove"),returnValue:!0}]})}),(0,D.w)(function(e){return e?l.pipe((0,D.w)(function(e){return e?r.collection.removeCollectionsFromChannel({channelId:e,collectionIds:n.map(function(e){return e.id})}):V.E}),(0,Ft.h)(!0)):(0,te.of)(!1)})).subscribe(function(e){e&&(i(),c.success((0,C.J)("catalog.notify-remove-collections-from-channel-success"),{count:n.length}),o.refresh())})}};function zi(e,t){1&e&&k._UZ(0,"clr-icon",32)}function Ki(e,t){1&e&&k._UZ(0,"clr-icon",33)}function Wi(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",29),k.NdJ("click",function(){k.CHM(n);var e=k.oxw().$implicit;return k.oxw().toggleExpanded(e)}),k.YNc(1,zi,1,0,"clr-icon",30),k.YNc(2,Ki,1,0,"clr-icon",31),k.qZA()}if(2&e){var o=k.oxw().$implicit,i=k.oxw();k.Q6J("disabled",i.expandAll),k.xp6(1),k.Q6J("ngIf",!o.expanded&&!i.expandAll),k.xp6(1),k.Q6J("ngIf",o.expanded||i.expandAll)}}function Xi(e,t){1&e&&k._UZ(0,"div",34)}function ea(e,t){1&e&&(k.TgZ(0,"vdr-chip"),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"catalog.private")))}function ta(e,t){1&e&&(k.TgZ(0,"div",35),k._UZ(1,"clr-icon",36),k.qZA())}var na=function(e){return{parentId:e}},oa=function(e){return["./","create",e]};function ia(e,t){if(1&e&&(k.TgZ(0,"a",37),k._UZ(1,"clr-icon",38),k._uU(2),k.ALo(3,"translate"),k.qZA()),2&e){var n=k.oxw().$implicit;k.Q6J("routerLink",k.VKq(6,oa,k.VKq(4,na,n.id))),k.xp6(2),k.hij(" ",k.lcZ(3,2,"catalog.create-new-collection")," ")}}function aa(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",21),k.NdJ("click",function(){var e=k.CHM(n).$implicit,t=k.oxw().$implicit;return k.oxw().move(t,e.id)}),k.ALo(1,"async"),k.TgZ(2,"div",39),k.TgZ(3,"div",40),k._UZ(4,"clr-icon",41),k.qZA(),k.TgZ(5,"div",42),k._uU(6),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.$implicit,i=k.oxw(2);k.Q6J("disabled",!k.lcZ(1,2,i.hasUpdatePermission$)),k.xp6(6),k.hij(" ",o.path," ")}}function ra(e,t){if(1&e&&k._UZ(0,"vdr-collection-tree-node",43),2&e){var n=k.oxw().$implicit,o=k.oxw();k.Q6J("expandAll",o.expandAll)("collectionTree",n)("activeCollectionId",o.activeCollectionId)("selectionManager",o.selectionManager)}}var ca=function(e){return{contents:e}},la=function(e){return["./",e]},sa=function(e){return["/catalog/collections/",e]},ua=function(){return["UpdateCatalog","UpdateCollection"]},da=function(){return["CreateCatalog","CreateCollection"]};function pa(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",3),k.TgZ(1,"div",4),k.TgZ(2,"div"),k.TgZ(3,"input",5),k.NdJ("click",function(e){var t=k.CHM(n).$implicit;return k.oxw().selectionManager.toggleSelection(t,e)}),k.qZA(),k.qZA(),k.TgZ(4,"div",6),k.YNc(5,Wi,3,3,"button",7),k.YNc(6,Xi,1,0,"ng-template",null,8,k.W1O),k._uU(8),k.qZA(),k._UZ(9,"div",9),k.YNc(10,ea,3,3,"vdr-chip",10),k.TgZ(11,"a",11),k._UZ(12,"clr-icon",12),k._uU(13),k.ALo(14,"translate"),k.qZA(),k.TgZ(15,"a",13),k._UZ(16,"clr-icon",14),k._uU(17),k.ALo(18,"translate"),k.qZA(),k.YNc(19,ta,2,0,"div",15),k.TgZ(20,"vdr-dropdown"),k.TgZ(21,"button",16),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw().getMoveListItems(e)}),k._UZ(22,"clr-icon",17),k.qZA(),k.TgZ(23,"vdr-dropdown-menu",18),k.YNc(24,ia,4,8,"a",19),k._UZ(25,"div",20),k.TgZ(26,"button",21),k.NdJ("click",function(){var e=k.CHM(n),t=e.$implicit,o=e.index;return k.oxw().moveUp(t,o)}),k.ALo(27,"async"),k._UZ(28,"clr-icon",22),k._uU(29),k.ALo(30,"translate"),k.qZA(),k.TgZ(31,"button",21),k.NdJ("click",function(){var e=k.CHM(n),t=e.$implicit,o=e.index;return k.oxw().moveDown(t,o)}),k.ALo(32,"async"),k._UZ(33,"clr-icon",23),k._uU(34),k.ALo(35,"translate"),k.qZA(),k.TgZ(36,"h4",24),k._uU(37),k.ALo(38,"translate"),k.qZA(),k.YNc(39,aa,7,4,"button",25),k._UZ(40,"div",20),k.TgZ(41,"button",26),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw().delete(e.id)}),k.ALo(42,"async"),k._UZ(43,"clr-icon",27),k._uU(44),k.ALo(45,"translate"),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.YNc(46,ra,1,4,"vdr-collection-tree-node",28),k.qZA()}if(2&e){var o=t.$implicit,i=t.index,a=k.MAs(7),r=k.oxw();k.ekj("private",o.isPrivate),k.Q6J("cdkDragData",o),k.xp6(1),k.ekj("active",o.id===r.activeCollectionId),k.Q6J("ngClass","depth-"+r.depth),k.xp6(2),k.Q6J("checked",r.selectionManager.isSelected(o)),k.xp6(2),k.Q6J("ngIf",null==o.children?null:o.children.length)("ngIfElse",a),k.xp6(3),k.hij(" ",o.name," "),k.xp6(2),k.Q6J("ngIf",o.isPrivate),k.xp6(1),k.Q6J("routerLink",k.VKq(46,la,k.VKq(44,ca,o.id))),k.xp6(2),k.hij(" ",k.lcZ(14,26,"catalog.view-contents")," "),k.xp6(2),k.Q6J("routerLink",k.VKq(48,sa,o.id)),k.xp6(2),k.hij(" ",k.lcZ(18,28,"common.edit")," "),k.xp6(2),k.Q6J("vdrIfPermissions",k.DdM(50,ua)),k.xp6(5),k.Q6J("vdrIfPermissions",k.DdM(51,da)),k.xp6(2),k.Q6J("disabled",0===i||!k.lcZ(27,30,r.hasUpdatePermission$)),k.xp6(3),k.hij(" ",k.lcZ(30,32,"catalog.move-up")," "),k.xp6(2),k.Q6J("disabled",i===r.collectionTree.children.length-1||!k.lcZ(32,34,r.hasUpdatePermission$)),k.xp6(3),k.hij(" ",k.lcZ(35,36,"catalog.move-down")," "),k.xp6(3),k.Oqu(k.lcZ(38,38,"catalog.move-to")),k.xp6(2),k.Q6J("ngForOf",r.moveListItems),k.xp6(2),k.Q6J("disabled",!k.lcZ(42,40,r.hasDeletePermission$)),k.xp6(3),k.hij(" ",k.lcZ(45,42,"common.delete")," "),k.xp6(2),k.Q6J("ngIf",o.expanded||r.expandAll)}}var ga=function(){function e(t,n,o,i,a,r){p(this,e),this.parent=t,this.root=n,this.dataService=o,this.router=i,this.route=a,this.changeDetectorRef=r,this.depth=0,this.expandAll=!1,this.moveListItems=[],t&&(this.depth=t.depth+1)}return f(e,[{key:"ngOnInit",value:function(){var e,t=this;this.parentName=this.collectionTree.name||"<root>";var n=this.dataService.client.userStatus().mapStream(function(e){return e.userStatus.permissions}).pipe((0,mt.d)(1));this.hasUpdatePermission$=n.pipe((0,x.U)(function(e){return e.includes(Z.y3$.UpdateCatalog)||e.includes(Z.y3$.UpdateCollection)})),this.hasDeletePermission$=n.pipe((0,x.U)(function(e){return e.includes(Z.y3$.DeleteCatalog)||e.includes(Z.y3$.DeleteCollection)})),this.subscription=null===(e=this.selectionManager)||void 0===e?void 0:e.selectionChanges$.subscribe(function(){return t.changeDetectorRef.markForCheck()})}},{key:"ngOnChanges",value:function(e){var t=e.expandAll;t&&!0===t.previousValue&&!1===t.currentValue&&this.collectionTree.children.forEach(function(e){return e.expanded=!1})}},{key:"ngOnDestroy",value:function(){var e;null===(e=this.subscription)||void 0===e||e.unsubscribe()}},{key:"trackByFn",value:function(e,t){return t.id}},{key:"toggleExpanded",value:function(e){var t,n;e.expanded=!e.expanded;var o=null!==(n=null===(t=this.route.snapshot.queryParamMap.get("expanded"))||void 0===t?void 0:t.split(","))&&void 0!==n?n:[];e.expanded?o.push(e.id):o=o.filter(function(t){return t!==e.id}),this.router.navigate(["./"],{queryParams:{expanded:o.filter(function(e){return!!e}).join(",")},queryParamsHandling:"merge",relativeTo:this.route})}},{key:"getMoveListItems",value:function(e){this.moveListItems=this.root.getMoveListItems(e)}},{key:"move",value:function(e,t){this.root.onMove({index:0,parentId:t,collectionId:e.id})}},{key:"moveUp",value:function(e,t){!e.parent||this.root.onMove({index:t-1,parentId:e.parent.id,collectionId:e.id})}},{key:"moveDown",value:function(e,t){!e.parent||this.root.onMove({index:t+1,parentId:e.parent.id,collectionId:e.id})}},{key:"drop",value:function(e){(0,pe.bA)(this.collectionTree.children,e.previousIndex,e.currentIndex),this.root.onDrop(e)}},{key:"delete",value:function(e){this.root.onDelete(e)}}]),e}();ga.\u0275fac=function(e){return new(e||ga)(k.Y36(ga,12),k.Y36(bt),k.Y36(Z.DoR),k.Y36(v.F0),k.Y36(v.gz),k.Y36(k.sBO))},ga.\u0275cmp=k.Xpm({type:ga,selectors:[["vdr-collection-tree-node"]],inputs:{collectionTree:"collectionTree",activeCollectionId:"activeCollectionId",expandAll:"expandAll",selectionManager:"selectionManager"},features:[k.TTD],decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],["type","checkbox","clrCheckbox","",3,"checked","click"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button",3,"click"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId","selectionManager",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],[1,"move-to-item"],[1,"move-icon"],["shape","child-arrow"],[1,"path"],[3,"expandAll","collectionTree","activeCollectionId","selectionManager"]],template:function(e,t){1&e&&(k.TgZ(0,"div",0,1),k.NdJ("cdkDropListDropped",function(e){return t.drop(e)}),k.ALo(2,"async"),k.YNc(3,pa,47,52,"div",2),k.qZA()),2&e&&(k.Q6J("cdkDropListData",t.collectionTree)("cdkDropListDisabled",!k.lcZ(2,4,t.hasUpdatePermission$)),k.xp6(3),k.Q6J("ngForOf",t.collectionTree.children)("ngForTrackBy",t.trackByFn))},directives:[pe.Wj,I.sg,ce.q0d,pe.Zt,I.mk,le.y,ce.KKC,I.O5,v.yS,ce.qvL,F.H,fe.J,me.U,ve.N,he.H,Bt.Y,pe.Bh,ga],pipes:[I.Ov,w.X$],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--clr-table-bgcolor);border-radius:var(--clr-global-borderradius);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background-color:var(--clr-table-bgcolor);border-radius:var(--clr-global-borderradius);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.move-to-item[_ngcontent-%COMP%]{display:flex;white-space:normal;align-items:baseline}.move-to-item[_ngcontent-%COMP%]   .move-icon[_ngcontent-%COMP%]{flex:none;margin-right:3px}.move-to-item[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{line-height:18px}"],changeDetection:0});var fa={location:"facet-list",label:(0,C.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:function(e){return e.includes(Z.y3$.DeleteFacet)||e.includes(Z.y3$.DeleteCatalog)},onClick:function(e){var t=e.injector,n=e.selection,o=e.hostComponent,i=e.clearSelection,a=t.get(Z.Z7U),c=t.get(Z.DoR),l=t.get(Z.gqp);function s(e,t){return a.dialog({title:(0,C.J)("catalog.confirm-bulk-delete-facets"),translationVars:{count:n.length},size:t?"lg":"md",body:t,buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:t?(0,C.J)("common.force-delete"):(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(n){return n?c.facet.deleteFacets(e,!!t).pipe((0,x.U)(function(e){return e.deleteFacets})):(0,te.of)([])}))}s((0,ge.T)(n.map(function(e){return e.id}))).pipe((0,D.w)(function(e){var t,o,i=0,a=[],c=[],l=0,u=r(e);try{for(u.s();!(o=u.n()).done;){var d=o.value;d.result===Z.PcR.DELETED?i++:d.message&&(a.push(d.message),c.push(null===(t=n[l])||void 0===t?void 0:t.id)),l++}}catch(p){u.e(p)}finally{u.f()}return 0<c.length?s(c,a.join("\n")).pipe((0,x.U)(function(e){var t=e.filter(function(e){return e.result===Z.PcR.DELETED}).length;return i+t})):(0,te.of)(i)})).subscribe(function(e){e&&(o.refresh(),i(),l.success((0,C.J)("catalog.notify-bulk-delete-facets-success"),{count:e}))})}},ma={location:"facet-list",label:(0,C.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:function(e){return e.includes(Z.y3$.UpdateFacet)||e.includes(Z.y3$.UpdateCatalog)},isVisible:function(e){var t=e.injector;return(0,Z.SDV)(t.get(Z.DoR))},onClick:function(e){var t=e.injector,n=e.selection,o=(e.hostComponent,e.clearSelection),i=t.get(Z.Z7U),a=t.get(Z.DoR),r=t.get(Z.gqp);i.fromComponent(_i,{size:"md",locals:{}}).pipe((0,D.w)(function(e){return e?a.facet.assignFacetsToChannel({facetIds:n.map(function(e){return e.id}),channelId:e.id}).pipe((0,Ft.h)(e)):V.E})).subscribe(function(e){r.success((0,C.J)("catalog.assign-facets-to-channel-success"),{count:n.length,channelCode:e.code}),o()})}},va={location:"facet-list",label:(0,C.J)("catalog.remove-from-channel"),getTranslationVars:function(e){var t=e.injector;return(0,Z.PDO)(t.get(Z.DoR))},icon:"layers",iconClass:"is-warning",requiresPermission:function(e){return e.includes(Z.y3$.UpdateFacet)||e.includes(Z.y3$.UpdateCatalog)},isVisible:function(e){var t=e.injector;return(0,Z._Nz)(t.get(Z.DoR))},onClick:function(e){var t=e.injector,n=e.selection,o=e.hostComponent,i=e.clearSelection,a=t.get(Z.Z7U),c=t.get(Z.DoR),l=t.get(Z.gqp),s=c.client.userStatus().mapSingle(function(e){return e.userStatus.activeChannelId});function u(e,t){return a.dialog({title:(0,C.J)("catalog.remove-from-channel"),translationVars:{count:n.length},size:t?"lg":"md",body:t,buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:t?(0,C.J)("common.force-remove"):(0,C.J)("common.remove"),returnValue:!0}]}).pipe((0,D.w)(function(n){return n?s.pipe((0,D.w)(function(n){return n?c.facet.removeFacetsFromChannel({channelId:n,facetIds:e,force:!!t}):V.E}),(0,x.U)(function(e){return e.removeFacetsFromChannel})):V.E}))}u((0,ge.T)(n.map(function(e){return e.id}))).pipe((0,D.w)(function(e){var t,o,i=n.length,a=[],c=[],l=0,s=r(e);try{for(s.s();!(o=s.n()).done;){var d=o.value;"FacetInUseError"===d.__typename&&(a.push(d.message),c.push(null===(t=n[l])||void 0===t?void 0:t.id),i--),l++}}catch(p){s.e(p)}finally{s.f()}return 0<c.length?u(c,a.join("\n")).pipe((0,x.U)(function(e){var t=e.filter(function(e){return"FacetInUseError"===e.__typename}).length;return n.length-t})):(0,te.of)(i)}),(0,D.w)(function(e){return e?(0,Z.PDO)(c).then(function(t){return{channelCode:t.channelCode,removedCount:e}}):V.E})).subscribe(function(e){var t=e.removedCount,n=e.channelCode;t&&(o.refresh(),i(),l.success((0,C.J)("catalog.notify-remove-facets-from-channel-success"),{count:t,channelCode:n}))})}},ha=["optionGroupName"];function Za(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",7),k.TgZ(1,"div",8),k.TgZ(2,"label"),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.TgZ(5,"input",9,10),k.NdJ("ngModelChange",function(e){return k.CHM(n).$implicit.name=e})("keydown.enter",function(e){k.CHM(n);var t=k.MAs(12);return k.oxw().handleEnter(e,t)}),k.qZA(),k.qZA(),k.TgZ(7,"div",11),k.TgZ(8,"label"),k._uU(9),k.ALo(10,"translate"),k.qZA(),k.TgZ(11,"vdr-option-value-input",12,13),k.NdJ("ngModelChange",function(e){return k.CHM(n).$implicit.values=e})("ngModelChange",function(){return k.CHM(n),k.oxw().generateVariants()})("edit",function(){return k.CHM(n),k.oxw().generateVariants()}),k.qZA(),k.qZA(),k.TgZ(13,"div",14),k.TgZ(14,"button",15),k.NdJ("click",function(){var e=k.CHM(n).$implicit;return k.oxw().removeOption(e.name)}),k.ALo(15,"translate"),k._UZ(16,"clr-icon",16),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.$implicit;k.xp6(3),k.Oqu(k.lcZ(4,7,"catalog.option")),k.xp6(2),k.Q6J("ngModel",o.name),k.xp6(4),k.Oqu(k.lcZ(10,9,"catalog.option-values")),k.xp6(2),k.Q6J("ngModel",o.values)("groupName",o.name)("disabled",""===o.name),k.xp6(3),k.Q6J("title",k.lcZ(15,11,"catalog.remove-option"))}}function ba(e,t){1&e&&(k.TgZ(0,"th"),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"common.create")))}function ya(e,t){1&e&&(k.TgZ(0,"th"),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,1,"catalog.variant")))}function Ca(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"td"),k.TgZ(1,"input",20),k.NdJ("change",function(){return k.CHM(n),k.oxw(2).onFormChange()})("ngModelChange",function(e){k.CHM(n);var t=k.oxw().$implicit;return k.oxw().variantFormValues[t.id].enabled=e}),k.qZA(),k.qZA()}if(2&e){var o=k.oxw().$implicit,i=k.oxw();k.xp6(1),k.Q6J("ngModel",i.variantFormValues[o.id].enabled)}}function xa(e,t){if(1&e&&(k.TgZ(0,"td"),k._uU(1),k.qZA()),2&e){var n=k.oxw().$implicit;k.xp6(1),k.hij(" ",n.values.join(" ")," ")}}function Aa(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"tr"),k.YNc(1,Ca,2,1,"td",5),k.YNc(2,xa,2,1,"td",5),k.TgZ(3,"td"),k.TgZ(4,"clr-input-container"),k.TgZ(5,"input",17),k.NdJ("change",function(){return k.CHM(n),k.oxw().onFormChange()})("ngModelChange",function(e){var t=k.CHM(n).$implicit;return k.oxw().variantFormValues[t.id].sku=e}),k.ALo(6,"translate"),k.qZA(),k.qZA(),k.qZA(),k.TgZ(7,"td"),k.TgZ(8,"clr-input-container"),k.TgZ(9,"vdr-currency-input",18),k.NdJ("ngModelChange",function(e){var t=k.CHM(n).$implicit;return k.oxw().variantFormValues[t.id].price=e})("ngModelChange",function(){return k.CHM(n),k.oxw().onFormChange()}),k.qZA(),k.qZA(),k.qZA(),k.TgZ(10,"td"),k.TgZ(11,"clr-input-container"),k.TgZ(12,"input",19),k.NdJ("ngModelChange",function(e){var t=k.CHM(n).$implicit;return k.oxw().variantFormValues[t.id].stock=e})("change",function(){return k.CHM(n),k.oxw().onFormChange()}),k.qZA(),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=t.$implicit,i=k.oxw();k.ekj("disabled",!i.variantFormValues[o.id].enabled),k.xp6(1),k.Q6J("ngIf",1<i.variants.length),k.xp6(1),k.Q6J("ngIf",1<i.variants.length),k.xp6(3),k.Q6J("ngModel",i.variantFormValues[o.id].sku)("placeholder",k.lcZ(6,9,"catalog.sku")),k.xp6(4),k.Q6J("ngModel",i.variantFormValues[o.id].price)("currencyCode",i.currencyCode),k.xp6(3),k.Q6J("ngModel",i.variantFormValues[o.id].stock)}}var ka="__DEFAULT_VARIANT__",Pa=function(){function e(t){p(this,e),this.dataService=t,this.variantsChange=new k.vpe,this.optionGroups=[],this.variantFormValues={}}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getActiveChannel().single$.subscribe(function(t){e.currencyCode=t.activeChannel.currencyCode}),this.generateVariants()}},{key:"addOption",value:function(){var e=this;this.optionGroups.push({name:"",values:[]});var t=this.optionGroups.length-1;setTimeout(function(){var n,o=null===(n=e.groupNameInputs.get(t))||void 0===n?void 0:n.nativeElement;null==o||o.focus()})}},{key:"removeOption",value:function(e){this.optionGroups=this.optionGroups.filter(function(t){return t.name!==e}),this.generateVariants()}},{key:"generateVariants",value:function(){var e=this,t=this.optionGroups.reduce(function(e,t){return e+t.values.length},0)?this.optionGroups.map(function(e){return e.values.map(function(e){return e.name})}):[[ka]];this.variants=(0,Tt.generateAllCombinations)(t).map(function(e){return{id:e.join("|"),values:e}}),this.variants.forEach(function(t){e.variantFormValues[t.id]||(e.variantFormValues[t.id]={optionValues:t.values,enabled:!0,price:e.copyFromDefault(t.id,"price",0),sku:e.copyFromDefault(t.id,"sku",""),stock:e.copyFromDefault(t.id,"stock",0)})}),this.onFormChange()}},{key:"trackByFn",value:function(e,t){return t.values.join("|")}},{key:"handleEnter",value:function(e,t){e.preventDefault(),e.stopPropagation(),t.focus()}},{key:"onFormChange",value:function(){var e=this,t=this.variants.map(function(t){return e.variantFormValues[t.id]}).filter(function(e){return e.enabled});this.variantsChange.emit({groups:this.optionGroups.map(function(e){return{name:e.name,values:e.values.map(function(e){return e.name})}}),variants:t})}},{key:"copyFromDefault",value:function(e,t,n){return e!==ka?this.variantFormValues[ka][t]:n}}]),e}();Pa.\u0275fac=function(e){return new(e||Pa)(k.Y36(Z.DoR))},Pa.\u0275cmp=k.Xpm({type:Pa,selectors:[["vdr-generate-product-variants"]],viewQuery:function(e,t){var n;(1&e&&k.Gf(ha,5,k.SBq),2&e)&&(k.iGM(n=k.CRH())&&(t.groupNameInputs=n))},outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],["optionGroupName",""],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange","edit"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(e,t){1&e&&(k.YNc(0,Za,17,13,"div",0),k.TgZ(1,"button",1),k.NdJ("click",function(){return t.addOption()}),k._UZ(2,"clr-icon",2),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.TgZ(5,"div",3),k.TgZ(6,"table",4),k.TgZ(7,"thead"),k.TgZ(8,"tr"),k.YNc(9,ba,3,3,"th",5),k.YNc(10,ya,3,3,"th",5),k.TgZ(11,"th"),k._uU(12),k.ALo(13,"translate"),k.qZA(),k.TgZ(14,"th"),k._uU(15),k.ALo(16,"translate"),k.qZA(),k.TgZ(17,"th"),k._uU(18),k.ALo(19,"translate"),k.qZA(),k.qZA(),k.qZA(),k.YNc(20,Aa,13,11,"tr",6),k.qZA(),k.qZA()),2&e&&(k.Q6J("ngForOf",t.optionGroups),k.xp6(3),k.hij(" ",k.lcZ(4,9,"catalog.add-option"),"\n"),k.xp6(6),k.Q6J("ngIf",1<t.variants.length),k.xp6(1),k.Q6J("ngIf",1<t.variants.length),k.xp6(2),k.Oqu(k.lcZ(13,11,"catalog.sku")),k.xp6(3),k.Oqu(k.lcZ(16,13,"catalog.price")),k.xp6(3),k.Oqu(k.lcZ(19,15,"catalog.stock-on-hand")),k.xp6(2),k.Q6J("ngForOf",t.variants)("ngForTrackBy",t.trackByFn))},directives:[I.sg,ce.qvL,I.O5,ce.q0d,ce.MgK,le.y,A.Fj,ce.xRP,A.Q7,A.JJ,A.On,ti,ce.G55,ni.K,A.qQ,A.wV,A.Wl,ce.KKC],pipes:[w.X$],styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});var Ta={location:"product-list",label:(0,C.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:function(e){return e.includes(Z.y3$.DeleteProduct)||e.includes(Z.y3$.DeleteCatalog)},onClick:function(e){var t=e.injector,n=e.selection,o=e.hostComponent,i=e.clearSelection,a=t.get(Z.Z7U),c=t.get(Z.DoR),l=t.get(Z.gqp);a.dialog({title:(0,C.J)("catalog.confirm-bulk-delete-products"),translationVars:{count:n.length},buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.delete"),returnValue:!0}]}).pipe((0,D.w)(function(e){return e?c.product.deleteProducts((0,ge.T)(n.map(function(e){return e.productId}))):V.E})).subscribe(function(e){var t,n=0,a=[],c=r(e.deleteProducts);try{for(c.s();!(t=c.n()).done;){var s=t.value;s.result===Z.PcR.DELETED?n++:s.message&&a.push(s.message)}}catch(u){c.e(u)}finally{c.f()}0<n&&l.success((0,C.J)("catalog.notify-bulk-delete-products-success"),{count:n}),0<a.length&&l.error(a.join("\n")),o.refresh(),i()})}},Oa={location:"product-list",label:(0,C.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:function(e){return e.includes(Z.y3$.UpdateCatalog)||e.includes(Z.y3$.UpdateProduct)},isVisible:function(e){var t=e.injector;return(0,Z.SDV)(t.get(Z.DoR))},onClick:function(e){var t=e.injector,n=e.selection,o=(e.hostComponent,e.clearSelection),i=t.get(Z.Z7U);t.get(Z.DoR),t.get(Z.gqp),i.fromComponent($n,{size:"lg",locals:{productIds:(0,ge.T)(n.map(function(e){return e.productId})),currentChannelIds:[]}}).subscribe(function(e){e&&o()})}},Fa={location:"product-list",label:(0,C.J)("catalog.remove-from-channel"),requiresPermission:function(e){return e.includes(Z.y3$.UpdateChannel)||e.includes(Z.y3$.UpdateProduct)},getTranslationVars:function(e){var t=e.injector;return(0,Z.PDO)(t.get(Z.DoR))},icon:"layers",iconClass:"is-warning",isVisible:function(e){var t=e.injector;return(0,Z._Nz)(t.get(Z.DoR))},onClick:function(e){var t=e.injector,n=e.selection,o=e.hostComponent,i=e.clearSelection,a=t.get(Z.Z7U),r=t.get(Z.DoR),c=t.get(Z.gqp),l=r.client.userStatus().mapSingle(function(e){return e.userStatus.activeChannelId});(0,dn.D)((0,Z.PDO)(t.get(Z.DoR))).pipe((0,D.w)(function(e){var t=e.channelCode;return a.dialog({title:(0,C.J)("catalog.remove-from-channel"),translationVars:{channelCode:t},buttons:[{type:"secondary",label:(0,C.J)("common.cancel")},{type:"danger",label:(0,C.J)("common.remove"),returnValue:!0}]})}),(0,D.w)(function(e){return e?l.pipe((0,D.w)(function(e){return e?r.product.removeProductsFromChannel({channelId:e,productIds:n.map(function(e){return e.productId})}):V.E}),(0,Ft.h)(!0)):(0,te.of)(!1)})).subscribe(function(e){e&&(i(),c.success((0,C.J)("common.notify-remove-products-from-channel-success"),{count:n.length}),setTimeout(function(){return o.refresh()},1e3))})}},qa={location:"product-list",label:(0,C.J)("catalog.edit-facet-values"),icon:"tag",requiresPermission:function(e){return e.includes(Z.y3$.UpdateCatalog)||e.includes(Z.y3$.UpdateProduct)},onClick:function(e){var t=e.injector,n=e.selection,o=e.hostComponent,i=e.clearSelection,a=t.get(Z.Z7U),r=t.get(Z.DoR),c=t.get(Z.gqp),l=o.groupByProduct?"product":"variant",s="product"===l?(0,ge.T)(n.map(function(e){return e.productId})):(0,ge.T)(n.map(function(e){return e.productVariantId}));return r.facet.getAllFacets().mapSingle(function(e){return e.facets.items}).pipe((0,D.w)(function(e){return a.fromComponent(Gi,{size:"xl",locals:{facets:e,mode:l,ids:s}})})).subscribe(function(e){e&&(c.success((0,C.J)("common.notify-bulk-update-success"),{count:n.length,entity:"product"===l?"Products":"ProductVariants"}),i())})}};function Ia(e,t){1&e&&(k._uU(0),k.ALo(1,"translate")),2&e&&k.Oqu(k.lcZ(1,1,"catalog.update-product-option"))}var wa=function(){return["UpdateCatalog","UpdateProduct"]};function Ma(e,t){if(1&e&&(k.TgZ(0,"section"),k.TgZ(1,"label"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k._UZ(4,"vdr-tabbed-custom-fields",10),k.ALo(5,"hasPermission"),k.qZA()),2&e){var n=k.oxw();k.xp6(2),k.Oqu(k.lcZ(3,4,"common.custom-fields")),k.xp6(2),k.Q6J("customFields",n.customFields)("customFieldsFormGroup",n.customFieldsForm)("readonly",!k.lcZ(5,6,k.DdM(8,wa)))}}function _a(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",11),k.NdJ("click",function(){return k.CHM(n),k.oxw().cancel()}),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.TgZ(3,"button",12),k.NdJ("click",function(){return k.CHM(n),k.oxw().update()}),k._uU(4),k.ALo(5,"translate"),k.qZA()}if(2&e){var o=k.oxw(),i=k.MAs(4),a=k.MAs(8);k.xp6(1),k.Oqu(k.lcZ(2,3,"common.cancel")),k.xp6(2),k.Q6J("disabled",i.invalid||a.invalid||i.pristine&&a.pristine&&o.customFieldsForm.pristine),k.xp6(1),k.hij(" ",k.lcZ(5,5,"catalog.update-product-option")," ")}}var Ja=function(){function e(){p(this,e),this.updateVariantName=!0,this.codeInputTouched=!1}return f(e,[{key:"ngOnInit",value:function(){var e,t=this,n=this.productOption.translations.find(function(e){return e.languageCode===t.activeLanguage});if(this.name=null!==(e=null==n?void 0:n.name)&&void 0!==e?e:"",this.code=this.productOption.code,this.customFieldsForm=new A.cw({}),this.customFields){var o,i=n&&n.customFields||{},a=r(this.customFields);try{for(a.s();!(o=a.n()).done;){var c=o.value,l=c.name,s="localeString"===c.type?i[l]:this.productOption.customFields[l];this.customFieldsForm.addControl(c.name,new A.NI(s))}}catch(u){a.e(u)}finally{a.f()}}}},{key:"update",value:function(){var e=(0,Z.iSy)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(Object.assign(Object.assign({},e),{autoUpdate:this.updateVariantName}))}},{key:"cancel",value:function(){this.resolveWith()}},{key:"updateCode",value:function(e){!this.codeInputTouched&&!this.productOption.code&&(this.code=(0,W.U)(e,"-"))}}]),e}();Ja.\u0275fac=function(e){return new(e||Ja)},Ja.\u0275cmp=k.Xpm({type:Ja,selectors:[["vdr-update-product-option-dialog"]],decls:16,vars:13,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["vdrDialogButtons",""],["entityName","ProductOption",3,"customFields","customFieldsFormGroup","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(k.YNc(0,Ia,2,3,"ng-template",0),k.TgZ(1,"vdr-form-field",1),k.ALo(2,"translate"),k.TgZ(3,"input",2,3),k.NdJ("ngModelChange",function(e){return t.name=e})("input",function(e){return t.updateCode(e.target.value)}),k.qZA(),k.qZA(),k.TgZ(5,"vdr-form-field",4),k.ALo(6,"translate"),k.TgZ(7,"input",5,6),k.NdJ("ngModelChange",function(e){return t.code=e}),k.qZA(),k.qZA(),k.TgZ(9,"clr-checkbox-wrapper"),k.TgZ(10,"input",7),k.NdJ("ngModelChange",function(e){return t.updateVariantName=e}),k.qZA(),k.TgZ(11,"label"),k._uU(12),k.ALo(13,"translate"),k.qZA(),k.qZA(),k.YNc(14,Ma,6,9,"section",8),k.YNc(15,_a,6,7,"ng-template",9)),2&e&&(k.xp6(1),k.Q6J("label",k.lcZ(2,7,"catalog.option-name")),k.xp6(2),k.Q6J("ngModel",t.name),k.xp6(2),k.Q6J("label",k.lcZ(6,9,"common.code")),k.xp6(2),k.Q6J("ngModel",t.code),k.xp6(3),k.Q6J("ngModel",t.updateVariantName),k.xp6(2),k.Oqu(k.lcZ(13,11,"catalog.auto-update-option-variant-name")),k.xp6(2),k.Q6J("ngIf",t.customFields.length))},directives:[hn.q,re.h,le.y,A.Fj,A.Q7,A.JJ,A.On,A.c5,ce.PEh,A.Wl,ce.KKC,ce.MgK,I.O5,bn.n,je.y],pipes:[w.X$,B.j],styles:[""],changeDetection:0});var La=g(97861),Ua=function(e){return{rate:e}};function Va(e,t){if(1&e&&(k.TgZ(0,"div",2),k._uU(1),k.ALo(2,"translate"),k.ALo(3,"async"),k.qZA()),2&e){var n=k.oxw();k.xp6(1),k.hij(" ",k.xi3(2,1,"catalog.price-includes-tax-at",k.VKq(6,Ua,k.lcZ(3,4,n.taxRate$))),"\n")}}var Na=function(e,t){return{price:e,rate:t}};function Sa(e,t){if(1&e&&(k.TgZ(0,"div",2),k._uU(1),k.ALo(2,"translate"),k.ALo(3,"localeCurrency"),k.ALo(4,"async"),k.ALo(5,"async"),k.qZA()),2&e){var n=k.oxw();k.xp6(1),k.hij(" ",k.xi3(2,1,"catalog.price-with-tax-in-default-zone",k.WLB(11,Na,k.xi3(3,4,k.lcZ(4,7,n.grossPrice$),n.currencyCode),k.lcZ(5,9,n.taxRate$))),"\n")}}var $a=function(){function e(t){p(this,e),this.dataService=t,this.priceChange$=new L.X(0),this.taxCategoryIdChange$=new L.X("")}return f(e,[{key:"ngOnInit",value:function(){var e=this.dataService.settings.getTaxRatesSimple(999,0,"cache-first").mapStream(function(e){return e.taxRates.items}),t=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(function(e){return e.activeChannel});this.taxRate$=(0,U.aj)(t,e,this.taxCategoryIdChange$).pipe((0,x.U)(function(e){var t=c(e,3),n=t[0],o=t[1],i=t[2],a=n.defaultTaxZone;if(!a)return 0;var r=o.find(function(e){return e.zone.id===a.id&&e.category.id===i});return r?r.value:0})),this.grossPrice$=(0,U.aj)(this.taxRate$,this.priceChange$).pipe((0,x.U)(function(e){var t=c(e,2),n=t[0],o=t[1];return Math.round(o*((100+n)/100))}))}},{key:"ngOnChanges",value:function(e){"price"in e&&this.priceChange$.next(e.price.currentValue),"taxCategoryId"in e&&this.taxCategoryIdChange$.next(e.taxCategoryId.currentValue)}}]),e}();$a.\u0275fac=function(e){return new(e||$a)(k.Y36(Z.DoR))},$a.\u0275cmp=k.Xpm({type:$a,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[k.TTD],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(e,t){1&e&&(k.TgZ(0,"label",0),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.YNc(3,Va,4,8,"div",1),k.YNc(4,Sa,6,14,"div",1)),2&e&&(k.xp6(1),k.Oqu(k.lcZ(2,3,"catalog.taxes")),k.xp6(2),k.Q6J("ngIf",t.priceIncludesTax),k.xp6(1),k.Q6J("ngIf",!t.priceIncludesTax))},directives:[ce.MgK,I.O5],pipes:[w.X$,I.Ov,Tn.k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0});var Da=g(49435),Qa=g(6444),Ya=g(84209),ja=g(11185),Ea=g(75850);function Ga(e,t){1&e&&(k.TgZ(0,"clr-toggle-wrapper"),k._UZ(1,"input",45),k.TgZ(2,"label"),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.qZA()),2&e&&(k.xp6(3),k.Oqu(k.lcZ(4,1,"common.enabled")))}function Ha(e,t){if(1&e&&(k.TgZ(0,"option",48),k._uU(1),k.qZA()),2&e){var n=t.$implicit;k.Q6J("value",n.id),k.xp6(1),k.hij(" ",n.name," ")}}function Ba(e,t){if(1&e&&(k.TgZ(0,"clr-select-container"),k.TgZ(1,"label"),k._uU(2),k.ALo(3,"translate"),k.qZA(),k.TgZ(4,"select",46),k.YNc(5,Ha,2,2,"option",47),k.qZA(),k.qZA()),2&e){var n=k.oxw(3);k.xp6(2),k.Oqu(k.lcZ(3,2,"catalog.tax-category")),k.xp6(3),k.Q6J("ngForOf",n.taxCategories)}}function Ra(e,t){if(1&e&&(k.TgZ(0,"label",29),k._uU(1),k.ALo(2,"translate"),k.qZA(),k.TgZ(3,"div",49),k._uU(4),k.qZA()),2&e){var n=k.oxw().ngIf,o=k.oxw(2);k.xp6(1),k.Oqu(k.lcZ(2,2,"catalog.tax-category")),k.xp6(3),k.hij(" ",o.getTaxCategoryName(n)," ")}}function za(e,t){if(1&e&&(k._UZ(0,"vdr-currency-input",50),k.ALo(1,"hasPermission")),2&e){var n=k.oxw(2).$implicit,o=k.oxw();k.Q6J("currencyCode",n.currencyCode)("readonly",!k.lcZ(1,2,o.updatePermission))}}function Ka(e,t){if(1&e&&(k._UZ(0,"vdr-currency-input",51),k.ALo(1,"hasPermission")),2&e){var n=k.oxw(2).$implicit,o=k.oxw();k.Q6J("currencyCode",n.currencyCode)("readonly",!k.lcZ(1,2,o.updatePermission))}}function Wa(e,t){if(1&e&&(k.TgZ(0,"clr-select-container"),k.TgZ(1,"label"),k._uU(2),k.ALo(3,"translate"),k._UZ(4,"vdr-help-tooltip",27),k.ALo(5,"translate"),k.qZA(),k.TgZ(6,"select",52),k.TgZ(7,"option",48),k._uU(8),k.ALo(9,"translate"),k.qZA(),k.TgZ(10,"option",48),k._uU(11),k.ALo(12,"translate"),k.qZA(),k.TgZ(13,"option",48),k._uU(14),k.ALo(15,"translate"),k.qZA(),k.qZA(),k.qZA()),2&e){var n=k.oxw(3);k.xp6(2),k.hij("",k.lcZ(3,8,"catalog.track-inventory")," "),k.xp6(2),k.Q6J("content",k.lcZ(5,10,"catalog.track-inventory-tooltip")),k.xp6(3),k.Q6J("value",n.GlobalFlag.TRUE),k.xp6(1),k.hij(" ",k.lcZ(9,12,"catalog.track-inventory-true")," "),k.xp6(2),k.Q6J("value",n.GlobalFlag.FALSE),k.xp6(1),k.hij(" ",k.lcZ(12,14,"catalog.track-inventory-false")," "),k.xp6(2),k.Q6J("value",n.GlobalFlag.INHERIT),k.xp6(1),k.hij(" ",k.lcZ(15,16,"catalog.track-inventory-inherit")," ")}}function Xa(e,t){if(1&e&&(k.TgZ(0,"section",53),k._UZ(1,"vdr-tabbed-custom-fields",54),k.ALo(2,"hasPermission"),k.qZA()),2&e){var n=k.oxw().ngIf,o=k.oxw(2);k.xp6(1),k.Q6J("customFields",o.customFields)("compact",!0)("customFieldsFormGroup",n.get("customFields"))("readonly",!k.lcZ(2,4,o.updatePermission))}}function er(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-chip",58),k.NdJ("iconClick",function(){var e=k.CHM(n).$implicit;return k.oxw(4).editOption(e)}),k.ALo(1,"hasPermission"),k.TgZ(2,"span",59),k._uU(3),k.qZA(),k._uU(4),k.qZA()}if(2&e){var o=t.$implicit,i=k.oxw(4);k.Q6J("colorFrom",i.optionGroupName(o.groupId))("invert",!0)("icon",k.lcZ(1,5,i.updatePermission)&&"pencil"),k.xp6(3),k.Oqu(i.optionGroupName(o.groupId)),k.xp6(1),k.hij(" ",i.optionName(o)," ")}}var tr=function(){return["./","options"]};function nr(e,t){if(1&e&&(k.TgZ(0,"div"),k.TgZ(1,"div",55),k.YNc(2,er,5,7,"vdr-chip",56),k.ALo(3,"sort"),k.TgZ(4,"a",57),k._uU(5),k.ALo(6,"translate"),k.qZA(),k.qZA(),k.qZA()),2&e){var n=k.oxw(2).$implicit;k.xp6(2),k.Q6J("ngForOf",k.xi3(3,3,n.options,"groupId")),k.xp6(2),k.Q6J("routerLink",k.DdM(8,tr)),k.xp6(1),k.hij("",k.lcZ(6,6,"catalog.edit-options"),"...")}}function or(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-facet-value-chip",60),k.NdJ("remove",function(){var e=k.CHM(n).$implicit,t=k.oxw(2).$implicit;return k.oxw().removeFacetValue(t,e.id)}),k.ALo(1,"hasPermission"),k.qZA()}if(2&e){var o=t.$implicit,i=k.oxw(3);k.Q6J("facetValue",o)("removable",k.lcZ(1,2,i.updatePermission))}}function ir(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-facet-value-chip",60),k.NdJ("remove",function(){var e=k.CHM(n).$implicit,t=k.oxw(2).$implicit;return k.oxw().removeFacetValue(t,e.id)}),k.ALo(1,"hasPermission"),k.qZA()}if(2&e){var o=t.$implicit,i=k.oxw(3);k.Q6J("facetValue",o)("removable",k.lcZ(1,2,i.updatePermission))}}function ar(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"button",61),k.NdJ("click",function(){k.CHM(n);var e=k.oxw(2).$implicit;return k.oxw().selectFacetValueClick.emit([e.id])}),k._UZ(1,"clr-icon",62),k._uU(2),k.ALo(3,"translate"),k.qZA()}2&e&&(k.xp6(2),k.hij(" ",k.lcZ(3,1,"catalog.add-facets")," "))}var rr=function(e){return{channelCode:e}};function cr(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"vdr-chip",69),k.NdJ("iconClick",function(){k.CHM(n);var e=k.oxw().$implicit,t=k.oxw(4).$implicit;return k.oxw().removeFromChannel.emit({channelId:e.id,variant:t})}),k.ALo(1,"translate"),k._UZ(2,"vdr-channel-badge",70),k._uU(3),k.ALo(4,"channelCodeToLabel"),k.qZA()}if(2&e){var o=k.oxw().$implicit;k.Q6J("title",k.xi3(1,3,"catalog.remove-from-channel",k.VKq(8,rr,o.code))),k.xp6(2),k.Q6J("channelCode",o.code),k.xp6(1),k.hij(" ",k.lcZ(4,6,o.code)," ")}}function lr(e,t){if(1&e&&(k.ynx(0),k.YNc(1,cr,5,10,"vdr-chip",68),k.BQk()),2&e){var n=t.$implicit,o=k.oxw(5);k.xp6(1),k.Q6J("ngIf",!o.isDefaultChannel(n.code))}}function sr(e,t){if(1&e){var n=k.EpF();k.TgZ(0,"div",13),k.TgZ(1,"div",64),k.YNc(2,lr,2,1,"ng-container",65),k.TgZ(3,"button",66),k.NdJ("click",function(){k.CHM(n);var e=k.oxw(3).$implicit;return k.oxw().assignToChannel.emit(e)}),k._UZ(4,"clr-icon",67),k._uU(5),k.ALo(6,"translate"),k.qZA(),k.qZA(),k.qZA()}if(2&e){var o=k.oxw(3).$implicit;k.xp6(2),k.Q6J("ngForOf",o.channels),k.xp6(3),k.hij(" ",k.lcZ(6,2,"catalog.assign-to-channel")," ")}}function ur(e,t){1&e&&(k.ynx(0),k.YNc(1,sr,7,4,"div",63),k.BQk())}function dr(e,t){if(1&e){var n=k.EpF();k.ynx(0,4),k.TgZ(1,"div",5),k.TgZ(2,"div",6),k.TgZ(3,"vdr-title-input",7),k.ALo(4,"hasPermission"),k.TgZ(5,"clr-input-container"),k._UZ(6,"input",8),k.ALo(7,"hasPermission"),k.ALo(8,"translate"),k.qZA(),k.qZA(),k.TgZ(9,"vdr-title-input",9),k.ALo(10,"hasPermission"),k.TgZ(11,"clr-input-container"),k._UZ(12,"input",10),k.ALo(13,"hasPermission"),k.ALo(14,"translate"),k.qZA(),k.qZA(),k.qZA(),k.TgZ(15,"div",11),k.YNc(16,Ga,5,3,"clr-toggle-wrapper",12),k.qZA(),k.qZA(),k.TgZ(17,"div",13),k.TgZ(18,"div",14),k.TgZ(19,"div",15),k.TgZ(20,"vdr-assets",16),k.NdJ("change",function(e){k.CHM(n);var t=k.oxw().$implicit;return k.oxw().onAssetChange(t.id,e)}),k.qZA(),k.qZA(),k.TgZ(21,"div",17),k.TgZ(22,"div",18),k.TgZ(23,"div",19),k.TgZ(24,"div",20),k.YNc(25,Ba,6,4,"clr-select-container",21),k.YNc(26,Ra,5,4,"ng-template",null,22,k.W1O),k.qZA(),k.TgZ(28,"div",23),k.TgZ(29,"clr-input-container"),k.TgZ(30,"label"),k._uU(31),k.ALo(32,"translate"),k.qZA(),k.YNc(33,za,2,4,"vdr-currency-input",24),k.YNc(34,Ka,2,4,"vdr-currency-input",25),k.qZA(),k.qZA(),k._UZ(35,"vdr-variant-price-detail",26),k.qZA(),k.TgZ(36,"div",19),k.YNc(37,Wa,16,18,"clr-select-container",12),k.TgZ(38,"clr-input-container"),k.TgZ(39,"label"),k._uU(40),k.ALo(41,"translate"),k._UZ(42,"vdr-help-tooltip",27),k.ALo(43,"translate"),k.qZA(),k._UZ(44,"input",28),k.ALo(45,"hasPermission"),k.qZA(),k.TgZ(46,"div"),k.TgZ(47,"label",29),k._uU(48),k.ALo(49,"translate"),k._UZ(50,"vdr-help-tooltip",27),k.ALo(51,"translate"),k.qZA(),k.TgZ(52,"div",30),k._uU(53),k.qZA(),k.qZA(),k.TgZ(54,"div"),k.TgZ(55,"label",29),k._uU(56),k.ALo(57,"translate"),k._UZ(58,"vdr-help-tooltip",27),k.ALo(59,"translate"),k.qZA(),k.TgZ(60,"div",30),k._uU(61),k.qZA(),k.qZA(),k.qZA(),k.TgZ(62,"div",19),k.TgZ(63,"div",31),k.TgZ(64,"label",29),k._uU(65),k.ALo(66,"translate"),k._UZ(67,"vdr-help-tooltip",27),k.ALo(68,"translate"),k.qZA(),k.TgZ(69,"div",32),k.TgZ(70,"clr-input-container"),k._UZ(71,"input",33),k.ALo(72,"hasPermission"),k.qZA(),k.TgZ(73,"clr-toggle-wrapper"),k._UZ(74,"input",34),k.ALo(75,"hasPermission"),k.TgZ(76,"label"),k._uU(77),k.ALo(78,"translate"),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.TgZ(79,"div",35),k.TgZ(80,"div",19),k.YNc(81,Xa,3,6,"section",36),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.qZA(),k.TgZ(82,"div",13),k.TgZ(83,"div",37),k._UZ(84,"vdr-entity-info",38),k.YNc(85,nr,7,9,"div",39),k._UZ(86,"div",40),k.TgZ(87,"div",41),k.YNc(88,or,2,4,"vdr-facet-value-chip",42),k.YNc(89,ir,2,4,"vdr-facet-value-chip",42),k.YNc(90,ar,4,3,"button",43),k.qZA(),k.qZA(),k.qZA(),k.YNc(91,ur,2,0,"ng-container",44),k.BQk()}if(2&e){var o,i=t.ngIf,a=k.MAs(27),r=k.oxw().$implicit,c=k.oxw();k.Q6J("formGroup",i),k.xp6(3),k.Q6J("readonly",!k.lcZ(4,55,c.updatePermission)),k.xp6(3),k.Q6J("readonly",!k.lcZ(7,57,c.updatePermission))("placeholder",k.lcZ(8,59,"catalog.sku")),k.xp6(3),k.Q6J("readonly",!k.lcZ(10,61,c.updatePermission)),k.xp6(3),k.Q6J("readonly",!k.lcZ(13,63,c.updatePermission))("placeholder",k.lcZ(14,65,"common.name")),k.xp6(4),k.Q6J("vdrIfPermissions",c.updatePermission),k.xp6(4),k.Q6J("compact",!0)("assets",(null==c.pendingAssetChanges[r.id]?null:c.pendingAssetChanges[r.id].assets)||r.assets)("featuredAsset",(null==c.pendingAssetChanges[r.id]?null:c.pendingAssetChanges[r.id].featuredAsset)||r.featuredAsset)("updatePermissions",c.updatePermission),k.xp6(5),k.Q6J("vdrIfPermissions",c.updatePermission)("vdrIfPermissionsElse",a),k.xp6(6),k.Oqu(k.lcZ(32,67,"catalog.price")),k.xp6(2),k.Q6J("ngIf",!c.channelPriceIncludesTax),k.xp6(1),k.Q6J("ngIf",c.channelPriceIncludesTax),k.xp6(1),k.Q6J("price",i.get("price").value)("currencyCode",r.currencyCode)("priceIncludesTax",c.channelPriceIncludesTax)("taxCategoryId",i.get("taxCategoryId").value),k.xp6(2),k.Q6J("vdrIfPermissions",c.updatePermission),k.xp6(3),k.hij("",k.lcZ(41,69,"catalog.stock-on-hand")," "),k.xp6(2),k.Q6J("content",k.lcZ(43,71,"catalog.stock-on-hand-tooltip")),k.xp6(2),k.ekj("inventory-untracked",c.inventoryIsNotTracked(i)),k.Q6J("min",c.getStockOnHandMinValue(i))("readonly",!k.lcZ(45,73,c.updatePermission))("vdrDisabled",c.inventoryIsNotTracked(i)),k.xp6(2),k.ekj("inventory-untracked",c.inventoryIsNotTracked(i)),k.xp6(2),k.hij("",k.lcZ(49,75,"catalog.stock-allocated")," "),k.xp6(2),k.Q6J("content",k.lcZ(51,77,"catalog.stock-allocated-tooltip")),k.xp6(3),k.hij(" ",r.stockAllocated," "),k.xp6(1),k.ekj("inventory-untracked",c.inventoryIsNotTracked(i)),k.xp6(2),k.hij("",k.lcZ(57,79,"catalog.stock-saleable")," "),k.xp6(2),k.Q6J("content",k.lcZ(59,81,"catalog.stock-saleable-tooltip")),k.xp6(3),k.hij(" ",c.getSaleableStockLevel(r)," "),k.xp6(2),k.ekj("inventory-untracked",c.inventoryIsNotTracked(i)),k.xp6(2),k.Oqu(k.lcZ(66,83,"catalog.out-of-stock-threshold")),k.xp6(2),k.Q6J("content",k.lcZ(68,85,"catalog.out-of-stock-threshold-tooltip")),k.xp6(4),k.Q6J("formControl",i.get("outOfStockThreshold"))("readonly",!k.lcZ(72,87,c.updatePermission))("vdrDisabled",!1!==(null==(o=i.get("useGlobalOutOfStockThreshold"))?null:o.value)||c.inventoryIsNotTracked(i)),k.xp6(3),k.Q6J("vdrDisabled",!k.lcZ(75,89,c.updatePermission)||c.inventoryIsNotTracked(i)),k.xp6(3),k.AsE("",k.lcZ(78,91,"catalog.use-global-value")," (",c.globalOutOfStockThreshold,")"),k.xp6(4),k.Q6J("ngIf",c.customFields.length),k.xp6(3),k.Q6J("entity",r),k.xp6(1),k.Q6J("ngIf",r.options.length),k.xp6(3),k.Q6J("ngForOf",c.existingFacetValues(r)),k.xp6(1),k.Q6J("ngForOf",c.pendingFacetValues(r)),k.xp6(1),k.Q6J("vdrIfPermissions",c.updatePermission)}}function pr(e,t){if(1&e&&(k.TgZ(0,"div",2),k.YNc(1,dr,92,93,"ng-container",3),k.qZA()),2&e){var n,o,i=t.$implicit,a=k.oxw();k.ekj("disabled",!(null!=(n=a.formGroupMap.get(i.id))&&null!=(o=n.get("enabled"))&&o.value)),k.xp6(1),k.Q6J("ngIf",a.formGroupMap.get(i.id))}}var gr=function(){return{itemsPerPage:10,currentPage:1}},fr=function(){function e(t,n,o){p(this,e),this.changeDetector=t,this.modalService=n,this.dataService=o,this.assignToChannel=new k.vpe,this.removeFromChannel=new k.vpe,this.assetChange=new k.vpe,this.selectionChange=new k.vpe,this.selectFacetValueClick=new k.vpe,this.updateProductOption=new k.vpe,this.selectedVariantIds=[],this.formGroupMap=new Map,this.GlobalFlag=Z.TvZ,this.updatePermission=[Z.y3$.UpdateCatalog,Z.y3$.UpdateProduct]}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe(function(t){var n=t.globalSettings;e.globalTrackInventory=n.trackInventory,e.globalOutOfStockThreshold=n.outOfStockThreshold,e.changeDetector.markForCheck()}),this.subscription=this.formArray.valueChanges.subscribe(function(){return e.changeDetector.markForCheck()}),this.subscription.add(this.formArray.valueChanges.pipe((0,x.U)(function(e){return e.length}),(0,N.b)(1),(0,_e.x)()).subscribe(function(){e.buildFormGroupMap()})),this.buildFormGroupMap()}},{key:"ngOnChanges",value:function(e){"facets"in e&&e.facets.currentValue&&(this.facetValues=(0,Z.k2u)(this.facets))}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"isDefaultChannel",value:function(e){return e===un.z$}},{key:"trackById",value:function(e,t){return t.id}},{key:"inventoryIsNotTracked",value:function(e){var t,n=null===(t=e.get("trackInventory"))||void 0===t?void 0:t.value;return n===Z.TvZ.FALSE||n===Z.TvZ.INHERIT&&!1===this.globalTrackInventory}},{key:"getTaxCategoryName",value:function(e){var t=e.get(["taxCategoryId"]);if(t&&this.taxCategories){var n=this.taxCategories.find(function(e){return e.id===t.value});return n?n.name:""}return""}},{key:"getStockOnHandMinValue",value:function(e){var t,n;return(null===(t=e.get("useGlobalOutOfStockThreshold"))||void 0===t?void 0:t.value)?this.globalOutOfStockThreshold:null===(n=e.get("outOfStockThreshold"))||void 0===n?void 0:n.value}},{key:"getSaleableStockLevel",value:function(e){var t=e.useGlobalOutOfStockThreshold?this.globalOutOfStockThreshold:e.outOfStockThreshold;return e.stockOnHand-e.stockAllocated-t}},{key:"areAllSelected",value:function(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}},{key:"onAssetChange",value:function(e,t){this.assetChange.emit(Object.assign({variantId:e},t));var n=this.variants.findIndex(function(t){return t.id===e});this.formArray.at(n).markAsDirty()}},{key:"toggleSelectAll",value:function(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map(function(e){return e.id}),this.selectionChange.emit(this.selectedVariantIds)}},{key:"toggleSelectVariant",value:function(e){var t=this.selectedVariantIds.indexOf(e);-1<t?this.selectedVariantIds.splice(t,1):this.selectedVariantIds.push(e),this.selectionChange.emit(this.selectedVariantIds)}},{key:"optionGroupName",value:function(e){var t,n=this,o=this.optionGroups.find(function(t){return t.id===e});if(o)return(null!==(t=null==o?void 0:o.translations.find(function(e){return e.languageCode===n.activeLanguage}))&&void 0!==t?t:o.translations[0]).name}},{key:"optionName",value:function(e){var t,n=this;return(null!==(t=e.translations.find(function(e){return e.languageCode===n.activeLanguage}))&&void 0!==t?t:e.translations[0]).name}},{key:"pendingFacetValues",value:function(e){var t=this;if(this.facets){var n=this.getFacetValueIds(e.id),o=e.facetValues.map(function(e){return e.id});return n.filter(function(e){return!o.includes(e)}).map(function(e){return t.facetValues.find(function(t){return t.id===e})}).filter(Tt.notNullOrUndefined)}return[]}},{key:"existingFacetValues",value:function(e){return a(this.getFacetValueIds(e.id)).filter(function(t){return e.facetValues.map(function(e){return e.id}).includes(t)}).map(function(t){return e.facetValues.find(function(e){return e.id===t})}).filter(Tt.notNullOrUndefined)}},{key:"removeFacetValue",value:function(e,t){var n=this.formGroupMap.get(e.id);if(n){var o=n.value.facetValueIds.filter(function(e){return e!==t});n.patchValue({facetValueIds:o}),n.markAsDirty()}}},{key:"isVariantSelected",value:function(e){return-1<this.selectedVariantIds.indexOf(e)}},{key:"editOption",value:function(e){var t=this;this.modalService.fromComponent(Ja,{size:"md",locals:{productOption:e,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe(function(e){e&&t.updateProductOption.emit(e)})}},{key:"buildFormGroupMap",value:function(){this.formGroupMap.clear();var e,t=r(this.formArray.controls);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.formGroupMap.set(n.value.id,n)}}catch(o){t.e(o)}finally{t.f()}this.changeDetector.markForCheck()}},{key:"getFacetValueIds",value:function(e){var t;return(null===(t=this.formGroupMap.get(e))||void 0===t?void 0:t.value).facetValueIds}}]),e}();fr.\u0275fac=function(e){return new(e||fr)(k.Y36(k.sBO),k.Y36(Z.Z7U),k.Y36(Z.DoR))},fr.\u0275cmp=k.Xpm({type:fr,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",paginationConfig:"paginationConfig",channelPriceIncludesTax:"channelPriceIncludesTax",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage",pendingAssetChanges:"pendingAssetChanges"},outputs:{assignToChannel:"assignToChannel",removeFromChannel:"removeFromChannel",assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[k.TTD],decls:3,vars:6,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","updatePermissions","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],[3,"content"],["clrInput","","type","number","step","1","formControlName","stockOnHand",3,"min","readonly","vdrDisabled"],[1,"clr-control-label"],[1,"value"],[1,"out-of-stock-threshold-wrapper"],[1,"flex"],["clrInput","","type","number",3,"formControl","readonly","vdrDisabled"],["type","checkbox","clrToggle","","name","useGlobalOutOfStockThreshold","formControlName","useGlobalOutOfStockThreshold",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"tax-category-label"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"],["clrSelect","","name","options","formControlName","trackInventory"],["formGroupName","customFields"],["entityName","ProductVariant",3,"customFields","compact","customFieldsFormGroup","readonly"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[1,"btn","btn-link","btn-sm",3,"routerLink"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],["class","card-block",4,"vdrIfDefaultChannelActive"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"title","iconClick",4,"ngIf"],["icon","times-circle",3,"title","iconClick"],[3,"channelCode"]],template:function(e,t){1&e&&(k.TgZ(0,"div",0),k.YNc(1,pr,2,3,"div",1),k.ALo(2,"paginate"),k.qZA()),2&e&&(k.xp6(1),k.Q6J("ngForOf",k.xi3(2,2,t.variants,t.paginationConfig||k.DdM(5,gr)))("ngForTrackBy",t.trackById))},directives:[I.sg,ce.q0d,I.O5,A.JL,A.sg,La.G,ce.G55,le.y,A.Fj,ce.xRP,A.JJ,A.u,F.H,we,ce.MgK,$a,Da.o,A.wV,A.qQ,se.x,A.oH,ce.PEh,A.Wl,ce.KKC,T.V,Qa.u,ce.dTv,A.EJ,ce.otW,A.YN,A.Kr,ni.K,A.x0,je.y,v.yS,Bt.Y,Rt.q,ce.qvL,Ya.M,ja.n],pipes:[H._s,B.j,w.X$,Ea.U,Pn.E],styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%]{margin-right:12px}.with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s;min-height:330px}.variant-container.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:var(--color-grey-400)}.variant-container[_ngcontent-%COMP%]     .clr-control-container{width:100%}.channel-assignment[_ngcontent-%COMP%]{justify-content:flex-end;flex-wrap:wrap;max-height:110px;overflow-y:auto}.channel-assignment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-left:24px}.inventory-untracked[_ngcontent-%COMP%]{opacity:.5}"],changeDetection:0});var mr=g(47846);function vr(e,t){if(1&e&&(k.ynx(0),k.TgZ(1,"th"),k._uU(2),k.qZA(),k.BQk()),2&e){var n=t.$implicit;k.xp6(2),k.Oqu(n.name)}}function hr(e,t){if(1&e&&(k._UZ(0,"img",18),k.ALo(1,"assetPreview")),2&e){var n=t.ngIf;k.Q6J("src",k.xi3(1,1,n,"tiny"),k.LSH)}}function Zr(e,t){1&e&&(k.TgZ(0,"div",19),k._UZ(1,"clr-icon",20),k.qZA())}function br(e,t){if(1&e&&(k.ynx(0),k.TgZ(1,"td",5),k.ALo(2,"stringToColor"),k._uU(3),k.qZA(),k.BQk()),2&e){var n=t.$implicit,o=k.oxw().ngIf,i=k.oxw(2);k.xp6(1),k.Udp("color",k.lcZ(2,5,i.optionGroupName(n.groupId))),k.ekj("disabled",!o.get("enabled").value),k.xp6(2),k.hij(" ",n.name," ")}}function yr(e,t){if(1&e&&(k._UZ(0,"vdr-currency-input",21),k.ALo(1,"hasPermission")),2&e){var n=k.oxw(2).$implicit,o=k.oxw();k.Q6J("currencyCode",n.currencyCode)("readonly",!k.lcZ(1,2,o.updatePermission))}}function Cr(e,t){if(1&e&&(k._UZ(0,"vdr-currency-input",22),k.ALo(1,"hasPermission")),2&e){var n=k.oxw(2).$implicit,o=k.oxw();k.Q6J("currencyCode",n.currencyCode)("readonly",!k.lcZ(1,2,o.updatePermission))}}function xr(e,t){if(1&e&&(k.ynx(0,4),k.TgZ(1,"td",5),k.TgZ(2,"div",6),k.TgZ(3,"div",7),k.YNc(4,hr,2,4,"img",8),k.YNc(5,Zr,2,0,"ng-template",null,9,k.W1O),k.qZA(),k.qZA(),k.qZA(),k.TgZ(7,"td",5),k.TgZ(8,"clr-input-container"),k._UZ(9,"input",10),k.ALo(10,"hasPermission"),k.ALo(11,"translate"),k.qZA(),k.qZA(),k.TgZ(12,"td",5),k.TgZ(13,"clr-input-container"),k._UZ(14,"input",11),k.ALo(15,"hasPermission"),k.ALo(16,"translate"),k.qZA(),k.qZA(),k.YNc(17,br,4,7,"ng-container",1),k.ALo(18,"sort"),k.TgZ(19,"td",12),k.TgZ(20,"clr-input-container"),k.YNc(21,yr,2,4,"vdr-currency-input",13),k.YNc(22,Cr,2,4,"vdr-currency-input",14),k.qZA(),k.qZA(),k.TgZ(23,"td",15),k.TgZ(24,"clr-input-container"),k._UZ(25,"input",16),k.ALo(26,"hasPermission"),k.qZA(),k.qZA(),k.TgZ(27,"td",15),k.TgZ(28,"clr-toggle-wrapper"),k._UZ(29,"input",17),k.ALo(30,"hasPermission"),k.qZA(),k.qZA(),k.BQk()),2&e){var n=t.ngIf,o=k.MAs(6),i=k.oxw().$implicit,a=k.oxw();k.Q6J("formGroup",n),k.xp6(1),k.ekj("disabled",!n.get("enabled").value),k.xp6(3),k.Q6J("ngIf",a.getFeaturedAsset(i))("ngIfElse",o),k.xp6(3),k.ekj("disabled",!n.get("enabled").value),k.xp6(2),k.Q6J("readonly",!k.lcZ(10,24,a.updatePermission))("placeholder",k.lcZ(11,26,"common.name")),k.xp6(3),k.ekj("disabled",!n.get("enabled").value),k.xp6(2),k.Q6J("readonly",!k.lcZ(15,28,a.updatePermission))("placeholder",k.lcZ(16,30,"catalog.sku")),k.xp6(3),k.Q6J("ngForOf",k.xi3(18,32,i.options,"groupId")),k.xp6(2),k.ekj("disabled",!n.get("enabled").value),k.xp6(2),k.Q6J("ngIf",!a.channelPriceIncludesTax),k.xp6(1),k.Q6J("ngIf",a.channelPriceIncludesTax),k.xp6(1),k.ekj("disabled",!n.get("enabled").value),k.xp6(2),k.Q6J("readonly",!k.lcZ(26,35,a.updatePermission)),k.xp6(2),k.ekj("disabled",!n.get("enabled").value),k.xp6(2),k.Q6J("vdrDisabled",!k.lcZ(30,37,a.updatePermission))}}function Ar(e,t){if(1&e&&(k.TgZ(0,"tr"),k.YNc(1,xr,31,39,"ng-container",3),k.qZA()),2&e){var n=t.$implicit,o=k.oxw();k.xp6(1),k.Q6J("ngIf",o.formGroupMap.get(n.id))}}var kr=function(){function e(t){p(this,e),this.changeDetector=t,this.formGroupMap=new Map,this.updatePermission=[Z.y3$.UpdateCatalog,Z.y3$.UpdateProduct]}return f(e,[{key:"ngOnInit",value:function(){var e=this;this.subscription=this.formArray.valueChanges.pipe((0,x.U)(function(e){return e.length}),(0,N.b)(1),(0,_e.x)()).subscribe(function(){e.buildFormGroupMap()}),this.buildFormGroupMap()}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe()}},{key:"trackByFn",value:function(e,t){return null!=t.id?t.id:e}},{key:"getFeaturedAsset",value:function(e){var t;return(null===(t=this.pendingAssetChanges[e.id])||void 0===t?void 0:t.featuredAsset)||e.featuredAsset}},{key:"optionGroupName",value:function(e){var t=this.optionGroups.find(function(t){return t.id===e});return t&&t.name}},{key:"buildFormGroupMap",value:function(){this.formGroupMap.clear();var e,t=r(this.formArray.controls);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.formGroupMap.set(n.value.id,n)}}catch(o){t.e(o)}finally{t.f()}this.changeDetector.markForCheck()}}]),e}();kr.\u0275fac=function(e){return new(e||kr)(k.Y36(k.sBO))},kr.\u0275cmp=k.Xpm({type:kr,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",paginationConfig:"paginationConfig",channelPriceIncludesTax:"channelPriceIncludesTax",optionGroups:"optionGroups",pendingAssetChanges:"pendingAssetChanges"},decls:24,vars:24,consts:[[1,"table"],[4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf","ngIfElse"],["placeholder",""],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"]],template:function(e,t){1&e&&(k.TgZ(0,"table",0),k.TgZ(1,"thead"),k.TgZ(2,"tr"),k._UZ(3,"th"),k.TgZ(4,"th"),k._uU(5),k.ALo(6,"translate"),k.qZA(),k.TgZ(7,"th"),k._uU(8),k.ALo(9,"translate"),k.qZA(),k.YNc(10,vr,3,1,"ng-container",1),k.ALo(11,"sort"),k.TgZ(12,"th"),k._uU(13),k.ALo(14,"translate"),k.qZA(),k.TgZ(15,"th"),k._uU(16),k.ALo(17,"translate"),k.qZA(),k.TgZ(18,"th"),k._uU(19),k.ALo(20,"translate"),k.qZA(),k.qZA(),k.qZA(),k.TgZ(21,"tbody"),k.YNc(22,Ar,2,1,"tr",2),k.ALo(23,"paginate"),k.qZA(),k.qZA()),2&e&&(k.xp6(5),k.Oqu(k.lcZ(6,8,"common.name")),k.xp6(3),k.Oqu(k.lcZ(9,10,"catalog.sku")),k.xp6(2),k.Q6J("ngForOf",k.xi3(11,12,t.optionGroups,"id")),k.xp6(3),k.Oqu(k.lcZ(14,15,"catalog.price")),k.xp6(3),k.Oqu(k.lcZ(17,17,"catalog.stock-on-hand")),k.xp6(3),k.Oqu(k.lcZ(20,19,"common.enabled")),k.xp6(3),k.Q6J("ngForOf",k.xi3(23,21,t.variants,t.paginationConfig))("ngForTrackBy",t.trackByFn))},directives:[I.sg,ce.q0d,I.O5,A.JL,A.sg,ce.G55,le.y,A.Fj,ce.xRP,A.JJ,A.u,A.qQ,A.wV,ce.PEh,A.Wl,ce.KKC,se.x,ce.qvL,ni.K],pipes:[w.X$,Ea.U,H._s,B.j,Ze.M,mr.s],styles:[".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0});var Pr=g(32930),Tr=function e(t){p(this,e),this.bulkActionRegistryService=t,t.registerBulkAction(qa),t.registerBulkAction(Oa),t.registerBulkAction(Fa),t.registerBulkAction(Ta),t.registerBulkAction(ma),t.registerBulkAction(va),t.registerBulkAction(fa),t.registerBulkAction(Bi),t.registerBulkAction(Ri),t.registerBulkAction(Hi)};Tr.\u0275fac=function(e){return new(e||Tr)(k.LFG(Z._4w))},Tr.\u0275mod=k.oAB({type:Tr}),Tr.\u0275inj=k.cJS({imports:[[Z.m81,v.Bz.forChild(Ci)]]}),k.B6R(bo,[P.Kk,P.BN,T.V,F.H,ce.PEh,le.y,A.Wl,ce.KKC,A.JJ,A.oH,ce.MgK,ae.S,P.mz,O.W,I.O5,A._Y,A.JL,A.sg,ce.gKI,ce.dl,ce.S4y,ce.Iq$,ce.Qs7,ce.tam,ce.UkA,A.x0,Qa.u,Ya.M,Pr.J,I.sg,Bt.Y,ja.n,ce.qvL,re.h,A.Fj,A.u,je.y,de.C,we,Rt.q,Pa,v.yS,E.w,G.L,kr,fr],[I.Ov,w.X$,Pn.E,B.j]),k.B6R(bt,[I.O5,ga,pe.Fd],[])}}])}();
//# sourceMappingURL=227-es5.7c2e48ef3720d724daf5.js.map