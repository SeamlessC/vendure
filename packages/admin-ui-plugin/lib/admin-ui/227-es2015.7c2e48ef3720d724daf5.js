"use strict";(self.webpackChunk_vendure_admin_ui=self.webpackChunk_vendure_admin_ui||[]).push([[227],{63227:function(e,t,n){n.r(t),n.d(t,{ApplyFacetDialogComponent:function(){return rn},AssetDetailComponent:function(){return Z},AssetListComponent:function(){return L},AssetResolver:function(){return ei},AssetsComponent:function(){return he},AssignProductsToChannelDialogComponent:function(){return Pn},AssignToChannelDialogComponent:function(){return vi},BulkAddFacetValuesDialogComponent:function(){return wi},CatalogModule:function(){return dr},CollectionContentsComponent:function(){return Fe},CollectionDetailComponent:function(){return We},CollectionListComponent:function(){return lt},CollectionResolver:function(){return ti},CollectionTreeComponent:function(){return ot},CollectionTreeNodeComponent:function(){return Ki},ConfirmVariantDeletionDialogComponent:function(){return _o},FacetDetailComponent:function(){return It},FacetListComponent:function(){return Gt},FacetResolver:function(){return ni},GET_PRODUCTS_WITH_FACET_VALUES_BY_IDS:function(){return bi},GET_VARIANTS_WITH_FACET_VALUES_BY_IDS:function(){return Ci},GenerateProductVariantsComponent:function(){return la},GeneratedVariant:function(){return Wo},OPTION_VALUE_INPUT_VALUE_ACCESSOR:function(){return No},OptionValueInputComponent:function(){return So},ProductDetailComponent:function(){return no},ProductDetailService:function(){return Fn},ProductListComponent:function(){return Ao},ProductOptionsEditorComponent:function(){return Fo},ProductResolver:function(){return oi},ProductVariantsEditorComponent:function(){return Xo},ProductVariantsListComponent:function(){return Wa},ProductVariantsResolver:function(){return ii},ProductVariantsTableComponent:function(){return cr},UPDATE_PRODUCTS_BULK:function(){return xi},UPDATE_VARIANTS_BULK:function(){return Ai},UpdateProductOptionDialogComponent:function(){return Za},VariantPriceDetailComponent:function(){return Pa},arrayToTree:function(){return tt},assetBreadcrumb:function(){return ui},assignCollectionsToChannelBulkAction:function(){return Mi},assignFacetValuesToProductsBulkAction:function(){return ga},assignFacetsToChannelBulkAction:function(){return Xi},assignProductsToChannelBulkAction:function(){return ua},catalogRoutes:function(){return ai},collectionBreadcrumb:function(){return di},deleteCollectionsBulkAction:function(){return ki},deleteFacetsBulkAction:function(){return Wi},deleteProductsBulkAction:function(){return da},facetBreadcrumb:function(){return li},productBreadcrumb:function(){return ri},productOptionsEditorBreadcrumb:function(){return ci},productVariantEditorBreadcrumb:function(){return si},removeCollectionsFromChannelBulkAction:function(){return _i},removeFacetsFromChannelBulkAction:function(){return ea},removeProductsFromChannelBulkAction:function(){return pa},replaceLast:function(){return On}});var o=n(16320),i=n(15455),a=n(30724),r=n(33927),s=n(1707),c=n(30464),l=n(27346),d=n(33146),u=n(38276),p=n(59416),g=n(83616),m=n(54364),h=n(70325);function f(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",4),c.NdJ("click",function(){return c.CHM(e),c.oxw().save()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.update")," ")}}const v=function(){return["UpdateCatalog","UpdateAsset"]};class Z extends i.UT_{constructor(e,t,n,o,i,a){super(t,e,n,i),this.notificationService=o,this.dataService=i,this.formBuilder=a,this.detailForm=new s.cw({}),this.customFields=this.getCustomFieldConfig("Asset")}ngOnInit(){this.detailForm=new s.cw({name:new s.NI(""),tags:new s.NI([]),customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))}),this.init()}ngOnDestroy(){this.destroy()}onAssetChange(e){var t,n;null===(t=this.detailForm.get("name"))||void 0===t||t.setValue(e.name),null===(n=this.detailForm.get("tags"))||void 0===n||n.setValue(e.tags),this.detailForm.markAsDirty()}save(){this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-update-success"),{entity:"Asset"})},e=>{this.notificationService.error((0,a.J)("common.notify-update-error"),{entity:"Asset"})})}setFormValues(e,t){var n,o;null===(n=this.detailForm.get("name"))||void 0===n||n.setValue(e.name),null===(o=this.detailForm.get("tags"))||void 0===o||o.setValue(e.tags),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),e)}}Z.\u0275fac=function(e){return new(e||Z)(c.Y36(o.F0),c.Y36(o.gz),c.Y36(i.iHG),c.Y36(i.gqp),c.Y36(i.DoR),c.Y36(s.qu))},Z.\u0275cmp=c.Xpm({type:Z,selectors:[["vdr-asset-detail"]],features:[c.qOj],decls:9,vars:11,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","customFields","customFieldsForm","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left"),c._UZ(2,"vdr-entity-info",0),c.ALo(3,"async"),c.qZA(),c.TgZ(4,"vdr-ab-right"),c._UZ(5,"vdr-action-bar-items",1),c.YNc(6,f,3,4,"button",2),c.qZA(),c.qZA(),c.TgZ(7,"vdr-asset-preview",3),c.NdJ("assetChange",function(e){return t.onAssetChange(e)}),c.ALo(8,"async"),c.qZA()),2&e&&(c.xp6(2),c.Q6J("entity",c.lcZ(3,6,t.entity$)),c.xp6(4),c.Q6J("vdrIfPermissions",c.DdM(10,v)),c.xp6(1),c.Q6J("asset",c.lcZ(8,8,t.entity$))("editable",!0)("customFields",t.customFields)("customFieldsForm",t.detailForm.get("customFields")))},directives:[l.Kk,l.BN,d.V,l.mz,u.W,p.H,g.A],pipes:[m.Ov,h.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0});var b=n(76491),C=n(61486),x=n(8117),A=n(80639),y=n(22663),P=n(71435),T=n(79902),O=n(12688),F=n(84042),q=n(89206),I=n(6940),w=n(50322),k=n(57483),M=n(97388);const _=function(){return{}},J=function(){return["DeleteCatalog","DeleteAsset"]};class L extends i.t7C{constructor(e,t,n,o,a){super(o,a),this.notificationService=e,this.modalService=t,this.dataService=n,this.searchTerm$=new b.X(void 0),this.filterByTags$=new b.X(void 0),this.uploading=!1,super.setQueryFn((...e)=>this.dataService.product.getAssetList(...e),e=>e.assets,(e,t)=>{var n;const o=this.searchTerm$.value,a=null===(n=this.filterByTags$.value)||void 0===n?void 0:n.map(e=>e.value);return{options:Object.assign(Object.assign({skip:e,take:t},o?{filter:{name:{contains:o}}}:{}),{sort:{createdAt:i.Asd.DESC},tags:a,tagsOperator:i.FnJ.AND})}},{take:25,skip:0})}ngOnInit(){super.ngOnInit(),this.paginationConfig$=(0,C.aj)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe((0,r.U)(([e,t,n])=>({itemsPerPage:e,currentPage:t,totalItems:n}))),this.searchTerm$.pipe((0,A.b)(250),(0,y.R)(this.destroy$)).subscribe(()=>this.refresh()),this.filterByTags$.pipe((0,y.R)(this.destroy$)).subscribe(()=>this.refresh()),this.allTags$=this.dataService.product.getTagList().mapStream(e=>e.tags.items)}filesSelected(e){e.length&&(this.uploading=!0,this.dataService.product.createAssets(e).pipe((0,P.x)(()=>this.uploading=!1)).subscribe(({createAssets:e})=>{let t=0;for(const n of e)switch(n.__typename){case"Asset":t++;break;case"MimeTypeError":this.notificationService.error(n.message)}0<t&&(super.refresh(),this.notificationService.success((0,a.J)("asset.notify-create-assets-success"),{count:t}))}))}deleteAssets(e){this.showModalAndDelete(e.map(e=>e.id)).pipe((0,T.w)(t=>t.result===i.PcR.DELETED?[!0]:this.showModalAndDelete(e.map(e=>e.id),t.message||"").pipe((0,r.U)(e=>e.result===i.PcR.DELETED)))).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"Assets"}),this.refresh()},e=>{this.notificationService.error((0,a.J)("common.notify-delete-error"),{entity:"Assets"})})}showModalAndDelete(e,t){return this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-assets"),translationVars:{count:e.length},body:t,buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(n=>n?this.dataService.product.deleteAssets(e,!!t):x.E),(0,r.U)(e=>e.deleteAssets))}}L.\u0275fac=function(e){return new(e||L)(c.Y36(i.gqp),c.Y36(i.Z7U),c.Y36(i.DoR),c.Y36(o.F0),c.Y36(o.gz))},L.\u0275cmp=c.Xpm({type:L,selectors:[["vdr-asset-list"]],features:[c.qOj],decls:19,vars:31,consts:[[3,"grow"],[1,"pr4","mt1",3,"tags","searchTermChange","tagsChange"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(e,t){1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left",0),c.TgZ(2,"vdr-asset-search-input",1),c.NdJ("searchTermChange",function(e){return t.searchTerm$.next(e)})("tagsChange",function(e){return t.filterByTags$.next(e)}),c.ALo(3,"async"),c.qZA(),c.qZA(),c.TgZ(4,"vdr-ab-right"),c._UZ(5,"vdr-action-bar-items",2),c.TgZ(6,"vdr-asset-file-input",3),c.NdJ("selectFiles",function(e){return t.filesSelected(e)}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(7,"vdr-asset-gallery",4),c.NdJ("deleteAssets",function(e){return t.deleteAssets(e)}),c.ALo(8,"paginate"),c.ALo(9,"async"),c.ALo(10,"async"),c.ALo(11,"hasPermission"),c.qZA(),c.TgZ(12,"div",5),c.TgZ(13,"vdr-items-per-page-controls",6),c.NdJ("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),c.ALo(14,"async"),c.qZA(),c.TgZ(15,"vdr-pagination-controls",7),c.NdJ("pageChange",function(e){return t.setPageNumber(e)}),c.ALo(16,"async"),c.ALo(17,"async"),c.ALo(18,"async"),c.qZA(),c.qZA()),2&e&&(c.xp6(1),c.Q6J("grow",!0),c.xp6(1),c.Q6J("tags",c.lcZ(3,10,t.allTags$)),c.xp6(4),c.Q6J("uploading",t.uploading),c.xp6(1),c.Q6J("assets",c.xi3(8,12,c.lcZ(9,15,t.items$),c.lcZ(10,17,t.paginationConfig$)||c.DdM(29,_)))("multiSelect",!0)("canDelete",c.lcZ(11,19,c.DdM(30,J))),c.xp6(6),c.Q6J("itemsPerPage",c.lcZ(14,21,t.itemsPerPage$)),c.xp6(2),c.Q6J("currentPage",c.lcZ(16,23,t.currentPage$))("itemsPerPage",c.lcZ(17,25,t.itemsPerPage$))("totalItems",c.lcZ(18,27,t.totalItems$)))},directives:[l.Kk,l.BN,O.V,l.mz,u.W,F.e,q.K,I.w,w.L],pipes:[m.Ov,k._s,M.j],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});var U=n(22490),V=n(79441),N=n(89919),S=n(81134),$=n(9170),D=n(53466),Q=n(85816),Y=n(87425),j=n(34652),E=n(65671),G=n(57890),H=n(63516),B=n(13628),R=n(82505),z=n(6411),K=n(31643),W=n(30735),X=n(41519),ee=n(28854),te=n(15111),ne=n(51353);function oe(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"img",11),c.NdJ("click",function(){c.CHM(e);const t=c.oxw(2);return t.previewAsset(t.featuredAsset)}),c.ALo(1,"assetPreview"),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("src",c.xi3(1,1,e.featuredAsset,"small"),c.LSH)}}function ie(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",12),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).selectAssets()}),c._UZ(1,"clr-icon",13),c.TgZ(2,"div"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA()}2&e&&(c.xp6(3),c.Oqu(c.lcZ(4,1,"catalog.no-featured-asset")))}function ae(e,t){1&e&&c.GkF(0)}function re(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",14),c.TgZ(1,"button",15),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).selectAssets()}),c._UZ(2,"clr-icon",16),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA()}2&e&&(c.xp6(3),c.hij(" ",c.lcZ(4,1,"asset.add-asset")," "))}function se(e,t){if(1&e&&(c.TgZ(0,"div",3),c.TgZ(1,"div",4),c.TgZ(2,"div",5),c.YNc(3,oe,2,4,"img",6),c.YNc(4,ie,5,3,"div",7),c.qZA(),c.qZA(),c.TgZ(5,"div",8),c.YNc(6,ae,1,0,"ng-container",9),c.qZA(),c.YNc(7,re,5,3,"div",10),c.qZA()),2&e){const e=c.oxw(),t=c.MAs(4);c.xp6(3),c.Q6J("ngIf",e.featuredAsset),c.xp6(1),c.Q6J("ngIf",!e.featuredAsset),c.xp6(2),c.Q6J("ngTemplateOutlet",t),c.xp6(1),c.Q6J("vdrIfPermissions",e.updatePermissions)}}function ce(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"img",11),c.NdJ("click",function(){c.CHM(e);const t=c.oxw(2);return t.previewAsset(t.featuredAsset)}),c.ALo(1,"assetPreview"),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("src",c.xi3(1,1,e.featuredAsset,"thumb"),c.LSH)}}function le(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",12),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).selectAssets()}),c._UZ(1,"clr-icon",19),c.qZA()}}function de(e,t){1&e&&c.GkF(0)}function ue(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",20),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).selectAssets()}),c.ALo(1,"translate"),c._UZ(2,"clr-icon",16),c._uU(3),c.ALo(4,"translate"),c.qZA()}2&e&&(c.Q6J("title",c.lcZ(1,2,"asset.add-asset")),c.xp6(3),c.hij(" ",c.lcZ(4,4,"asset.add-asset")," "))}function pe(e,t){if(1&e&&(c.TgZ(0,"div",17),c.YNc(1,ce,2,4,"img",6),c.YNc(2,le,2,0,"div",7),c.qZA(),c.YNc(3,de,1,0,"ng-container",9),c.YNc(4,ue,5,6,"button",18)),2&e){const e=c.oxw(),t=c.MAs(4);c.xp6(1),c.Q6J("ngIf",e.featuredAsset),c.xp6(1),c.Q6J("ngIf",!e.featuredAsset),c.xp6(1),c.Q6J("ngTemplateOutlet",t),c.xp6(1),c.Q6J("vdrIfPermissions",e.updatePermissions)}}function ge(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",23),c.NdJ("cdkDropListDropped",function(t){return c.CHM(e),c.oxw(2).dropListDropped(t)}),c.ALo(1,"hasPermission"),c.TgZ(2,"vdr-dropdown",24),c.TgZ(3,"div",25),c._UZ(4,"img",26),c.ALo(5,"assetPreview"),c.qZA(),c.TgZ(6,"vdr-dropdown-menu",27),c.TgZ(7,"button",28),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw(2).previewAsset(t)}),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.TgZ(10,"button",29),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw(2).setAsFeatured(t)}),c.ALo(11,"hasPermission"),c._uU(12),c.ALo(13,"translate"),c.qZA(),c._UZ(14,"div",30),c.TgZ(15,"button",31),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw(2).removeAsset(t)}),c.ALo(16,"hasPermission"),c._uU(17),c.ALo(18,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,n=t.index,o=c.oxw(2);c.Q6J("cdkDropListData",n)("cdkDropListDisabled",!c.lcZ(1,10,o.updatePermissions)),c.xp6(3),c.ekj("featured",o.isFeatured(e)),c.xp6(1),c.Q6J("src",c.xi3(5,12,e,"tiny"),c.LSH),c.xp6(4),c.hij(" ",c.lcZ(9,15,"asset.preview")," "),c.xp6(2),c.Q6J("disabled",o.isFeatured(e)||!c.lcZ(11,17,o.updatePermissions)),c.xp6(2),c.hij(" ",c.lcZ(13,19,"asset.set-as-featured-asset")," "),c.xp6(3),c.Q6J("disabled",!c.lcZ(16,21,o.updatePermissions)),c.xp6(2),c.hij(" ",c.lcZ(18,23,"asset.remove-asset")," ")}}function me(e,t){if(1&e&&(c.TgZ(0,"div",21),c.YNc(1,ge,19,25,"div",22),c.qZA()),2&e){const e=c.oxw();c.ekj("compact",e.compact),c.xp6(1),c.Q6J("ngForOf",e.assets)}}class he{constructor(e,t){this.modalService=e,this.changeDetector=t,this.compact=!1,this.change=new c.vpe,this.assets=[]}set assetsSetter(e){this.assets=(e||[]).slice()}selectAssets(){this.modalService.fromComponent(i.V61,{size:"xl"}).subscribe(e=>{e&&e.length&&(this.assets=(0,K.T)(this.assets.concat(e),"id"),this.featuredAsset||(this.featuredAsset=e[0]),this.emitChangeEvent(this.assets,this.featuredAsset),this.changeDetector.markForCheck())})}setAsFeatured(e){this.featuredAsset=e,this.emitChangeEvent(this.assets,e)}isFeatured(e){return!!this.featuredAsset&&this.featuredAsset.id===e.id}previewAsset(e){this.modalService.fromComponent(i.IW,{size:"xl",closable:!0,locals:{asset:e}}).subscribe()}removeAsset(e){this.assets=this.assets.filter(t=>t.id!==e.id),this.featuredAsset&&this.featuredAsset.id===e.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}emitChangeEvent(e,t){this.change.emit({assets:e,featuredAsset:t})}dropListDropped(e){(0,z.bA)(this.assets,e.previousContainer.data,e.container.data),this.emitChangeEvent(this.assets,this.featuredAsset)}}he.\u0275fac=function(e){return new(e||he)(c.Y36(i.Z7U),c.Y36(c.sBO))},he.\u0275cmp=c.Xpm({type:he,selectors:[["vdr-assets"]],hostVars:2,hostBindings:function(e,t){2&e&&c.ekj("compact",t.compact)},inputs:{assetsSetter:["assets","assetsSetter"],featuredAsset:"featuredAsset",compact:"compact",updatePermissions:"updatePermissions"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["class","drop-list","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"drop-list",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["cdkDrag",""],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(e,t){if(1&e&&(c.YNc(0,se,8,4,"div",0),c.YNc(1,pe,5,4,"ng-template",null,1,c.W1O),c.YNc(3,me,2,3,"ng-template",null,2,c.W1O)),2&e){const e=c.MAs(2);c.Q6J("ngIf",!t.compact)("ngIfElse",e)}},directives:[m.O5,m.tP,p.H,E.qvL,z.Fd,m.sg,z.Wj,W.J,z.Zt,X.U,ee.N,te.H],pipes:[ne.M,h.X$,M.j],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer;border-radius:var(--border-radius-img)}.featured-asset[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:60px}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);border-radius:var(--border-radius-img);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:var(--border-radius-img)}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500);border-radius:calc(var(--border-radius-img) + 2px)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:54px}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{width:50px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){display:none}"],changeDetection:0});var fe=n(1143),ve=n(83720),Ze=n(14921),be=n(18293),Ce=n(20365),xe=n(28899);function Ae(e,t){1&e&&c.GkF(0)}const ye=function(){return{tab:"variants"}},Pe=function(e,t){return["/catalog/products",e,t]};function Te(e,t){if(1&e&&(c.TgZ(0,"td",7),c._uU(1),c.qZA(),c.TgZ(2,"td",7),c.TgZ(3,"small",8),c._uU(4),c.qZA(),c.qZA(),c.TgZ(5,"td",9),c._UZ(6,"vdr-table-row-action",10),c.ALo(7,"translate"),c.qZA()),2&e){const e=t.item;c.xp6(1),c.Oqu(e.name),c.xp6(3),c.Oqu(e.sku),c.xp6(2),c.Q6J("label",c.lcZ(7,4,"common.edit"))("linkTo",c.WLB(7,Pe,e.productId,c.DdM(6,ye)))}}const Oe=function(e){return{$implicit:e}};class Fe{constructor(e,t,n){this.route=e,this.router=t,this.dataService=n,this.previewUpdatedFilters=!1,this.filterTermControl=new s.NI(""),this.isLoading=!1,this.collectionIdChange$=new b.X(""),this.parentIdChange$=new b.X(""),this.filterChanges$=new b.X([]),this.refresh$=new b.X(!0),this.destroy$=new V.xQ}ngOnInit(){this.contentsCurrentPage$=this.route.queryParamMap.pipe((0,r.U)(e=>e.get("contentsPage")),(0,r.U)(e=>e?+e:1),(0,fe.O)(1),(0,ve.x)()),this.contentsItemsPerPage$=this.route.queryParamMap.pipe((0,r.U)(e=>e.get("contentsPerPage")),(0,r.U)(e=>e?+e:10),(0,fe.O)(10),(0,ve.x)());const e=this.filterTermControl.valueChanges.pipe((0,A.b)(250),(0,Ze.b)(()=>this.setContentsPageNumber(1)),(0,fe.O)("")),t=this.filterChanges$.asObservable().pipe((0,$.h)(()=>this.previewUpdatedFilters),(0,Ze.b)(()=>this.setContentsPageNumber(1)),(0,fe.O)([])),n=(0,C.aj)(this.collectionIdChange$,this.parentIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,e,t,this.refresh$).pipe((0,y.R)(this.destroy$),(0,Ze.b)(()=>this.isLoading=!0),(0,A.b)(50),(0,T.w)(([e,t,n,o,i,a])=>{const r=o,s=(n-1)*o;if(a.length&&this.previewUpdatedFilters){const e=i?{name:{contains:i}}:void 0;return this.dataService.collection.previewCollectionVariants({parentId:t,filters:a},{take:r,skip:s,filter:e}).mapSingle(e=>e.previewCollectionVariants).pipe((0,be.K)(()=>(0,S.of)({items:[],totalItems:0})))}return e?this.dataService.collection.getCollectionContents(e,r,s,i).mapSingle(e=>{var t;return null===(t=e.collection)||void 0===t?void 0:t.productVariants}):(0,S.of)(null)}),(0,Ze.b)(()=>this.isLoading=!1),(0,P.x)(()=>this.isLoading=!1));this.contents$=n.pipe((0,r.U)(e=>e?e.items:[])),this.contentsTotalItems$=n.pipe((0,r.U)(e=>e?e.totalItems:0))}ngOnChanges(e){"collectionId"in e&&this.collectionIdChange$.next(e.collectionId.currentValue),"parentId"in e&&this.parentIdChange$.next(e.parentId.currentValue),"updatedFilters"in e&&this.updatedFilters&&this.filterChanges$.next(this.updatedFilters)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(e){this.setParam("contentsPage",e)}setContentsItemsPerPage(e){this.setParam("contentsPerPage",e)}refresh(){this.refresh$.next(!0)}setParam(e,t){this.router.navigate(["./"],{relativeTo:this.route,queryParams:{[e]:t},queryParamsHandling:"merge",replaceUrl:!0})}}Fe.\u0275fac=function(e){return new(e||Fe)(c.Y36(o.gz),c.Y36(o.F0),c.Y36(i.DoR))},Fe.\u0275cmp=c.Xpm({type:Fe,selectors:[["vdr-collection-contents"]],contentQueries:function(e,t,n){if(1&e&&c.Suo(n,c.Rgc,7),2&e){let e;c.iGM(e=c.CRH())&&(t.headerTemplate=e.first)}},inputs:{collectionId:"collectionId",parentId:"parentId",updatedFilters:"updatedFilters",previewUpdatedFilters:"previewUpdatedFilters"},features:[c.TTD],decls:14,vars:26,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",3,"placeholder","formControl"],[1,"table-wrapper"],[1,"progress","loop"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"sku"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.YNc(2,Ae,1,0,"ng-container",2),c.ALo(3,"async"),c.qZA(),c._UZ(4,"input",3),c.ALo(5,"translate"),c.qZA(),c.TgZ(6,"div",4),c._UZ(7,"div",5),c.TgZ(8,"vdr-data-table",6),c.NdJ("pageChange",function(e){return t.setContentsPageNumber(e)})("itemsPerPageChange",function(e){return t.setContentsItemsPerPage(e)}),c.ALo(9,"async"),c.ALo(10,"async"),c.ALo(11,"async"),c.ALo(12,"async"),c.YNc(13,Te,8,10,"ng-template"),c.qZA(),c.qZA()),2&e&&(c.xp6(2),c.Q6J("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",c.VKq(24,Oe,c.lcZ(3,12,t.contentsTotalItems$))),c.xp6(2),c.Q6J("placeholder",c.lcZ(5,14,"catalog.filter-by-name"))("formControl",t.filterTermControl),c.xp6(3),c.ekj("visible",t.isLoading),c.xp6(1),c.ekj("loading",t.isLoading),c.Q6J("items",c.lcZ(9,16,t.contents$))("itemsPerPage",c.lcZ(10,18,t.contentsItemsPerPage$))("totalItems",c.lcZ(11,20,t.contentsTotalItems$))("currentPage",c.lcZ(12,22,t.contentsCurrentPage$)))},directives:[m.tP,G.y,s.Fj,s.JJ,s.oH,Ce.Q,xe.v],pipes:[m.Ov,h.X$],styles:[".contents-header[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     table{margin-top:-1px}vdr-data-table[_ngcontent-%COMP%]{opacity:1;transition:opacity .3s}vdr-data-table.loading[_ngcontent-%COMP%]{opacity:.5}.table-wrapper[_ngcontent-%COMP%]{position:relative}.progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;overflow:hidden;height:6px;opacity:0;transition:opacity .1s}.progress.visible[_ngcontent-%COMP%]{opacity:1}.sku[_ngcontent-%COMP%]{color:var(--color-text-200)}"],changeDetection:0});var qe=n(50837),Ie=n(54116);const we=["collectionContents"];function ke(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",6),c.NdJ("click",function(){return c.CHM(e),c.oxw().create()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.create")," ")}}function Me(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",6),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).save()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("disabled",(e.detailForm.invalid||e.detailForm.pristine)&&!e.assetsChanged()),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.update")," ")}}function _e(e,t){if(1&e&&c.YNc(0,Me,3,4,"button",7),2&e){const e=c.oxw();c.Q6J("vdrIfPermissions",e.updatePermission)}}const Je=function(){return["/catalog/collections"]};function Le(e,t){1&e&&(c.TgZ(0,"a",35),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&e&&(c.Q6J("routerLink",c.DdM(4,Je)),c.xp6(1),c.Oqu(c.lcZ(2,2,"catalog.root-collection")))}const Ue=function(e){return["/catalog/collections",e]};function Ve(e,t){if(1&e&&(c.TgZ(0,"a",35),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&e){const e=c.oxw().$implicit;c.Q6J("routerLink",c.VKq(4,Ue,e.id)),c.xp6(1),c.Oqu(c.lcZ(2,2,e.name))}}function Ne(e,t){if(1&e&&(c.ynx(0),c._uU(1),c.ALo(2,"translate"),c.BQk()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.Oqu(c.lcZ(2,1,e.name))}}function Se(e,t){if(1&e&&(c.TgZ(0,"li"),c.YNc(1,Le,3,5,"a",33),c.YNc(2,Ve,3,6,"a",33),c.YNc(3,Ne,3,3,"ng-container",34),c.qZA()),2&e){const e=t.first,n=t.last;c.xp6(1),c.Q6J("ngIf",e),c.xp6(1),c.Q6J("ngIf",!e&&!n),c.xp6(1),c.Q6J("ngIf",n)}}function $e(e,t){1&e&&(c.ynx(0),c._uU(1),c.ALo(2,"translate"),c.BQk()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"catalog.public")))}function De(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.Oqu(c.lcZ(1,1,"catalog.private"))}const Qe=function(){return["customFields"]};function Ye(e,t){if(1&e&&(c.TgZ(0,"section",36),c.TgZ(1,"label"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c._UZ(4,"vdr-tabbed-custom-fields",37),c.ALo(5,"hasPermission"),c.qZA()),2&e){const e=c.oxw(2);c.xp6(2),c.Oqu(c.lcZ(3,4,"common.custom-fields")),c.xp6(2),c.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get(c.DdM(8,Qe)))("readonly",!c.lcZ(5,6,e.updatePermission))}}function je(e,t){if(1&e){const e=c.EpF();c.ynx(0),c.TgZ(1,"vdr-configurable-input",38),c.NdJ("remove",function(){const t=c.CHM(e).index;return c.oxw(2).removeFilter(t)}),c.ALo(2,"hasPermission"),c.qZA(),c.BQk()}if(2&e){const e=t.$implicit,n=t.index,o=c.oxw(2);c.xp6(1),c.Q6J("position",n)("operation",e)("operationDefinition",o.getFilterDefinition(e))("formControlName",n)("readonly",!c.lcZ(2,5,o.updatePermission))}}function Ee(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",43),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw(3).addFilter(t)}),c._uU(1),c.qZA()}if(2&e){const e=t.$implicit;c.xp6(1),c.hij(" ",e.description," ")}}function Ge(e,t){if(1&e&&(c.TgZ(0,"div"),c.TgZ(1,"vdr-dropdown"),c.TgZ(2,"button",39),c._UZ(3,"clr-icon",40),c._uU(4),c.ALo(5,"translate"),c.qZA(),c.TgZ(6,"vdr-dropdown-menu",41),c.YNc(7,Ee,2,1,"button",42),c.qZA(),c.qZA(),c.qZA()),2&e){const e=c.oxw(2);c.xp6(4),c.hij(" ",c.lcZ(5,2,"marketing.add-condition")," "),c.xp6(3),c.Q6J("ngForOf",e.allFilters)}}const He=function(e){return{count:e}},Be=function(){return{standalone:!0}};function Re(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",44),c._uU(1),c.ALo(2,"translate"),c.ALo(3,"translate"),c.qZA(),c.TgZ(4,"clr-checkbox-wrapper"),c.TgZ(5,"input",45),c.NdJ("ngModelChange",function(){return c.CHM(e),c.oxw(2).toggleLivePreview()}),c.qZA(),c.TgZ(6,"label"),c._uU(7),c.ALo(8,"translate"),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,n=c.oxw(2);let o,i;c.xp6(1),c.AsE(" ",c.lcZ(2,8,"catalog.collection-contents")," (",c.xi3(3,10,"common.results-count",c.VKq(15,He,e)),") "),c.xp6(3),c.ekj("disabled",null==(o=n.detailForm.get("filters"))?null:o.pristine),c.xp6(1),c.Q6J("ngModelOptions",c.DdM(17,Be))("disabled",null==(i=n.detailForm.get("filters"))?null:i.pristine)("ngModel",n.livePreview),c.xp6(2),c.Oqu(c.lcZ(8,13,"catalog.live-preview-contents"))}}const ze=function(e){return{pattern:e}};function Ke(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"form",8),c.TgZ(1,"nav",9),c.TgZ(2,"ul",10),c.YNc(3,Se,4,3,"li",11),c.qZA(),c.qZA(),c.TgZ(4,"div",12),c.TgZ(5,"div",13),c.TgZ(6,"vdr-form-field",14),c.ALo(7,"translate"),c.TgZ(8,"clr-toggle-wrapper"),c._UZ(9,"input",15),c.ALo(10,"hasPermission"),c.TgZ(11,"label",16),c.YNc(12,$e,3,3,"ng-container",17),c.YNc(13,De,2,3,"ng-template",null,18,c.W1O),c.qZA(),c.qZA(),c.qZA(),c.TgZ(15,"vdr-form-field",19),c.ALo(16,"translate"),c.TgZ(17,"input",20),c.NdJ("input",function(t){return c.CHM(e),c.oxw().updateSlug(t.target.value)}),c.ALo(18,"hasPermission"),c.qZA(),c.qZA(),c.TgZ(19,"vdr-form-field",21),c.ALo(20,"translate"),c.ALo(21,"translate"),c._UZ(22,"input",22),c.ALo(23,"hasPermission"),c.qZA(),c._UZ(24,"vdr-rich-text-editor",23),c.ALo(25,"hasPermission"),c.ALo(26,"translate"),c.YNc(27,Ye,6,9,"section",24),c._UZ(28,"vdr-custom-detail-component-host",25),c.qZA(),c.TgZ(29,"div",26),c.TgZ(30,"vdr-assets",27),c.NdJ("change",function(t){c.CHM(e);return c.oxw().assetChanges=t}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(31,"div",28),c.TgZ(32,"div",13),c.TgZ(33,"label"),c._uU(34),c.ALo(35,"translate"),c.qZA(),c.YNc(36,je,3,7,"ng-container",29),c.YNc(37,Ge,8,4,"div",30),c.qZA(),c.TgZ(38,"div",13),c.TgZ(39,"vdr-collection-contents",31,32),c.ALo(41,"async"),c.ALo(42,"async"),c.YNc(43,Re,9,18,"ng-template"),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.ngIf,n=c.MAs(14),o=c.oxw();c.Q6J("formGroup",o.detailForm),c.xp6(3),c.Q6J("ngForOf",e.breadcrumbs),c.xp6(3),c.Q6J("label",c.lcZ(7,27,"catalog.visibility")),c.xp6(3),c.Q6J("vdrDisabled",!c.lcZ(10,29,o.updatePermission)),c.xp6(3),c.Q6J("ngIf",o.detailForm.value.visible)("ngIfElse",n),c.xp6(3),c.Q6J("label",c.lcZ(16,31,"common.name")),c.xp6(2),c.Q6J("readonly",!c.lcZ(18,33,o.updatePermission)),c.xp6(2),c.Q6J("label",c.lcZ(20,35,"catalog.slug"))("errors",c.VKq(51,ze,c.lcZ(21,37,"catalog.slug-pattern-error"))),c.xp6(3),c.Q6J("readonly",!c.lcZ(23,39,o.updatePermission)),c.xp6(2),c.Q6J("readonly",!c.lcZ(25,41,o.updatePermission))("label",c.lcZ(26,43,"common.description")),c.xp6(3),c.Q6J("ngIf",o.customFields.length),c.xp6(1),c.Q6J("entity$",o.entity$)("detailForm",o.detailForm),c.xp6(2),c.Q6J("assets",e.assets)("featuredAsset",e.featuredAsset)("updatePermissions",o.updatePermission),c.xp6(4),c.Oqu(c.lcZ(35,45,"catalog.filters")),c.xp6(2),c.Q6J("ngForOf",o.filters)("ngForTrackBy",o.trackByFn),c.xp6(1),c.Q6J("vdrIfPermissions",o.updatePermission),c.xp6(2),c.Q6J("collectionId",o.id)("parentId",c.lcZ(41,47,o.parentId$))("updatedFilters",c.lcZ(42,49,o.updatedFilters$))("previewUpdatedFilters",o.livePreview)}}class We extends i.UT_{constructor(e,t,n,o,a,r,c,l,d){var u;super(t,e,n,a),this.changeDetector=o,this.dataService=a,this.formBuilder=r,this.notificationService=c,this.modalService=l,this.localStorageService=d,this.assetChanges={},this.filters=[],this.allFilters=[],this.livePreview=!1,this.updatePermission=[i.y3$.UpdateCatalog,i.y3$.UpdateCollection],this.filterRemoved$=new V.xQ,this.customFields=this.getCustomFieldConfig("Collection"),this.detailForm=this.formBuilder.group({name:["",s.kI.required],slug:["",(0,i.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",visible:!1,filters:this.formBuilder.array([]),customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))}),this.livePreview=null!==(u=this.localStorageService.get("livePreviewCollectionContents"))&&void 0!==u&&u}ngOnInit(){this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe(e=>{this.allFilters=e.collectionFilters});const e=this.detailForm.get("filters");this.updatedFilters$=(0,N.T)(e.statusChanges,this.filterRemoved$).pipe((0,A.b)(200),(0,$.h)(()=>e.touched),(0,r.U)(()=>this.mapOperationsToInputs(this.filters,e.value).filter(e=>{for(const t of e.arguments)if(""===t.value)return!1;return!0}))),this.parentId$=this.route.paramMap.pipe((0,r.U)(e=>e.get("parentId")||void 0),(0,T.w)(e=>e?(0,S.of)(e):this.entity$.pipe((0,r.U)(e=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.id}))))}ngOnDestroy(){this.destroy()}getFilterDefinition(e){return this.allFilters.find(t=>t.code===e.code)}assetsChanged(){return!!Object.values(this.assetChanges).length}updateSlug(e){(0,C.aj)(this.entity$,this.languageCode$).pipe((0,D.q)(1)).subscribe(([t,n])=>{const o=this.detailForm.get(["slug"]),a=(0,i.ZIM)(t,n),r=!a||!a.slug;o&&o.pristine&&r&&o.setValue((0,U.U)(`${e}`,"-"))})}addFilter(e){const t=this.detailForm.get("filters"),n=e.args.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:(0,i.sux)(t.value)}),{});t.push(this.formBuilder.control({code:e.code,args:n})),this.filters.push({code:e.code,args:e.args.map(e=>({name:e.name,value:(0,i.sux)(e.value)}))})}removeFilter(e){const t=this.detailForm.get("filters");-1!==e&&(t.removeAt(e),t.markAsDirty(),t.markAsTouched(),this.filters.splice(e,1),this.filterRemoved$.next())}create(){!this.detailForm.dirty||(0,C.aj)(this.entity$,this.languageCode$).pipe((0,D.q)(1),(0,Q.zg)(([e,t])=>{const n=this.getUpdatedCollection(e,this.detailForm,t),o=this.route.snapshot.paramMap.get("parentId");return o&&(n.parentId=o),this.dataService.collection.createCollection(n)})).subscribe(e=>{this.notificationService.success((0,a.J)("common.notify-create-success"),{entity:"Collection"}),this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",e.createCollection.id],{relativeTo:this.route})},e=>{this.notificationService.error((0,a.J)("common.notify-create-error"),{entity:"Collection"})})}save(){(0,C.aj)(this.entity$,this.languageCode$).pipe((0,D.q)(1),(0,Q.zg)(([e,t])=>{const n=this.getUpdatedCollection(e,this.detailForm,t);return this.dataService.collection.updateCollection(n)})).subscribe(()=>{this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,a.J)("common.notify-update-success"),{entity:"Collection"}),this.contentsComponent.refresh()},e=>{this.notificationService.error((0,a.J)("common.notify-update-error"),{entity:"Collection"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}toggleLivePreview(){this.livePreview=!this.livePreview,this.localStorageService.set("livePreviewCollectionContents",this.livePreview)}trackByFn(e,t){return JSON.stringify(t)}setFormValues(e,t){const n=(0,i.ZIM)(e,t);this.detailForm.patchValue({name:n?n.name:"",slug:n?n.slug:"",description:n?n.description:"",visible:!e.isPrivate});const o=this.detailForm.get("filters");o.length!==e.filters.length&&(o.clear(),this.filters=[],e.filters.forEach(e=>this.addFilter(e))),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),e,n)}getUpdatedCollection(e,t,n){var o,a;const r=(0,i.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},r),{assetIds:null===(o=this.assetChanges.assets)||void 0===o?void 0:o.map(e=>e.id),featuredAssetId:null===(a=this.assetChanges.featuredAsset)||void 0===a?void 0:a.id,isPrivate:!t.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}mapOperationsToInputs(e,t){return e.map((e,n)=>({code:e.code,arguments:Object.entries(t[n].args).map(([e,t],n)=>({name:e,value:(0,i.qrw)(t)}))}))}}We.\u0275fac=function(e){return new(e||We)(c.Y36(o.F0),c.Y36(o.gz),c.Y36(i.iHG),c.Y36(c.sBO),c.Y36(i.DoR),c.Y36(s.qu),c.Y36(i.gqp),c.Y36(i.Z7U),c.Y36(i.n2A))},We.\u0275cmp=c.Xpm({type:We,selectors:[["vdr-collection-detail"]],viewQuery:function(e,t){if(1&e&&c.Gf(we,5),2&e){let e;c.iGM(e=c.CRH())&&(t.contentsComponent=e.first)}},features:[c.qOj],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["role","navigation"],[1,"collection-breadcrumbs"],[4,"ngFor","ngForOf"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],["locationId","collection-detail",3,"entity$","detailForm"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","updatePermissions","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"vdrIfPermissions"],[3,"collectionId","parentId","updatedFilters","previewUpdatedFilters"],["collectionContents",""],[3,"routerLink",4,"ngIf"],[4,"ngIf"],[3,"routerLink"],["formGroupName","customFields"],["entityName","Collection",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","operation","operationDefinition","formControlName","readonly","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"],["type","checkbox","clrCheckbox","",3,"ngModelOptions","disabled","ngModel","ngModelChange"]],template:function(e,t){if(1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left"),c._UZ(2,"vdr-entity-info",0),c.ALo(3,"async"),c.TgZ(4,"vdr-language-selector",1),c.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),c.ALo(5,"async"),c.ALo(6,"async"),c.ALo(7,"async"),c.qZA(),c.qZA(),c.TgZ(8,"vdr-ab-right"),c._UZ(9,"vdr-action-bar-items",2),c.YNc(10,ke,3,4,"button",3),c.ALo(11,"async"),c.YNc(12,_e,1,1,"ng-template",null,4,c.W1O),c.qZA(),c.qZA(),c.YNc(14,Ke,44,53,"form",5),c.ALo(15,"async")),2&e){const e=c.MAs(13);c.xp6(2),c.Q6J("entity",c.lcZ(3,7,t.entity$)),c.xp6(2),c.Q6J("disabled",c.lcZ(5,9,t.isNew$))("availableLanguageCodes",c.lcZ(6,11,t.availableLanguages$))("currentLanguageCode",c.lcZ(7,13,t.languageCode$)),c.xp6(6),c.Q6J("ngIf",c.lcZ(11,15,t.isNew$))("ngIfElse",e),c.xp6(4),c.Q6J("ngIf",c.lcZ(15,17,t.entity$))}},directives:[l.Kk,l.BN,d.V,Y.S,l.mz,u.W,m.O5,p.H,s._Y,s.JL,s.sg,m.sg,j.h,E.PEh,G.y,s.Wl,E.KKC,s.JJ,s.u,H.x,E.MgK,s.Fj,B.Y,R.C,he,s.CE,E.q0d,Fe,o.yS,s.x0,qe.y,Ie.q,W.J,X.U,E.qvL,ee.N,te.H,s.On],pipes:[m.Ov,h.X$,M.j],styles:['@charset "UTF-8";.visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}clr-checkbox-wrapper[_ngcontent-%COMP%]{transition:opacity .3s}clr-checkbox-wrapper.disabled[_ngcontent-%COMP%]{opacity:.5}.collection-breadcrumbs[_ngcontent-%COMP%]{list-style-type:none;background-color:var(--color-component-bg-200);padding:2px 6px;margin-bottom:6px;border-radius:var(--clr-global-borderradius)}.collection-breadcrumbs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:.65rem;display:inline-block;margin-right:10px}.collection-breadcrumbs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:not(:last-child):after{content:"\\203a";top:0;color:var(--color-grey-400);margin-left:10px}'],changeDetection:0});var Xe=n(92597),et=n(85236);function tt(e,t,n=[]){var o,i;const a=[],r={},s=function(e){const t=new Map;function n(e){t.set(e.id,e),e.children.forEach(n)}return e&&n(e),t}(t);for(const c of e)r[c.id]=Object.assign(Object.assign({},c),{children:[]});for(const c of e.map(e=>e.id))if(r.hasOwnProperty(c)){const e=r[c];e.expanded=null!==(i=null===(o=s.get(c))||void 0===o?void 0:o.expanded)&&void 0!==i?i:n.includes(c);const t=e.parent;if(!t)continue;r[t.id]?r[t.id]?r[t.id].children.push(e):r[t.id]={children:[e]}:a.push(e)}return{id:a.length?a[0].parent.id:void 0,children:a}}function nt(e,t){if(1&e&&c._UZ(0,"vdr-collection-tree-node",1),2&e){const e=c.oxw();c.Q6J("expandAll",e.expandAll)("collectionTree",e.collectionTree)("selectionManager",e.selectionManager)("activeCollectionId",e.activeCollectionId)}}class ot{constructor(){this.expandAll=!1,this.expandedIds=[],this.rearrange=new c.vpe,this.deleteCollection=new c.vpe,this.allMoveListItems=[]}ngOnChanges(e){"collections"in e&&this.collections&&(this.collectionTree=tt(this.collections,this.collectionTree,this.expandedIds),this.allMoveListItems=[])}onDrop(e){const t=e.item.data,n=e.container.data.id;if(null==n)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:t.id,parentId:n,index:e.currentIndex})}onMove(e){this.rearrange.emit(e)}onDelete(e){this.deleteCollection.emit(e)}getMoveListItems(e){return 0===this.allMoveListItems.length&&(this.allMoveListItems=this.calculateAllMoveListItems()),this.allMoveListItems.filter(t=>{var n;return t.id!==e.id&&!t.ancestorIdPath.has(e.id)&&t.id!==(null===(n=e.parent)||void 0===n?void 0:n.id)})}calculateAllMoveListItems(){const e=(t,n,o,i)=>{const a=n.concat(t.name);return i.push({path:a.slice(1).join(" / ")||"root",id:t.id,ancestorIdPath:o}),t.children.forEach(n=>e(n,a,new Set([...o,t.id]),i)),i};return e(this.collectionTree,[],new Set,[])}isRootNode(e){return!e.hasOwnProperty("parent")}}ot.\u0275fac=function(e){return new(e||ot)},ot.\u0275cmp=c.Xpm({type:ot,selectors:[["vdr-collection-tree"]],inputs:{collections:"collections",activeCollectionId:"activeCollectionId",expandAll:"expandAll",expandedIds:"expandedIds",selectionManager:"selectionManager"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[c.TTD],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","selectionManager","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","selectionManager","activeCollectionId"]],template:function(e,t){1&e&&c.YNc(0,nt,1,4,"vdr-collection-tree-node",0),2&e&&c.Q6J("ngIf",t.collectionTree)},styles:[""],changeDetection:0});const it=function(){return["./create"]};function at(e,t){1&e&&(c.TgZ(0,"a",15),c._UZ(1,"clr-icon",16),c._uU(2),c.ALo(3,"translate"),c.qZA()),2&e&&(c.Q6J("routerLink",c.DdM(4,it)),c.xp6(2),c.hij(" ",c.lcZ(3,2,"catalog.create-new-collection")," "))}const rt=function(e){return{count:e}};function st(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",17),c._uU(1),c.ALo(2,"async"),c.ALo(3,"translate"),c.qZA(),c.TgZ(4,"button",18),c.NdJ("click",function(){return c.CHM(e),c.oxw().closeContents()}),c._UZ(5,"clr-icon",19),c.qZA()}if(2&e){const e=t.$implicit,n=c.oxw();c.xp6(1),c.AsE(" ",c.lcZ(2,2,n.activeCollectionTitle$)," (",c.xi3(3,4,"common.results-count",c.VKq(7,rt,e)),") ")}}const ct=function(){return["CreateCatalog","CreateCollection"]};class lt{constructor(e,t,n,o,a,r,c){this.dataService=e,this.notificationService=t,this.modalService=n,this.router=o,this.route=a,this.serverConfigService=r,this.changeDetectorRef=c,this.filterTermControl=new s.NI(""),this.expandAll=!1,this.expandedIds=[],this.destroy$=new V.xQ,this.selectionManager=new i.ZE0({additiveMode:!0,multiSelect:!0,itemsAreEqual:(e,t)=>e.id===t.id})}ngOnInit(){var e,t;this.queryResult=this.dataService.collection.getCollections(1e3,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream(e=>e.collections.items).pipe((0,Ze.b)(e=>this.selectionManager.setCurrentItems(e)),(0,Xe.d)(1)),this.activeCollectionId$=this.route.paramMap.pipe((0,r.U)(e=>e.get("contents")),(0,ve.x)()),this.expandedIds=null!==(t=null===(e=this.route.snapshot.queryParamMap.get("expanded"))||void 0===e?void 0:e.split(","))&&void 0!==t?t:[],this.expandAll="all"===this.route.snapshot.queryParamMap.get("expanded"),this.activeCollectionTitle$=(0,C.aj)(this.activeCollectionId$,this.items$).pipe((0,r.U)(([e,t])=>{if(e){const n=t.find(t=>t.id===e);return n?n.name:""}return""})),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:e})=>e.contentLanguage).pipe((0,Ze.b)(()=>this.refresh())),this.filterTermControl.valueChanges.pipe((0,A.b)(250),(0,y.R)(this.destroy$)).subscribe(e=>{this.router.navigate(["./"],{queryParams:{q:e||void 0},queryParamsHandling:"merge",relativeTo:this.route})}),this.route.queryParamMap.pipe((0,r.U)(e=>e.get("q")),(0,ve.x)(),(0,y.R)(this.destroy$)).subscribe(()=>this.refresh()),this.filterTermControl.patchValue(this.route.snapshot.queryParamMap.get("q"))}ngOnDestroy(){this.queryResult.completed$.next(),this.destroy$.next(void 0),this.destroy$.complete()}toggleExpandAll(){this.router.navigate(["./"],{queryParams:{expanded:this.expandAll?"all":void 0},queryParamsHandling:"merge",relativeTo:this.route})}onRearrange(e){this.dataService.collection.moveCollection([e]).subscribe({next:()=>{this.notificationService.success((0,a.J)("common.notify-saved-changes")),this.refresh()},error:e=>{this.notificationService.error((0,a.J)("common.notify-save-changes-error"))}})}deleteCollection(e){this.items$.pipe((0,D.q)(1),(0,r.U)(t=>-1<t.findIndex(t=>t.parent&&t.parent.id===e)),(0,T.w)(e=>this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-collection"),body:e?(0,a.J)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]})),(0,T.w)(t=>t?this.dataService.collection.deleteCollection(e):x.E)).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"Collection"}),this.refresh()},e=>{this.notificationService.error((0,a.J)("common.notify-delete-error"),{entity:"Collection"})})}closeContents(){const e=Object.assign({},this.route.snapshot.params);delete e.contents,this.router.navigate(["./",e],{relativeTo:this.route,queryParamsHandling:"preserve"})}setLanguage(e){this.dataService.client.setContentLanguage(e).subscribe()}refresh(){const e=this.route.snapshot.queryParamMap.get("q");this.queryResult.ref.refetch({options:Object.assign({skip:0,take:1e3},e?{filter:{name:{contains:e}}}:{})})}}lt.\u0275fac=function(e){return new(e||lt)(c.Y36(i.DoR),c.Y36(i.gqp),c.Y36(i.Z7U),c.Y36(o.F0),c.Y36(o.gz),c.Y36(i.iHG),c.Y36(c.sBO))},lt.\u0275cmp=c.Xpm({type:lt,selectors:[["vdr-collection-list"]],decls:29,vars:35,consts:[[1,""],["type","text","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],[1,"flex","center"],[1,"expand-all-toggle","mt2"],["type","checkbox","clrToggle","",3,"ngModel","ngModelChange","change"],[1,"mt2",3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"bulk-select-controls"],["type","checkbox","clrCheckbox","",3,"checked","click"],["locationId","collection-list",1,"ml2",3,"hostComponent","selectionManager"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","expandedIds","selectionManager","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(e,t){1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left"),c.TgZ(2,"div",0),c._UZ(3,"input",1),c.ALo(4,"translate"),c.TgZ(5,"div",2),c.TgZ(6,"clr-toggle-wrapper",3),c.TgZ(7,"input",4),c.NdJ("ngModelChange",function(e){return t.expandAll=e})("change",function(){return t.toggleExpandAll()}),c.qZA(),c.TgZ(8,"label"),c._uU(9),c.ALo(10,"translate"),c.qZA(),c.qZA(),c.TgZ(11,"vdr-language-selector",5),c.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),c.ALo(12,"async"),c.ALo(13,"async"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(14,"vdr-ab-right"),c._UZ(15,"vdr-action-bar-items",6),c.YNc(16,at,4,5,"a",7),c.qZA(),c.qZA(),c.TgZ(17,"div",8),c.TgZ(18,"input",9),c.NdJ("click",function(){return t.selectionManager.toggleSelectAll()}),c.qZA(),c._UZ(19,"vdr-bulk-action-menu",10),c.qZA(),c.TgZ(20,"div",11),c.TgZ(21,"vdr-collection-tree",12),c.NdJ("rearrange",function(e){return t.onRearrange(e)})("deleteCollection",function(e){return t.deleteCollection(e)}),c.ALo(22,"async"),c.ALo(23,"async"),c.qZA(),c.TgZ(24,"div",13),c.ALo(25,"async"),c.TgZ(26,"vdr-collection-contents",14),c.ALo(27,"async"),c.YNc(28,st,6,9,"ng-template"),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(3),c.Q6J("formControl",t.filterTermControl)("placeholder",c.lcZ(4,18,"catalog.filter-by-name")),c.xp6(4),c.Q6J("ngModel",t.expandAll),c.xp6(2),c.hij(" ",c.lcZ(10,20,"catalog.expand-all-collections")," "),c.xp6(2),c.Q6J("availableLanguageCodes",c.lcZ(12,22,t.availableLanguages$))("currentLanguageCode",c.lcZ(13,24,t.contentLanguage$)),c.xp6(5),c.Q6J("vdrIfPermissions",c.DdM(34,ct)),c.xp6(2),c.Q6J("checked",t.selectionManager.areAllCurrentItemsSelected()),c.xp6(1),c.Q6J("hostComponent",t)("selectionManager",t.selectionManager),c.xp6(2),c.Q6J("collections",c.lcZ(22,26,t.items$))("activeCollectionId",c.lcZ(23,28,t.activeCollectionId$))("expandAll",t.expandAll)("expandedIds",t.expandedIds)("selectionManager",t.selectionManager),c.xp6(3),c.ekj("expanded",c.lcZ(25,30,t.activeCollectionId$)),c.xp6(2),c.Q6J("collectionId",c.lcZ(27,32,t.activeCollectionId$)))},directives:[l.Kk,l.BN,G.y,s.Fj,s.JJ,s.oH,E.PEh,s.Wl,E.KKC,s.On,E.MgK,Y.S,l.mz,u.W,p.H,et.c,ot,Fe,o.yS,E.qvL],pipes:[h.X$,m.Ov],styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.bulk-select-controls[_ngcontent-%COMP%]{min-height:36px;padding-left:14px;display:flex;align-items:center;border-bottom:1px solid var(--color-component-border-200)}.expand-all-toggle[_ngcontent-%COMP%]{display:block}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:none;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"],changeDetection:0});var dt=n(87187),ut=n(42720),pt=n(67202);function gt(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",6),c.NdJ("click",function(){return c.CHM(e),c.oxw().create()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.create")," ")}}function mt(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",6),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).save()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.update")," ")}}function ht(e,t){if(1&e&&c.YNc(0,mt,3,4,"button",7),2&e){const e=c.oxw();c.Q6J("vdrIfPermissions",e.updatePermission)}}function ft(e,t){1&e&&(c.ynx(0),c._uU(1),c.ALo(2,"translate"),c.BQk()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"catalog.public")))}function vt(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.Oqu(c.lcZ(1,1,"catalog.private"))}const Zt=function(){return["facet","customFields"]};function bt(e,t){if(1&e&&(c.TgZ(0,"section",22),c.TgZ(1,"label"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c._UZ(4,"vdr-tabbed-custom-fields",23),c.ALo(5,"hasPermission"),c.qZA()),2&e){const e=c.oxw(2);c.xp6(2),c.Oqu(c.lcZ(3,4,"common.custom-fields")),c.xp6(2),c.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get(c.DdM(8,Zt)))("readonly",!c.lcZ(5,6,e.updatePermission))}}function Ct(e,t){1&e&&(c.ynx(0),c.TgZ(1,"th"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.BQk()),2&e&&(c.xp6(2),c.Oqu(c.lcZ(3,1,"common.custom-fields")))}const xt=function(e){return["values",e,"customFields"]};function At(e,t){if(1&e&&(c.TgZ(0,"td",40),c._UZ(1,"vdr-tabbed-custom-fields",41),c.ALo(2,"hasPermission"),c.qZA()),2&e){const e=c.oxw().index,t=c.oxw(4);c.xp6(1),c.Q6J("customFields",t.customValueFields)("compact",!0)("customFieldsFormGroup",t.detailForm.get(c.VKq(6,xt,e)))("readonly",!c.lcZ(2,4,t.updatePermission))}}function yt(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"tr",30),c.TgZ(1,"td",31),c._UZ(2,"vdr-entity-info",0),c.qZA(),c.TgZ(3,"td",31),c.TgZ(4,"input",32),c.NdJ("input",function(t){const n=c.CHM(e).index,o=c.oxw(3).ngIf;return c.oxw().updateValueCode(null==o.values[n]?null:o.values[n].code,t.target.value,n)}),c.ALo(5,"hasPermission"),c.qZA(),c.qZA(),c.TgZ(6,"td",31),c._UZ(7,"input",33),c.qZA(),c.YNc(8,At,3,8,"td",34),c.TgZ(9,"td",31),c.TgZ(10,"vdr-dropdown"),c.TgZ(11,"button",35),c._uU(12),c.ALo(13,"translate"),c._UZ(14,"clr-icon",36),c.qZA(),c.TgZ(15,"vdr-dropdown-menu",37),c.TgZ(16,"button",38),c.NdJ("click",function(){const t=c.CHM(e).index,n=c.oxw(3).ngIf;return c.oxw().deleteFacetValue(null==n.values[t]?null:n.values[t].id,t)}),c.ALo(17,"hasPermission"),c._UZ(18,"clr-icon",39),c._uU(19),c.ALo(20,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,n=t.index,o=c.oxw(4);c.Q6J("formGroupName",n),c.xp6(2),c.Q6J("entity",e),c.xp6(2),c.Q6J("readonly",!c.lcZ(5,7,o.updatePermission)),c.xp6(4),c.Q6J("ngIf",o.customValueFields.length),c.xp6(4),c.hij(" ",c.lcZ(13,9,"common.actions")," "),c.xp6(4),c.Q6J("disabled",!c.lcZ(17,11,o.updatePermission)),c.xp6(3),c.hij(" ",c.lcZ(20,13,"common.delete")," ")}}function Pt(e,t){if(1&e&&(c.TgZ(0,"table",27),c.TgZ(1,"thead"),c.TgZ(2,"tr"),c._UZ(3,"th"),c.TgZ(4,"th"),c._uU(5),c.ALo(6,"translate"),c.qZA(),c.TgZ(7,"th"),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.YNc(10,Ct,4,3,"ng-container",28),c._UZ(11,"th"),c.qZA(),c.qZA(),c.TgZ(12,"tbody"),c.YNc(13,yt,21,15,"tr",29),c.qZA(),c.qZA()),2&e){const e=c.oxw(3);c.xp6(5),c.Oqu(c.lcZ(6,4,"common.name")),c.xp6(3),c.Oqu(c.lcZ(9,6,"common.code")),c.xp6(2),c.Q6J("ngIf",e.customValueFields.length),c.xp6(3),c.Q6J("ngForOf",e.values)}}function Tt(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",42),c.NdJ("click",function(){return c.CHM(e),c.oxw(3).addFacetValue()}),c._UZ(1,"clr-icon",43),c._uU(2),c.ALo(3,"translate"),c.qZA()}2&e&&(c.xp6(2),c.hij(" ",c.lcZ(3,1,"catalog.add-facet-value")," "))}const Ot=function(){return["CreateCatalog","CreateFacet"]};function Ft(e,t){if(1&e&&(c.TgZ(0,"section",24),c.TgZ(1,"label"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.YNc(4,Pt,14,8,"table",25),c.TgZ(5,"div"),c.YNc(6,Tt,4,3,"button",26),c.qZA(),c.qZA()),2&e){const e=c.oxw(2);c.xp6(2),c.Oqu(c.lcZ(3,3,"catalog.facet-values")),c.xp6(2),c.Q6J("ngIf",0<e.getValuesFormArray().length),c.xp6(2),c.Q6J("vdrIfPermissions",c.DdM(5,Ot))}}function qt(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"form",8),c.TgZ(1,"section",9),c.TgZ(2,"vdr-form-field",10),c.ALo(3,"translate"),c.TgZ(4,"clr-toggle-wrapper"),c._UZ(5,"input",11),c.ALo(6,"hasPermission"),c.TgZ(7,"label",12),c.YNc(8,ft,3,3,"ng-container",13),c.YNc(9,vt,2,3,"ng-template",null,14,c.W1O),c.qZA(),c.qZA(),c.qZA(),c.TgZ(11,"vdr-form-field",15),c.ALo(12,"translate"),c.TgZ(13,"input",16),c.NdJ("input",function(t){const n=c.CHM(e).ngIf;return c.oxw().updateCode(n.code,t.target.value)}),c.ALo(14,"hasPermission"),c.qZA(),c.qZA(),c.TgZ(15,"vdr-form-field",17),c.ALo(16,"translate"),c.ALo(17,"hasPermission"),c._UZ(18,"input",18),c.ALo(19,"hasPermission"),c.qZA(),c.YNc(20,bt,6,9,"section",19),c._UZ(21,"vdr-custom-detail-component-host",20),c.qZA(),c.YNc(22,Ft,7,6,"section",21),c.ALo(23,"async"),c.qZA()}if(2&e){const e=c.MAs(10),t=c.oxw();c.Q6J("formGroup",t.detailForm),c.xp6(2),c.Q6J("label",c.lcZ(3,14,"catalog.visibility")),c.xp6(3),c.Q6J("vdrDisabled",!c.lcZ(6,16,t.updatePermission)),c.xp6(3),c.Q6J("ngIf",t.detailForm.value.facet.visible)("ngIfElse",e),c.xp6(3),c.Q6J("label",c.lcZ(12,18,"common.name")),c.xp6(2),c.Q6J("readonly",!c.lcZ(14,20,t.updatePermission)),c.xp6(2),c.Q6J("label",c.lcZ(16,22,"common.code"))("readOnlyToggle",c.lcZ(17,24,t.updatePermission)),c.xp6(3),c.Q6J("readonly",!c.lcZ(19,26,t.updatePermission)),c.xp6(2),c.Q6J("ngIf",t.customFields.length),c.xp6(1),c.Q6J("entity$",t.entity$)("detailForm",t.detailForm),c.xp6(1),c.Q6J("ngIf",!c.lcZ(23,28,t.isNew$))}}class It extends i.UT_{constructor(e,t,n,o,a,r,c,l){super(t,e,n,a),this.changeDetector=o,this.dataService=a,this.formBuilder=r,this.notificationService=c,this.modalService=l,this.updatePermission=[i.y3$.UpdateCatalog,i.y3$.UpdateFacet],this.customFields=this.getCustomFieldConfig("Facet"),this.customValueFields=this.getCustomFieldConfig("FacetValue"),this.detailForm=this.formBuilder.group({facet:this.formBuilder.group({code:["",s.kI.required],name:"",visible:!0,customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))}),values:this.formBuilder.array([])})}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}updateCode(e,t){if(!e){const e=this.detailForm.get(["facet","code"]);e&&e.pristine&&e.setValue((0,U.U)(t,"-"))}}updateValueCode(e,t,n){if(!e){const e=this.detailForm.get(["values",n,"code"]);e&&e.pristine&&e.setValue((0,U.U)(t,"-"))}}customValueFieldIsSet(e,t){return!!this.detailForm.get(["values",e,"customFields",t])}getValuesFormArray(){return this.detailForm.get("values")}addFacetValue(){const e=this.detailForm.get("values");if(e){const t=this.formBuilder.group({id:"",name:["",s.kI.required],code:""}),n={name:"",code:""};if(this.customValueFields.length){const e=new s.cw({});n.customFields={};for(const t of this.customValueFields){const n=t.name;e.addControl(n,new s.NI)}t.addControl("customFields",e)}e.insert(e.length,t),this.values.push(n)}}create(){const e=this.detailForm.get("facet");!e||!e.dirty||(0,C.aj)(this.entity$,this.languageCode$).pipe((0,D.q)(1),(0,Q.zg)(([t,n])=>{const o=this.getUpdatedFacet(t,e,n);return this.dataService.facet.createFacet(o)}),(0,T.w)(e=>this.dataService.facet.getAllFacets().single$.pipe((0,pt.h)(e)))).subscribe(e=>{this.notificationService.success((0,a.J)("common.notify-create-success"),{entity:"Facet"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",e.createFacet.id],{relativeTo:this.route})},e=>{this.notificationService.error((0,a.J)("common.notify-create-error"),{entity:"Facet"})})}save(){(0,C.aj)(this.entity$,this.languageCode$).pipe((0,D.q)(1),(0,Q.zg)(([e,t])=>{const n=this.detailForm.get("facet"),o=[];if(n&&n.dirty){const i=this.getUpdatedFacet(e,n,t);i&&o.push(this.dataService.facet.updateFacet(i))}const i=this.detailForm.get("values");if(i&&i.dirty){const n=this.getCreatedFacetValues(e,i,t);n.length&&o.push(this.dataService.facet.createFacetValues(n).pipe((0,T.w)(()=>this.dataService.facet.getFacet(this.id).single$)));const a=this.getUpdatedFacetValues(e,i,t);a.length&&o.push(this.dataService.facet.updateFacetValues(a))}return(0,ut.D)(o)}),(0,T.w)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,a.J)("common.notify-update-success"),{entity:"Facet"})},e=>{this.notificationService.error((0,a.J)("common.notify-update-error"),{entity:"Facet"})})}deleteFacetValue(e,t){if(!e){const e=this.detailForm.get("values");return e&&e.removeAt(t),void this.values.splice(t,1)}this.showModalAndDelete(e).pipe((0,T.w)(t=>t.result===i.PcR.DELETED?[!0]:this.showModalAndDelete(e,t.message||"").pipe((0,r.U)(e=>e.result===i.PcR.DELETED))),(0,T.w)(e=>e?this.dataService.facet.getFacet(this.id).single$:[])).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"FacetValue"})},e=>{this.notificationService.error((0,a.J)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(e,t){return this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-facet-value"),body:t,buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(n=>n?this.dataService.facet.deleteFacetValues([e],!!t):x.E),(0,r.U)(e=>e.deleteFacetValues[0]))}setFormValues(e,t){var n;const o=(0,i.ZIM)(e,t);if(this.detailForm.patchValue({facet:{code:e.code,visible:!e.isPrivate,name:null!==(n=null==o?void 0:o.name)&&void 0!==n?n:""}}),this.customFields.length){this.detailForm.get(["facet","customFields"]);this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["facet","customFields"]),e,o)}const a=this.detailForm.get("values");this.values=[...e.values],e.values.forEach((e,n)=>{var o,r,c,l,d;const u=(0,i.ZIM)(e,t),p={id:e.id,code:e.code,name:u?u.name:""},g=a.at(n);if(g?(null===(o=g.get("id"))||void 0===o||o.setValue(p.id),null===(r=g.get("code"))||void 0===r||r.setValue(p.code),null===(c=g.get("name"))||void 0===c||c.setValue(p.name)):a.insert(n,this.formBuilder.group(p)),this.customValueFields.length){let t=this.detailForm.get(["values",n,"customFields"]);if(t||(t=new s.cw({}),this.detailForm.get(["values",n]).addControl("customFields",t)),t)for(const n of this.customValueFields){const o=n.name,i="localeString"===n.type?null===(d=null===(l=u)||void 0===l?void 0:l.customFields)||void 0===d?void 0:d[o]:e.customFields[o],a=t.get(o);a?a.setValue(i):t.addControl(o,new s.NI(i))}}})}getUpdatedFacet(e,t,n){const o=(0,i.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}});return o.isPrivate=!t.value.visible,o}getCreatedFacetValues(e,t,n){return t.controls.filter(e=>!e.value.id).map(e=>e.value).map(e=>(0,i.iSy)({translatable:Object.assign(Object.assign({},e),{translations:[]}),updatedFields:e,customFieldConfig:this.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})).map(t=>Object.assign({facetId:e.id},t))}getUpdatedFacetValues(e,t,n){const o=e.values.filter((e,n)=>{const o=t.get(n.toString());return o&&o.dirty&&o.value.id}),r=t.controls.filter(e=>e.dirty&&e.value.id).map(e=>e.value);if(o.length!==r.length)throw new Error((0,a.J)("error.facet-value-form-values-do-not-match"));return o.map((e,t)=>(0,i.iSy)({translatable:e,updatedFields:r[t],customFieldConfig:this.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})).filter(dt.notNullOrUndefined)}}It.\u0275fac=function(e){return new(e||It)(c.Y36(o.F0),c.Y36(o.gz),c.Y36(i.iHG),c.Y36(c.sBO),c.Y36(i.DoR),c.Y36(s.qu),c.Y36(i.gqp),c.Y36(i.Z7U))},It.\u0275cmp=c.Xpm({type:It,selectors:[["vdr-facet-detail"]],features:[c.qOj],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","facet-detail",3,"entity$","detailForm"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],["entityName","Facet",3,"customFields","customFieldsFormGroup","readonly"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],[4,"ngIf"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["class","",4,"ngIf"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[1,""],["entityName","FacetValue",3,"customFields","compact","customFieldsFormGroup","readonly"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(e,t){if(1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left"),c._UZ(2,"vdr-entity-info",0),c.ALo(3,"async"),c.TgZ(4,"vdr-language-selector",1),c.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),c.ALo(5,"async"),c.ALo(6,"async"),c.ALo(7,"async"),c.qZA(),c.qZA(),c.TgZ(8,"vdr-ab-right"),c._UZ(9,"vdr-action-bar-items",2),c.YNc(10,gt,3,4,"button",3),c.ALo(11,"async"),c.YNc(12,ht,1,1,"ng-template",null,4,c.W1O),c.qZA(),c.qZA(),c.YNc(14,qt,24,30,"form",5),c.ALo(15,"async")),2&e){const e=c.MAs(13);c.xp6(2),c.Q6J("entity",c.lcZ(3,7,t.entity$)),c.xp6(2),c.Q6J("disabled",c.lcZ(5,9,t.isNew$))("availableLanguageCodes",c.lcZ(6,11,t.availableLanguages$))("currentLanguageCode",c.lcZ(7,13,t.languageCode$)),c.xp6(6),c.Q6J("ngIf",c.lcZ(11,15,t.isNew$))("ngIfElse",e),c.xp6(4),c.Q6J("ngIf",c.lcZ(15,17,t.entity$))}},directives:[l.Kk,l.BN,d.V,Y.S,l.mz,u.W,m.O5,p.H,s._Y,s.JL,s.sg,s.x0,j.h,E.PEh,G.y,s.Wl,E.KKC,s.JJ,s.u,H.x,E.MgK,s.Fj,R.C,qe.y,s.CE,m.sg,W.J,X.U,E.qvL,ee.N,te.H],pipes:[m.Ov,h.X$,M.j],styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0});var wt=n(430),kt=n(30901),Mt=n(74447),_t=n(26074);const Jt=function(){return["./create"]};function Lt(e,t){1&e&&(c.TgZ(0,"a",8),c._UZ(1,"clr-icon",9),c._uU(2),c.ALo(3,"translate"),c.qZA()),2&e&&(c.Q6J("routerLink",c.DdM(4,Jt)),c.xp6(2),c.hij(" ",c.lcZ(3,2,"catalog.create-new-facet")," "))}function Ut(e,t){if(1&e&&c._UZ(0,"vdr-facet-value-chip",22),2&e){const e=t.$implicit;c.Q6J("facetValue",e)("removable",!1)("displayFacetName",!1)}}function Vt(e,t){if(1&e&&(c.ynx(0),c._UZ(1,"clr-icon",9),c._uU(2),c.BQk()),2&e){const e=c.oxw(2).item,t=c.oxw();c.xp6(2),c.hij(" ",e.values.length-t.initialLimit," ")}}function Nt(e,t){1&e&&c._UZ(0,"clr-icon",25)}function St(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",23),c.NdJ("click",function(){c.CHM(e);const t=c.oxw().item;return c.oxw().toggleDisplayLimit(t)}),c.YNc(1,Vt,3,1,"ng-container",13),c.YNc(2,Nt,1,0,"ng-template",null,24,c.W1O),c.qZA()}if(2&e){const e=c.MAs(3),t=c.oxw().item,n=c.oxw();c.xp6(1),c.Q6J("ngIf",(n.displayLimit[t.id]||0)<t.values.length)("ngIfElse",e)}}function $t(e,t){1&e&&(c.ynx(0),c._uU(1),c.ALo(2,"translate"),c.BQk()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"catalog.public")))}function Dt(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.Oqu(c.lcZ(1,1,"catalog.private"))}const Qt=function(e){return["./",e]},Yt=function(){return["DeleteCatalog","DeleteFacet"]};function jt(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"td",10),c._uU(1),c.qZA(),c.TgZ(2,"td",10),c._uU(3),c.qZA(),c.TgZ(4,"td",10),c.YNc(5,Ut,1,3,"vdr-facet-value-chip",11),c.ALo(6,"slice"),c.YNc(7,St,4,2,"button",12),c.qZA(),c.TgZ(8,"td",10),c.TgZ(9,"vdr-chip"),c.YNc(10,$t,3,3,"ng-container",13),c.YNc(11,Dt,2,3,"ng-template",null,14,c.W1O),c.qZA(),c.qZA(),c.TgZ(13,"td",15),c._UZ(14,"vdr-table-row-action",16),c.ALo(15,"translate"),c.qZA(),c.TgZ(16,"td",15),c.TgZ(17,"vdr-dropdown"),c.TgZ(18,"button",17),c._uU(19),c.ALo(20,"translate"),c._UZ(21,"clr-icon",18),c.qZA(),c.TgZ(22,"vdr-dropdown-menu",19),c.TgZ(23,"button",20),c.NdJ("click",function(){const t=c.CHM(e).item;return c.oxw().deleteFacet(t.id)}),c.ALo(24,"hasPermission"),c._UZ(25,"clr-icon",21),c._uU(26),c.ALo(27,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.item,n=c.MAs(12),o=c.oxw();c.ekj("private",e.isPrivate),c.xp6(1),c.Oqu(e.code),c.xp6(1),c.ekj("private",e.isPrivate),c.xp6(1),c.Oqu(e.name),c.xp6(1),c.ekj("private",e.isPrivate),c.xp6(1),c.Q6J("ngForOf",c.Dn7(6,23,e.values,0,o.displayLimit[e.id]||3)),c.xp6(2),c.Q6J("ngIf",e.values.length>o.initialLimit),c.xp6(1),c.ekj("private",e.isPrivate),c.xp6(2),c.Q6J("ngIf",!e.isPrivate)("ngIfElse",n),c.xp6(3),c.ekj("private",e.isPrivate),c.xp6(1),c.Q6J("label",c.lcZ(15,27,"common.edit"))("linkTo",c.VKq(35,Qt,e.id)),c.xp6(2),c.ekj("private",e.isPrivate),c.xp6(3),c.hij(" ",c.lcZ(20,29,"common.actions")," "),c.xp6(4),c.Q6J("disabled",!c.lcZ(24,31,c.DdM(37,Yt))),c.xp6(3),c.hij(" ",c.lcZ(27,33,"common.delete")," ")}}const Et=function(){return["CreateCatalog","CreateFacet"]};class Gt extends i.t7C{constructor(e,t,n,o,a,r){super(a,r),this.dataService=e,this.modalService=t,this.notificationService=n,this.serverConfigService=o,this.filterTermControl=new s.NI(""),this.initialLimit=3,this.displayLimit={},super.setQueryFn((...e)=>this.dataService.facet.getFacets(...e).refetchOnChannelChange(),e=>e.facets,(e,t)=>({options:{skip:e,take:t,filter:{name:{contains:this.filterTermControl.value}},sort:{createdAt:wt.As.DESC}}})),this.selectionManager=new i.ZE0({multiSelect:!0,itemsAreEqual:(e,t)=>e.id===t.id,additiveMode:!0})}ngOnInit(){super.ngOnInit(),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:e})=>e.contentLanguage).pipe((0,Ze.b)(()=>this.refresh())),this.filterTermControl.valueChanges.pipe((0,$.h)(e=>2<=e.length||0===e.length),(0,A.b)(250),(0,y.R)(this.destroy$)).subscribe(()=>this.refresh())}toggleDisplayLimit(e){this.displayLimit[e.id]===e.values.length?this.displayLimit[e.id]=this.initialLimit:this.displayLimit[e.id]=e.values.length}deleteFacet(e){this.showModalAndDelete(e).pipe((0,T.w)(t=>t.result===i.PcR.DELETED?[!0]:this.showModalAndDelete(e,t.message||"").pipe((0,r.U)(e=>e.result===i.PcR.DELETED))),(0,T.w)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"FacetValue"}),this.refresh()},e=>{this.notificationService.error((0,a.J)("common.notify-delete-error"),{entity:"FacetValue"})})}setLanguage(e){this.dataService.client.setContentLanguage(e).subscribe()}showModalAndDelete(e,t){return this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-facet"),body:t,buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:t?(0,a.J)("common.force-delete"):(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(n=>n?this.dataService.facet.deleteFacet(e,!!t):x.E),(0,r.U)(e=>e.deleteFacet))}}Gt.\u0275fac=function(e){return new(e||Gt)(c.Y36(i.DoR),c.Y36(i.Z7U),c.Y36(i.gqp),c.Y36(i.iHG),c.Y36(o.F0),c.Y36(o.gz))},Gt.\u0275cmp=c.Xpm({type:Gt,selectors:[["vdr-facet-list"]],features:[c.qOj],decls:33,vars:40,consts:[[1,""],["type","text","name","searchTerm",1,"clr-input","search-input",3,"formControl","placeholder"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","selectionManager","pageChange","itemsPerPageChange"],["locationId","facet-list",3,"hostComponent","selectionManager"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(e,t){1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left"),c.TgZ(2,"div",0),c._UZ(3,"input",1),c.ALo(4,"translate"),c.TgZ(5,"div"),c.TgZ(6,"vdr-language-selector",2),c.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),c.ALo(7,"async"),c.ALo(8,"async"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(9,"vdr-ab-right"),c._UZ(10,"vdr-action-bar-items",3),c.YNc(11,Lt,4,5,"a",4),c.qZA(),c.qZA(),c.TgZ(12,"vdr-data-table",5),c.NdJ("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),c.ALo(13,"async"),c.ALo(14,"async"),c.ALo(15,"async"),c.ALo(16,"async"),c._UZ(17,"vdr-bulk-action-menu",6),c.TgZ(18,"vdr-dt-column"),c._uU(19),c.ALo(20,"translate"),c.qZA(),c.TgZ(21,"vdr-dt-column"),c._uU(22),c.ALo(23,"translate"),c.qZA(),c.TgZ(24,"vdr-dt-column",7),c._uU(25),c.ALo(26,"translate"),c.qZA(),c.TgZ(27,"vdr-dt-column"),c._uU(28),c.ALo(29,"translate"),c.qZA(),c._UZ(30,"vdr-dt-column"),c._UZ(31,"vdr-dt-column"),c.YNc(32,jt,28,38,"ng-template"),c.qZA()),2&e&&(c.xp6(3),c.Q6J("formControl",t.filterTermControl)("placeholder",c.lcZ(4,17,"catalog.filter-by-name")),c.xp6(3),c.Q6J("availableLanguageCodes",c.lcZ(7,19,t.availableLanguages$))("currentLanguageCode",c.lcZ(8,21,t.contentLanguage$)),c.xp6(5),c.Q6J("vdrIfPermissions",c.DdM(39,Et)),c.xp6(1),c.Q6J("items",c.lcZ(13,23,t.items$))("itemsPerPage",c.lcZ(14,25,t.itemsPerPage$))("totalItems",c.lcZ(15,27,t.totalItems$))("currentPage",c.lcZ(16,29,t.currentPage$))("selectionManager",t.selectionManager),c.xp6(5),c.Q6J("hostComponent",t)("selectionManager",t.selectionManager),c.xp6(2),c.Oqu(c.lcZ(20,31,"common.code")),c.xp6(3),c.Oqu(c.lcZ(23,33,"common.name")),c.xp6(2),c.Q6J("expand",!0),c.xp6(1),c.Oqu(c.lcZ(26,35,"catalog.values")),c.xp6(3),c.Oqu(c.lcZ(29,37,"catalog.visibility")))},directives:[l.Kk,l.BN,G.y,s.Fj,s.JJ,s.oH,Y.S,l.mz,u.W,p.H,Ce.Q,et.c,kt.E,o.yS,E.qvL,m.sg,m.O5,Mt.Y,xe.v,W.J,X.U,ee.N,te.H,_t.q],pipes:[h.X$,m.Ov,m.OU,M.j],styles:["td.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]});var Ht=n(76879),Bt=n(30400),Rt=n(27272);class zt{constructor(e){this.notifier=e}call(e,t){return t.subscribe(new Kt(e,this.notifier))}}class Kt extends Rt.Ds{constructor(e,t){super(e),this.hasValue=!1;const n=new Rt.IY(this);this.add(n),this.innerSubscription=n;const o=(0,Rt.ft)(t,n);o!==n&&(this.add(o),this.innerSubscription=o)}_next(e){this.hasValue&&super._next(e)}notifyNext(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()}notifyComplete(){}}var Wt=n(84515),Xt=n(17163),en=n(20309),tn=n(77206),nn=n(98318);function on(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.Oqu(c.lcZ(1,1,"catalog.add-facets"))}function an(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",3),c.NdJ("click",function(){return c.CHM(e),c.oxw().cancel()}),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"button",4),c.NdJ("click",function(){return c.CHM(e),c.oxw().selectValues()}),c._uU(4),c.ALo(5,"translate"),c.qZA()}if(2&e){const e=c.oxw();c.xp6(1),c.Oqu(c.lcZ(2,3,"common.cancel")),c.xp6(2),c.Q6J("disabled",0===e.selectedValues.length),c.xp6(1),c.hij(" ",c.lcZ(5,5,"catalog.add-facets")," ")}}class rn{constructor(e){this.changeDetector=e,this.selectedValues=[]}ngAfterViewInit(){setTimeout(()=>this.selector.focus(),0)}selectValues(){this.resolveWith(this.selectedValues)}cancel(){this.resolveWith()}}rn.\u0275fac=function(e){return new(e||rn)(c.Y36(c.sBO))},rn.\u0275cmp=c.Xpm({type:rn,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(e,t){if(1&e&&c.Gf(i.$MF,5),2&e){let e;c.iGM(e=c.CRH())&&(t.selector=e.first)}},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(c.YNc(0,on,2,3,"ng-template",0),c.TgZ(1,"vdr-facet-value-selector",1),c.NdJ("selectedValuesChange",function(e){return t.selectedValues=e}),c.qZA(),c.YNc(2,an,6,7,"ng-template",2)),2&e&&(c.xp6(1),c.Q6J("facets",t.facets))},directives:[en.q,tn.$,nn.n],pipes:[h.X$],styles:[""],changeDetection:0});var sn=n(3786),cn=n(15646),ln=n(28766),dn=n(4187);function un(e,t){1&e&&(c.ynx(0),c._uU(1),c.ALo(2,"translate"),c.BQk()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"catalog.assign-variants-to-channel")))}function pn(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.Oqu(c.lcZ(1,1,"catalog.assign-products-to-channel"))}function gn(e,t){if(1&e&&(c.YNc(0,un,3,3,"ng-container",12),c.YNc(1,pn,2,3,"ng-template",null,13,c.W1O)),2&e){const e=c.MAs(2),t=c.oxw();c.Q6J("ngIf",t.isProductVariantMode)("ngIfElse",e)}}const mn=function(e){return{channel:e}};function hn(e,t){if(1&e&&(c._uU(0),c.ALo(1,"translate")),2&e){const e=c.oxw();c.hij(" ",c.xi3(1,1,"catalog.price-in-channel",c.VKq(4,mn,null==e.selectedChannel?null:e.selectedChannel.code))," ")}}function fn(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.hij(" ",c.lcZ(1,1,"catalog.no-channel-selected")," ")}function vn(e,t){if(1&e&&(c._uU(0),c.ALo(1,"localeCurrency")),2&e){const e=c.oxw().$implicit,t=c.oxw();c.hij(" ",c.xi3(1,1,e.pricePreview,null==t.selectedChannel?null:t.selectedChannel.currencyCode)," ")}}function Zn(e,t){1&e&&c._uU(0," - ")}function bn(e,t){if(1&e&&(c.TgZ(0,"tr"),c.TgZ(1,"td"),c._uU(2),c.qZA(),c.TgZ(3,"td"),c._uU(4),c.ALo(5,"localeCurrency"),c.qZA(),c.TgZ(6,"td"),c.YNc(7,vn,2,4,"ng-template",8),c.YNc(8,Zn,1,0,"ng-template",null,14,c.W1O),c.qZA(),c.qZA()),2&e){const e=t.$implicit,n=c.MAs(9),o=c.oxw();c.xp6(2),c.Oqu(e.name),c.xp6(2),c.Oqu(c.xi3(5,4,e.price,null==o.currentChannel?null:o.currentChannel.currencyCode)),c.xp6(3),c.Q6J("ngIf",o.selectedChannel)("ngIfElse",n)}}const Cn=function(e){return{channelCode:e}};function xn(e,t){if(1&e&&(c._uU(0),c.ALo(1,"translate")),2&e){const e=c.oxw(2);c.hij(" ",c.xi3(1,1,"catalog.assign-to-named-channel",c.VKq(4,Cn,null==e.selectedChannel?null:e.selectedChannel.code))," ")}}function An(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.hij(" ",c.lcZ(1,1,"catalog.no-channel-selected")," ")}function yn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",15),c.NdJ("click",function(){return c.CHM(e),c.oxw().cancel()}),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"button",16),c.NdJ("click",function(){return c.CHM(e),c.oxw().assign()}),c.YNc(4,xn,2,6,"ng-template",8),c.YNc(5,An,2,3,"ng-template",null,9,c.W1O),c.qZA()}if(2&e){const e=c.MAs(6),t=c.oxw();c.xp6(1),c.Oqu(c.lcZ(2,4,"common.cancel")),c.xp6(2),c.Q6J("disabled",!t.selectedChannel),c.xp6(1),c.Q6J("ngIf",t.selectedChannel)("ngIfElse",e)}}class Pn{constructor(e,t){this.dataService=e,this.notificationService=t,this.priceFactorControl=new s.NI(1),this.selectedChannelIdControl=new s.NI}get isProductVariantMode(){return null!=this.productVariantIds}ngOnInit(){const e=this.dataService.client.userStatus().mapSingle(({userStatus:e})=>e.activeChannelId),t=this.dataService.settings.getChannels().mapSingle(e=>e.channels);(0,C.aj)(e,t).subscribe(([e,t])=>{this.currentChannel=t.find(t=>t.id===e),this.availableChannels=t}),this.selectedChannelIdControl.valueChanges.subscribe(e=>{this.selectChannel(e)}),this.variantsPreview$=(0,C.aj)((0,Bt.D)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe((0,fe.O)(1))).pipe((0,r.U)(([e,t])=>e.map(e=>({id:e.id,name:e.name,price:e.price,pricePreview:e.price*+t}))))}selectChannel(e){this.selectedChannel=this.availableChannels.find(t=>t.id===e[0])}assign(){const e=this.selectedChannel;e&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:e.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success((0,a.J)("catalog.assign-variant-to-channel-success"),{channel:e.code,count:this.productVariantIds.length}),this.resolveWith(!0)}):this.dataService.product.assignProductsToChannel({channelId:e.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success((0,a.J)("catalog.assign-product-to-channel-success"),{channel:e.code,count:this.productIds.length}),this.resolveWith(!0)}))}cancel(){this.resolveWith()}getTopVariants(e){return(0,sn.mG)(this,void 0,void 0,function*(){const t=[];for(let n=0;n<this.productIds.length&&t.length<e;n++){const o=yield this.dataService.product.getProduct(this.productIds[n],{take:this.isProductVariantMode?void 0:e}).mapSingle(({product:e})=>(e?e.variantList.items:[]).filter(e=>{var t;return!this.isProductVariantMode||(null===(t=this.productVariantIds)||void 0===t?void 0:t.includes(e.id))})).toPromise();t.push(...o||[])}return t.slice(0,e)})}}Pn.\u0275fac=function(e){return new(e||Pn)(c.Y36(i.DoR),c.Y36(i.gqp))},Pn.\u0275cmp=c.Xpm({type:Pn,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:32,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","disableChannelIds","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],[4,"ngIf","ngIfElse"],["productModeTitle",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(c.YNc(0,gn,3,2,"ng-template",0),c.TgZ(1,"div",1),c.TgZ(2,"clr-input-container"),c.TgZ(3,"label"),c._uU(4),c.ALo(5,"translate"),c.qZA(),c._UZ(6,"vdr-channel-assignment-control",2),c.qZA(),c._UZ(7,"div",3),c.TgZ(8,"clr-input-container"),c.TgZ(9,"label"),c._uU(10),c.ALo(11,"translate"),c.qZA(),c._UZ(12,"input",4),c.qZA(),c.qZA(),c.TgZ(13,"div",5),c.TgZ(14,"label",6),c._uU(15),c.ALo(16,"translate"),c.qZA(),c.TgZ(17,"table",7),c.TgZ(18,"thead"),c.TgZ(19,"tr"),c.TgZ(20,"th"),c._uU(21),c.ALo(22,"translate"),c.qZA(),c.TgZ(23,"th"),c._uU(24),c.ALo(25,"translate"),c.ALo(26,"translate"),c.ALo(27,"channelCodeToLabel"),c.qZA(),c.TgZ(28,"th"),c.YNc(29,hn,2,6,"ng-template",8),c.YNc(30,fn,2,3,"ng-template",null,9,c.W1O),c.qZA(),c.qZA(),c.qZA(),c.TgZ(32,"tbody"),c.YNc(33,bn,10,7,"tr",10),c.ALo(34,"async"),c.qZA(),c.qZA(),c.qZA(),c.YNc(35,yn,7,6,"ng-template",11)),2&e){const e=c.MAs(31);c.xp6(4),c.Oqu(c.lcZ(5,13,"common.channel")),c.xp6(2),c.Q6J("multiple",!1)("includeDefaultChannel",!1)("disableChannelIds",t.currentChannelIds)("formControl",t.selectedChannelIdControl),c.xp6(4),c.Oqu(c.lcZ(11,15,"catalog.price-conversion-factor")),c.xp6(2),c.Q6J("formControl",t.priceFactorControl),c.xp6(3),c.Oqu(c.lcZ(16,17,"catalog.channel-price-preview")),c.xp6(6),c.Oqu(c.lcZ(22,19,"common.name")),c.xp6(3),c.hij(" ",c.xi3(25,21,"catalog.price-in-channel",c.VKq(30,mn,c.lcZ(26,24,c.lcZ(27,26,null==t.currentChannel?null:t.currentChannel.code))))," "),c.xp6(5),c.Q6J("ngIf",t.selectedChannel)("ngIfElse",e),c.xp6(4),c.Q6J("ngForOf",c.lcZ(34,28,t.variantsPreview$))}},directives:[en.q,E.G55,E.MgK,cn.S,E.xRP,s.JJ,s.oH,G.y,s.qQ,s.Fd,s.wV,s.Fj,m.O5,m.sg,nn.n],pipes:[h.X$,ln.E,m.Ov,dn.k],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0});var Tn=n(45871);function On(e,t,n){if(!e)return"";const o=e.lastIndexOf(t);if(-1===o)return e;return e.substr(0,o)+e.substr(o).replace(t,n)}class Fn{constructor(e){this.dataService=e}getFacets(){return this.dataService.facet.getAllFacets().mapSingle(e=>e.facets.items)}getTaxCategories(){return this.dataService.settings.getTaxCategories().mapSingle(e=>e.taxCategories).pipe((0,Xe.d)(1))}createProductWithVariants(e,t,n){const o=this.dataService.product.createProduct(e),i=t.groups.filter(e=>0<e.values.length),a=this.createProductOptionGroups(i,n);return(0,ut.D)(o,a).pipe((0,Q.zg)(([{createProduct:e},t])=>(t.length?(0,ut.D)(t.map(t=>this.dataService.product.addOptionGroupToProduct({productId:e.id,optionGroupId:t.id}))):(0,S.of)([])).pipe((0,r.U)(()=>({createProduct:e,optionGroups:t})))),(0,Q.zg)(({createProduct:e,optionGroups:o})=>{const i=t.variants.map(e=>{const t=o.length?e.optionValues.map((e,t)=>{const n=o[t].options.find(t=>t.name===e);if(!n)throw new Error(`Could not find a matching ProductOption "${e}" when creating variant`);return n.id}):[];return Object.assign(Object.assign({},e),{optionIds:t})}),a=o.map(e=>e.options).reduce((e,t)=>[...e,...t],[]);return this.createProductVariants(e,i,a,n)}))}createProductOptionGroups(e,t){return e.length?(0,ut.D)(e.map(e=>this.dataService.product.createProductOptionGroups({code:(0,U.U)(e.name,"-"),translations:[{languageCode:t,name:e.name}],options:e.values.map(e=>({code:(0,U.U)(e,"-"),translations:[{languageCode:t,name:e}]}))}).pipe((0,r.U)(e=>e.createProductOptionGroup)))):(0,S.of)([])}createProductVariants(e,t,n,o){const i=t.map(t=>{const i=n.length?`${e.name} ${t.optionIds.map(e=>n.find(t=>t.id===e)).filter(dt.notNullOrUndefined).map(e=>e.name).join(" ")}`:e.name;return{productId:e.id,price:t.price,sku:t.sku,stockOnHand:t.stock,translations:[{languageCode:o,name:i}],optionIds:t.optionIds}});return this.dataService.product.createProductVariants(i).pipe((0,r.U)(({createProductVariants:t})=>({createProductVariants:t,productId:e.id})))}updateProduct(e){const{product:t,languageCode:n,autoUpdate:o,productInput:a,variantsInput:r}=e,s=[],c=r||[];return(o?this.dataService.product.getProductVariants({},t.id).mapSingle(({productVariants:e})=>e.items):(0,S.of)([])).pipe((0,Q.zg)(e=>{var r,l,d,u;if(a){s.push(this.dataService.product.updateProduct(a));const p=null!==(l=null===(r=(0,i.ZIM)(t,n))||void 0===r?void 0:r.name)&&void 0!==l?l:"",g=null===(d=(0,i.ZIM)(a,n))||void 0===d?void 0:d.name;if(g&&p!==g&&o)for(const t of e){const e=(null===(u=(0,i.ZIM)(t,n))||void 0===u?void 0:u.name)||"";let o;const a=c.find(e=>e.id===t.id);a?o=a:(o={id:t.id,translations:[{languageCode:n,name:e}]},c.push(o));const r=(0,i.ZIM)(o,n);r&&(r.name?r.name=On(r.name,p,g):r.name=[g,...t.options.map(e=>e.name)].join(" "))}}return c.length&&s.push(this.dataService.product.updateProductVariants(c)),(0,ut.D)(s)}))}updateProductOption(e,t,n){return(e.autoUpdate?this.dataService.product.getProductVariants({},t.id).mapSingle(({productVariants:e})=>e.items):(0,S.of)([])).pipe((0,Q.zg)(t=>{var o,a,r;let s=(0,S.of)([]);if(e.autoUpdate){let c;const l=null===(o=(0,i.ZIM)(e,n))||void 0===o?void 0:o.name;l||(s=(0,S.of)([]));const d=[];for(const o of t)if(o.options.map(e=>e.id).includes(e.id)){c||(c=null===(a=(0,i.ZIM)(o.options.find(t=>t.id===e.id),n))||void 0===a?void 0:a.name);const t=(null===(r=(0,i.ZIM)(o,n))||void 0===r?void 0:r.name)||"";c&&l&&t.includes(c)&&d.push({id:o.id,translations:[{languageCode:n,name:On(t,c,l)}]})}d.length&&(s=this.dataService.product.updateProductVariants(d))}return this.dataService.product.updateProductOption(e).pipe((0,Q.zg)(()=>s))}))}deleteProductVariant(e,t){return this.dataService.product.deleteProductVariant(e).pipe((0,T.w)(e=>e.deleteProductVariant.result===i.PcR.DELETED?this.dataService.product.getProduct(t).single$:(0,Tn._)(e.deleteProductVariant.message)))}}Fn.\u0275fac=function(e){return new(e||Fn)(c.LFG(i.DoR))},Fn.\u0275prov=c.Yz7({token:Fn,factory:Fn.\u0275fac,providedIn:"root"});const qn=function(){return["product","enabled"]};function In(e,t){if(1&e&&(c.TgZ(0,"clr-toggle-wrapper"),c._UZ(1,"input",8),c.TgZ(2,"label"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("formControl",e.detailForm.get(c.DdM(4,qn))),c.xp6(2),c.Oqu(c.lcZ(4,2,"common.enabled"))}}function wn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",9),c.NdJ("click",function(){return c.CHM(e),c.oxw().create()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine||!e.variantsToCreateAreValid()),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.create")," ")}}function kn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",9),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).save()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("disabled",(e.detailForm.invalid||e.detailForm.pristine)&&!e.assetsChanged()&&!e.variantAssetsChanged()),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.update")," ")}}const Mn=function(){return["UpdateCatalog","UpdateProduct"]};function _n(e,t){1&e&&c.YNc(0,kn,3,4,"button",10),2&e&&c.Q6J("vdrIfPermissions",c.DdM(1,Mn))}function Jn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-chip",42),c.NdJ("iconClick",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw(6).removeFromChannel(t.id)}),c._UZ(1,"vdr-channel-badge",43),c._uU(2),c.ALo(3,"channelCodeToLabel"),c.qZA()}if(2&e){const e=c.oxw().$implicit;c.xp6(1),c.Q6J("channelCode",e.code),c.xp6(1),c.hij(" ",c.lcZ(3,2,e.code)," ")}}function Ln(e,t){if(1&e&&(c.ynx(0),c.YNc(1,Jn,4,4,"vdr-chip",41),c.BQk()),2&e){const e=t.$implicit,n=c.oxw(6);c.xp6(1),c.Q6J("ngIf",!n.isDefaultChannel(e.code))}}function Un(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-form-item",36),c.ALo(1,"translate"),c.TgZ(2,"div",37),c.YNc(3,Ln,2,1,"ng-container",38),c.ALo(4,"async"),c.TgZ(5,"button",39),c.NdJ("click",function(){return c.CHM(e),c.oxw(5).assignToChannel()}),c._UZ(6,"clr-icon",40),c._uU(7),c.ALo(8,"translate"),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=c.oxw(5);c.Q6J("label",c.lcZ(1,3,"common.channels")),c.xp6(3),c.Q6J("ngForOf",c.lcZ(4,5,e.productChannels$)),c.xp6(4),c.hij(" ",c.lcZ(8,7,"catalog.assign-to-channel")," ")}}function Vn(e,t){1&e&&(c.ynx(0),c.YNc(1,Un,9,9,"vdr-form-item",35),c.BQk())}function Nn(e,t){1&e&&(c.ynx(0),c.YNc(1,Vn,2,0,"ng-container",34),c.BQk())}const Sn=function(){return["product","customFields"]};function $n(e,t){if(1&e&&(c.TgZ(0,"section",44),c.TgZ(1,"label"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c._UZ(4,"vdr-tabbed-custom-fields",45),c.ALo(5,"hasPermission"),c.qZA()),2&e){const e=c.oxw(3);c.xp6(2),c.Oqu(c.lcZ(3,4,"common.custom-fields")),c.xp6(2),c.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get(c.DdM(8,Sn)))("readonly",!c.lcZ(5,6,c.DdM(9,Mn)))}}function Dn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-facet-value-chip",46),c.NdJ("remove",function(){const t=c.CHM(e).$implicit;return c.oxw(3).removeProductFacetValue(t.id)}),c.ALo(1,"hasPermission"),c.qZA()}if(2&e){const e=t.$implicit;c.Q6J("facetValue",e)("removable",c.lcZ(1,2,c.DdM(4,Mn)))}}function Qn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",47),c.NdJ("click",function(){return c.CHM(e),c.oxw(3).selectProductFacetValue()}),c._UZ(1,"clr-icon",48),c._uU(2),c.ALo(3,"translate"),c.qZA()}2&e&&(c.xp6(2),c.hij(" ",c.lcZ(3,1,"catalog.add-facets")," "))}function Yn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div"),c.TgZ(1,"h4"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.TgZ(4,"vdr-generate-product-variants",49),c.NdJ("variantsChange",function(t){c.CHM(e);return c.oxw(3).createVariantsConfig=t}),c.qZA(),c.qZA()}2&e&&(c.xp6(2),c.Oqu(c.lcZ(3,1,"catalog.product-variants")))}const jn=function(){return["product","name"]},En=function(e){return{pattern:e}};function Gn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"clr-tab-content"),c.TgZ(1,"div",16),c.TgZ(2,"div",17),c.TgZ(3,"section",18),c.YNc(4,Nn,2,0,"ng-container",15),c.ALo(5,"async"),c.TgZ(6,"vdr-form-field",19),c.ALo(7,"translate"),c.TgZ(8,"input",20),c.NdJ("input",function(t){return c.CHM(e),c.oxw(2).updateSlug(t.target.value)}),c.ALo(9,"hasPermission"),c.qZA(),c.qZA(),c.TgZ(10,"div",21),c.ALo(11,"async"),c.TgZ(12,"clr-checkbox-wrapper"),c._UZ(13,"input",22),c.TgZ(14,"label"),c._uU(15),c.ALo(16,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(17,"vdr-form-field",23),c.ALo(18,"translate"),c.ALo(19,"translate"),c._UZ(20,"input",24),c.ALo(21,"hasPermission"),c.qZA(),c.TgZ(22,"vdr-form-field",25),c.ALo(23,"translate"),c.ALo(24,"translate"),c._UZ(25,"textarea",26),c.ALo(26,"hasPermission"),c.qZA(),c.YNc(27,$n,6,10,"section",27),c._UZ(28,"vdr-custom-detail-component-host",28),c.qZA(),c.qZA(),c.TgZ(29,"div",29),c.TgZ(30,"vdr-assets",30),c.NdJ("change",function(t){c.CHM(e);return c.oxw(2).assetChanges=t}),c.qZA(),c.TgZ(31,"div",31),c.YNc(32,Dn,2,5,"vdr-facet-value-chip",32),c.ALo(33,"async"),c.YNc(34,Qn,4,3,"button",33),c.qZA(),c.qZA(),c.qZA(),c.YNc(35,Yn,5,3,"div",15),c.ALo(36,"async"),c.qZA()}if(2&e){const e=c.oxw().ngIf,t=c.oxw();let n;c.xp6(4),c.Q6J("ngIf",!c.lcZ(5,21,t.isNew$)),c.xp6(2),c.Q6J("label",c.lcZ(7,23,"catalog.product-name")),c.xp6(2),c.Q6J("readonly",!c.lcZ(9,25,c.DdM(47,Mn))),c.xp6(2),c.ekj("visible",!1===c.lcZ(11,27,t.isNew$)&&(null==(n=t.detailForm.get(c.DdM(48,jn)))?null:n.dirty)),c.xp6(5),c.Oqu(c.lcZ(16,29,"catalog.auto-update-product-variant-name")),c.xp6(2),c.Q6J("label",c.lcZ(18,31,"catalog.slug"))("errors",c.VKq(49,En,c.lcZ(19,33,"catalog.slug-pattern-error"))),c.xp6(3),c.Q6J("readonly",!c.lcZ(21,35,c.DdM(51,Mn))),c.xp6(2),c.Q6J("label",c.lcZ(23,37,"common.description"))("errors",c.VKq(52,En,c.lcZ(24,39,"catalog.description-pattern-error"))),c.xp6(3),c.Q6J("readonly",!c.lcZ(26,41,c.DdM(54,Mn))),c.xp6(2),c.Q6J("ngIf",t.customFields.length),c.xp6(1),c.Q6J("entity$",t.entity$)("detailForm",t.detailForm),c.xp6(2),c.Q6J("assets",t.assetChanges.assets||e.assets)("featuredAsset",t.assetChanges.featuredAsset||e.featuredAsset)("updatePermissions",t.updatePermissions),c.xp6(2),c.Q6J("ngForOf",c.lcZ(33,43,t.facetValues$)),c.xp6(2),c.Q6J("vdrIfPermissions",c.DdM(55,Mn)),c.xp6(1),c.Q6J("ngIf",c.lcZ(36,45,t.isNew$))}}const Hn=function(){return["./","manage-variants"]};function Bn(e,t){1&e&&(c.TgZ(0,"a",67),c._UZ(1,"clr-icon",68),c._uU(2),c.ALo(3,"translate"),c.qZA()),2&e&&(c.Q6J("routerLink",c.DdM(4,Hn)),c.xp6(2),c.hij(" ",c.lcZ(3,2,"catalog.manage-variants")," "))}function Rn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",69),c.TgZ(1,"vdr-items-per-page-controls",70),c.NdJ("itemsPerPageChange",function(t){return c.CHM(e),c.oxw(4).setItemsPerPage(t)}),c.ALo(2,"async"),c.qZA(),c.TgZ(3,"vdr-pagination-controls",71),c.NdJ("pageChange",function(t){return c.CHM(e),c.oxw(4).setPage(t)}),c.ALo(4,"async"),c.ALo(5,"async"),c.ALo(6,"async"),c.qZA(),c.qZA()}if(2&e){const e=c.oxw(4);let t;c.xp6(1),c.Q6J("itemsPerPage",c.lcZ(2,4,e.itemsPerPage$)),c.xp6(2),c.Q6J("id",null==(t=c.lcZ(4,6,e.paginationConfig$))?null:t.id)("currentPage",c.lcZ(5,8,e.currentPage$))("itemsPerPage",c.lcZ(6,10,e.itemsPerPage$))}}function zn(e,t){if(1&e&&(c._UZ(0,"vdr-product-variants-table",72),c.ALo(1,"async"),c.ALo(2,"async"),c.ALo(3,"async")),2&e){const e=c.oxw(3).ngIf,t=c.oxw();c.Q6J("variants",c.lcZ(1,6,t.variants$))("paginationConfig",c.lcZ(2,8,t.paginationConfig$))("optionGroups",e.optionGroups)("channelPriceIncludesTax",c.lcZ(3,10,t.channelPriceIncludesTax$))("productVariantsFormArray",t.detailForm.get("variants"))("pendingAssetChanges",t.variantAssetChanges)}}function Kn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-product-variants-list",73),c.NdJ("assignToChannel",function(t){return c.CHM(e),c.oxw(4).assignVariantToChannel(t)})("removeFromChannel",function(t){return c.CHM(e),c.oxw(4).removeVariantFromChannel(t)})("assetChange",function(t){return c.CHM(e),c.oxw(4).variantAssetChange(t)})("updateProductOption",function(t){return c.CHM(e),c.oxw(4).updateProductOption(t)})("selectionChange",function(t){c.CHM(e);return c.oxw(4).selectedVariantIds=t})("selectFacetValueClick",function(t){return c.CHM(e),c.oxw(4).selectVariantFacetValue(t)}),c.ALo(1,"async"),c.ALo(2,"async"),c.ALo(3,"async"),c.ALo(4,"async"),c.ALo(5,"async"),c.ALo(6,"async"),c.qZA()}if(2&e){const e=c.oxw(3).ngIf,t=c.oxw();c.Q6J("variants",c.lcZ(1,11,t.variants$))("paginationConfig",c.lcZ(2,13,t.paginationConfig$))("channelPriceIncludesTax",c.lcZ(3,15,t.channelPriceIncludesTax$))("facets",c.lcZ(4,17,t.facets$))("optionGroups",e.optionGroups)("productVariantsFormArray",t.detailForm.get("variants"))("taxCategories",c.lcZ(5,19,t.taxCategories$))("customFields",t.customVariantFields)("customOptionFields",t.customOptionFields)("activeLanguage",c.lcZ(6,21,t.languageCode$))("pendingAssetChanges",t.variantAssetChanges)}}function Wn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",69),c.TgZ(1,"vdr-items-per-page-controls",70),c.NdJ("itemsPerPageChange",function(t){return c.CHM(e),c.oxw(4).setItemsPerPage(t)}),c.ALo(2,"async"),c.qZA(),c.TgZ(3,"vdr-pagination-controls",71),c.NdJ("pageChange",function(t){return c.CHM(e),c.oxw(4).setPage(t)}),c.ALo(4,"async"),c.ALo(5,"async"),c.ALo(6,"async"),c.qZA(),c.qZA()}if(2&e){const e=c.oxw(4);let t;c.xp6(1),c.Q6J("itemsPerPage",c.lcZ(2,4,e.itemsPerPage$)),c.xp6(2),c.Q6J("id",null==(t=c.lcZ(4,6,e.paginationConfig$))?null:t.id)("currentPage",c.lcZ(5,8,e.currentPage$))("itemsPerPage",c.lcZ(6,10,e.itemsPerPage$))}}function Xn(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"clr-tab-content"),c.TgZ(1,"section",50),c.TgZ(2,"div",51),c.TgZ(3,"div",52),c.TgZ(4,"button",53),c.NdJ("click",function(){c.CHM(e);return c.oxw(3).variantDisplayMode="card"}),c._UZ(5,"clr-icon",54),c.TgZ(6,"span",55),c._uU(7),c.ALo(8,"translate"),c.qZA(),c.qZA(),c.TgZ(9,"button",56),c.NdJ("click",function(){c.CHM(e);return c.oxw(3).variantDisplayMode="table"}),c._UZ(10,"clr-icon",57),c.TgZ(11,"span",55),c._uU(12),c.ALo(13,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(14,"div",58),c._UZ(15,"input",59),c.ALo(16,"translate"),c.TgZ(17,"button",60),c.NdJ("click",function(){return c.CHM(e),c.oxw(3).filterInput.setValue("")}),c._UZ(18,"clr-icon",61),c.qZA(),c.qZA(),c._UZ(19,"div",62),c.YNc(20,Bn,4,5,"a",63),c.qZA(),c.YNc(21,Rn,7,12,"div",64),c.ALo(22,"async"),c.YNc(23,zn,4,12,"vdr-product-variants-table",65),c.YNc(24,Kn,7,23,"vdr-product-variants-list",66),c.qZA(),c.YNc(25,Wn,7,12,"div",64),c.ALo(26,"async"),c.qZA()}if(2&e){const e=c.oxw(3);let t,n;c.xp6(4),c.ekj("btn-primary","card"===e.variantDisplayMode),c.xp6(3),c.Oqu(c.lcZ(8,13,"catalog.display-variant-cards")),c.xp6(2),c.ekj("btn-primary","table"===e.variantDisplayMode),c.xp6(3),c.Oqu(c.lcZ(13,15,"catalog.display-variant-table")),c.xp6(3),c.Q6J("formControl",e.filterInput)("placeholder",c.lcZ(16,17,"catalog.filter-by-name-or-sku")),c.xp6(5),c.Q6J("vdrIfPermissions",c.DdM(23,Mn)),c.xp6(1),c.Q6J("ngIf",10<(null==(t=c.lcZ(22,19,e.paginationConfig$))?null:t.totalItems)),c.xp6(2),c.Q6J("ngIf","table"===e.variantDisplayMode),c.xp6(1),c.Q6J("ngIf","card"===e.variantDisplayMode),c.xp6(1),c.Q6J("ngIf",10<(null==(n=c.lcZ(26,21,e.paginationConfig$))?null:n.totalItems))}}function eo(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"clr-tab"),c.TgZ(1,"button",13),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).navigateToTab("variants")}),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.YNc(4,Xn,27,24,"clr-tab-content",14),c.ALo(5,"async"),c.qZA()}if(2&e){const e=c.oxw(2);c.xp6(2),c.hij(" ",c.lcZ(3,2,"catalog.product-variants")," "),c.xp6(2),c.Q6J("clrIfActive","variants"===c.lcZ(5,4,e.activeTab$))}}function to(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"form",11),c._UZ(1,"button",12),c.TgZ(2,"clr-tabs"),c.TgZ(3,"clr-tab"),c.TgZ(4,"button",13),c.NdJ("click",function(){return c.CHM(e),c.oxw().navigateToTab("details")}),c._uU(5),c.ALo(6,"translate"),c.qZA(),c.YNc(7,Gn,37,56,"clr-tab-content",14),c.ALo(8,"async"),c.qZA(),c.YNc(9,eo,6,6,"clr-tab",15),c.ALo(10,"async"),c.qZA(),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("formGroup",e.detailForm),c.xp6(5),c.hij(" ",c.lcZ(6,4,"catalog.product-details")," "),c.xp6(2),c.Q6J("clrIfActive","details"===c.lcZ(8,6,e.activeTab$)),c.xp6(2),c.Q6J("ngIf",!c.lcZ(10,8,e.isNew$))}}class no extends i.UT_{constructor(e,t,n,o,a,r,c,l,d,u){super(e,t,n,l),this.productDetailService=o,this.formBuilder=a,this.modalService=r,this.notificationService=c,this.dataService=l,this.location=d,this.changeDetector=u,this.filterInput=new s.NI(""),this.assetChanges={},this.variantAssetChanges={},this.variantFacetValueChanges={},this.currentPage$=new b.X(1),this.itemsPerPage$=new b.X(10),this.selectedVariantIds=[],this.variantDisplayMode="card",this.createVariantsConfig={groups:[],variants:[]},this.productVariantMap=new Map,this.updatePermissions=[i.y3$.UpdateCatalog,i.y3$.UpdateProduct],this.customFields=this.getCustomFieldConfig("Product"),this.customVariantFields=this.getCustomFieldConfig("ProductVariant"),this.customOptionGroupFields=this.getCustomFieldConfig("ProductOptionGroup"),this.customOptionFields=this.getCustomFieldConfig("ProductOption"),this.detailForm=this.formBuilder.group({product:this.formBuilder.group({enabled:!0,name:["",s.kI.required],autoUpdateVariantNames:!0,slug:["",(0,i.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",facetValueIds:[[]],customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))}),variants:this.formBuilder.array([])})}ngOnInit(){this.init(),this.product$=this.entity$,this.totalItems$=this.product$.pipe((0,r.U)(e=>e.variantList.totalItems)),this.paginationConfig$=(0,C.aj)(this.totalItems$,this.itemsPerPage$,this.currentPage$).pipe((0,r.U)(([e,t,n])=>({totalItems:e,itemsPerPage:t,currentPage:n})));this.product$.pipe((0,r.U)(e=>e.variantList.items));const e=this.filterInput.valueChanges.pipe((0,fe.O)(""),(0,A.b)(200),(0,Xe.d)()),t=this.product$.pipe((0,r.U)(e=>e.variantList.items)),n=(0,C.aj)(e,this.currentPage$,this.itemsPerPage$).pipe((o=t,e=>e.lift(new zt(o))),(0,Wt.T)(1),(0,T.w)(([e,t,n])=>this.dataService.product.getProductVariants(Object.assign(Object.assign({skip:(t-1)*n,take:n},e?{filter:{name:{contains:e},sku:{contains:e}}}:{}),{filterOperator:i.FnJ.OR}),this.id).mapStream(({productVariants:e})=>e.items)),(0,Xe.d)({bufferSize:1,refCount:!0}));var o;this.variants$=(0,N.T)(t,n).pipe((0,Ze.b)(e=>{for(const t of e)this.productVariantMap.set(t.id,t)})),this.taxCategories$=this.productDetailService.getTaxCategories().pipe((0,y.R)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe((0,r.U)(e=>e.get("tab"))),(0,C.aj)(n,this.languageCode$).pipe((0,y.R)(this.destroy$)).subscribe(([e,t])=>{this.buildVariantFormArray(e,t)}),this.facets$=this.productDetailService.getFacets();const a=this.product$.pipe((0,r.U)(e=>e.facetValues)),s=this.facets$.pipe((0,r.U)(i.k2u)),c=this.getProductFormGroup().valueChanges.pipe((0,r.U)(e=>e.facetValueIds),(0,ve.x)()),l=(0,C.aj)(c,a,s).pipe((0,r.U)(([e,t,n])=>{const o=[...t,...n];return e.map(e=>o.find(t=>t.id===e)).filter(dt.notNullOrUndefined)}));this.facetValues$=(0,N.T)(a,l),this.productChannels$=this.product$.pipe((0,r.U)(e=>e.channels)),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(e=>e.activeChannel.pricesIncludeTax).pipe((0,Xe.d)(1))}ngOnDestroy(){this.destroy()}navigateToTab(e){this.location.replaceState(this.router.createUrlTree(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:e})],{queryParamsHandling:"merge",relativeTo:this.route}).toString())}isDefaultChannel(e){return e===Ht.z$}setPage(e){this.currentPage$.next(e)}setItemsPerPage(e){this.itemsPerPage$.next(+e),this.currentPage$.next(1)}assignToChannel(){this.productChannels$.pipe((0,D.q)(1),(0,T.w)(e=>this.modalService.fromComponent(Pn,{size:"lg",locals:{productIds:[this.id],currentChannelIds:e.map(e=>e.id)}}))).subscribe()}removeFromChannel(e){(0,Bt.D)((0,i.PDO)(this.dataService,e)).pipe((0,T.w)(({channelCode:e})=>this.modalService.dialog({title:(0,a.J)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("catalog.remove-from-channel"),translationVars:{channelCode:e},returnValue:!0}]})),(0,T.w)(t=>t?this.dataService.product.removeProductsFromChannel({channelId:e,productIds:[this.id]}):x.E)).subscribe(()=>{this.notificationService.success((0,a.J)("catalog.notify-remove-product-from-channel-success"))},e=>{this.notificationService.error((0,a.J)("catalog.notify-remove-product-from-channel-error"))})}assignVariantToChannel(e){return this.modalService.fromComponent(Pn,{size:"lg",locals:{productIds:[this.id],productVariantIds:[e.id],currentChannelIds:e.channels.map(e=>e.id)}}).subscribe()}removeVariantFromChannel({channelId:e,variant:t}){(0,Bt.D)((0,i.PDO)(this.dataService,e)).pipe((0,T.w)(({channelCode:e})=>this.modalService.dialog({title:(0,a.J)("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("catalog.remove-from-channel"),translationVars:{channelCode:e},returnValue:!0}]})),(0,T.w)(n=>n?this.dataService.product.removeVariantsFromChannel({channelId:e,productVariantIds:[t.id]}):x.E)).subscribe(()=>{this.notificationService.success((0,a.J)("catalog.notify-remove-variant-from-channel-success"))},e=>{this.notificationService.error((0,a.J)("catalog.notify-remove-variant-from-channel-error"))})}assetsChanged(){return!!Object.values(this.assetChanges).length}variantAssetsChanged(){return!!Object.keys(this.variantAssetChanges).length}variantAssetChange(e){this.variantAssetChanges[e.variantId]=e}updateSlug(e){(0,C.aj)(this.entity$,this.languageCode$).pipe((0,D.q)(1)).subscribe(([t,n])=>{const o=this.detailForm.get(["product","slug"]),a=(0,i.ZIM)(t,n),r=!a||!a.slug;o&&o.pristine&&r&&o.setValue((0,U.U)(`${e}`,"-"))})}selectProductFacetValue(){this.displayFacetValueModal().subscribe(e=>{if(e){const t=this.getProductFormGroup(),n=t.value.facetValueIds;t.patchValue({facetValueIds:(0,K.T)([...n,...e])}),t.markAsDirty()}})}updateProductOption(e){(0,C.aj)(this.product$,this.languageCode$).pipe((0,D.q)(1),(0,Q.zg)(([t,n])=>this.productDetailService.updateProductOption(e,t,n))).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-update-success"),{entity:"ProductOption"})},e=>{this.notificationService.error((0,a.J)("common.notify-update-error"),{entity:"ProductOption"})})}removeProductFacetValue(e){const t=this.getProductFormGroup(),n=t.value.facetValueIds;t.patchValue({facetValueIds:n.filter(t=>t!==e)}),t.markAsDirty()}selectVariantFacetValue(e){this.displayFacetValueModal().pipe((0,Xt.M)(this.variants$)).subscribe(([t,n])=>{if(t){for(const o of e){const e=n.findIndex(e=>e.id===o),i=n[e],a=i?i.facetValues.map(e=>e.id):[],r=this.detailForm.get("variants").controls.find(e=>e.value.id===o);if(r){const e=(0,K.T)([...a,...t]);r.patchValue({facetValueIds:e}),r.markAsDirty(),this.variantFacetValueChanges[o]=e}}this.changeDetector.markForCheck()}})}variantsToCreateAreValid(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every(e=>""!==e.sku)}displayFacetValueModal(){return this.productDetailService.getFacets().pipe((0,Q.zg)(e=>this.modalService.fromComponent(rn,{size:"md",closable:!0,locals:{facets:e}})),(0,r.U)(e=>e&&e.map(e=>e.id)))}create(){const e=this.getProductFormGroup();!e.dirty||(0,C.aj)(this.product$,this.languageCode$).pipe((0,D.q)(1),(0,Q.zg)(([t,n])=>{const o=this.getUpdatedProduct(t,e,n);return this.productDetailService.createProductWithVariants(o,this.createVariantsConfig,n)})).subscribe(({createProductVariants:e,productId:t})=>{this.notificationService.success((0,a.J)("common.notify-create-success"),{entity:"Product"}),this.assetChanges={},this.variantAssetChanges={},this.detailForm.markAsPristine(),this.router.navigate(["../",t],{relativeTo:this.route})},e=>{console.error(e),this.notificationService.error((0,a.J)("common.notify-create-error"),{entity:"Product"})})}save(){(0,C.aj)(this.product$,this.languageCode$,this.channelPriceIncludesTax$).pipe((0,D.q)(1),(0,Q.zg)(([e,t,n])=>{var o,i;const a=this.getProductFormGroup();let r,s;(a.dirty||this.assetsChanged())&&(r=this.getUpdatedProduct(e,a,t));const c=this.detailForm.get("variants");return(c&&c.dirty||this.variantAssetsChanged())&&(s=this.getUpdatedProductVariants(e,c,t,n)),this.productDetailService.updateProduct({product:e,languageCode:t,autoUpdate:null!==(i=null===(o=this.detailForm.get(["product","autoUpdateVariantNames"]))||void 0===o?void 0:o.value)&&void 0!==i&&i,productInput:r,variantsInput:s})})).subscribe(e=>{this.updateSlugAfterSave(e),this.detailForm.markAsPristine(),this.assetChanges={},this.variantAssetChanges={},this.notificationService.success((0,a.J)("common.notify-update-success"),{entity:"Product"}),this.changeDetector.markForCheck()},e=>{this.notificationService.error((0,a.J)("common.notify-update-error"),{entity:"Product"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}setFormValues(e,t){const n=(0,i.ZIM)(e,t);this.detailForm.patchValue({product:{enabled:e.enabled,name:n?n.name:"",slug:n?n.slug:"",description:n?n.description:"",facetValueIds:e.facetValues.map(e=>e.id)}}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["product","customFields"]),e,n),this.buildVariantFormArray(e.variantList.items,t)}buildVariantFormArray(e,t){const n=this.detailForm.get("variants");e.forEach((e,o)=>{const a=(0,i.ZIM)(e,t),r=this.variantFacetValueChanges[e.id]||e.facetValues.map(e=>e.id),s={id:e.id,enabled:e.enabled,sku:e.sku,name:a?a.name:"",price:e.price,priceWithTax:e.priceWithTax,taxCategoryId:e.taxCategory.id,stockOnHand:e.stockOnHand,useGlobalOutOfStockThreshold:e.useGlobalOutOfStockThreshold,outOfStockThreshold:e.outOfStockThreshold,trackInventory:e.trackInventory,facetValueIds:r};let c=n.controls.find(t=>t.value.id===e.id);if(c?c.pristine&&c.patchValue(s):(c=this.formBuilder.group(Object.assign(Object.assign({},s),{facetValueIds:this.formBuilder.control(r)})),n.insert(o,c)),this.customVariantFields.length){let t=c.get(["customFields"]);t||(t=this.formBuilder.group(this.customVariantFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{})),c.addControl("customFields",t)),this.setCustomFieldFormValues(this.customVariantFields,t,e,a)}})}getUpdatedProduct(e,t,n){var o,a;const r=(0,i.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},r),{assetIds:null===(o=this.assetChanges.assets)||void 0===o?void 0:o.map(e=>e.id),featuredAssetId:null===(a=this.assetChanges.featuredAsset)||void 0===a?void 0:a.id,facetValueIds:t.value.facetValueIds})}getUpdatedProductVariants(e,t,n,o){const r=t.controls.filter(e=>e.dirty),s=r.map(e=>this.productVariantMap.get(e.value.id)).filter(dt.notNullOrUndefined),c=r.map(e=>e.value);if(s.length!==c.length)throw new Error((0,a.J)("error.product-variant-form-values-do-not-match"));return s.map((e,t)=>{var a,r;const s=c.find(t=>t.id===e.id),l=(0,i.iSy)({translatable:e,updatedFields:s,customFieldConfig:this.customVariantFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}});l.taxCategoryId=s.taxCategoryId,l.facetValueIds=s.facetValueIds,l.price=o?s.priceWithTax:s.price;const d=this.variantAssetChanges[e.id];return d&&(l.featuredAssetId=null===(a=d.featuredAsset)||void 0===a?void 0:a.id,l.assetIds=null===(r=d.assets)||void 0===r?void 0:r.map(e=>e.id)),l}).filter(dt.notNullOrUndefined)}getProductFormGroup(){return this.detailForm.get("product")}updateSlugAfterSave(e){const t=e[0],n=this.detailForm.get(["product","slug"]);n&&t.hasOwnProperty("updateProduct")&&n.setValue(t.updateProduct.slug,{emitEvent:!1})}}no.\u0275fac=function(e){return new(e||no)(c.Y36(o.gz),c.Y36(o.F0),c.Y36(i.iHG),c.Y36(Fn),c.Y36(s.qu),c.Y36(i.Z7U),c.Y36(i.gqp),c.Y36(i.DoR),c.Y36(m.Ye),c.Y36(c.sBO))},no.\u0275cmp=c.Xpm({type:no,selectors:[["vdr-product-detail"]],features:[c.qOj],decls:18,vars:21,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["type","submit","hidden","","x-data","prevents enter key from triggering other buttons"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],[1,"auto-rename-wrapper"],["clrCheckbox","","type","checkbox","id","auto-update","formControlName","autoUpdateVariantNames"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["for","description",3,"label","errors"],["rows","9","id","slug","type","text","formControlName","description",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["locationId","product-detail",3,"entity$","detailForm"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","updatePermissions","change"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFields","customFieldsFormGroup","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"full-label"],[1,"btn",3,"click"],["shape","table"],[1,"variant-filter"],[3,"formControl","placeholder"],[1,"icon-button",3,"click"],["shape","times"],[1,"flex-spacer"],["class","btn btn-secondary edit-variants-btn mb0 mr0",3,"routerLink",4,"vdrIfPermissions"],["class","pagination-row mt4",4,"ngIf"],[3,"variants","paginationConfig","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges",4,"ngIf"],[3,"variants","paginationConfig","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","edit-variants-btn","mb0","mr0",3,"routerLink"],["shape","add-text"],[1,"pagination-row","mt4"],[3,"itemsPerPage","itemsPerPageChange"],[3,"id","currentPage","itemsPerPage","pageChange"],[3,"variants","paginationConfig","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges"],[3,"variants","paginationConfig","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(e,t){if(1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left"),c.TgZ(2,"div",0),c._UZ(3,"vdr-entity-info",1),c.ALo(4,"async"),c.YNc(5,In,5,5,"clr-toggle-wrapper",2),c.qZA(),c.TgZ(6,"vdr-language-selector",3),c.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),c.ALo(7,"async"),c.ALo(8,"async"),c.ALo(9,"async"),c.qZA(),c.qZA(),c.TgZ(10,"vdr-ab-right"),c._UZ(11,"vdr-action-bar-items",4),c.YNc(12,wn,3,4,"button",5),c.ALo(13,"async"),c.YNc(14,_n,1,2,"ng-template",null,6,c.W1O),c.qZA(),c.qZA(),c.YNc(16,to,11,10,"form",7),c.ALo(17,"async")),2&e){const e=c.MAs(15);c.xp6(3),c.Q6J("entity",c.lcZ(4,8,t.entity$)),c.xp6(2),c.Q6J("vdrIfPermissions",c.DdM(20,Mn)),c.xp6(1),c.Q6J("disabled",c.lcZ(7,10,t.isNew$))("availableLanguageCodes",c.lcZ(8,12,t.availableLanguages$))("currentLanguageCode",c.lcZ(9,14,t.languageCode$)),c.xp6(6),c.Q6J("ngIf",c.lcZ(13,16,t.isNew$))("ngIfElse",e),c.xp6(4),c.Q6J("ngIf",c.lcZ(17,18,t.product$))}},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}textarea[_ngcontent-%COMP%]{width:100%}.facets[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;align-items:center}@media screen and (min-width: 768px){.facets[_ngcontent-%COMP%]{max-width:340px}}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:none;max-width:initial;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}@media screen and (min-width: 768px){.view-mode[_ngcontent-%COMP%]{flex-direction:row}}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap;max-height:144px;overflow-y:auto}.auto-rename-wrapper[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible[_ngcontent-%COMP%]{max-height:24px;margin-bottom:12px}.pagination-row[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between}"],changeDetection:0});var oo=n(65318),io=n(62875),ao=n(40809);const ro=["productSearchInputComponent"];function so(e,t){1&e&&c._UZ(0,"vdr-status-badge",20)}const co=function(){return["UpdateCatalog","UpdateProduct"]},lo=function(e){return{count:e}};function uo(e,t){if(1&e){const e=c.EpF();c.ynx(0),c.TgZ(1,"button",21),c.NdJ("click",function(){return c.CHM(e),c.oxw().runPendingSearchIndexUpdates()}),c.ALo(2,"hasPermission"),c._UZ(3,"vdr-status-badge",20),c._uU(4),c.ALo(5,"translate"),c.qZA(),c._UZ(6,"div",22),c.BQk()}if(2&e){const e=c.oxw();c.xp6(1),c.Q6J("disabled",!c.lcZ(2,2,c.DdM(7,co))),c.xp6(3),c.hij(" ",c.xi3(5,4,"catalog.run-pending-search-index-updates",c.VKq(8,lo,e.pendingSearchIndexUpdates))," ")}}const po=function(){return["./create"]};function go(e,t){1&e&&(c.TgZ(0,"a",23),c._UZ(1,"clr-icon",24),c._uU(2),c.ALo(3,"translate"),c.qZA()),2&e&&(c.Q6J("routerLink",c.DdM(4,po)),c.xp6(2),c.hij(" ",c.lcZ(3,2,"catalog.create-new-product")," "))}function mo(e,t){if(1&e&&(c._UZ(0,"img",38),c.ALo(1,"assetPreview")),2&e){const e=t.ngIf;c.Q6J("src",c.xi3(1,1,e,"tiny"),c.LSH)}}function ho(e,t){1&e&&(c.TgZ(0,"div",39),c._UZ(1,"clr-icon",40),c.qZA())}function fo(e,t){if(1&e&&(c.TgZ(0,"div",41),c._uU(1),c.qZA()),2&e){const e=c.oxw().item;c.xp6(1),c.Oqu(e.sku)}}function vo(e,t){1&e&&(c.TgZ(0,"vdr-chip"),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"common.disabled")))}const Zo=function(e){return["./",e]},bo=function(){return["DeleteCatalog","DeleteProduct"]};function Co(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"td",25),c.TgZ(1,"div",26),c.YNc(2,mo,2,4,"img",27),c.YNc(3,ho,2,0,"ng-template",null,28,c.W1O),c.qZA(),c.qZA(),c.TgZ(5,"td",29),c.TgZ(6,"div"),c._uU(7),c.qZA(),c.YNc(8,fo,2,1,"div",30),c.qZA(),c.TgZ(9,"td",31),c.YNc(10,vo,3,3,"vdr-chip",10),c.qZA(),c.TgZ(11,"td",32),c._UZ(12,"vdr-table-row-action",33),c.ALo(13,"translate"),c.TgZ(14,"vdr-dropdown"),c.TgZ(15,"button",34),c._uU(16),c.ALo(17,"translate"),c._UZ(18,"clr-icon",35),c.qZA(),c.TgZ(19,"vdr-dropdown-menu",8),c.TgZ(20,"button",36),c.NdJ("click",function(){const t=c.CHM(e).item;return c.oxw().deleteProduct(t.productId)}),c.ALo(21,"hasPermission"),c._UZ(22,"clr-icon",37),c._uU(23),c.ALo(24,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.item,n=c.MAs(4),o=c.oxw();c.ekj("disabled",!e.enabled),c.xp6(2),c.Q6J("ngIf",o.groupByProduct?e.productAsset:e.productVariantAsset||e.productAsset)("ngIfElse",n),c.xp6(3),c.ekj("disabled",!e.enabled),c.xp6(2),c.Oqu(o.groupByProduct?e.productName:e.productVariantName),c.xp6(1),c.Q6J("ngIf",!o.groupByProduct),c.xp6(1),c.ekj("disabled",!e.enabled),c.xp6(1),c.Q6J("ngIf",!e.enabled),c.xp6(1),c.ekj("disabled",!e.enabled),c.xp6(1),c.Q6J("label",c.lcZ(13,18,"common.edit"))("linkTo",c.VKq(26,Zo,e.productId)),c.xp6(4),c.hij(" ",c.lcZ(17,20,"common.actions")," "),c.xp6(4),c.Q6J("disabled",!c.lcZ(21,22,c.DdM(28,bo))),c.xp6(3),c.hij(" ",c.lcZ(24,24,"common.delete")," ")}}const xo=function(){return["CreateCatalog","CreateProduct"]};class Ao extends i.t7C{constructor(e,t,n,o,a,s,c){super(s,c),this.dataService=e,this.modalService=t,this.notificationService=n,this.jobQueueService=o,this.serverConfigService=a,this.searchTerm="",this.facetValueIds=[],this.groupByProduct=!0,this.pendingSearchIndexUpdates=0,this.route.queryParamMap.pipe((0,r.U)(e=>e.get("q")),(0,y.R)(this.destroy$)).subscribe(e=>{this.searchTerm=e||"",this.productSearchInput&&this.productSearchInput.setSearchTerm(e)}),this.selectedFacetValueIds$=this.route.queryParamMap.pipe((0,r.U)(e=>e.getAll("fvids"))),this.selectedFacetValueIds$.pipe((0,y.R)(this.destroy$)).subscribe(e=>{this.facetValueIds=e,this.productSearchInput&&this.productSearchInput.setFacetValues(e)}),super.setQueryFn((...e)=>this.dataService.product.searchProducts(this.searchTerm,...e).refetchOnChannelChange(),e=>e.search,(e,t)=>({input:{skip:e,take:t,term:this.searchTerm,facetValueIds:this.facetValueIds,facetValueOperator:i.FnJ.AND,groupByProduct:this.groupByProduct}})),this.selectionManager=new i.ZE0({multiSelect:!0,itemsAreEqual:(e,t)=>this.groupByProduct?e.productId===t.productId:e.productVariantId===t.productVariantId,additiveMode:!0})}ngOnInit(){super.ngOnInit(),this.facetValues$=this.result$.pipe((0,r.U)(e=>e.search.facetValues)),this.facetValues$.pipe((0,D.q)(1),(0,oo.g)(100),(0,Xt.M)(this.selectedFacetValueIds$)).subscribe(([e,t])=>{this.productSearchInput.setFacetValues(t)}),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:e})=>e.contentLanguage).pipe((0,Ze.b)(()=>this.refresh())),this.dataService.product.getPendingSearchIndexUpdates().mapSingle(({pendingSearchIndexUpdates:e})=>e).subscribe(e=>this.pendingSearchIndexUpdates=e)}ngAfterViewInit(){this.productSearchInput&&this.searchTerm&&setTimeout(()=>this.productSearchInput.setSearchTerm(this.searchTerm))}setSearchTerm(e){this.searchTerm=e,this.setQueryParam({q:e||null,page:1}),this.refresh()}setFacetValueIds(e){this.facetValueIds=e,this.setQueryParam({fvids:e,page:1}),this.refresh()}rebuildSearchIndex(){this.dataService.product.reindex().subscribe(({reindex:e})=>{this.notificationService.info((0,a.J)("catalog.reindexing")),this.jobQueueService.addJob(e.id,e=>{if(e.state===i.Zyh.COMPLETED){const t=(new Intl.NumberFormat).format(e.duration||0);this.notificationService.success((0,a.J)("catalog.reindex-successful"),{count:e.result.indexedItemCount,time:t}),this.refresh()}else this.notificationService.error((0,a.J)("catalog.reindex-error"))})})}runPendingSearchIndexUpdates(){this.dataService.product.runPendingSearchIndexUpdates().subscribe(e=>{this.notificationService.info((0,a.J)("catalog.running-search-index-updates"),{count:this.pendingSearchIndexUpdates}),this.pendingSearchIndexUpdates=0})}deleteProduct(e){this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(t=>t?this.dataService.product.deleteProduct(e):x.E),(0,oo.g)(500)).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"Product"}),this.refresh()},e=>{this.notificationService.error((0,a.J)("common.notify-delete-error"),{entity:"Product"})})}setLanguage(e){this.dataService.client.setContentLanguage(e).subscribe()}}function yo(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",6),c.NdJ("click",function(){return c.CHM(e),c.oxw().save()}),c._uU(1),c.ALo(2,"translate"),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("disabled",e.detailForm.pristine||e.detailForm.invalid),c.xp6(1),c.hij(" ",c.lcZ(2,2,"common.update")," ")}}function Po(e,t){if(1&e&&(c.TgZ(0,"tr",22),c.TgZ(1,"td",23),c._UZ(2,"vdr-entity-info",13),c.qZA(),c.TgZ(3,"td",23),c._UZ(4,"input",24),c.ALo(5,"hasPermission"),c.qZA(),c.TgZ(6,"td",23),c._UZ(7,"input",25),c.qZA(),c.qZA()),2&e){const e=t.$implicit,n=t.index,o=c.oxw(3);c.Q6J("formGroupName",n),c.xp6(2),c.Q6J("entity",e.value),c.xp6(2),c.Q6J("readonly",!c.lcZ(5,3,o.updatePermission))}}function To(e,t){if(1&e&&(c.TgZ(0,"div",10),c.TgZ(1,"section",11),c.TgZ(2,"div",12),c._UZ(3,"vdr-entity-info",13),c.TgZ(4,"div",14),c._uU(5),c.qZA(),c.qZA(),c.TgZ(6,"div",15),c.TgZ(7,"vdr-form-field",16),c.ALo(8,"translate"),c._UZ(9,"input",17),c.ALo(10,"hasPermission"),c.qZA(),c.TgZ(11,"vdr-form-field",18),c.ALo(12,"translate"),c._UZ(13,"input",19),c.ALo(14,"hasPermission"),c.qZA(),c.qZA(),c.TgZ(15,"section",15),c.TgZ(16,"table",20),c.TgZ(17,"thead"),c.TgZ(18,"tr"),c._UZ(19,"th"),c.TgZ(20,"th"),c._uU(21),c.ALo(22,"translate"),c.qZA(),c.TgZ(23,"th"),c._uU(24),c.ALo(25,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(26,"tbody"),c.YNc(27,Po,8,5,"tr",21),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e){const e=t.$implicit,n=t.index,o=c.oxw(2);c.xp6(1),c.Q6J("formArrayName",n),c.xp6(2),c.Q6J("entity",e.value),c.xp6(2),c.Oqu(e.value.code),c.xp6(2),c.Q6J("label",c.lcZ(8,12,"common.name")),c.xp6(2),c.Q6J("id","name-"+n)("readonly",!c.lcZ(10,14,o.updatePermission)),c.xp6(2),c.Q6J("label",c.lcZ(12,16,"common.code")),c.xp6(2),c.Q6J("id","code-"+n)("readonly",!c.lcZ(14,18,o.updatePermission)),c.xp6(8),c.Oqu(c.lcZ(22,20,"common.name")),c.xp6(3),c.Oqu(c.lcZ(25,22,"common.code")),c.xp6(3),c.Q6J("ngForOf",o.getOptions(e))}}function Oo(e,t){if(1&e&&(c.TgZ(0,"form",7),c.TgZ(1,"div",8),c.YNc(2,To,28,24,"div",9),c.qZA(),c.qZA()),2&e){const e=c.oxw();c.Q6J("formGroup",e.detailForm),c.xp6(2),c.Q6J("ngForOf",e.getOptionGroups())}}Ao.\u0275fac=function(e){return new(e||Ao)(c.Y36(i.DoR),c.Y36(i.Z7U),c.Y36(i.gqp),c.Y36(i.u8d),c.Y36(i.iHG),c.Y36(o.F0),c.Y36(o.gz))},Ao.\u0275cmp=c.Xpm({type:Ao,selectors:[["vdr-products-list"]],viewQuery:function(e,t){if(1&e&&c.Gf(ro,7),2&e){let e;c.iGM(e=c.CRH())&&(t.productSearchInput=e.first)}},features:[c.qOj],decls:43,vars:46,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu","mr3"],["type","button","vdrDropdownTrigger","",1,"icon-button","search-index-button",3,"title"],["shape","cog"],["type","warning",4,"ngIf"],["vdrPosition","bottom-right"],[1,"dropdown-header"],[4,"ngIf"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"flex","wrap"],[1,"mt2"],["type","checkbox","clrToggle","",3,"ngModel","ngModelChange"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","selectionManager","pageChange","itemsPerPageChange"],["locationId","product-list",3,"hostComponent","selectionManager"],["type","warning"],["type","button","vdrDropdownItem","",1,"run-updates-button",3,"disabled","click"],[1,"dropdown-divider"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle","image-col"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"left","align-middle"],["class","sku",4,"ngIf"],[1,"align-middle"],[1,"right","align-middle"],["iconShape","edit",1,"edit-button",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"sku"]],template:function(e,t){1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left",0),c.TgZ(2,"div",1),c.TgZ(3,"vdr-product-search-input",2,3),c.NdJ("searchTermChange",function(e){return t.setSearchTerm(e)})("facetValueChange",function(e){return t.setFacetValueIds(e)}),c.ALo(5,"async"),c.qZA(),c.TgZ(6,"vdr-dropdown",4),c.TgZ(7,"button",5),c.ALo(8,"translate"),c._UZ(9,"clr-icon",6),c.YNc(10,so,1,0,"vdr-status-badge",7),c.qZA(),c.TgZ(11,"vdr-dropdown-menu",8),c.TgZ(12,"h4",9),c._uU(13),c.ALo(14,"translate"),c.qZA(),c.YNc(15,uo,7,10,"ng-container",10),c.TgZ(16,"button",11),c.NdJ("click",function(){return t.rebuildSearchIndex()}),c.ALo(17,"hasPermission"),c._uU(18),c.ALo(19,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(20,"div",12),c.TgZ(21,"clr-toggle-wrapper",13),c.TgZ(22,"input",14),c.NdJ("ngModelChange",function(e){return t.groupByProduct=e})("ngModelChange",function(){return t.refresh()}),c.qZA(),c.TgZ(23,"label"),c._uU(24),c.ALo(25,"translate"),c.qZA(),c.qZA(),c.TgZ(26,"vdr-language-selector",15),c.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),c.ALo(27,"async"),c.ALo(28,"async"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(29,"vdr-ab-right"),c._UZ(30,"vdr-action-bar-items",16),c.YNc(31,go,4,5,"a",17),c.qZA(),c.qZA(),c.TgZ(32,"vdr-data-table",18),c.NdJ("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),c.ALo(33,"async"),c.ALo(34,"async"),c.ALo(35,"async"),c.ALo(36,"async"),c._UZ(37,"vdr-bulk-action-menu",19),c._UZ(38,"vdr-dt-column"),c._UZ(39,"vdr-dt-column"),c._UZ(40,"vdr-dt-column"),c._UZ(41,"vdr-dt-column"),c.YNc(42,Co,25,29,"ng-template"),c.qZA()),2&e&&(c.xp6(1),c.Q6J("grow",!0),c.xp6(2),c.Q6J("facetValueResults",c.lcZ(5,20,t.facetValues$)),c.xp6(4),c.Q6J("title",c.lcZ(8,22,t.pendingSearchIndexUpdates?"catalog.pending-search-index-updates":"catalog.search-index-controls")),c.xp6(3),c.Q6J("ngIf",t.pendingSearchIndexUpdates),c.xp6(3),c.Oqu(c.lcZ(14,24,"catalog.search-index-controls")),c.xp6(2),c.Q6J("ngIf",t.pendingSearchIndexUpdates),c.xp6(1),c.Q6J("disabled",!c.lcZ(17,26,c.DdM(44,co))),c.xp6(2),c.hij(" ",c.lcZ(19,28,"catalog.rebuild-search-index")," "),c.xp6(4),c.Q6J("ngModel",t.groupByProduct),c.xp6(2),c.hij(" ",c.lcZ(25,30,"catalog.group-by-product")," "),c.xp6(2),c.Q6J("availableLanguageCodes",c.lcZ(27,32,t.availableLanguages$))("currentLanguageCode",c.lcZ(28,34,t.contentLanguage$)),c.xp6(5),c.Q6J("vdrIfPermissions",c.DdM(45,xo)),c.xp6(1),c.Q6J("items",c.lcZ(33,36,t.items$))("itemsPerPage",c.lcZ(34,38,t.itemsPerPage$))("totalItems",c.lcZ(35,40,t.totalItems$))("currentPage",c.lcZ(36,42,t.currentPage$))("selectionManager",t.selectionManager),c.xp6(5),c.Q6J("hostComponent",t)("selectionManager",t.selectionManager))},directives:[l.Kk,l.BN,io.j,W.J,X.U,E.qvL,m.O5,ee.N,te.H,E.PEh,G.y,s.Wl,E.KKC,s.JJ,s.On,E.MgK,Y.S,l.mz,u.W,p.H,Ce.Q,et.c,kt.E,ao.e,o.yS,xe.v,Mt.Y],pipes:[m.Ov,h.X$,M.j,ne.M],styles:[".image-col[_ngcontent-%COMP%]{width:70px}.image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}vdr-product-search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width: 768px){vdr-product-search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.search-index-button[_ngcontent-%COMP%]{position:relative}.search-index-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{right:0;top:0}.run-updates-button[_ngcontent-%COMP%]{position:relative}.run-updates-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{left:10px;top:10px}.edit-button[_ngcontent-%COMP%]{margin-right:24px}.sku[_ngcontent-%COMP%]{color:var(--color-text-300)}"]});class Fo extends i.UT_{constructor(e,t,n,o,a,r,s,c){super(e,t,n,o),this.route=e,this.router=t,this.serverConfigService=n,this.dataService=o,this.productDetailService=a,this.formBuilder=r,this.changeDetector=s,this.notificationService=c,this.autoUpdateVariantNames=!0,this.updatePermission=[i.y3$.UpdateCatalog,i.y3$.UpdateProduct],this.optionGroupCustomFields=this.getCustomFieldConfig("ProductOptionGroup"),this.optionCustomFields=this.getCustomFieldConfig("ProductOption")}ngOnInit(){this.optionGroups$=this.route.snapshot.data.entity.pipe((0,r.U)(e=>e.optionGroups)),this.detailForm=new s.cw({optionGroups:new s.Oe([])}),super.init()}getOptionGroups(){return this.detailForm.get("optionGroups").controls}getOptions(e){return e.get("options").controls}save(){if(this.detailForm.invalid||this.detailForm.pristine)return;const e=this.dataService.product.getProduct(this.id).mapSingle(e=>e.product);(0,C.aj)(this.entity$,this.languageCode$,e).pipe((0,D.q)(1),(0,Q.zg)(([{optionGroups:e},t,n])=>{var o,i,a,r,s;const c=[];for(const l of this.getOptionGroups()){if((null===(o=l.get("name"))||void 0===o?void 0:o.dirty)||(null===(i=l.get("code"))||void 0===i?void 0:i.dirty)){const n=e.find(e=>e.id===l.value.id);if(n){const e=this.getUpdatedOptionGroup(n,l,t);c.push(this.dataService.product.updateProductOptionGroup(e))}}for(const o of this.getOptions(l))if((null===(a=o.get("name"))||void 0===a?void 0:a.dirty)||(null===(r=o.get("code"))||void 0===r?void 0:r.dirty)){const i=null===(s=e.find(e=>e.id===l.value.id))||void 0===s?void 0:s.options.find(e=>e.id===o.value.id);if(i){const e=this.getUpdatedOption(i,o,t);c.push(this.productDetailService.updateProductOption(Object.assign(Object.assign({},e),{autoUpdate:this.autoUpdateVariantNames}),n,t))}}}return(0,ut.D)(c)})).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,a.J)("common.notify-update-success"),{entity:"ProductOptionGroup"})},e=>{this.notificationService.error((0,a.J)("common.notify-update-error"),{entity:"ProductOptionGroup"})})}getUpdatedOptionGroup(e,t,n){return(0,i.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.optionGroupCustomFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}})}getUpdatedOption(e,t,n){return(0,i.iSy)({translatable:e,updatedFields:t.value,customFieldConfig:this.optionGroupCustomFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}})}setFormValues(e,t){const n=new s.Oe([]);for(const o of e.optionGroups){const e=(0,i.ZIM)(o,t),a={id:o.id,createdAt:o.createdAt,updatedAt:o.updatedAt,code:o.code,name:e?e.name:""},r=new s.Oe([]);for(const n of o.options){const e=(0,i.ZIM)(n,t),o=this.formBuilder.group({id:n.id,createdAt:n.createdAt,updatedAt:n.updatedAt,code:n.code,name:e?e.name:""});r.push(o)}const c=this.formBuilder.group(a);c.addControl("options",r),n.push(c)}this.detailForm.setControl("optionGroups",n)}}Fo.\u0275fac=function(e){return new(e||Fo)(c.Y36(o.gz),c.Y36(o.F0),c.Y36(i.iHG),c.Y36(i.DoR),c.Y36(Fn),c.Y36(s.qu),c.Y36(c.sBO),c.Y36(i.gqp))},Fo.\u0275cmp=c.Xpm({type:Fo,selectors:[["vdr-product-options-editor"]],features:[c.qOj],decls:16,vars:14,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"flex","center"],[1,"mr2"],["clrCheckbox","","type","checkbox","id","auto-update",3,"ngModel","ngModelChange"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"form",3,"formGroup"],["formGroupName","optionGroups",1,"clr-row"],["class","clr-col-12 clr-col-xl-6",4,"ngFor","ngForOf"],[1,"clr-col-12","clr-col-xl-6"],[1,"card",3,"formArrayName"],[1,"card-header","option-group-header"],[3,"entity"],[1,"ml2"],[1,"card-block"],["for","name",3,"label"],["type","text","formControlName","name",3,"id","readonly"],["for","code",3,"label"],["type","text","formControlName","code",3,"id","readonly"],["formGroupName","options",1,"facet-values-list","table","mt2","mb4"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly"],["type","text","formControlName","code"]],template:function(e,t){1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-left"),c.TgZ(2,"vdr-language-selector",0),c.NdJ("languageCodeChange",function(e){return t.setLanguage(e)}),c.ALo(3,"async"),c.ALo(4,"async"),c.qZA(),c.qZA(),c.TgZ(5,"vdr-ab-right"),c.TgZ(6,"div",1),c.TgZ(7,"div",2),c.TgZ(8,"clr-checkbox-wrapper"),c.TgZ(9,"input",3),c.NdJ("ngModelChange",function(e){return t.autoUpdateVariantNames=e}),c.qZA(),c.TgZ(10,"label"),c._uU(11),c.ALo(12,"translate"),c.qZA(),c.qZA(),c.qZA(),c.YNc(13,yo,3,4,"button",4),c.qZA(),c.qZA(),c.qZA(),c.YNc(14,Oo,3,2,"form",5),c.ALo(15,"async")),2&e&&(c.xp6(2),c.Q6J("availableLanguageCodes",c.lcZ(3,6,t.availableLanguages$))("currentLanguageCode",c.lcZ(4,8,t.languageCode$)),c.xp6(7),c.Q6J("ngModel",t.autoUpdateVariantNames),c.xp6(2),c.Oqu(c.lcZ(12,10,"catalog.auto-update-product-variant-name")),c.xp6(2),c.Q6J("vdrIfPermissions",t.updatePermission),c.xp6(1),c.Q6J("ngIf",c.lcZ(15,12,t.optionGroups$)))},directives:[l.Kk,l.BN,Y.S,l.mz,E.PEh,G.y,s.Wl,E.KKC,s.JJ,s.On,E.MgK,p.H,m.O5,s._Y,s.JL,s.sg,s.x0,m.sg,s.CE,d.V,j.h,s.Fj,s.u],pipes:[m.Ov,h.X$,M.j],styles:[".option-group-header[_ngcontent-%COMP%]{display:flex;align-items:baseline}"],changeDetection:0});var qo=n(65762),Io=n(51253);function wo(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.hij(" ",c.lcZ(1,1,"catalog.confirm-deletion-of-unused-variants-title"),"\n")}function ko(e,t){if(1&e&&(c.TgZ(0,"li"),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.xp6(1),c.AsE("",e.name," (",e.sku,")")}}function Mo(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",3),c.NdJ("click",function(){return c.CHM(e),c.oxw().cancel()}),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"button",4),c.NdJ("click",function(){return c.CHM(e),c.oxw().confirm()}),c._uU(4),c.ALo(5,"translate"),c.qZA()}2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,2,"common.cancel")),c.xp6(3),c.hij(" ",c.lcZ(5,4,"common.confirm")," "))}class _o{constructor(){this.variants=[]}confirm(){this.resolveWith(!0)}cancel(){this.resolveWith()}}_o.\u0275fac=function(e){return new(e||_o)},_o.\u0275cmp=c.Xpm({type:_o,selectors:[["vdr-confirm-variant-deletion-dialog"]],decls:6,vars:4,consts:[["vdrDialogTitle",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(c.YNc(0,wo,2,3,"ng-template",0),c._uU(1),c.ALo(2,"translate"),c.TgZ(3,"ul"),c.YNc(4,ko,2,2,"li",1),c.qZA(),c.YNc(5,Mo,6,6,"ng-template",2)),2&e&&(c.xp6(1),c.hij("\n",c.lcZ(2,2,"catalog.confirm-deletion-of-unused-variants-body"),"\n"),c.xp6(3),c.Q6J("ngForOf",t.variants))},directives:[en.q,m.sg,nn.n],pipes:[h.X$],styles:[""],changeDetection:0});const Jo=["textArea"],Lo=["editNameInput"];function Uo(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-chip",6),c.NdJ("iconClick",function(){const t=c.CHM(e).$implicit;return c.oxw(2).removeOption(t)}),c.TgZ(1,"span",7),c.TgZ(2,"input",8,9),c.NdJ("blur",function(t){const n=c.CHM(e).index;return c.oxw(2).updateOption(n,t)})("click",function(e){return e.cancelBubble=!0}),c.qZA(),c.qZA(),c.TgZ(4,"span",10),c.NdJ("click",function(t){const n=c.CHM(e).index;return c.oxw(2).editName(n,t)}),c._uU(5),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,n=t.last,o=t.index,i=c.oxw(2);c.ekj("selected",n&&i.lastSelected)("locked",e.locked),c.Q6J("icon",e.locked?"lock":"times")("colorFrom",i.groupName),c.xp6(1),c.Q6J("hidden",i.editingIndex!==o),c.xp6(1),c.Q6J("ngModel",e.name),c.xp6(2),c.ekj("editable",!e.locked&&!e.id),c.Q6J("hidden",i.editingIndex===o),c.xp6(1),c.Oqu(e.name)}}function Vo(e,t){if(1&e&&(c.TgZ(0,"div",4),c.YNc(1,Uo,6,12,"vdr-chip",5),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.optionValues)}}const No={provide:s.JU,useExisting:(0,c.Gpc)(()=>So),multi:!0};class So{constructor(e){this.changeDetector=e,this.groupName="",this.add=new c.vpe,this.remove=new c.vpe,this.edit=new c.vpe,this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1,this.editingIndex=-1}get optionValues(){var e,t;return null!==(t=null!==(e=this.formValue)&&void 0!==e?e:this.options)&&void 0!==t?t:[]}registerOnChange(e){this.onChangeFn=e}registerOnTouched(e){this.onTouchFn=e}setDisabledState(e){this.disabled=e,this.changeDetector.markForCheck()}writeValue(e){this.formValue=e||[]}focus(){this.textArea.nativeElement.focus()}editName(e,t){var n;const o=this.optionValues[e];if(!o.locked&&!o.id){t.cancelBubble=!0,this.editingIndex=e;const o=null===(n=this.nameInputs.get(e))||void 0===n?void 0:n.nativeElement;setTimeout(()=>null==o?void 0:o.focus())}}updateOption(e,t){const n=this.optionValues[e],o=t.target.value;n&&(o&&(n.name=o,this.edit.emit({index:e,option:n})),this.editingIndex=-1)}removeOption(e){var t;e.locked||(this.formValue?(this.formValue=null===(t=this.formValue)||void 0===t?void 0:t.filter(t=>t.name!==e.name),this.onChangeFn(this.formValue)):this.remove.emit(e))}handleKey(e){switch(e.key){case",":case"Enter":this.addOptionValue(),e.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}handleBlur(){this.isFocussed=!1,this.addOptionValue()}addOptionValue(){const e=this.parseInputIntoOptions(this.input).filter(e=>{var t;const n=null!==(t=this.options)&&void 0!==t?t:this.formValue;return!(null==n?void 0:n.find(t=>(null==t?void 0:t.name)===e.name))});if(!this.formValue&&this.options)for(const t of e)this.add.emit(t);else this.formValue=(0,K.T)([...this.formValue,...e]),this.onChangeFn(this.formValue);this.input=""}parseInputIntoOptions(e){return e.split(/[,\n]/).map(e=>e.trim()).filter(e=>""!==e).map(e=>({name:e,locked:!1}))}removeLastOption(){if(this.optionValues.length){const e=this.optionValues[this.optionValues.length-1];this.removeOption(e)}}}So.\u0275fac=function(e){return new(e||So)(c.Y36(c.sBO))},So.\u0275cmp=c.Xpm({type:So,selectors:[["vdr-option-value-input"]],viewQuery:function(e,t){if(1&e&&(c.Gf(Jo,7),c.Gf(Lo,5,c.SBq)),2&e){let e;c.iGM(e=c.CRH())&&(t.textArea=e.first),c.iGM(e=c.CRH())&&(t.nameInputs=e)}},inputs:{groupName:"groupName",options:"options",disabled:"disabled"},outputs:{add:"add",remove:"remove",edit:"edit"},features:[c._Bn([No])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"],[3,"hidden"],["type","text",3,"ngModel","blur","click"],["editNameInput",""],[1,"option-name",3,"hidden","click"]],template:function(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",0),c.NdJ("click",function(){return c.CHM(e),c.MAs(3).focus()}),c.YNc(1,Vo,2,1,"div",1),c.TgZ(2,"textarea",2,3),c.NdJ("keyup",function(e){return t.handleKey(e)})("focus",function(){return t.isFocussed=!0})("blur",function(){return t.handleBlur()})("ngModelChange",function(e){return t.input=e}),c.qZA(),c.qZA()}2&e&&(c.ekj("focus",t.isFocussed),c.xp6(1),c.Q6J("ngIf",0<t.optionValues.length),c.xp6(1),c.Q6J("ngModel",t.input)("disabled",t.disabled))},directives:[m.O5,G.y,s.Fj,s.JJ,s.On,m.sg,Mt.Y],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}vdr-chip[_ngcontent-%COMP%]   .option-name.editable[_ngcontent-%COMP%]:hover{outline:1px solid var(--color-component-bg-300);outline-offset:1px;border-radius:1px}vdr-chip[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:0!important;margin-top:-2px;margin-bottom:-2px}"]});var $o=n(87283);function Do(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",7),c.TgZ(1,"div",8),c.TgZ(2,"label"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.TgZ(5,"input",9),c.NdJ("ngModelChange",function(t){return c.CHM(e).$implicit.name=t}),c.qZA(),c.qZA(),c.TgZ(6,"div",10),c.TgZ(7,"label"),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.TgZ(10,"vdr-option-value-input",11,12),c.NdJ("add",function(t){const n=c.CHM(e).index;return c.oxw().addOption(n,t.name)})("remove",function(t){const n=c.CHM(e).index;return c.oxw().removeOption(n,t)}),c.qZA(),c.qZA(),c.TgZ(12,"div"),c.TgZ(13,"button",13),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw().removeOptionGroup(t)}),c._UZ(14,"clr-icon",14),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit;c.xp6(3),c.Oqu(c.lcZ(4,8,"catalog.option")),c.xp6(2),c.Q6J("ngModel",e.name)("readonly",!e.isNew),c.xp6(3),c.Oqu(c.lcZ(9,10,"catalog.option-values")),c.xp6(2),c.Q6J("options",e.values)("groupName",e.name)("disabled",""===e.name),c.xp6(3),c.Q6J("disabled",e.locked)}}function Qo(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"clr-checkbox-wrapper"),c.TgZ(1,"input",18),c.NdJ("ngModelChange",function(t){c.CHM(e);return c.oxw().$implicit.enabled=t})("ngModelChange",function(){c.CHM(e);return c.oxw(2).formValueChanged=!0}),c.qZA(),c.TgZ(2,"label"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA()}if(2&e){const e=c.oxw().$implicit;c.xp6(1),c.Q6J("ngModel",e.enabled),c.xp6(2),c.Oqu(c.lcZ(4,2,"common.create"))}}function Yo(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"clr-input-container"),c.TgZ(1,"input",19),c.NdJ("ngModelChange",function(t){c.CHM(e);return c.oxw().$implicit.sku=t})("ngModelChange",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().onFormChanged(t)}),c.ALo(2,"translate"),c.qZA(),c.qZA()}if(2&e){const e=c.oxw().$implicit;c.xp6(1),c.Q6J("ngModel",e.sku)("placeholder",c.lcZ(2,2,"catalog.sku"))}}function jo(e,t){if(1&e&&(c.TgZ(0,"span"),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.Oqu(e.sku)}}function Eo(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"clr-input-container"),c.TgZ(1,"vdr-currency-input",20),c.NdJ("ngModelChange",function(t){c.CHM(e);return c.oxw().$implicit.price=t})("ngModelChange",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().onFormChanged(t)}),c.qZA(),c.qZA()}if(2&e){const e=c.oxw().$implicit,t=c.oxw();c.xp6(1),c.Q6J("ngModel",e.price)("currencyCode",t.currencyCode)}}function Go(e,t){if(1&e&&(c.TgZ(0,"span"),c._uU(1),c.ALo(2,"localeCurrency"),c.qZA()),2&e){const e=c.oxw().$implicit,t=c.oxw();c.xp6(1),c.Oqu(c.xi3(2,1,e.price,t.currencyCode))}}function Ho(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"clr-input-container"),c.TgZ(1,"input",21),c.NdJ("ngModelChange",function(t){c.CHM(e);return c.oxw().$implicit.stock=t})("ngModelChange",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().onFormChanged(t)}),c.qZA(),c.qZA()}if(2&e){const e=c.oxw().$implicit;c.xp6(1),c.Q6J("ngModel",e.stock)}}function Bo(e,t){if(1&e&&(c.TgZ(0,"span"),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.Oqu(e.stock)}}function Ro(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-dropdown"),c.TgZ(1,"button",22),c._UZ(2,"clr-icon",23),c.qZA(),c.TgZ(3,"vdr-dropdown-menu",24),c.TgZ(4,"button",25),c.NdJ("click",function(){const t=c.CHM(e).ngIf,n=c.oxw().$implicit;return c.oxw().deleteVariant(t,n.options)}),c._UZ(5,"clr-icon",26),c._uU(6),c.ALo(7,"translate"),c.qZA(),c.qZA(),c.qZA()}2&e&&(c.xp6(6),c.hij(" ",c.lcZ(7,1,"common.delete")," "))}function zo(e,t){if(1&e&&(c.TgZ(0,"tr"),c.TgZ(1,"td",15),c.YNc(2,Qo,5,4,"clr-checkbox-wrapper",16),c.qZA(),c.TgZ(3,"td"),c._uU(4),c.ALo(5,"translate"),c.qZA(),c.TgZ(6,"td"),c.TgZ(7,"div",17),c.YNc(8,Yo,3,4,"clr-input-container",16),c.YNc(9,jo,2,1,"span",16),c.qZA(),c.qZA(),c.TgZ(10,"td"),c.TgZ(11,"div",17),c.YNc(12,Eo,2,2,"clr-input-container",16),c.YNc(13,Go,3,4,"span",16),c.qZA(),c.qZA(),c.TgZ(14,"td"),c.TgZ(15,"div",17),c.YNc(16,Ho,2,1,"clr-input-container",16),c.YNc(17,Bo,2,1,"span",16),c.qZA(),c.qZA(),c.TgZ(18,"td"),c.YNc(19,Ro,8,3,"vdr-dropdown",16),c.qZA(),c.qZA()),2&e){const e=t.$implicit,n=c.oxw();c.ekj("disabled",!e.enabled||e.existing),c.xp6(2),c.Q6J("ngIf",!e.existing),c.xp6(2),c.hij(" ",c.lcZ(5,11,n.getVariantName(e))," "),c.xp6(4),c.Q6J("ngIf",!e.existing),c.xp6(1),c.Q6J("ngIf",e.existing),c.xp6(3),c.Q6J("ngIf",!e.existing),c.xp6(1),c.Q6J("ngIf",e.existing),c.xp6(3),c.Q6J("ngIf",!e.existing),c.xp6(1),c.Q6J("ngIf",e.existing),c.xp6(2),c.Q6J("ngIf",e.productVariantId)}}const Ko=function(e){return{count:e}};class Wo{constructor(e){for(const t of Object.keys(e))this[t]=e[t]}}class Xo{constructor(e,t,n,o,i){this.route=e,this.dataService=t,this.productDetailService=n,this.notificationService=o,this.modalService=i,this.formValueChanged=!1,this.optionsChanged=!1,this.generatedVariants=[]}ngOnInit(){this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||(0,i.kAh)(),this.dataService.settings.getActiveChannel().single$.subscribe(e=>{this.currencyCode=e.activeChannel.currencyCode})}onFormChanged(e){this.formValueChanged=!0,e.enabled=!0}canDeactivate(){return!this.formValueChanged}getVariantsToAdd(){return this.generatedVariants.filter(e=>!e.existing&&e.enabled)}getVariantName(e){return 0===e.options.length?(0,a.J)("catalog.default-variant"):e.options.map(e=>e.name).join(" ")}addOptionGroup(){this.optionGroups.push({isNew:!0,locked:!1,name:"",values:[]}),this.optionsChanged=!0}removeOptionGroup(e){const t=e.id;e.isNew?(this.optionGroups=this.optionGroups.filter(t=>t!==e),this.generateVariants(),this.optionsChanged=!0):t&&this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-product-option-group"),translationVars:{name:e.name},buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(e=>e?this.dataService.product.removeOptionGroupFromProduct({optionGroupId:t,productId:this.product.id}):x.E)).subscribe(({removeOptionGroupFromProduct:e})=>{var t;"Product"===e.__typename?(this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"ProductOptionGroup"}),this.initOptionsAndVariants(),this.optionsChanged=!0):"ProductOptionInUseError"===e.__typename&&this.notificationService.error(null!==(t=e.message)&&void 0!==t?t:"")})}addOption(e,t){const n=this.optionGroups[e];n&&(n.values.push({name:t,locked:!1}),this.generateVariants(),this.optionsChanged=!0)}removeOption(e,{id:t,name:n}){const o=this.optionGroups[e];o&&(t?this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-product-option"),translationVars:{name:n},buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(e=>e?this.dataService.product.deleteProductOption(t):x.E)).subscribe(({deleteProductOption:e})=>{var n;e.result===i.PcR.DELETED?(this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"ProductOption"}),o.values=o.values.filter(e=>e.id!==t),this.generateVariants(),this.optionsChanged=!0):this.notificationService.error(null!==(n=e.message)&&void 0!==n?n:"")}):(o.values=o.values.filter(e=>e.name!==n),this.generateVariants()))}generateVariants(){const e=this.optionGroups.map(e=>e.values),t=this.generatedVariants,n=(e,n,o,i)=>{var a,r,s,c,l,d;const u=this.getVariantPrototype(n,t);return new Wo({enabled:!0,existing:!!o,productVariantId:null==o?void 0:o.id,isDefault:e,options:n,price:null!==(r=null!==(a=null==o?void 0:o.price)&&void 0!==a?a:null==i?void 0:i.price)&&void 0!==r?r:u.price,sku:null!==(c=null!==(s=null==o?void 0:o.sku)&&void 0!==s?s:null==i?void 0:i.sku)&&void 0!==c?c:u.sku,stock:null!==(d=null!==(l=null==o?void 0:o.stockOnHand)&&void 0!==l?l:null==i?void 0:i.stockOnHand)&&void 0!==d?d:u.stock})};this.generatedVariants=e.length?(0,dt.generateAllCombinations)(e).map(e=>{const t=this.product.variants.find(t=>this.optionsAreEqual(t.options,e)),o=this.product.variants.find(t=>this.optionsAreSubset(t.options,e));return n(!1,e,t,o)}):[n(!0,[],this.product.variants[0])]}getVariantPrototype(e,t){return t.filter(t=>e.map(e=>e.name).filter(e=>t.options.map(e=>e.name).includes(e))).length?(0,qo.e)(t[0],["sku","price","stock"]):{sku:"",price:0,stock:0}}deleteVariant(e,t){this.modalService.dialog({title:(0,a.J)("catalog.confirm-delete-product-variant"),translationVars:{name:t.map(e=>e.name).join(" ")},buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(t=>t?this.productDetailService.deleteProductVariant(e,this.product.id):x.E),(0,T.w)(()=>this.reFetchProduct(null))).subscribe(()=>{this.notificationService.success((0,a.J)("common.notify-delete-success"),{entity:"ProductVariant"}),this.initOptionsAndVariants()},e=>{this.notificationService.error((0,a.J)("common.notify-delete-error"),{entity:"ProductVariant"})})}save(){this.optionGroups=this.optionGroups.filter(e=>e.values.length);const e=this.optionGroups.filter(e=>e.isNew).map(e=>({name:e.name,values:[]}));this.checkUniqueSkus().pipe((0,Q.zg)(()=>this.confirmDeletionOfObsoleteVariants()),(0,Q.zg)(()=>this.productDetailService.createProductOptionGroups(e,this.languageCode)),(0,Q.zg)(e=>this.addOptionGroupsToProduct(e)),(0,Q.zg)(e=>this.addNewOptionsToGroups(e)),(0,Q.zg)(e=>this.fetchOptionGroups(e)),(0,Q.zg)(e=>this.createNewProductVariants(e)),(0,Q.zg)(e=>this.deleteObsoleteVariants(e.createProductVariants)),(0,Q.zg)(e=>this.reFetchProduct(e))).subscribe({next:e=>{this.formValueChanged=!1,this.notificationService.success((0,a.J)("catalog.created-new-variants-success"),{count:e.length}),this.initOptionsAndVariants(),this.optionsChanged=!1}})}checkUniqueSkus(){const e=this.generatedVariants.filter((e,t)=>e.enabled&&this.generatedVariants.find(t=>t.sku.trim()===e.sku.trim()&&t!==e));return e.length?this.modalService.dialog({title:(0,a.J)("catalog.duplicate-sku-warning"),body:(0,K.T)(e.map(e=>`${e.sku}`)).join(", "),buttons:[{label:(0,a.J)("common.close"),returnValue:!1,type:"primary"}]}).pipe((0,Q.zg)(e=>x.E)):(0,S.of)(!0)}confirmDeletionOfObsoleteVariants(){const e=this.getObsoleteVariants();return e.length?this.modalService.fromComponent(_o,{locals:{variants:e}}).pipe((0,Q.zg)(e=>!0===e?(0,S.of)(!0):x.E)):(0,S.of)(!0)}getObsoleteVariants(){return this.product.variants.filter(e=>!this.generatedVariants.find(t=>t.productVariantId===e.id))}hasOnlyDefaultVariant(e){return 1===e.variants.length&&0===e.optionGroups.length}addOptionGroupsToProduct(e){return e.length?(0,ut.D)(e.map(e=>this.dataService.product.addOptionGroupToProduct({productId:this.product.id,optionGroupId:e.id}))).pipe((0,r.U)(()=>e)):(0,S.of)([])}addNewOptionsToGroups(e){const t=this.optionGroups.map(t=>{const n=e.find(e=>e.name===t.name),o=n?n.id:t.id;if(!o)throw new Error("Could not get a productOptionGroupId");return t.values.filter(e=>!e.locked).map(e=>({productOptionGroupId:o,code:(0,U.U)(e.name,"-"),translations:[{name:e.name,languageCode:this.languageCode}]}))}).reduce((e,t)=>[...e,...t],[]),n=[...e.map(e=>e.id),...this.optionGroups.map(e=>e.id).filter(dt.notNullOrUndefined)];return t.length?(0,ut.D)(t.map(e=>this.dataService.product.addOptionToGroup(e))).pipe((0,r.U)(()=>n)):(0,S.of)(n)}fetchOptionGroups(e){return(0,ut.D)(e.map(e=>this.dataService.product.getProductOptionGroup(e).mapSingle(e=>e.productOptionGroup).pipe((0,$.h)(dt.notNullOrUndefined)))).pipe((0,Io.d)([]))}createNewProductVariants(e){const t=e.filter(dt.notNullOrUndefined).map(e=>e.options).reduce((e,t)=>[...e,...t],[]),n=this.generatedVariants.filter(e=>e.enabled&&!e.existing).map(t=>{const n=e.map((e,n)=>{const o=e.options.find(e=>e.name===t.options[n].name);if(o)return o.id;throw new Error(`Could not find a matching option for group ${e.name}`)});return{price:t.price,sku:t.sku,stock:t.stock,optionIds:n}});return this.productDetailService.createProductVariants(this.product,n,t,this.languageCode)}deleteObsoleteVariants(e){const t=this.getObsoleteVariants();if(t.length){const n=t.map(t=>this.dataService.product.deleteProductVariant(t.id).pipe((0,r.U)(()=>e)));return(0,ut.D)(...n)}return(0,S.of)(e)}reFetchProduct(e){const t=this.route.snapshot.paramMap.get("id");return t?this.dataService.product.getProduct(t).single$.pipe((0,r.U)(()=>e)):(0,S.of)(e)}initOptionsAndVariants(){this.dataService.product.getProductVariantsOptions(this.route.snapshot.paramMap.get("id")).mapSingle(({product:e})=>e).subscribe(e=>{this.product=e;const t=e.variants.map(e=>e.options.map(e=>e.id)).flat(),n=e.variants.map(e=>e.options.map(e=>e.groupId)).flat();this.optionGroups=e.optionGroups.map(e=>({id:e.id,isNew:!1,name:e.name,locked:n.includes(e.id),values:e.options.map(e=>({id:e.id,name:e.name,locked:t.includes(e.id)}))})),this.generateVariants()})}optionsAreEqual(e,t){return this.toOptionString(e)===this.toOptionString(t)}optionsAreSubset(e,t){return this.toOptionString(t).includes(this.toOptionString(e))}toOptionString(e){return e.map(e=>e.name).sort().join("|")}}Xo.\u0275fac=function(e){return new(e||Xo)(c.Y36(o.gz),c.Y36(i.DoR),c.Y36(Fn),c.Y36(i.gqp),c.Y36(i.Z7U))},Xo.\u0275cmp=c.Xpm({type:Xo,selectors:[["vdr-product-variants-editor"]],decls:29,vars:24,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"options","groupName","disabled","add","remove"],["optionValueInputComponent",""],[1,"btn","btn-icon","btn-danger-outline","mt5",3,"disabled","click"],["shape","trash"],[1,"left"],[4,"ngIf"],[1,"flex","center"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(e,t){1&e&&(c.TgZ(0,"vdr-action-bar"),c.TgZ(1,"vdr-ab-right"),c.TgZ(2,"button",0),c.NdJ("click",function(){return t.save()}),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA(),c.qZA(),c.YNc(5,Do,15,12,"div",1),c.TgZ(6,"button",2),c.NdJ("click",function(){return t.addOptionGroup()}),c._UZ(7,"clr-icon",3),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.TgZ(10,"div",4),c.TgZ(11,"table",5),c.TgZ(12,"thead"),c.TgZ(13,"tr"),c._UZ(14,"th"),c.TgZ(15,"th"),c._uU(16),c.ALo(17,"translate"),c.qZA(),c.TgZ(18,"th"),c._uU(19),c.ALo(20,"translate"),c.qZA(),c.TgZ(21,"th"),c._uU(22),c.ALo(23,"translate"),c.qZA(),c.TgZ(24,"th"),c._uU(25),c.ALo(26,"translate"),c.qZA(),c._UZ(27,"th"),c.qZA(),c.qZA(),c.YNc(28,zo,20,13,"tr",6),c.qZA(),c.qZA()),2&e&&(c.xp6(2),c.Q6J("disabled",!t.formValueChanged&&!t.optionsChanged||0===t.getVariantsToAdd().length),c.xp6(1),c.hij(" ",c.xi3(4,9,"common.add-new-variants",c.VKq(22,Ko,t.getVariantsToAdd().length))," "),c.xp6(2),c.Q6J("ngForOf",t.optionGroups),c.xp6(3),c.hij(" ",c.lcZ(9,12,"catalog.add-option"),"\n"),c.xp6(8),c.Oqu(c.lcZ(17,14,"catalog.variant")),c.xp6(3),c.Oqu(c.lcZ(20,16,"catalog.sku")),c.xp6(3),c.Oqu(c.lcZ(23,18,"catalog.price")),c.xp6(3),c.Oqu(c.lcZ(26,20,"catalog.stock-on-hand")),c.xp6(3),c.Q6J("ngForOf",t.generatedVariants))},directives:[l.Kk,l.mz,m.sg,E.qvL,E.MgK,G.y,s.Fj,E.xRP,s.JJ,s.On,So,m.O5,E.PEh,s.Wl,E.KKC,E.G55,s.Q7,$o.K,s.qQ,s.wV,W.J,X.U,ee.N,te.H],pipes:[h.X$,dn.k],styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});class ei extends i.p_9{constructor(e,t){super(e,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:i.h3s.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},e=>t.product.getAsset(e).mapStream(e=>e.asset))}}ei.\u0275fac=function(e){return new(e||ei)(c.LFG(o.F0),c.LFG(i.DoR))},ei.\u0275prov=c.Yz7({token:ei,factory:ei.\u0275fac,providedIn:"root"});class ti extends i.p_9{constructor(e,t){super(e,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:(0,i.kAh)(),name:"",slug:"",isPrivate:!1,breadcrumbs:[],description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},e=>t.collection.getCollection(e).mapStream(e=>e.collection))}}ti.\u0275fac=function(e){return new(e||ti)(c.LFG(o.F0),c.LFG(i.DoR))},ti.\u0275prov=c.Yz7({token:ti,factory:ti.\u0275fac,providedIn:"root"});class ni extends i.p_9{constructor(e,t){super(e,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:(0,i.kAh)(),name:"",code:"",translations:[],values:[]},e=>t.facet.getFacet(e).mapStream(e=>e.facet))}}ni.\u0275fac=function(e){return new(e||ni)(c.LFG(o.F0),c.LFG(i.DoR))},ni.\u0275prov=c.Yz7({token:ni,factory:ni.\u0275fac,providedIn:"root"});class oi extends i.p_9{constructor(e,t){super(t,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:(0,i.kAh)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variantList:{items:[],totalItems:0},channels:[]},t=>e.product.getProduct(t,{take:10}).refetchOnChannelChange().mapStream(e=>e.product))}}oi.\u0275fac=function(e){return new(e||oi)(c.LFG(i.DoR),c.LFG(o.F0))},oi.\u0275prov=c.Yz7({token:oi,factory:oi.\u0275fac,providedIn:"root"});class ii extends i.p_9{constructor(e,t){super(e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},e=>t.product.getProductVariantsOptions(e).mapStream(e=>e.product))}}ii.\u0275fac=function(e){return new(e||ii)(c.LFG(o.F0),c.LFG(i.DoR))},ii.\u0275prov=c.Yz7({token:ii,factory:ii.\u0275fac,providedIn:"root"});const ai=[{path:"products",component:Ao,data:{breadcrumb:(0,a.J)("breadcrumb.products")}},{path:"products/:id",component:no,resolve:(0,i.Po4)(oi),canDeactivate:[i.TSp],data:{breadcrumb:ri}},{path:"products/:id/manage-variants",component:Xo,resolve:(0,i.Po4)(ii),canDeactivate:[i.TSp],data:{breadcrumb:si}},{path:"products/:id/options",component:Fo,resolve:(0,i.Po4)(ii),canDeactivate:[i.TSp],data:{breadcrumb:ci}},{path:"facets",component:Gt,data:{breadcrumb:(0,a.J)("breadcrumb.facets")}},{path:"facets/:id",component:It,resolve:(0,i.Po4)(ni),canDeactivate:[i.TSp],data:{breadcrumb:li}},{path:"collections",component:lt,data:{breadcrumb:(0,a.J)("breadcrumb.collections")}},{path:"collections/:id",component:We,resolve:(0,i.Po4)(ti),canDeactivate:[i.TSp],data:{breadcrumb:di}},{path:"assets",component:L,data:{breadcrumb:(0,a.J)("breadcrumb.assets")}},{path:"assets/:id",component:Z,resolve:(0,i.Po4)(ei),data:{breadcrumb:ui}}];function ri(e,t){return(0,i.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.products",getName:e=>e.name,route:"products"})}function si(e,t){return e.entity.pipe((0,r.U)(e=>[{label:(0,a.J)("breadcrumb.products"),link:["../","products"]},{label:`${e.name}`,link:["../","products",t.id,{tab:"variants"}]},{label:(0,a.J)("breadcrumb.manage-variants"),link:["manage-variants"]}]))}function ci(e,t){return e.entity.pipe((0,r.U)(e=>[{label:(0,a.J)("breadcrumb.products"),link:["../","products"]},{label:`${e.name}`,link:["../","products",t.id,{tab:"variants"}]},{label:(0,a.J)("breadcrumb.product-options"),link:["options"]}]))}function li(e,t){return(0,i.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.facets",getName:e=>e.name,route:"facets"})}function di(e,t){return(0,i.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.collections",getName:e=>e.name,route:"collections"})}function ui(e,t){return(0,i.YWC)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.assets",getName:e=>e.name,route:"assets"})}function pi(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.hij(" ",c.lcZ(1,1,"catalog.assign-to-channel"),"\n")}const gi=function(e){return{channelCode:e}};function mi(e,t){if(1&e&&(c._uU(0),c.ALo(1,"translate")),2&e){const e=c.oxw(2);c.hij(" ",c.xi3(1,1,"catalog.assign-to-named-channel",c.VKq(4,gi,null==e.selectedChannel?null:e.selectedChannel.code))," ")}}function hi(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.hij(" ",c.lcZ(1,1,"catalog.no-channel-selected")," ")}function fi(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",4),c.NdJ("click",function(){return c.CHM(e),c.oxw().cancel()}),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"button",5),c.NdJ("click",function(){return c.CHM(e),c.oxw().assign()}),c.YNc(4,mi,2,6,"ng-template",6),c.YNc(5,hi,2,3,"ng-template",null,7,c.W1O),c.qZA()}if(2&e){const e=c.MAs(6),t=c.oxw();c.xp6(1),c.Oqu(c.lcZ(2,4,"common.cancel")),c.xp6(2),c.Q6J("disabled",!t.selectedChannel),c.xp6(1),c.Q6J("ngIf",t.selectedChannel)("ngIfElse",e)}}class vi{constructor(e,t){this.dataService=e,this.notificationService=t,this.selectedChannelIdControl=new s.NI}ngOnInit(){const e=this.dataService.client.userStatus().mapSingle(({userStatus:e})=>e.activeChannelId),t=this.dataService.settings.getChannels().mapSingle(e=>e.channels);(0,C.aj)(e,t).subscribe(([e,t])=>{this.currentChannel=t.find(t=>t.id===e),this.availableChannels=t}),this.selectedChannelIdControl.valueChanges.subscribe(e=>{this.selectChannel(e)})}selectChannel(e){this.selectedChannel=this.availableChannels.find(t=>t.id===e[0])}assign(){const e=this.selectedChannel;e&&this.resolveWith(e)}cancel(){this.resolveWith()}}vi.\u0275fac=function(e){return new(e||vi)(c.Y36(i.DoR),c.Y36(i.gqp))},vi.\u0275cmp=c.Xpm({type:vi,selectors:[["vdr-assign-to-channel-dialog"]],decls:7,vars:6,consts:[["vdrDialogTitle",""],[1,"mb4"],["clrInput","",3,"multiple","includeDefaultChannel","formControl"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[3,"ngIf","ngIfElse"],["noSelection",""]],template:function(e,t){1&e&&(c.YNc(0,pi,2,3,"ng-template",0),c.TgZ(1,"clr-input-container",1),c.TgZ(2,"label"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c._UZ(5,"vdr-channel-assignment-control",2),c.qZA(),c.YNc(6,fi,7,6,"ng-template",3)),2&e&&(c.xp6(3),c.Oqu(c.lcZ(4,4,"common.channel")),c.xp6(2),c.Q6J("multiple",!1)("includeDefaultChannel",!1)("formControl",t.selectedChannelIdControl))},directives:[en.q,E.G55,E.MgK,cn.S,E.xRP,s.JJ,s.oH,nn.n,m.O5],pipes:[h.X$],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}"],changeDetection:0});var Zi=n(32928);const bi=Zi.Ps`
    query GetProductsWithFacetValuesByIds($ids: [String!]!) {
        products(options: { filter: { id: { in: $ids } } }) {
            items {
                id
                name
                facetValues {
                    id
                    name
                    code
                    facet {
                        id
                        name
                        code
                    }
                }
            }
        }
    }
`,Ci=Zi.Ps`
    query GetVariantsWithFacetValuesByIds($ids: [String!]!) {
        productVariants(options: { filter: { id: { in: $ids } } }) {
            items {
                id
                name
                sku
                facetValues {
                    id
                    name
                    code
                    facet {
                        id
                        name
                        code
                    }
                }
            }
        }
    }
`,xi=Zi.Ps`
    mutation UpdateProductsBulk($input: [UpdateProductInput!]!) {
        updateProducts(input: $input) {
            id
            name
            facetValues {
                id
                name
                code
            }
        }
    }
`,Ai=Zi.Ps`
    mutation UpdateVariantsBulk($input: [UpdateProductVariantInput!]!) {
        updateProductVariants(input: $input) {
            id
            name
            facetValues {
                id
                name
                code
            }
        }
    }
`;function yi(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.hij(" ",c.lcZ(1,1,"catalog.edit-facet-values"),"\n")}function Pi(e,t){if(1&e&&(c.TgZ(0,"div",14),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.Oqu(e.sku)}}function Ti(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-facet-value-chip",15),c.NdJ("remove",function(){const t=c.CHM(e).$implicit,n=c.oxw().$implicit;return c.oxw(2).removeFacetValue(n,t.id)}),c.qZA()}if(2&e){const e=t.$implicit;c.Q6J("facetValue",e)}}function Oi(e,t){if(1&e&&(c.TgZ(0,"tr"),c.TgZ(1,"td",10),c.TgZ(2,"div"),c._uU(3),c.qZA(),c.YNc(4,Pi,2,1,"div",11),c.qZA(),c.TgZ(5,"td",12),c.YNc(6,Ti,1,1,"vdr-facet-value-chip",13),c.qZA(),c.qZA()),2&e){const e=t.$implicit;c.xp6(3),c.Oqu(e.name),c.xp6(1),c.Q6J("ngIf",e.sku),c.xp6(2),c.Q6J("ngForOf",e.facetValues)}}function Fi(e,t){if(1&e&&(c.TgZ(0,"table",8),c.TgZ(1,"tbody"),c.YNc(2,Oi,7,3,"tr",9),c.qZA(),c.qZA()),2&e){const e=c.oxw();c.xp6(2),c.Q6J("ngForOf",e.items)}}function qi(e,t){1&e&&(c.TgZ(0,"div",16),c._UZ(1,"clr-spinner"),c.qZA())}function Ii(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",17),c.NdJ("click",function(){return c.CHM(e),c.oxw().cancel()}),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"button",18),c.NdJ("click",function(){return c.CHM(e),c.oxw().addFacetValues()}),c._uU(4),c.ALo(5,"translate"),c.qZA()}if(2&e){const e=c.oxw();c.xp6(1),c.Oqu(c.lcZ(2,3,"common.cancel")),c.xp6(2),c.Q6J("disabled",0===e.selectedValues.length&&!1===e.facetValuesRemoved),c.xp6(1),c.hij(" ",c.lcZ(5,5,"common.update")," ")}}class wi{constructor(e,t){this.dataService=e,this.changeDetectorRef=t,this.mode="product",this.facets=[],this.state="loading",this.selectedValues=[],this.items=[],this.facetValuesRemoved=!1}ngOnInit(){var e,t;const n="product"===this.mode?this.dataService.query(bi,{ids:null!==(e=this.ids)&&void 0!==e?e:[]}).mapSingle(({products:e})=>e.items.map(e=>Object.assign(Object.assign({},e),{facetValues:[...e.facetValues]}))):this.dataService.query(Ci,{ids:null!==(t=this.ids)&&void 0!==t?t:[]}).mapSingle(({productVariants:e})=>e.items.map(e=>Object.assign(Object.assign({},e),{facetValues:[...e.facetValues]})));this.subscription=n.subscribe({next:e=>{this.items=e,this.state="ready",this.changeDetectorRef.markForCheck()}})}ngOnDestroy(){var e;null===(e=this.subscription)||void 0===e||e.unsubscribe()}cancel(){this.resolveWith()}removeFacetValue(e,t){e.facetValues=e.facetValues.filter(e=>e.id!==t),this.facetValuesRemoved=!0}addFacetValues(){var e,t;const n=this.selectedValues.map(e=>e.id);return this.state="saving",("product"===this.mode?this.dataService.mutate(xi,{input:null===(e=this.items)||void 0===e?void 0:e.map(e=>({id:e.id,facetValueIds:(0,K.T)([...e.facetValues.map(e=>e.id),...n])}))}):this.dataService.mutate(Ai,{input:null===(t=this.items)||void 0===t?void 0:t.map(e=>({id:e.id,facetValueIds:(0,K.T)([...e.facetValues.map(e=>e.id),...n])}))})).subscribe(e=>{this.resolveWith(this.selectedValues)})}}wi.\u0275fac=function(e){return new(e||wi)(c.Y36(i.DoR),c.Y36(c.sBO))},wi.\u0275cmp=c.Xpm({type:wi,selectors:[["vdr-bulk-add-facet-values-dialog"]],decls:11,vars:6,consts:[["vdrDialogTitle",""],[1,"flex"],[1,"flex","center"],[1,"mr2"],[3,"facets","selectedValuesChange"],["class","table",4,"ngIf","ngIfElse"],["placeholder",""],["vdrDialogButtons",""],[1,"table"],[4,"ngFor","ngForOf"],[1,"left","align-middle"],["class","sku",4,"ngIf"],[1,"left"],[3,"facetValue","remove",4,"ngFor","ngForOf"],[1,"sku"],[3,"facetValue","remove"],[1,"loading"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(c.YNc(0,yi,2,3,"ng-template",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c.TgZ(3,"div",3),c._uU(4),c.ALo(5,"translate"),c.qZA(),c.TgZ(6,"vdr-facet-value-selector",4),c.NdJ("selectedValuesChange",function(e){return t.selectedValues=e}),c.qZA(),c.qZA(),c.qZA(),c.YNc(7,Fi,3,1,"table",5),c.YNc(8,qi,2,0,"ng-template",null,6,c.W1O),c.YNc(10,Ii,6,7,"ng-template",7)),2&e){const e=c.MAs(9);c.xp6(4),c.hij(" ",c.lcZ(5,4,"catalog.add-facet-value")," "),c.xp6(2),c.Q6J("facets",t.facets),c.xp6(1),c.Q6J("ngIf","loading"!==t.state)("ngIfElse",e)}},directives:[en.q,tn.$,m.O5,nn.n,m.sg,_t.q,E.vNO],pipes:[h.X$],styles:[".loading[_ngcontent-%COMP%]{min-height:25vh;display:flex;justify-content:center;align-items:center}.sku[_ngcontent-%COMP%]{color:var(--color-text-300)}"],changeDetection:0});const ki={location:"collection-list",label:(0,a.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:e=>e.includes(i.y3$.DeleteCollection)||e.includes(i.y3$.DeleteCatalog),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const r=e.get(i.Z7U),s=e.get(i.DoR),c=e.get(i.gqp);r.dialog({title:(0,a.J)("catalog.confirm-bulk-delete-collections"),translationVars:{count:t.length},buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(e=>e?s.collection.deleteCollections((0,K.T)(t.map(e=>e.id))):x.E)).subscribe(e=>{let t=0;const r=[];for(const n of e.deleteCollections)n.result===i.PcR.DELETED?t++:n.message&&r.push(n.message);0<t&&c.success((0,a.J)("catalog.notify-bulk-delete-collections-success"),{count:t}),0<r.length&&c.error(r.join("\n")),n.refresh(),o()})}},Mi={location:"collection-list",label:(0,a.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:e=>e.includes(i.y3$.UpdateCatalog)||e.includes(i.y3$.UpdateProduct),isVisible:({injector:e})=>(0,i.SDV)(e.get(i.DoR)),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const r=e.get(i.Z7U),s=e.get(i.DoR),c=e.get(i.gqp);r.fromComponent(vi,{size:"md",locals:{}}).pipe((0,T.w)(e=>e?s.collection.assignCollectionsToChannel({collectionIds:t.map(e=>e.id),channelId:e.id}).pipe((0,pt.h)(e)):x.E)).subscribe(e=>{c.success((0,a.J)("catalog.assign-collections-to-channel-success"),{count:t.length,channelCode:e.code}),o()})}},_i={location:"collection-list",label:(0,a.J)("catalog.remove-from-channel"),requiresPermission:e=>e.includes(i.y3$.UpdateChannel)||e.includes(i.y3$.UpdateProduct),getTranslationVars:({injector:e})=>(0,i.PDO)(e.get(i.DoR)),icon:"layers",iconClass:"is-warning",isVisible:({injector:e})=>(0,i._Nz)(e.get(i.DoR)),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const r=e.get(i.Z7U),s=e.get(i.DoR),c=e.get(i.gqp),l=s.client.userStatus().mapSingle(({userStatus:e})=>e.activeChannelId);(0,Bt.D)((0,i.PDO)(e.get(i.DoR))).pipe((0,T.w)(({channelCode:e})=>r.dialog({title:(0,a.J)("catalog.remove-from-channel"),translationVars:{channelCode:e},buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.remove"),returnValue:!0}]})),(0,T.w)(e=>e?l.pipe((0,T.w)(e=>e?s.collection.removeCollectionsFromChannel({channelId:e,collectionIds:t.map(e=>e.id)}):x.E),(0,pt.h)(!0)):(0,S.of)(!1))).subscribe(e=>{e&&(o(),c.success((0,a.J)("catalog.notify-remove-collections-from-channel-success"),{count:t.length}),n.refresh())})}};function Ji(e,t){1&e&&c._UZ(0,"clr-icon",32)}function Li(e,t){1&e&&c._UZ(0,"clr-icon",33)}function Ui(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",29),c.NdJ("click",function(){c.CHM(e);const t=c.oxw().$implicit;return c.oxw().toggleExpanded(t)}),c.YNc(1,Ji,1,0,"clr-icon",30),c.YNc(2,Li,1,0,"clr-icon",31),c.qZA()}if(2&e){const e=c.oxw().$implicit,t=c.oxw();c.Q6J("disabled",t.expandAll),c.xp6(1),c.Q6J("ngIf",!e.expanded&&!t.expandAll),c.xp6(1),c.Q6J("ngIf",e.expanded||t.expandAll)}}function Vi(e,t){1&e&&c._UZ(0,"div",34)}function Ni(e,t){1&e&&(c.TgZ(0,"vdr-chip"),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"catalog.private")))}function Si(e,t){1&e&&(c.TgZ(0,"div",35),c._UZ(1,"clr-icon",36),c.qZA())}const $i=function(e){return{parentId:e}},Di=function(e){return["./","create",e]};function Qi(e,t){if(1&e&&(c.TgZ(0,"a",37),c._UZ(1,"clr-icon",38),c._uU(2),c.ALo(3,"translate"),c.qZA()),2&e){const e=c.oxw().$implicit;c.Q6J("routerLink",c.VKq(6,Di,c.VKq(4,$i,e.id))),c.xp6(2),c.hij(" ",c.lcZ(3,2,"catalog.create-new-collection")," ")}}function Yi(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",21),c.NdJ("click",function(){const t=c.CHM(e).$implicit,n=c.oxw().$implicit;return c.oxw().move(n,t.id)}),c.ALo(1,"async"),c.TgZ(2,"div",39),c.TgZ(3,"div",40),c._UZ(4,"clr-icon",41),c.qZA(),c.TgZ(5,"div",42),c._uU(6),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,n=c.oxw(2);c.Q6J("disabled",!c.lcZ(1,2,n.hasUpdatePermission$)),c.xp6(6),c.hij(" ",e.path," ")}}function ji(e,t){if(1&e&&c._UZ(0,"vdr-collection-tree-node",43),2&e){const e=c.oxw().$implicit,t=c.oxw();c.Q6J("expandAll",t.expandAll)("collectionTree",e)("activeCollectionId",t.activeCollectionId)("selectionManager",t.selectionManager)}}const Ei=function(e){return{contents:e}},Gi=function(e){return["./",e]},Hi=function(e){return["/catalog/collections/",e]},Bi=function(){return["UpdateCatalog","UpdateCollection"]},Ri=function(){return["CreateCatalog","CreateCollection"]};function zi(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",3),c.TgZ(1,"div",4),c.TgZ(2,"div"),c.TgZ(3,"input",5),c.NdJ("click",function(t){const n=c.CHM(e).$implicit;return c.oxw().selectionManager.toggleSelection(n,t)}),c.qZA(),c.qZA(),c.TgZ(4,"div",6),c.YNc(5,Ui,3,3,"button",7),c.YNc(6,Vi,1,0,"ng-template",null,8,c.W1O),c._uU(8),c.qZA(),c._UZ(9,"div",9),c.YNc(10,Ni,3,3,"vdr-chip",10),c.TgZ(11,"a",11),c._UZ(12,"clr-icon",12),c._uU(13),c.ALo(14,"translate"),c.qZA(),c.TgZ(15,"a",13),c._UZ(16,"clr-icon",14),c._uU(17),c.ALo(18,"translate"),c.qZA(),c.YNc(19,Si,2,0,"div",15),c.TgZ(20,"vdr-dropdown"),c.TgZ(21,"button",16),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw().getMoveListItems(t)}),c._UZ(22,"clr-icon",17),c.qZA(),c.TgZ(23,"vdr-dropdown-menu",18),c.YNc(24,Qi,4,8,"a",19),c._UZ(25,"div",20),c.TgZ(26,"button",21),c.NdJ("click",function(){const t=c.CHM(e),n=t.$implicit,o=t.index;return c.oxw().moveUp(n,o)}),c.ALo(27,"async"),c._UZ(28,"clr-icon",22),c._uU(29),c.ALo(30,"translate"),c.qZA(),c.TgZ(31,"button",21),c.NdJ("click",function(){const t=c.CHM(e),n=t.$implicit,o=t.index;return c.oxw().moveDown(n,o)}),c.ALo(32,"async"),c._UZ(33,"clr-icon",23),c._uU(34),c.ALo(35,"translate"),c.qZA(),c.TgZ(36,"h4",24),c._uU(37),c.ALo(38,"translate"),c.qZA(),c.YNc(39,Yi,7,4,"button",25),c._UZ(40,"div",20),c.TgZ(41,"button",26),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw().delete(t.id)}),c.ALo(42,"async"),c._UZ(43,"clr-icon",27),c._uU(44),c.ALo(45,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.YNc(46,ji,1,4,"vdr-collection-tree-node",28),c.qZA()}if(2&e){const e=t.$implicit,n=t.index,o=c.MAs(7),i=c.oxw();c.ekj("private",e.isPrivate),c.Q6J("cdkDragData",e),c.xp6(1),c.ekj("active",e.id===i.activeCollectionId),c.Q6J("ngClass","depth-"+i.depth),c.xp6(2),c.Q6J("checked",i.selectionManager.isSelected(e)),c.xp6(2),c.Q6J("ngIf",null==e.children?null:e.children.length)("ngIfElse",o),c.xp6(3),c.hij(" ",e.name," "),c.xp6(2),c.Q6J("ngIf",e.isPrivate),c.xp6(1),c.Q6J("routerLink",c.VKq(46,Gi,c.VKq(44,Ei,e.id))),c.xp6(2),c.hij(" ",c.lcZ(14,26,"catalog.view-contents")," "),c.xp6(2),c.Q6J("routerLink",c.VKq(48,Hi,e.id)),c.xp6(2),c.hij(" ",c.lcZ(18,28,"common.edit")," "),c.xp6(2),c.Q6J("vdrIfPermissions",c.DdM(50,Bi)),c.xp6(5),c.Q6J("vdrIfPermissions",c.DdM(51,Ri)),c.xp6(2),c.Q6J("disabled",0===n||!c.lcZ(27,30,i.hasUpdatePermission$)),c.xp6(3),c.hij(" ",c.lcZ(30,32,"catalog.move-up")," "),c.xp6(2),c.Q6J("disabled",n===i.collectionTree.children.length-1||!c.lcZ(32,34,i.hasUpdatePermission$)),c.xp6(3),c.hij(" ",c.lcZ(35,36,"catalog.move-down")," "),c.xp6(3),c.Oqu(c.lcZ(38,38,"catalog.move-to")),c.xp6(2),c.Q6J("ngForOf",i.moveListItems),c.xp6(2),c.Q6J("disabled",!c.lcZ(42,40,i.hasDeletePermission$)),c.xp6(3),c.hij(" ",c.lcZ(45,42,"common.delete")," "),c.xp6(2),c.Q6J("ngIf",e.expanded||i.expandAll)}}class Ki{constructor(e,t,n,o,i,a){this.parent=e,this.root=t,this.dataService=n,this.router=o,this.route=i,this.changeDetectorRef=a,this.depth=0,this.expandAll=!1,this.moveListItems=[],e&&(this.depth=e.depth+1)}ngOnInit(){var e;this.parentName=this.collectionTree.name||"<root>";const t=this.dataService.client.userStatus().mapStream(e=>e.userStatus.permissions).pipe((0,Xe.d)(1));this.hasUpdatePermission$=t.pipe((0,r.U)(e=>e.includes(i.y3$.UpdateCatalog)||e.includes(i.y3$.UpdateCollection))),this.hasDeletePermission$=t.pipe((0,r.U)(e=>e.includes(i.y3$.DeleteCatalog)||e.includes(i.y3$.DeleteCollection))),this.subscription=null===(e=this.selectionManager)||void 0===e?void 0:e.selectionChanges$.subscribe(()=>this.changeDetectorRef.markForCheck())}ngOnChanges(e){const t=e.expandAll;t&&!0===t.previousValue&&!1===t.currentValue&&this.collectionTree.children.forEach(e=>e.expanded=!1)}ngOnDestroy(){var e;null===(e=this.subscription)||void 0===e||e.unsubscribe()}trackByFn(e,t){return t.id}toggleExpanded(e){var t,n;e.expanded=!e.expanded;let o=null!==(n=null===(t=this.route.snapshot.queryParamMap.get("expanded"))||void 0===t?void 0:t.split(","))&&void 0!==n?n:[];e.expanded?o.push(e.id):o=o.filter(t=>t!==e.id),this.router.navigate(["./"],{queryParams:{expanded:o.filter(e=>!!e).join(",")},queryParamsHandling:"merge",relativeTo:this.route})}getMoveListItems(e){this.moveListItems=this.root.getMoveListItems(e)}move(e,t){this.root.onMove({index:0,parentId:t,collectionId:e.id})}moveUp(e,t){!e.parent||this.root.onMove({index:t-1,parentId:e.parent.id,collectionId:e.id})}moveDown(e,t){!e.parent||this.root.onMove({index:t+1,parentId:e.parent.id,collectionId:e.id})}drop(e){(0,z.bA)(this.collectionTree.children,e.previousIndex,e.currentIndex),this.root.onDrop(e)}delete(e){this.root.onDelete(e)}}Ki.\u0275fac=function(e){return new(e||Ki)(c.Y36(Ki,12),c.Y36(ot),c.Y36(i.DoR),c.Y36(o.F0),c.Y36(o.gz),c.Y36(c.sBO))},Ki.\u0275cmp=c.Xpm({type:Ki,selectors:[["vdr-collection-tree-node"]],inputs:{collectionTree:"collectionTree",activeCollectionId:"activeCollectionId",expandAll:"expandAll",selectionManager:"selectionManager"},features:[c.TTD],decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],["type","checkbox","clrCheckbox","",3,"checked","click"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button",3,"click"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId","selectionManager",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],[1,"move-to-item"],[1,"move-icon"],["shape","child-arrow"],[1,"path"],[3,"expandAll","collectionTree","activeCollectionId","selectionManager"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0,1),c.NdJ("cdkDropListDropped",function(e){return t.drop(e)}),c.ALo(2,"async"),c.YNc(3,zi,47,52,"div",2),c.qZA()),2&e&&(c.Q6J("cdkDropListData",t.collectionTree)("cdkDropListDisabled",!c.lcZ(2,4,t.hasUpdatePermission$)),c.xp6(3),c.Q6J("ngForOf",t.collectionTree.children)("ngForTrackBy",t.trackByFn))},directives:[z.Wj,m.sg,E.q0d,z.Zt,m.mk,G.y,E.KKC,m.O5,o.yS,E.qvL,p.H,W.J,X.U,ee.N,te.H,Mt.Y,z.Bh,Ki],pipes:[m.Ov,h.X$],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--clr-table-bgcolor);border-radius:var(--clr-global-borderradius);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background-color:var(--clr-table-bgcolor);border-radius:var(--clr-global-borderradius);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.move-to-item[_ngcontent-%COMP%]{display:flex;white-space:normal;align-items:baseline}.move-to-item[_ngcontent-%COMP%]   .move-icon[_ngcontent-%COMP%]{flex:none;margin-right:3px}.move-to-item[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{line-height:18px}"],changeDetection:0});const Wi={location:"facet-list",label:(0,a.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:e=>e.includes(i.y3$.DeleteFacet)||e.includes(i.y3$.DeleteCatalog),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const s=e.get(i.Z7U),c=e.get(i.DoR),l=e.get(i.gqp);function d(e,n){return s.dialog({title:(0,a.J)("catalog.confirm-bulk-delete-facets"),translationVars:{count:t.length},size:n?"lg":"md",body:n,buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:n?(0,a.J)("common.force-delete"):(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(t=>t?c.facet.deleteFacets(e,!!n).pipe((0,r.U)(e=>e.deleteFacets)):(0,S.of)([])))}d((0,K.T)(t.map(e=>e.id))).pipe((0,T.w)(e=>{var n;let o=0;const a=[],s=[];let c=0;for(const r of e)r.result===i.PcR.DELETED?o++:r.message&&(a.push(r.message),s.push(null===(n=t[c])||void 0===n?void 0:n.id)),c++;return 0<s.length?d(s,a.join("\n")).pipe((0,r.U)(e=>{const t=e.filter(e=>e.result===i.PcR.DELETED).length;return o+t})):(0,S.of)(o)})).subscribe(e=>{e&&(n.refresh(),o(),l.success((0,a.J)("catalog.notify-bulk-delete-facets-success"),{count:e}))})}},Xi={location:"facet-list",label:(0,a.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:e=>e.includes(i.y3$.UpdateFacet)||e.includes(i.y3$.UpdateCatalog),isVisible:({injector:e})=>(0,i.SDV)(e.get(i.DoR)),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const r=e.get(i.Z7U),s=e.get(i.DoR),c=e.get(i.gqp);r.fromComponent(vi,{size:"md",locals:{}}).pipe((0,T.w)(e=>e?s.facet.assignFacetsToChannel({facetIds:t.map(e=>e.id),channelId:e.id}).pipe((0,pt.h)(e)):x.E)).subscribe(e=>{c.success((0,a.J)("catalog.assign-facets-to-channel-success"),{count:t.length,channelCode:e.code}),o()})}},ea={location:"facet-list",label:(0,a.J)("catalog.remove-from-channel"),getTranslationVars:({injector:e})=>(0,i.PDO)(e.get(i.DoR)),icon:"layers",iconClass:"is-warning",requiresPermission:e=>e.includes(i.y3$.UpdateFacet)||e.includes(i.y3$.UpdateCatalog),isVisible:({injector:e})=>(0,i._Nz)(e.get(i.DoR)),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const s=e.get(i.Z7U),c=e.get(i.DoR),l=e.get(i.gqp),d=c.client.userStatus().mapSingle(({userStatus:e})=>e.activeChannelId);function u(e,n){return s.dialog({title:(0,a.J)("catalog.remove-from-channel"),translationVars:{count:t.length},size:n?"lg":"md",body:n,buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:n?(0,a.J)("common.force-remove"):(0,a.J)("common.remove"),returnValue:!0}]}).pipe((0,T.w)(t=>t?d.pipe((0,T.w)(t=>t?c.facet.removeFacetsFromChannel({channelId:t,facetIds:e,force:!!n}):x.E),(0,r.U)(e=>e.removeFacetsFromChannel)):x.E))}u((0,K.T)(t.map(e=>e.id))).pipe((0,T.w)(e=>{var n;let o=t.length;const i=[],a=[];let s=0;for(const r of e)"FacetInUseError"===r.__typename&&(i.push(r.message),a.push(null===(n=t[s])||void 0===n?void 0:n.id),o--),s++;return 0<a.length?u(a,i.join("\n")).pipe((0,r.U)(e=>{const n=e.filter(e=>"FacetInUseError"===e.__typename).length;return t.length-n})):(0,S.of)(o)}),(0,T.w)(e=>e?(0,i.PDO)(c).then(({channelCode:t})=>({channelCode:t,removedCount:e})):x.E)).subscribe(({removedCount:e,channelCode:t})=>{e&&(n.refresh(),o(),l.success((0,a.J)("catalog.notify-remove-facets-from-channel-success"),{count:e,channelCode:t}))})}},ta=["optionGroupName"];function na(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",7),c.TgZ(1,"div",8),c.TgZ(2,"label"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.TgZ(5,"input",9,10),c.NdJ("ngModelChange",function(t){return c.CHM(e).$implicit.name=t})("keydown.enter",function(t){c.CHM(e);const n=c.MAs(12);return c.oxw().handleEnter(t,n)}),c.qZA(),c.qZA(),c.TgZ(7,"div",11),c.TgZ(8,"label"),c._uU(9),c.ALo(10,"translate"),c.qZA(),c.TgZ(11,"vdr-option-value-input",12,13),c.NdJ("ngModelChange",function(t){return c.CHM(e).$implicit.values=t})("ngModelChange",function(){return c.CHM(e),c.oxw().generateVariants()})("edit",function(){return c.CHM(e),c.oxw().generateVariants()}),c.qZA(),c.qZA(),c.TgZ(13,"div",14),c.TgZ(14,"button",15),c.NdJ("click",function(){const t=c.CHM(e).$implicit;return c.oxw().removeOption(t.name)}),c.ALo(15,"translate"),c._UZ(16,"clr-icon",16),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit;c.xp6(3),c.Oqu(c.lcZ(4,7,"catalog.option")),c.xp6(2),c.Q6J("ngModel",e.name),c.xp6(4),c.Oqu(c.lcZ(10,9,"catalog.option-values")),c.xp6(2),c.Q6J("ngModel",e.values)("groupName",e.name)("disabled",""===e.name),c.xp6(3),c.Q6J("title",c.lcZ(15,11,"catalog.remove-option"))}}function oa(e,t){1&e&&(c.TgZ(0,"th"),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"common.create")))}function ia(e,t){1&e&&(c.TgZ(0,"th"),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,1,"catalog.variant")))}function aa(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"td"),c.TgZ(1,"input",20),c.NdJ("change",function(){return c.CHM(e),c.oxw(2).onFormChange()})("ngModelChange",function(t){c.CHM(e);const n=c.oxw().$implicit;return c.oxw().variantFormValues[n.id].enabled=t}),c.qZA(),c.qZA()}if(2&e){const e=c.oxw().$implicit,t=c.oxw();c.xp6(1),c.Q6J("ngModel",t.variantFormValues[e.id].enabled)}}function ra(e,t){if(1&e&&(c.TgZ(0,"td"),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.hij(" ",e.values.join(" ")," ")}}function sa(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"tr"),c.YNc(1,aa,2,1,"td",5),c.YNc(2,ra,2,1,"td",5),c.TgZ(3,"td"),c.TgZ(4,"clr-input-container"),c.TgZ(5,"input",17),c.NdJ("change",function(){return c.CHM(e),c.oxw().onFormChange()})("ngModelChange",function(t){const n=c.CHM(e).$implicit;return c.oxw().variantFormValues[n.id].sku=t}),c.ALo(6,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(7,"td"),c.TgZ(8,"clr-input-container"),c.TgZ(9,"vdr-currency-input",18),c.NdJ("ngModelChange",function(t){const n=c.CHM(e).$implicit;return c.oxw().variantFormValues[n.id].price=t})("ngModelChange",function(){return c.CHM(e),c.oxw().onFormChange()}),c.qZA(),c.qZA(),c.qZA(),c.TgZ(10,"td"),c.TgZ(11,"clr-input-container"),c.TgZ(12,"input",19),c.NdJ("ngModelChange",function(t){const n=c.CHM(e).$implicit;return c.oxw().variantFormValues[n.id].stock=t})("change",function(){return c.CHM(e),c.oxw().onFormChange()}),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=t.$implicit,n=c.oxw();c.ekj("disabled",!n.variantFormValues[e.id].enabled),c.xp6(1),c.Q6J("ngIf",1<n.variants.length),c.xp6(1),c.Q6J("ngIf",1<n.variants.length),c.xp6(3),c.Q6J("ngModel",n.variantFormValues[e.id].sku)("placeholder",c.lcZ(6,9,"catalog.sku")),c.xp6(4),c.Q6J("ngModel",n.variantFormValues[e.id].price)("currencyCode",n.currencyCode),c.xp6(3),c.Q6J("ngModel",n.variantFormValues[e.id].stock)}}const ca="__DEFAULT_VARIANT__";class la{constructor(e){this.dataService=e,this.variantsChange=new c.vpe,this.optionGroups=[],this.variantFormValues={}}ngOnInit(){this.dataService.settings.getActiveChannel().single$.subscribe(e=>{this.currencyCode=e.activeChannel.currencyCode}),this.generateVariants()}addOption(){this.optionGroups.push({name:"",values:[]});const e=this.optionGroups.length-1;setTimeout(()=>{var t;const n=null===(t=this.groupNameInputs.get(e))||void 0===t?void 0:t.nativeElement;null==n||n.focus()})}removeOption(e){this.optionGroups=this.optionGroups.filter(t=>t.name!==e),this.generateVariants()}generateVariants(){const e=this.optionGroups.reduce((e,t)=>e+t.values.length,0)?this.optionGroups.map(e=>e.values.map(e=>e.name)):[[ca]];this.variants=(0,dt.generateAllCombinations)(e).map(e=>({id:e.join("|"),values:e})),this.variants.forEach(e=>{this.variantFormValues[e.id]||(this.variantFormValues[e.id]={optionValues:e.values,enabled:!0,price:this.copyFromDefault(e.id,"price",0),sku:this.copyFromDefault(e.id,"sku",""),stock:this.copyFromDefault(e.id,"stock",0)})}),this.onFormChange()}trackByFn(e,t){return t.values.join("|")}handleEnter(e,t){e.preventDefault(),e.stopPropagation(),t.focus()}onFormChange(){const e=this.variants.map(e=>this.variantFormValues[e.id]).filter(e=>e.enabled);this.variantsChange.emit({groups:this.optionGroups.map(e=>({name:e.name,values:e.values.map(e=>e.name)})),variants:e})}copyFromDefault(e,t,n){return e!==ca?this.variantFormValues[ca][t]:n}}la.\u0275fac=function(e){return new(e||la)(c.Y36(i.DoR))},la.\u0275cmp=c.Xpm({type:la,selectors:[["vdr-generate-product-variants"]],viewQuery:function(e,t){if(1&e&&c.Gf(ta,5,c.SBq),2&e){let e;c.iGM(e=c.CRH())&&(t.groupNameInputs=e)}},outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],["optionGroupName",""],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange","edit"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(e,t){1&e&&(c.YNc(0,na,17,13,"div",0),c.TgZ(1,"button",1),c.NdJ("click",function(){return t.addOption()}),c._UZ(2,"clr-icon",2),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.TgZ(5,"div",3),c.TgZ(6,"table",4),c.TgZ(7,"thead"),c.TgZ(8,"tr"),c.YNc(9,oa,3,3,"th",5),c.YNc(10,ia,3,3,"th",5),c.TgZ(11,"th"),c._uU(12),c.ALo(13,"translate"),c.qZA(),c.TgZ(14,"th"),c._uU(15),c.ALo(16,"translate"),c.qZA(),c.TgZ(17,"th"),c._uU(18),c.ALo(19,"translate"),c.qZA(),c.qZA(),c.qZA(),c.YNc(20,sa,13,11,"tr",6),c.qZA(),c.qZA()),2&e&&(c.Q6J("ngForOf",t.optionGroups),c.xp6(3),c.hij(" ",c.lcZ(4,9,"catalog.add-option"),"\n"),c.xp6(6),c.Q6J("ngIf",1<t.variants.length),c.xp6(1),c.Q6J("ngIf",1<t.variants.length),c.xp6(2),c.Oqu(c.lcZ(13,11,"catalog.sku")),c.xp6(3),c.Oqu(c.lcZ(16,13,"catalog.price")),c.xp6(3),c.Oqu(c.lcZ(19,15,"catalog.stock-on-hand")),c.xp6(2),c.Q6J("ngForOf",t.variants)("ngForTrackBy",t.trackByFn))},directives:[m.sg,E.qvL,m.O5,E.q0d,E.MgK,G.y,s.Fj,E.xRP,s.Q7,s.JJ,s.On,So,E.G55,$o.K,s.qQ,s.wV,s.Wl,E.KKC],pipes:[h.X$],styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});const da={location:"product-list",label:(0,a.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:e=>e.includes(i.y3$.DeleteProduct)||e.includes(i.y3$.DeleteCatalog),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const r=e.get(i.Z7U),s=e.get(i.DoR),c=e.get(i.gqp);r.dialog({title:(0,a.J)("catalog.confirm-bulk-delete-products"),translationVars:{count:t.length},buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.delete"),returnValue:!0}]}).pipe((0,T.w)(e=>e?s.product.deleteProducts((0,K.T)(t.map(e=>e.productId))):x.E)).subscribe(e=>{let t=0;const r=[];for(const n of e.deleteProducts)n.result===i.PcR.DELETED?t++:n.message&&r.push(n.message);0<t&&c.success((0,a.J)("catalog.notify-bulk-delete-products-success"),{count:t}),0<r.length&&c.error(r.join("\n")),n.refresh(),o()})}},ua={location:"product-list",label:(0,a.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:e=>e.includes(i.y3$.UpdateCatalog)||e.includes(i.y3$.UpdateProduct),isVisible:({injector:e})=>(0,i.SDV)(e.get(i.DoR)),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const a=e.get(i.Z7U);e.get(i.DoR),e.get(i.gqp);a.fromComponent(Pn,{size:"lg",locals:{productIds:(0,K.T)(t.map(e=>e.productId)),currentChannelIds:[]}}).subscribe(e=>{e&&o()})}},pa={location:"product-list",label:(0,a.J)("catalog.remove-from-channel"),requiresPermission:e=>e.includes(i.y3$.UpdateChannel)||e.includes(i.y3$.UpdateProduct),getTranslationVars:({injector:e})=>(0,i.PDO)(e.get(i.DoR)),icon:"layers",iconClass:"is-warning",isVisible:({injector:e})=>(0,i._Nz)(e.get(i.DoR)),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const r=e.get(i.Z7U),s=e.get(i.DoR),c=e.get(i.gqp),l=s.client.userStatus().mapSingle(({userStatus:e})=>e.activeChannelId);(0,Bt.D)((0,i.PDO)(e.get(i.DoR))).pipe((0,T.w)(({channelCode:e})=>r.dialog({title:(0,a.J)("catalog.remove-from-channel"),translationVars:{channelCode:e},buttons:[{type:"secondary",label:(0,a.J)("common.cancel")},{type:"danger",label:(0,a.J)("common.remove"),returnValue:!0}]})),(0,T.w)(e=>e?l.pipe((0,T.w)(e=>e?s.product.removeProductsFromChannel({channelId:e,productIds:t.map(e=>e.productId)}):x.E),(0,pt.h)(!0)):(0,S.of)(!1))).subscribe(e=>{e&&(o(),c.success((0,a.J)("common.notify-remove-products-from-channel-success"),{count:t.length}),setTimeout(()=>n.refresh(),1e3))})}},ga={location:"product-list",label:(0,a.J)("catalog.edit-facet-values"),icon:"tag",requiresPermission:e=>e.includes(i.y3$.UpdateCatalog)||e.includes(i.y3$.UpdateProduct),onClick:({injector:e,selection:t,hostComponent:n,clearSelection:o})=>{const r=e.get(i.Z7U),s=e.get(i.DoR),c=e.get(i.gqp),l=n.groupByProduct?"product":"variant",d="product"===l?(0,K.T)(t.map(e=>e.productId)):(0,K.T)(t.map(e=>e.productVariantId));return s.facet.getAllFacets().mapSingle(e=>e.facets.items).pipe((0,T.w)(e=>r.fromComponent(wi,{size:"xl",locals:{facets:e,mode:l,ids:d}}))).subscribe(e=>{e&&(c.success((0,a.J)("common.notify-bulk-update-success"),{count:t.length,entity:"product"===l?"Products":"ProductVariants"}),o())})}};function ma(e,t){1&e&&(c._uU(0),c.ALo(1,"translate")),2&e&&c.Oqu(c.lcZ(1,1,"catalog.update-product-option"))}const ha=function(){return["UpdateCatalog","UpdateProduct"]};function fa(e,t){if(1&e&&(c.TgZ(0,"section"),c.TgZ(1,"label"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c._UZ(4,"vdr-tabbed-custom-fields",10),c.ALo(5,"hasPermission"),c.qZA()),2&e){const e=c.oxw();c.xp6(2),c.Oqu(c.lcZ(3,4,"common.custom-fields")),c.xp6(2),c.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.customFieldsForm)("readonly",!c.lcZ(5,6,c.DdM(8,ha)))}}function va(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",11),c.NdJ("click",function(){return c.CHM(e),c.oxw().cancel()}),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"button",12),c.NdJ("click",function(){return c.CHM(e),c.oxw().update()}),c._uU(4),c.ALo(5,"translate"),c.qZA()}if(2&e){const e=c.oxw(),t=c.MAs(4),n=c.MAs(8);c.xp6(1),c.Oqu(c.lcZ(2,3,"common.cancel")),c.xp6(2),c.Q6J("disabled",t.invalid||n.invalid||t.pristine&&n.pristine&&e.customFieldsForm.pristine),c.xp6(1),c.hij(" ",c.lcZ(5,5,"catalog.update-product-option")," ")}}class Za{constructor(){this.updateVariantName=!0,this.codeInputTouched=!1}ngOnInit(){var e;const t=this.productOption.translations.find(e=>e.languageCode===this.activeLanguage);if(this.name=null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"",this.code=this.productOption.code,this.customFieldsForm=new s.cw({}),this.customFields){const e=t&&t.customFields||{};for(const t of this.customFields){const n=t.name,o="localeString"===t.type?e[n]:this.productOption.customFields[n];this.customFieldsForm.addControl(t.name,new s.NI(o))}}}update(){const e=(0,i.iSy)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(Object.assign(Object.assign({},e),{autoUpdate:this.updateVariantName}))}cancel(){this.resolveWith()}updateCode(e){!this.codeInputTouched&&!this.productOption.code&&(this.code=(0,U.U)(e,"-"))}}Za.\u0275fac=function(e){return new(e||Za)},Za.\u0275cmp=c.Xpm({type:Za,selectors:[["vdr-update-product-option-dialog"]],decls:16,vars:13,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["vdrDialogButtons",""],["entityName","ProductOption",3,"customFields","customFieldsFormGroup","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(c.YNc(0,ma,2,3,"ng-template",0),c.TgZ(1,"vdr-form-field",1),c.ALo(2,"translate"),c.TgZ(3,"input",2,3),c.NdJ("ngModelChange",function(e){return t.name=e})("input",function(e){return t.updateCode(e.target.value)}),c.qZA(),c.qZA(),c.TgZ(5,"vdr-form-field",4),c.ALo(6,"translate"),c.TgZ(7,"input",5,6),c.NdJ("ngModelChange",function(e){return t.code=e}),c.qZA(),c.qZA(),c.TgZ(9,"clr-checkbox-wrapper"),c.TgZ(10,"input",7),c.NdJ("ngModelChange",function(e){return t.updateVariantName=e}),c.qZA(),c.TgZ(11,"label"),c._uU(12),c.ALo(13,"translate"),c.qZA(),c.qZA(),c.YNc(14,fa,6,9,"section",8),c.YNc(15,va,6,7,"ng-template",9)),2&e&&(c.xp6(1),c.Q6J("label",c.lcZ(2,7,"catalog.option-name")),c.xp6(2),c.Q6J("ngModel",t.name),c.xp6(2),c.Q6J("label",c.lcZ(6,9,"common.code")),c.xp6(2),c.Q6J("ngModel",t.code),c.xp6(3),c.Q6J("ngModel",t.updateVariantName),c.xp6(2),c.Oqu(c.lcZ(13,11,"catalog.auto-update-option-variant-name")),c.xp6(2),c.Q6J("ngIf",t.customFields.length))},directives:[en.q,j.h,G.y,s.Fj,s.Q7,s.JJ,s.On,s.c5,E.PEh,s.Wl,E.KKC,E.MgK,m.O5,nn.n,qe.y],pipes:[h.X$,M.j],styles:[""],changeDetection:0});var ba=n(97861);const Ca=function(e){return{rate:e}};function xa(e,t){if(1&e&&(c.TgZ(0,"div",2),c._uU(1),c.ALo(2,"translate"),c.ALo(3,"async"),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.hij(" ",c.xi3(2,1,"catalog.price-includes-tax-at",c.VKq(6,Ca,c.lcZ(3,4,e.taxRate$))),"\n")}}const Aa=function(e,t){return{price:e,rate:t}};function ya(e,t){if(1&e&&(c.TgZ(0,"div",2),c._uU(1),c.ALo(2,"translate"),c.ALo(3,"localeCurrency"),c.ALo(4,"async"),c.ALo(5,"async"),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.hij(" ",c.xi3(2,1,"catalog.price-with-tax-in-default-zone",c.WLB(11,Aa,c.xi3(3,4,c.lcZ(4,7,e.grossPrice$),e.currencyCode),c.lcZ(5,9,e.taxRate$))),"\n")}}class Pa{constructor(e){this.dataService=e,this.priceChange$=new b.X(0),this.taxCategoryIdChange$=new b.X("")}ngOnInit(){const e=this.dataService.settings.getTaxRatesSimple(999,0,"cache-first").mapStream(e=>e.taxRates.items),t=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(e=>e.activeChannel);this.taxRate$=(0,C.aj)(t,e,this.taxCategoryIdChange$).pipe((0,r.U)(([e,t,n])=>{const o=e.defaultTaxZone;if(!o)return 0;const i=t.find(e=>e.zone.id===o.id&&e.category.id===n);return i?i.value:0})),this.grossPrice$=(0,C.aj)(this.taxRate$,this.priceChange$).pipe((0,r.U)(([e,t])=>Math.round(t*((100+e)/100))))}ngOnChanges(e){"price"in e&&this.priceChange$.next(e.price.currentValue),"taxCategoryId"in e&&this.taxCategoryIdChange$.next(e.taxCategoryId.currentValue)}}Pa.\u0275fac=function(e){return new(e||Pa)(c.Y36(i.DoR))},Pa.\u0275cmp=c.Xpm({type:Pa,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[c.TTD],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(e,t){1&e&&(c.TgZ(0,"label",0),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.YNc(3,xa,4,8,"div",1),c.YNc(4,ya,6,14,"div",1)),2&e&&(c.xp6(1),c.Oqu(c.lcZ(2,3,"catalog.taxes")),c.xp6(2),c.Q6J("ngIf",t.priceIncludesTax),c.xp6(1),c.Q6J("ngIf",!t.priceIncludesTax))},directives:[E.MgK,m.O5],pipes:[h.X$,m.Ov,dn.k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0});var Ta=n(49435),Oa=n(6444),Fa=n(84209),qa=n(11185),Ia=n(75850);function wa(e,t){1&e&&(c.TgZ(0,"clr-toggle-wrapper"),c._UZ(1,"input",45),c.TgZ(2,"label"),c._uU(3),c.ALo(4,"translate"),c.qZA(),c.qZA()),2&e&&(c.xp6(3),c.Oqu(c.lcZ(4,1,"common.enabled")))}function ka(e,t){if(1&e&&(c.TgZ(0,"option",48),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("value",e.id),c.xp6(1),c.hij(" ",e.name," ")}}function Ma(e,t){if(1&e&&(c.TgZ(0,"clr-select-container"),c.TgZ(1,"label"),c._uU(2),c.ALo(3,"translate"),c.qZA(),c.TgZ(4,"select",46),c.YNc(5,ka,2,2,"option",47),c.qZA(),c.qZA()),2&e){const e=c.oxw(3);c.xp6(2),c.Oqu(c.lcZ(3,2,"catalog.tax-category")),c.xp6(3),c.Q6J("ngForOf",e.taxCategories)}}function _a(e,t){if(1&e&&(c.TgZ(0,"label",29),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"div",49),c._uU(4),c.qZA()),2&e){const e=c.oxw().ngIf,t=c.oxw(2);c.xp6(1),c.Oqu(c.lcZ(2,2,"catalog.tax-category")),c.xp6(3),c.hij(" ",t.getTaxCategoryName(e)," ")}}function Ja(e,t){if(1&e&&(c._UZ(0,"vdr-currency-input",50),c.ALo(1,"hasPermission")),2&e){const e=c.oxw(2).$implicit,t=c.oxw();c.Q6J("currencyCode",e.currencyCode)("readonly",!c.lcZ(1,2,t.updatePermission))}}function La(e,t){if(1&e&&(c._UZ(0,"vdr-currency-input",51),c.ALo(1,"hasPermission")),2&e){const e=c.oxw(2).$implicit,t=c.oxw();c.Q6J("currencyCode",e.currencyCode)("readonly",!c.lcZ(1,2,t.updatePermission))}}function Ua(e,t){if(1&e&&(c.TgZ(0,"clr-select-container"),c.TgZ(1,"label"),c._uU(2),c.ALo(3,"translate"),c._UZ(4,"vdr-help-tooltip",27),c.ALo(5,"translate"),c.qZA(),c.TgZ(6,"select",52),c.TgZ(7,"option",48),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.TgZ(10,"option",48),c._uU(11),c.ALo(12,"translate"),c.qZA(),c.TgZ(13,"option",48),c._uU(14),c.ALo(15,"translate"),c.qZA(),c.qZA(),c.qZA()),2&e){const e=c.oxw(3);c.xp6(2),c.hij("",c.lcZ(3,8,"catalog.track-inventory")," "),c.xp6(2),c.Q6J("content",c.lcZ(5,10,"catalog.track-inventory-tooltip")),c.xp6(3),c.Q6J("value",e.GlobalFlag.TRUE),c.xp6(1),c.hij(" ",c.lcZ(9,12,"catalog.track-inventory-true")," "),c.xp6(2),c.Q6J("value",e.GlobalFlag.FALSE),c.xp6(1),c.hij(" ",c.lcZ(12,14,"catalog.track-inventory-false")," "),c.xp6(2),c.Q6J("value",e.GlobalFlag.INHERIT),c.xp6(1),c.hij(" ",c.lcZ(15,16,"catalog.track-inventory-inherit")," ")}}function Va(e,t){if(1&e&&(c.TgZ(0,"section",53),c._UZ(1,"vdr-tabbed-custom-fields",54),c.ALo(2,"hasPermission"),c.qZA()),2&e){const e=c.oxw().ngIf,t=c.oxw(2);c.xp6(1),c.Q6J("customFields",t.customFields)("compact",!0)("customFieldsFormGroup",e.get("customFields"))("readonly",!c.lcZ(2,4,t.updatePermission))}}function Na(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-chip",58),c.NdJ("iconClick",function(){const t=c.CHM(e).$implicit;return c.oxw(4).editOption(t)}),c.ALo(1,"hasPermission"),c.TgZ(2,"span",59),c._uU(3),c.qZA(),c._uU(4),c.qZA()}if(2&e){const e=t.$implicit,n=c.oxw(4);c.Q6J("colorFrom",n.optionGroupName(e.groupId))("invert",!0)("icon",c.lcZ(1,5,n.updatePermission)&&"pencil"),c.xp6(3),c.Oqu(n.optionGroupName(e.groupId)),c.xp6(1),c.hij(" ",n.optionName(e)," ")}}const Sa=function(){return["./","options"]};function $a(e,t){if(1&e&&(c.TgZ(0,"div"),c.TgZ(1,"div",55),c.YNc(2,Na,5,7,"vdr-chip",56),c.ALo(3,"sort"),c.TgZ(4,"a",57),c._uU(5),c.ALo(6,"translate"),c.qZA(),c.qZA(),c.qZA()),2&e){const e=c.oxw(2).$implicit;c.xp6(2),c.Q6J("ngForOf",c.xi3(3,3,e.options,"groupId")),c.xp6(2),c.Q6J("routerLink",c.DdM(8,Sa)),c.xp6(1),c.hij("",c.lcZ(6,6,"catalog.edit-options"),"...")}}function Da(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-facet-value-chip",60),c.NdJ("remove",function(){const t=c.CHM(e).$implicit,n=c.oxw(2).$implicit;return c.oxw().removeFacetValue(n,t.id)}),c.ALo(1,"hasPermission"),c.qZA()}if(2&e){const e=t.$implicit,n=c.oxw(3);c.Q6J("facetValue",e)("removable",c.lcZ(1,2,n.updatePermission))}}function Qa(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-facet-value-chip",60),c.NdJ("remove",function(){const t=c.CHM(e).$implicit,n=c.oxw(2).$implicit;return c.oxw().removeFacetValue(n,t.id)}),c.ALo(1,"hasPermission"),c.qZA()}if(2&e){const e=t.$implicit,n=c.oxw(3);c.Q6J("facetValue",e)("removable",c.lcZ(1,2,n.updatePermission))}}function Ya(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",61),c.NdJ("click",function(){c.CHM(e);const t=c.oxw(2).$implicit;return c.oxw().selectFacetValueClick.emit([t.id])}),c._UZ(1,"clr-icon",62),c._uU(2),c.ALo(3,"translate"),c.qZA()}2&e&&(c.xp6(2),c.hij(" ",c.lcZ(3,1,"catalog.add-facets")," "))}const ja=function(e){return{channelCode:e}};function Ea(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"vdr-chip",69),c.NdJ("iconClick",function(){c.CHM(e);const t=c.oxw().$implicit,n=c.oxw(4).$implicit;return c.oxw().removeFromChannel.emit({channelId:t.id,variant:n})}),c.ALo(1,"translate"),c._UZ(2,"vdr-channel-badge",70),c._uU(3),c.ALo(4,"channelCodeToLabel"),c.qZA()}if(2&e){const e=c.oxw().$implicit;c.Q6J("title",c.xi3(1,3,"catalog.remove-from-channel",c.VKq(8,ja,e.code))),c.xp6(2),c.Q6J("channelCode",e.code),c.xp6(1),c.hij(" ",c.lcZ(4,6,e.code)," ")}}function Ga(e,t){if(1&e&&(c.ynx(0),c.YNc(1,Ea,5,10,"vdr-chip",68),c.BQk()),2&e){const e=t.$implicit,n=c.oxw(5);c.xp6(1),c.Q6J("ngIf",!n.isDefaultChannel(e.code))}}function Ha(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",13),c.TgZ(1,"div",64),c.YNc(2,Ga,2,1,"ng-container",65),c.TgZ(3,"button",66),c.NdJ("click",function(){c.CHM(e);const t=c.oxw(3).$implicit;return c.oxw().assignToChannel.emit(t)}),c._UZ(4,"clr-icon",67),c._uU(5),c.ALo(6,"translate"),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=c.oxw(3).$implicit;c.xp6(2),c.Q6J("ngForOf",e.channels),c.xp6(3),c.hij(" ",c.lcZ(6,2,"catalog.assign-to-channel")," ")}}function Ba(e,t){1&e&&(c.ynx(0),c.YNc(1,Ha,7,4,"div",63),c.BQk())}function Ra(e,t){if(1&e){const e=c.EpF();c.ynx(0,4),c.TgZ(1,"div",5),c.TgZ(2,"div",6),c.TgZ(3,"vdr-title-input",7),c.ALo(4,"hasPermission"),c.TgZ(5,"clr-input-container"),c._UZ(6,"input",8),c.ALo(7,"hasPermission"),c.ALo(8,"translate"),c.qZA(),c.qZA(),c.TgZ(9,"vdr-title-input",9),c.ALo(10,"hasPermission"),c.TgZ(11,"clr-input-container"),c._UZ(12,"input",10),c.ALo(13,"hasPermission"),c.ALo(14,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(15,"div",11),c.YNc(16,wa,5,3,"clr-toggle-wrapper",12),c.qZA(),c.qZA(),c.TgZ(17,"div",13),c.TgZ(18,"div",14),c.TgZ(19,"div",15),c.TgZ(20,"vdr-assets",16),c.NdJ("change",function(t){c.CHM(e);const n=c.oxw().$implicit;return c.oxw().onAssetChange(n.id,t)}),c.qZA(),c.qZA(),c.TgZ(21,"div",17),c.TgZ(22,"div",18),c.TgZ(23,"div",19),c.TgZ(24,"div",20),c.YNc(25,Ma,6,4,"clr-select-container",21),c.YNc(26,_a,5,4,"ng-template",null,22,c.W1O),c.qZA(),c.TgZ(28,"div",23),c.TgZ(29,"clr-input-container"),c.TgZ(30,"label"),c._uU(31),c.ALo(32,"translate"),c.qZA(),c.YNc(33,Ja,2,4,"vdr-currency-input",24),c.YNc(34,La,2,4,"vdr-currency-input",25),c.qZA(),c.qZA(),c._UZ(35,"vdr-variant-price-detail",26),c.qZA(),c.TgZ(36,"div",19),c.YNc(37,Ua,16,18,"clr-select-container",12),c.TgZ(38,"clr-input-container"),c.TgZ(39,"label"),c._uU(40),c.ALo(41,"translate"),c._UZ(42,"vdr-help-tooltip",27),c.ALo(43,"translate"),c.qZA(),c._UZ(44,"input",28),c.ALo(45,"hasPermission"),c.qZA(),c.TgZ(46,"div"),c.TgZ(47,"label",29),c._uU(48),c.ALo(49,"translate"),c._UZ(50,"vdr-help-tooltip",27),c.ALo(51,"translate"),c.qZA(),c.TgZ(52,"div",30),c._uU(53),c.qZA(),c.qZA(),c.TgZ(54,"div"),c.TgZ(55,"label",29),c._uU(56),c.ALo(57,"translate"),c._UZ(58,"vdr-help-tooltip",27),c.ALo(59,"translate"),c.qZA(),c.TgZ(60,"div",30),c._uU(61),c.qZA(),c.qZA(),c.qZA(),c.TgZ(62,"div",19),c.TgZ(63,"div",31),c.TgZ(64,"label",29),c._uU(65),c.ALo(66,"translate"),c._UZ(67,"vdr-help-tooltip",27),c.ALo(68,"translate"),c.qZA(),c.TgZ(69,"div",32),c.TgZ(70,"clr-input-container"),c._UZ(71,"input",33),c.ALo(72,"hasPermission"),c.qZA(),c.TgZ(73,"clr-toggle-wrapper"),c._UZ(74,"input",34),c.ALo(75,"hasPermission"),c.TgZ(76,"label"),c._uU(77),c.ALo(78,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(79,"div",35),c.TgZ(80,"div",19),c.YNc(81,Va,3,6,"section",36),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(82,"div",13),c.TgZ(83,"div",37),c._UZ(84,"vdr-entity-info",38),c.YNc(85,$a,7,9,"div",39),c._UZ(86,"div",40),c.TgZ(87,"div",41),c.YNc(88,Da,2,4,"vdr-facet-value-chip",42),c.YNc(89,Qa,2,4,"vdr-facet-value-chip",42),c.YNc(90,Ya,4,3,"button",43),c.qZA(),c.qZA(),c.qZA(),c.YNc(91,Ba,2,0,"ng-container",44),c.BQk()}if(2&e){const e=t.ngIf,n=c.MAs(27),o=c.oxw().$implicit,i=c.oxw();let a;c.Q6J("formGroup",e),c.xp6(3),c.Q6J("readonly",!c.lcZ(4,55,i.updatePermission)),c.xp6(3),c.Q6J("readonly",!c.lcZ(7,57,i.updatePermission))("placeholder",c.lcZ(8,59,"catalog.sku")),c.xp6(3),c.Q6J("readonly",!c.lcZ(10,61,i.updatePermission)),c.xp6(3),c.Q6J("readonly",!c.lcZ(13,63,i.updatePermission))("placeholder",c.lcZ(14,65,"common.name")),c.xp6(4),c.Q6J("vdrIfPermissions",i.updatePermission),c.xp6(4),c.Q6J("compact",!0)("assets",(null==i.pendingAssetChanges[o.id]?null:i.pendingAssetChanges[o.id].assets)||o.assets)("featuredAsset",(null==i.pendingAssetChanges[o.id]?null:i.pendingAssetChanges[o.id].featuredAsset)||o.featuredAsset)("updatePermissions",i.updatePermission),c.xp6(5),c.Q6J("vdrIfPermissions",i.updatePermission)("vdrIfPermissionsElse",n),c.xp6(6),c.Oqu(c.lcZ(32,67,"catalog.price")),c.xp6(2),c.Q6J("ngIf",!i.channelPriceIncludesTax),c.xp6(1),c.Q6J("ngIf",i.channelPriceIncludesTax),c.xp6(1),c.Q6J("price",e.get("price").value)("currencyCode",o.currencyCode)("priceIncludesTax",i.channelPriceIncludesTax)("taxCategoryId",e.get("taxCategoryId").value),c.xp6(2),c.Q6J("vdrIfPermissions",i.updatePermission),c.xp6(3),c.hij("",c.lcZ(41,69,"catalog.stock-on-hand")," "),c.xp6(2),c.Q6J("content",c.lcZ(43,71,"catalog.stock-on-hand-tooltip")),c.xp6(2),c.ekj("inventory-untracked",i.inventoryIsNotTracked(e)),c.Q6J("min",i.getStockOnHandMinValue(e))("readonly",!c.lcZ(45,73,i.updatePermission))("vdrDisabled",i.inventoryIsNotTracked(e)),c.xp6(2),c.ekj("inventory-untracked",i.inventoryIsNotTracked(e)),c.xp6(2),c.hij("",c.lcZ(49,75,"catalog.stock-allocated")," "),c.xp6(2),c.Q6J("content",c.lcZ(51,77,"catalog.stock-allocated-tooltip")),c.xp6(3),c.hij(" ",o.stockAllocated," "),c.xp6(1),c.ekj("inventory-untracked",i.inventoryIsNotTracked(e)),c.xp6(2),c.hij("",c.lcZ(57,79,"catalog.stock-saleable")," "),c.xp6(2),c.Q6J("content",c.lcZ(59,81,"catalog.stock-saleable-tooltip")),c.xp6(3),c.hij(" ",i.getSaleableStockLevel(o)," "),c.xp6(2),c.ekj("inventory-untracked",i.inventoryIsNotTracked(e)),c.xp6(2),c.Oqu(c.lcZ(66,83,"catalog.out-of-stock-threshold")),c.xp6(2),c.Q6J("content",c.lcZ(68,85,"catalog.out-of-stock-threshold-tooltip")),c.xp6(4),c.Q6J("formControl",e.get("outOfStockThreshold"))("readonly",!c.lcZ(72,87,i.updatePermission))("vdrDisabled",!1!==(null==(a=e.get("useGlobalOutOfStockThreshold"))?null:a.value)||i.inventoryIsNotTracked(e)),c.xp6(3),c.Q6J("vdrDisabled",!c.lcZ(75,89,i.updatePermission)||i.inventoryIsNotTracked(e)),c.xp6(3),c.AsE("",c.lcZ(78,91,"catalog.use-global-value")," (",i.globalOutOfStockThreshold,")"),c.xp6(4),c.Q6J("ngIf",i.customFields.length),c.xp6(3),c.Q6J("entity",o),c.xp6(1),c.Q6J("ngIf",o.options.length),c.xp6(3),c.Q6J("ngForOf",i.existingFacetValues(o)),c.xp6(1),c.Q6J("ngForOf",i.pendingFacetValues(o)),c.xp6(1),c.Q6J("vdrIfPermissions",i.updatePermission)}}function za(e,t){if(1&e&&(c.TgZ(0,"div",2),c.YNc(1,Ra,92,93,"ng-container",3),c.qZA()),2&e){const e=t.$implicit,n=c.oxw();let o,i;c.ekj("disabled",!(null!=(o=n.formGroupMap.get(e.id))&&null!=(i=o.get("enabled"))&&i.value)),c.xp6(1),c.Q6J("ngIf",n.formGroupMap.get(e.id))}}const Ka=function(){return{itemsPerPage:10,currentPage:1}};class Wa{constructor(e,t,n){this.changeDetector=e,this.modalService=t,this.dataService=n,this.assignToChannel=new c.vpe,this.removeFromChannel=new c.vpe,this.assetChange=new c.vpe,this.selectionChange=new c.vpe,this.selectFacetValueClick=new c.vpe,this.updateProductOption=new c.vpe,this.selectedVariantIds=[],this.formGroupMap=new Map,this.GlobalFlag=i.TvZ,this.updatePermission=[i.y3$.UpdateCatalog,i.y3$.UpdateProduct]}ngOnInit(){this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe(({globalSettings:e})=>{this.globalTrackInventory=e.trackInventory,this.globalOutOfStockThreshold=e.outOfStockThreshold,this.changeDetector.markForCheck()}),this.subscription=this.formArray.valueChanges.subscribe(()=>this.changeDetector.markForCheck()),this.subscription.add(this.formArray.valueChanges.pipe((0,r.U)(e=>e.length),(0,A.b)(1),(0,ve.x)()).subscribe(()=>{this.buildFormGroupMap()})),this.buildFormGroupMap()}ngOnChanges(e){"facets"in e&&e.facets.currentValue&&(this.facetValues=(0,i.k2u)(this.facets))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}isDefaultChannel(e){return e===Ht.z$}trackById(e,t){return t.id}inventoryIsNotTracked(e){var t;const n=null===(t=e.get("trackInventory"))||void 0===t?void 0:t.value;return n===i.TvZ.FALSE||n===i.TvZ.INHERIT&&!1===this.globalTrackInventory}getTaxCategoryName(e){const t=e.get(["taxCategoryId"]);if(t&&this.taxCategories){const e=this.taxCategories.find(e=>e.id===t.value);return e?e.name:""}return""}getStockOnHandMinValue(e){var t,n;return(null===(t=e.get("useGlobalOutOfStockThreshold"))||void 0===t?void 0:t.value)?this.globalOutOfStockThreshold:null===(n=e.get("outOfStockThreshold"))||void 0===n?void 0:n.value}getSaleableStockLevel(e){const t=e.useGlobalOutOfStockThreshold?this.globalOutOfStockThreshold:e.outOfStockThreshold;return e.stockOnHand-e.stockAllocated-t}areAllSelected(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}onAssetChange(e,t){this.assetChange.emit(Object.assign({variantId:e},t));const n=this.variants.findIndex(t=>t.id===e);this.formArray.at(n).markAsDirty()}toggleSelectAll(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map(e=>e.id),this.selectionChange.emit(this.selectedVariantIds)}toggleSelectVariant(e){const t=this.selectedVariantIds.indexOf(e);-1<t?this.selectedVariantIds.splice(t,1):this.selectedVariantIds.push(e),this.selectionChange.emit(this.selectedVariantIds)}optionGroupName(e){var t;const n=this.optionGroups.find(t=>t.id===e);if(n)return(null!==(t=null==n?void 0:n.translations.find(e=>e.languageCode===this.activeLanguage))&&void 0!==t?t:n.translations[0]).name}optionName(e){var t;return(null!==(t=e.translations.find(e=>e.languageCode===this.activeLanguage))&&void 0!==t?t:e.translations[0]).name}pendingFacetValues(e){if(this.facets){const t=this.getFacetValueIds(e.id),n=e.facetValues.map(e=>e.id);return t.filter(e=>!n.includes(e)).map(e=>this.facetValues.find(t=>t.id===e)).filter(dt.notNullOrUndefined)}return[]}existingFacetValues(e){return[...this.getFacetValueIds(e.id)].filter(t=>e.facetValues.map(e=>e.id).includes(t)).map(t=>e.facetValues.find(e=>e.id===t)).filter(dt.notNullOrUndefined)}removeFacetValue(e,t){const n=this.formGroupMap.get(e.id);if(n){const e=n.value.facetValueIds.filter(e=>e!==t);n.patchValue({facetValueIds:e}),n.markAsDirty()}}isVariantSelected(e){return-1<this.selectedVariantIds.indexOf(e)}editOption(e){this.modalService.fromComponent(Za,{size:"md",locals:{productOption:e,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe(e=>{e&&this.updateProductOption.emit(e)})}buildFormGroupMap(){this.formGroupMap.clear();for(const e of this.formArray.controls)this.formGroupMap.set(e.value.id,e);this.changeDetector.markForCheck()}getFacetValueIds(e){var t;return(null===(t=this.formGroupMap.get(e))||void 0===t?void 0:t.value).facetValueIds}}Wa.\u0275fac=function(e){return new(e||Wa)(c.Y36(c.sBO),c.Y36(i.Z7U),c.Y36(i.DoR))},Wa.\u0275cmp=c.Xpm({type:Wa,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",paginationConfig:"paginationConfig",channelPriceIncludesTax:"channelPriceIncludesTax",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage",pendingAssetChanges:"pendingAssetChanges"},outputs:{assignToChannel:"assignToChannel",removeFromChannel:"removeFromChannel",assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[c.TTD],decls:3,vars:6,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","updatePermissions","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],[3,"content"],["clrInput","","type","number","step","1","formControlName","stockOnHand",3,"min","readonly","vdrDisabled"],[1,"clr-control-label"],[1,"value"],[1,"out-of-stock-threshold-wrapper"],[1,"flex"],["clrInput","","type","number",3,"formControl","readonly","vdrDisabled"],["type","checkbox","clrToggle","","name","useGlobalOutOfStockThreshold","formControlName","useGlobalOutOfStockThreshold",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"tax-category-label"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"],["clrSelect","","name","options","formControlName","trackInventory"],["formGroupName","customFields"],["entityName","ProductVariant",3,"customFields","compact","customFieldsFormGroup","readonly"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[1,"btn","btn-link","btn-sm",3,"routerLink"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],["class","card-block",4,"vdrIfDefaultChannelActive"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"title","iconClick",4,"ngIf"],["icon","times-circle",3,"title","iconClick"],[3,"channelCode"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.YNc(1,za,2,3,"div",1),c.ALo(2,"paginate"),c.qZA()),2&e&&(c.xp6(1),c.Q6J("ngForOf",c.xi3(2,2,t.variants,t.paginationConfig||c.DdM(5,Ka)))("ngForTrackBy",t.trackById))},directives:[m.sg,E.q0d,m.O5,s.JL,s.sg,ba.G,E.G55,G.y,s.Fj,E.xRP,s.JJ,s.u,p.H,he,E.MgK,Pa,Ta.o,s.wV,s.qQ,H.x,s.oH,E.PEh,s.Wl,E.KKC,d.V,Oa.u,E.dTv,s.EJ,E.otW,s.YN,s.Kr,$o.K,s.x0,qe.y,o.yS,Mt.Y,_t.q,E.qvL,Fa.M,qa.n],pipes:[k._s,M.j,h.X$,Ia.U,ln.E],styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%]{margin-right:12px}.with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s;min-height:330px}.variant-container.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media screen and (min-width: 768px){.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:var(--color-grey-400)}.variant-container[_ngcontent-%COMP%]     .clr-control-container{width:100%}.channel-assignment[_ngcontent-%COMP%]{justify-content:flex-end;flex-wrap:wrap;max-height:110px;overflow-y:auto}.channel-assignment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-left:24px}.inventory-untracked[_ngcontent-%COMP%]{opacity:.5}"],changeDetection:0});var Xa=n(47846);function er(e,t){if(1&e&&(c.ynx(0),c.TgZ(1,"th"),c._uU(2),c.qZA(),c.BQk()),2&e){const e=t.$implicit;c.xp6(2),c.Oqu(e.name)}}function tr(e,t){if(1&e&&(c._UZ(0,"img",18),c.ALo(1,"assetPreview")),2&e){const e=t.ngIf;c.Q6J("src",c.xi3(1,1,e,"tiny"),c.LSH)}}function nr(e,t){1&e&&(c.TgZ(0,"div",19),c._UZ(1,"clr-icon",20),c.qZA())}function or(e,t){if(1&e&&(c.ynx(0),c.TgZ(1,"td",5),c.ALo(2,"stringToColor"),c._uU(3),c.qZA(),c.BQk()),2&e){const e=t.$implicit,n=c.oxw().ngIf,o=c.oxw(2);c.xp6(1),c.Udp("color",c.lcZ(2,5,o.optionGroupName(e.groupId))),c.ekj("disabled",!n.get("enabled").value),c.xp6(2),c.hij(" ",e.name," ")}}function ir(e,t){if(1&e&&(c._UZ(0,"vdr-currency-input",21),c.ALo(1,"hasPermission")),2&e){const e=c.oxw(2).$implicit,t=c.oxw();c.Q6J("currencyCode",e.currencyCode)("readonly",!c.lcZ(1,2,t.updatePermission))}}function ar(e,t){if(1&e&&(c._UZ(0,"vdr-currency-input",22),c.ALo(1,"hasPermission")),2&e){const e=c.oxw(2).$implicit,t=c.oxw();c.Q6J("currencyCode",e.currencyCode)("readonly",!c.lcZ(1,2,t.updatePermission))}}function rr(e,t){if(1&e&&(c.ynx(0,4),c.TgZ(1,"td",5),c.TgZ(2,"div",6),c.TgZ(3,"div",7),c.YNc(4,tr,2,4,"img",8),c.YNc(5,nr,2,0,"ng-template",null,9,c.W1O),c.qZA(),c.qZA(),c.qZA(),c.TgZ(7,"td",5),c.TgZ(8,"clr-input-container"),c._UZ(9,"input",10),c.ALo(10,"hasPermission"),c.ALo(11,"translate"),c.qZA(),c.qZA(),c.TgZ(12,"td",5),c.TgZ(13,"clr-input-container"),c._UZ(14,"input",11),c.ALo(15,"hasPermission"),c.ALo(16,"translate"),c.qZA(),c.qZA(),c.YNc(17,or,4,7,"ng-container",1),c.ALo(18,"sort"),c.TgZ(19,"td",12),c.TgZ(20,"clr-input-container"),c.YNc(21,ir,2,4,"vdr-currency-input",13),c.YNc(22,ar,2,4,"vdr-currency-input",14),c.qZA(),c.qZA(),c.TgZ(23,"td",15),c.TgZ(24,"clr-input-container"),c._UZ(25,"input",16),c.ALo(26,"hasPermission"),c.qZA(),c.qZA(),c.TgZ(27,"td",15),c.TgZ(28,"clr-toggle-wrapper"),c._UZ(29,"input",17),c.ALo(30,"hasPermission"),c.qZA(),c.qZA(),c.BQk()),2&e){const e=t.ngIf,n=c.MAs(6),o=c.oxw().$implicit,i=c.oxw();c.Q6J("formGroup",e),c.xp6(1),c.ekj("disabled",!e.get("enabled").value),c.xp6(3),c.Q6J("ngIf",i.getFeaturedAsset(o))("ngIfElse",n),c.xp6(3),c.ekj("disabled",!e.get("enabled").value),c.xp6(2),c.Q6J("readonly",!c.lcZ(10,24,i.updatePermission))("placeholder",c.lcZ(11,26,"common.name")),c.xp6(3),c.ekj("disabled",!e.get("enabled").value),c.xp6(2),c.Q6J("readonly",!c.lcZ(15,28,i.updatePermission))("placeholder",c.lcZ(16,30,"catalog.sku")),c.xp6(3),c.Q6J("ngForOf",c.xi3(18,32,o.options,"groupId")),c.xp6(2),c.ekj("disabled",!e.get("enabled").value),c.xp6(2),c.Q6J("ngIf",!i.channelPriceIncludesTax),c.xp6(1),c.Q6J("ngIf",i.channelPriceIncludesTax),c.xp6(1),c.ekj("disabled",!e.get("enabled").value),c.xp6(2),c.Q6J("readonly",!c.lcZ(26,35,i.updatePermission)),c.xp6(2),c.ekj("disabled",!e.get("enabled").value),c.xp6(2),c.Q6J("vdrDisabled",!c.lcZ(30,37,i.updatePermission))}}function sr(e,t){if(1&e&&(c.TgZ(0,"tr"),c.YNc(1,rr,31,39,"ng-container",3),c.qZA()),2&e){const e=t.$implicit,n=c.oxw();c.xp6(1),c.Q6J("ngIf",n.formGroupMap.get(e.id))}}class cr{constructor(e){this.changeDetector=e,this.formGroupMap=new Map,this.updatePermission=[i.y3$.UpdateCatalog,i.y3$.UpdateProduct]}ngOnInit(){this.subscription=this.formArray.valueChanges.pipe((0,r.U)(e=>e.length),(0,A.b)(1),(0,ve.x)()).subscribe(()=>{this.buildFormGroupMap()}),this.buildFormGroupMap()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}trackByFn(e,t){return null!=t.id?t.id:e}getFeaturedAsset(e){var t;return(null===(t=this.pendingAssetChanges[e.id])||void 0===t?void 0:t.featuredAsset)||e.featuredAsset}optionGroupName(e){const t=this.optionGroups.find(t=>t.id===e);return t&&t.name}buildFormGroupMap(){this.formGroupMap.clear();for(const e of this.formArray.controls)this.formGroupMap.set(e.value.id,e);this.changeDetector.markForCheck()}}cr.\u0275fac=function(e){return new(e||cr)(c.Y36(c.sBO))},cr.\u0275cmp=c.Xpm({type:cr,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",paginationConfig:"paginationConfig",channelPriceIncludesTax:"channelPriceIncludesTax",optionGroups:"optionGroups",pendingAssetChanges:"pendingAssetChanges"},decls:24,vars:24,consts:[[1,"table"],[4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf","ngIfElse"],["placeholder",""],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"]],template:function(e,t){1&e&&(c.TgZ(0,"table",0),c.TgZ(1,"thead"),c.TgZ(2,"tr"),c._UZ(3,"th"),c.TgZ(4,"th"),c._uU(5),c.ALo(6,"translate"),c.qZA(),c.TgZ(7,"th"),c._uU(8),c.ALo(9,"translate"),c.qZA(),c.YNc(10,er,3,1,"ng-container",1),c.ALo(11,"sort"),c.TgZ(12,"th"),c._uU(13),c.ALo(14,"translate"),c.qZA(),c.TgZ(15,"th"),c._uU(16),c.ALo(17,"translate"),c.qZA(),c.TgZ(18,"th"),c._uU(19),c.ALo(20,"translate"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(21,"tbody"),c.YNc(22,sr,2,1,"tr",2),c.ALo(23,"paginate"),c.qZA(),c.qZA()),2&e&&(c.xp6(5),c.Oqu(c.lcZ(6,8,"common.name")),c.xp6(3),c.Oqu(c.lcZ(9,10,"catalog.sku")),c.xp6(2),c.Q6J("ngForOf",c.xi3(11,12,t.optionGroups,"id")),c.xp6(3),c.Oqu(c.lcZ(14,15,"catalog.price")),c.xp6(3),c.Oqu(c.lcZ(17,17,"catalog.stock-on-hand")),c.xp6(3),c.Oqu(c.lcZ(20,19,"common.enabled")),c.xp6(3),c.Q6J("ngForOf",c.xi3(23,21,t.variants,t.paginationConfig))("ngForTrackBy",t.trackByFn))},directives:[m.sg,E.q0d,m.O5,s.JL,s.sg,E.G55,G.y,s.Fj,E.xRP,s.JJ,s.u,s.qQ,s.wV,E.PEh,s.Wl,E.KKC,H.x,E.qvL,$o.K],pipes:[h.X$,Ia.U,k._s,M.j,ne.M,Xa.s],styles:[".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0});var lr=n(32930);class dr{constructor(e){this.bulkActionRegistryService=e,e.registerBulkAction(ga),e.registerBulkAction(ua),e.registerBulkAction(pa),e.registerBulkAction(da),e.registerBulkAction(Xi),e.registerBulkAction(ea),e.registerBulkAction(Wi),e.registerBulkAction(Mi),e.registerBulkAction(_i),e.registerBulkAction(ki)}}dr.\u0275fac=function(e){return new(e||dr)(c.LFG(i._4w))},dr.\u0275mod=c.oAB({type:dr}),dr.\u0275inj=c.cJS({imports:[[i.m81,o.Bz.forChild(ai)]]}),c.B6R(no,[l.Kk,l.BN,d.V,p.H,E.PEh,G.y,s.Wl,E.KKC,s.JJ,s.oH,E.MgK,Y.S,l.mz,u.W,m.O5,s._Y,s.JL,s.sg,E.gKI,E.dl,E.S4y,E.Iq$,E.Qs7,E.tam,E.UkA,s.x0,Oa.u,Fa.M,lr.J,m.sg,Mt.Y,qa.n,E.qvL,j.h,s.Fj,s.u,qe.y,R.C,he,_t.q,la,o.yS,I.w,w.L,cr,Wa],[m.Ov,h.X$,ln.E,M.j]),c.B6R(ot,[m.O5,Ki,z.Fd],[])}}]);
//# sourceMappingURL=227-es2015.7c2e48ef3720d724daf5.js.map